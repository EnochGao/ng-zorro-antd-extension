import{a as Jn,b as oa,c as er}from"./chunk-DTSBX4ZR.js";import{a as sa,b as aa}from"./chunk-E44YRNLJ.js";import{j as Si}from"./chunk-UEO2LBLP.js";import"./chunk-MFMZI4JG.js";import"./chunk-IF2R5RDT.js";import"./chunk-JLUX7UYA.js";import"./chunk-H66T5NKY.js";import"./chunk-752J3DYG.js";import"./chunk-M44EP7KY.js";import"./chunk-MRWPMGKP.js";import"./chunk-KBDRVQ2X.js";import"./chunk-ZVWL25YR.js";import"./chunk-MWDUSRTL.js";import{a as ta,b as ia,d as na,e as ra}from"./chunk-TU4Q4OVA.js";import"./chunk-K66H5K2I.js";import"./chunk-VCG636SY.js";import{$b as Zs,Ab as qn,Ba as Ks,Bb as Yn,Cc as Qn,Da as tn,Eb as Kn,Ec as yi,Ed as ea,Fb as Zn,Gb as bi,Hb as vi,Ib as Ht,Jb as k,Ka as Ae,La as ni,Lb as Ut,Lc as kt,Rb as xi,Sb as ct,Ya as Vt,ab as qe,ca as Wn,gc as Qs,la as Et,ma as Gn,na as jn,ob as N,pb as F,pc as Js,qb as he,ua as ti,ub as Xn,va as ii,xb as It}from"./chunk-OGFJLPPA.js";import{e as od,f as sd}from"./chunk-UKNGC2Y4.js";var Wc=od((vb,$c)=>{"use strict";var dd=Object.create,Mn=Object.defineProperty,pd=Object.getOwnPropertyDescriptor,fd=Object.getOwnPropertyNames,gd=Object.getPrototypeOf,md=Object.prototype.hasOwnProperty,wd=(e,t,i)=>t in e?Mn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[t]=i,bd=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),vd=(e,t)=>{for(var i in t)Mn(e,i,{get:t[i],enumerable:!0})},Bl=(e,t,i,n)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of fd(t))!md.call(e,r)&&r!==i&&Mn(e,r,{get:()=>t[r],enumerable:!(n=pd(t,r))||n.enumerable});return e},xd=(e,t,i)=>(i=e!=null?dd(gd(e)):{},Bl(t||!e||!e.__esModule?Mn(i,"default",{value:e,enumerable:!0}):i,e)),yd=e=>Bl(Mn({},"__esModule",{value:!0}),e),u=(e,t,i)=>wd(e,typeof t!="symbol"?t+"":t,i),Sd=bd((e,t)=>{var i=-1,n=1,r=0;function o(y,I,C,E,O){if(y===I)return y?[[r,y]]:[];if(C!=null){var R=ge(y,I,C);if(R)return R}var M=l(y,I),H=y.substring(0,M);y=y.substring(M),I=I.substring(M),M=p(y,I);var j=y.substring(y.length-M);y=y.substring(0,y.length-M),I=I.substring(0,I.length-M);var K=s(y,I);return H&&K.unshift([r,H]),j&&K.push([r,j]),L(K,O),E&&f(K),K}function s(y,I){var C;if(!y)return[[n,I]];if(!I)return[[i,y]];var E=y.length>I.length?y:I,O=y.length>I.length?I:y,R=E.indexOf(O);if(R!==-1)return C=[[n,E.substring(0,R)],[r,O],[n,E.substring(R+O.length)]],y.length>I.length&&(C[0][0]=C[2][0]=i),C;if(O.length===1)return[[i,y],[n,I]];var M=d(y,I);if(M){var H=M[0],j=M[1],K=M[2],Q=M[3],Z=M[4],ve=o(H,K),re=o(j,Q);return ve.concat([[r,Z]],re)}return a(y,I)}function a(y,I){for(var C=y.length,E=I.length,O=Math.ceil((C+E)/2),R=O,M=2*O,H=new Array(M),j=new Array(M),K=0;K<M;K++)H[K]=-1,j[K]=-1;H[R+1]=0,j[R+1]=0;for(var Q=C-E,Z=Q%2!==0,ve=0,re=0,ae=0,Ce=0,Se=0;Se<O;Se++){for(var ee=-Se+ve;ee<=Se-re;ee+=2){var G=R+ee,le;ee===-Se||ee!==Se&&H[G-1]<H[G+1]?le=H[G+1]:le=H[G-1]+1;for(var V=le-ee;le<C&&V<E&&y.charAt(le)===I.charAt(V);)le++,V++;if(H[G]=le,le>C)re+=2;else if(V>E)ve+=2;else if(Z){var ie=R+Q-ee;if(ie>=0&&ie<M&&j[ie]!==-1){var ne=C-j[ie];if(le>=ne)return h(y,I,le,V)}}}for(var de=-Se+ae;de<=Se-Ce;de+=2){var ie=R+de,ne;de===-Se||de!==Se&&j[ie-1]<j[ie+1]?ne=j[ie+1]:ne=j[ie-1]+1;for(var tt=ne-de;ne<C&&tt<E&&y.charAt(C-ne-1)===I.charAt(E-tt-1);)ne++,tt++;if(j[ie]=ne,ne>C)Ce+=2;else if(tt>E)ae+=2;else if(!Z){var G=R+Q-de;if(G>=0&&G<M&&H[G]!==-1){var le=H[G],V=R+le-G;if(ne=C-ne,le>=ne)return h(y,I,le,V)}}}}return[[i,y],[n,I]]}function h(y,I,C,E){var O=y.substring(0,C),R=I.substring(0,E),M=y.substring(C),H=I.substring(E),j=o(O,R),K=o(M,H);return j.concat(K)}function l(y,I){if(!y||!I||y.charAt(0)!==I.charAt(0))return 0;for(var C=0,E=Math.min(y.length,I.length),O=E,R=0;C<O;)y.substring(R,O)==I.substring(R,O)?(C=O,R=C):E=O,O=Math.floor((E-C)/2+C);return B(y.charCodeAt(O-1))&&O--,O}function c(y,I){var C=y.length,E=I.length;if(C==0||E==0)return 0;C>E?y=y.substring(C-E):C<E&&(I=I.substring(0,C));var O=Math.min(C,E);if(y==I)return O;for(var R=0,M=1;;){var H=y.substring(O-M),j=I.indexOf(H);if(j==-1)return R;M+=j,(j==0||y.substring(O-M)==I.substring(0,M))&&(R=M,M++)}}function p(y,I){if(!y||!I||y.slice(-1)!==I.slice(-1))return 0;for(var C=0,E=Math.min(y.length,I.length),O=E,R=0;C<O;)y.substring(y.length-O,y.length-R)==I.substring(I.length-O,I.length-R)?(C=O,R=C):E=O,O=Math.floor((E-C)/2+C);return D(y.charCodeAt(y.length-O))&&O--,O}function d(y,I){var C=y.length>I.length?y:I,E=y.length>I.length?I:y;if(C.length<4||E.length*2<C.length)return null;function O(re,ae,Ce){for(var Se=re.substring(Ce,Ce+Math.floor(re.length/4)),ee=-1,G="",le,V,ie,ne;(ee=ae.indexOf(Se,ee+1))!==-1;){var de=l(re.substring(Ce),ae.substring(ee)),tt=p(re.substring(0,Ce),ae.substring(0,ee));G.length<tt+de&&(G=ae.substring(ee-tt,ee)+ae.substring(ee,ee+de),le=re.substring(0,Ce-tt),V=re.substring(Ce+de),ie=ae.substring(0,ee-tt),ne=ae.substring(ee+de))}return G.length*2>=re.length?[le,V,ie,ne,G]:null}var R=O(C,E,Math.ceil(C.length/4)),M=O(C,E,Math.ceil(C.length/2)),H;if(!R&&!M)return null;M?R?H=R[4].length>M[4].length?R:M:H=M:H=R;var j,K,Q,Z;y.length>I.length?(j=H[0],K=H[1],Q=H[2],Z=H[3]):(Q=H[0],Z=H[1],j=H[2],K=H[3]);var ve=H[4];return[j,K,Q,Z,ve]}function f(y){for(var I=!1,C=[],E=0,O=null,R=0,M=0,H=0,j=0,K=0;R<y.length;)y[R][0]==r?(C[E++]=R,M=j,H=K,j=0,K=0,O=y[R][1]):(y[R][0]==n?j+=y[R][1].length:K+=y[R][1].length,O&&O.length<=Math.max(M,H)&&O.length<=Math.max(j,K)&&(y.splice(C[E-1],0,[i,O]),y[C[E-1]+1][0]=n,E--,E--,R=E>0?C[E-1]:-1,M=0,H=0,j=0,K=0,O=null,I=!0)),R++;for(I&&L(y),S(y),R=1;R<y.length;){if(y[R-1][0]==i&&y[R][0]==n){var Q=y[R-1][1],Z=y[R][1],ve=c(Q,Z),re=c(Z,Q);ve>=re?(ve>=Q.length/2||ve>=Z.length/2)&&(y.splice(R,0,[r,Z.substring(0,ve)]),y[R-1][1]=Q.substring(0,Q.length-ve),y[R+1][1]=Z.substring(ve),R++):(re>=Q.length/2||re>=Z.length/2)&&(y.splice(R,0,[r,Q.substring(0,re)]),y[R-1][0]=n,y[R-1][1]=Z.substring(0,Z.length-re),y[R+1][0]=i,y[R+1][1]=Q.substring(re),R++),R++}R++}}var g=/[^a-zA-Z0-9]/,m=/\s/,v=/[\r\n]/,b=/\n\r?\n$/,w=/^\r?\n\r?\n/;function S(y){function I(re,ae){if(!re||!ae)return 6;var Ce=re.charAt(re.length-1),Se=ae.charAt(0),ee=Ce.match(g),G=Se.match(g),le=ee&&Ce.match(m),V=G&&Se.match(m),ie=le&&Ce.match(v),ne=V&&Se.match(v),de=ie&&re.match(b),tt=ne&&ae.match(w);return de||tt?5:ie||ne?4:ee&&!le&&V?3:le||V?2:ee||G?1:0}for(var C=1;C<y.length-1;){if(y[C-1][0]==r&&y[C+1][0]==r){var E=y[C-1][1],O=y[C][1],R=y[C+1][1],M=p(E,O);if(M){var H=O.substring(O.length-M);E=E.substring(0,E.length-M),O=H+O.substring(0,O.length-M),R=H+R}for(var j=E,K=O,Q=R,Z=I(E,O)+I(O,R);O.charAt(0)===R.charAt(0);){E+=O.charAt(0),O=O.substring(1)+R.charAt(0),R=R.substring(1);var ve=I(E,O)+I(O,R);ve>=Z&&(Z=ve,j=E,K=O,Q=R)}y[C-1][1]!=j&&(j?y[C-1][1]=j:(y.splice(C-1,1),C--),y[C][1]=K,Q?y[C+1][1]=Q:(y.splice(C+1,1),C--))}C++}}function L(y,I){y.push([r,""]);for(var C=0,E=0,O=0,R="",M="",H;C<y.length;){if(C<y.length-1&&!y[C][1]){y.splice(C,1);continue}switch(y[C][0]){case n:O++,M+=y[C][1],C++;break;case i:E++,R+=y[C][1],C++;break;case r:var j=C-O-E-1;if(I){if(j>=0&&q(y[j][1])){var K=y[j][1].slice(-1);if(y[j][1]=y[j][1].slice(0,-1),R=K+R,M=K+M,!y[j][1]){y.splice(j,1),C--;var Q=j-1;y[Q]&&y[Q][0]===n&&(O++,M=y[Q][1]+M,Q--),y[Q]&&y[Q][0]===i&&(E++,R=y[Q][1]+R,Q--),j=Q}}if(W(y[C][1])){var K=y[C][1].charAt(0);y[C][1]=y[C][1].slice(1),R+=K,M+=K}}if(C<y.length-1&&!y[C][1]){y.splice(C,1);break}if(R.length>0||M.length>0){R.length>0&&M.length>0&&(H=l(M,R),H!==0&&(j>=0?y[j][1]+=M.substring(0,H):(y.splice(0,0,[r,M.substring(0,H)]),C++),M=M.substring(H),R=R.substring(H)),H=p(M,R),H!==0&&(y[C][1]=M.substring(M.length-H)+y[C][1],M=M.substring(0,M.length-H),R=R.substring(0,R.length-H)));var Z=O+E;R.length===0&&M.length===0?(y.splice(C-Z,Z),C=C-Z):R.length===0?(y.splice(C-Z,Z,[n,M]),C=C-Z+1):M.length===0?(y.splice(C-Z,Z,[i,R]),C=C-Z+1):(y.splice(C-Z,Z,[i,R],[n,M]),C=C-Z+2)}C!==0&&y[C-1][0]===r?(y[C-1][1]+=y[C][1],y.splice(C,1)):C++,O=0,E=0,R="",M="";break}}y[y.length-1][1]===""&&y.pop();var ve=!1;for(C=1;C<y.length-1;)y[C-1][0]===r&&y[C+1][0]===r&&(y[C][1].substring(y[C][1].length-y[C-1][1].length)===y[C-1][1]?(y[C][1]=y[C-1][1]+y[C][1].substring(0,y[C][1].length-y[C-1][1].length),y[C+1][1]=y[C-1][1]+y[C+1][1],y.splice(C-1,1),ve=!0):y[C][1].substring(0,y[C+1][1].length)==y[C+1][1]&&(y[C-1][1]+=y[C+1][1],y[C][1]=y[C][1].substring(y[C+1][1].length)+y[C+1][1],y.splice(C+1,1),ve=!0)),C++;ve&&L(y,I)}function B(y){return y>=55296&&y<=56319}function D(y){return y>=56320&&y<=57343}function W(y){return D(y.charCodeAt(0))}function q(y){return B(y.charCodeAt(y.length-1))}function ye(y){for(var I=[],C=0;C<y.length;C++)y[C][1].length>0&&I.push(y[C]);return I}function Xe(y,I,C,E){return q(y)||W(E)?null:ye([[r,y],[i,I],[n,C],[r,E]])}function ge(y,I,C){var E=typeof C=="number"?{index:C,length:0}:C.oldRange,O=typeof C=="number"?null:C.newRange,R=y.length,M=I.length;if(E.length===0&&(O===null||O.length===0)){var H=E.index,j=y.slice(0,H),K=y.slice(H),Q=O?O.index:null;e:{var Z=H+M-R;if(Q!==null&&Q!==Z||Z<0||Z>M)break e;var ve=I.slice(0,Z),re=I.slice(Z);if(re!==K)break e;var ae=Math.min(H,Z),Ce=j.slice(0,ae),Se=ve.slice(0,ae);if(Ce!==Se)break e;var ee=j.slice(ae),G=ve.slice(ae);return Xe(Ce,ee,G,K)}e:{if(Q!==null&&Q!==H)break e;var le=H,ve=I.slice(0,le),re=I.slice(le);if(ve!==j)break e;var V=Math.min(R-le,M-le),ie=K.slice(K.length-V),ne=re.slice(re.length-V);if(ie!==ne)break e;var ee=K.slice(0,K.length-V),G=re.slice(0,re.length-V);return Xe(j,ee,G,ie)}}if(E.length>0&&O&&O.length===0)e:{var Ce=y.slice(0,E.index),ie=y.slice(E.index+E.length),ae=Ce.length,V=ie.length;if(M<ae+V)break e;var Se=I.slice(0,ae),ne=I.slice(M-V);if(Ce!==Se||ie!==ne)break e;var ee=y.slice(ae,R-V),G=I.slice(ae,M-V);return Xe(Ce,ee,G,ie)}return null}function me(y,I,C,E){return o(y,I,C,E,!0)}me.INSERT=n,me.DELETE=i,me.EQUAL=r,t.exports=me}),_l={};vd(_l,{CoreViewer:()=>Hc,HOOKS:()=>Lr,Navigation:()=>Uc,PageProgression:()=>hs,PageSide:()=>Dl,PageViewMode:()=>W0,Profiler:()=>$l,ReadyState:()=>Vl,UserAgentBaseCss:()=>Bh,UserAgentPageCss:()=>Oh,UserAgentTocCss:()=>_h,UserAgentXml:()=>Lh,ValidationTxt:()=>Rh,VivliostylePolyfillCss:()=>Mh,VivliostyleViewportCss:()=>Ah,VivliostyleViewportScreenCss:()=>Fh,ZoomType:()=>$0,getHooksForName:()=>xt,isDebug:()=>kn,pageProgressionOf:()=>zl,plugin:()=>Ed,printHTML:()=>j0,profile:()=>Td,profiler:()=>st,registerHook:()=>mt,removeHook:()=>Ul,setDebug:()=>Ml});$c.exports=yd(_l);var kn=!1;function Ml(e){kn=e}var hs=(e=>(e.LTR="ltr",e.RTL="rtl",e))(hs||{});function zl(e){switch(e){case"ltr":return"ltr";case"rtl":return"rtl";default:throw new Error(`unknown PageProgression: ${e}`)}}var Dl=(e=>(e.LEFT="left",e.RIGHT="right",e))(Dl||{}),Vl=(e=>(e.LOADING="loading",e.INTERACTIVE="interactive",e.COMPLETE="complete",e))(Vl||{}),Hl=(e=>(e[e.DEBUG=1]="DEBUG",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e))(Hl||{}),Cd=class{constructor(e){this.opt_console=e,u(this,"listeners",{})}consoleDebug(e){this.opt_console?this.opt_console.debug?this.opt_console.debug(...e):this.opt_console.log(...e):console.debug(...e)}consoleInfo(e){this.opt_console?this.opt_console.info?this.opt_console.info(...e):this.opt_console.log(...e):console.info(...e)}consoleWarn(e){this.opt_console?this.opt_console.warn?this.opt_console.warn(...e):this.opt_console.log(...e):console.warn(...e)}consoleError(e){this.opt_console?this.opt_console.error?this.opt_console.error(...e):this.opt_console.log(...e):console.error(...e)}triggerListeners(e,t){let i=this.listeners[e];i&&i(t)}addListener(e,t){this.listeners[e]=t}debug(...e){let t=tr(arguments);this.consoleDebug(ir(t)),this.triggerListeners(1,t)}info(...e){let t=tr(arguments);this.consoleInfo(ir(t)),this.triggerListeners(2,t)}warn(...e){let t=tr(arguments);this.consoleWarn(ir(t)),this.triggerListeners(3,t)}error(...e){let t=tr(arguments);this.consoleError(ir(t)),this.triggerListeners(4,t)}};function tr(e){let t=Array.from(e),i=null;return t[0]instanceof Error&&(i=t.shift()),{error:i,messages:t}}function ir(e){let t=e.error,i=t&&(t.frameTrace||t.stack),n=[].concat(e.messages);return t&&(n.length>0&&(n=n.concat([`
`])),n=n.concat([t.toString()]),i&&(n=n.concat([`
`]).concat(i))),n}var U=new Cd,Lr=(e=>(e.SIMPLE_PROPERTY="SIMPLE_PROPERTY",e.PREPROCESS_SINGLE_DOCUMENT="PREPROCESS_SINGLE_DOCUMENT",e.PREPROCESS_TEXT_CONTENT="PREPROCESS_TEXT_CONTENT",e.PREPROCESS_ELEMENT_STYLE="PREPROCESS_ELEMENT_STYLE",e.POLYFILLED_INHERITED_PROPS="POLYFILLED_INHERITED_PROPS",e.CONFIGURATION="CONFIGURATION",e.RESOLVE_TEXT_NODE_BREAKER="RESOLVE_TEXT_NODE_BREAKER",e.RESOLVE_FORMATTING_CONTEXT="RESOLVE_FORMATTING_CONTEXT",e.RESOLVE_LAYOUT_PROCESSOR="RESOLVE_LAYOUT_PROCESSOR",e.POST_LAYOUT_BLOCK="POST_LAYOUT_BLOCK",e))(Lr||{}),vr={};function mt(e,t,i){if(!Lr[e])U.warn(new Error(`Skipping unknown plugin hook '${e}'.`));else{let n=vr[e];n||(n=vr[e]=[]),i?n.unshift(t):n.push(t)}}function Ul(e,t){if(!Lr[e])U.warn(new Error(`Ignoring unknown plugin hook '${e}'.`));else{let i=vr[e];if(i){let n=i.indexOf(t);n>=0&&i.splice(n,1)}}}function xt(e){return vr[e]||[]}var Ed={registerHook:mt,removeHook:Ul},$l=class{constructor(e){this.performanceInstance=e,u(this,"timestamps",{}),u(this,"registerTiming"),u(this,"registerStartTiming"),u(this,"registerEndTiming"),this.registerTiming=Ei,this.registerStartTiming=this.registerStartTiming=Ei,this.registerEndTiming=this.registerEndTiming=Ei}forceRegisterStartTiming(e,t){Jr.call(this,e,"start",t)}forceRegisterEndTiming(e,t){Jr.call(this,e,"end",t)}printTimings(){let e=this.timestamps,t="";Object.keys(e).forEach(i=>{let n=e[i],r=n.length;for(let o=0;o<r;o++){let s=n[o];t+=i,r>1&&(t+=`(${o})`),t+=` => start: ${s.start}, end: ${s.end}, duration: ${s.end-s.start}
`}}),U.info(t)}disable(){this.registerTiming=Ei,this.registerStartTiming=this.registerStartTiming=Ei,this.registerEndTiming=this.registerEndTiming=Ei}enable(){this.registerTiming=Jr,this.registerStartTiming=this.registerStartTiming=ha,this.registerEndTiming=this.registerEndTiming=kd}isEnabled(){return this.registerStartTiming===ha}};function Ei(){}function Jr(e,t,i){i||(i=this.performanceInstance.now());let n=this.timestamps[e];n||(n=this.timestamps[e]=[]);let r,o=n.length;for(let s=o-1;s>=0&&(r=n[s],!(r&&!r[t]));s--)r=null;r||(r={},n.push(r)),r[t]=i}function ha(e,t){this.registerTiming(e,"start",t)}function kd(e,t){this.registerTiming(e,"end",t)}var Pd={now:Date.now},Nd=window&&window.performance,st=new $l(Nd||Pd);st.forceRegisterStartTiming("load_vivliostyle");var Td={profiler:{registerStartTiming:st.registerStartTiming,registerEndTiming:st.registerEndTiming,printTimings:st.printTimings,disable:st.disable,enable:st.enable}},mo=new RegExp("^[\\s\\p{Zs}\\p{P}\\p{Mn}]*[\\p{L}\\p{N}]\\p{Mn}*(?:[\\s\\p{Zs}]*\\p{P}\\p{Mn}*)*","u"),At="data-adapt-eloff",Id={};function us(e){return JSON.parse(e)}function Lt(e){let t=e.match(/^([^#]*)/);return t?t[1]:e}function Fd(e){let t=e.match(/^([^#?]*)/);return t?t[1]:e}var Ui=window.location.href;function ua(e){Ui=e}var pi=window.location.href;function ca(e){pi=e}function Te(e,t){if(/^data:/i.test(t))return e||t;if(!t||e.match(/^\w{2,}:/))return e.toLowerCase().match("^javascript:")?"#":(e.match(/^\w{2,}:\/\/[^\/]+$/)&&(e=`${e}/`),e);t.match(/^\w{2,}:\/\/[^\/]+$/)&&(t=`${t}/`);let i;if(e.match(/^\/\//))return i=t.match(/^(\w{2,}:)\/\//),i?i[1]+e:e;if(e.match(/^\//))return i=t.match(/^(\w{2,}:\/\/[^\/]+)\//),i?i[1]+e:e;if(e.match(/^\.(\/|$)/)&&(e=e.substr(2)),t=Fd(t),e.match(/^#/))return t+e;let n=t.lastIndexOf("/");if(n<0)return e;let r=t.substr(0,n+1)+e,o="";for(i=r.match(/^([^?#]*)([?#].*)$/),i&&(r=i[1],o=i[2]);n=r.indexOf("/../"),!(n<=0);){let s=r.lastIndexOf("/",n-1);if(s<=0)break;r=r.substr(0,s)+r.substr(n+3)}return r.replace(/\/(\.\/)+/g,"/")+o}function Pn(e){let t;return(t=/^(https?:)\/\/github\.com\/([^/]+\/[^/]+)\/(blob\/|tree\/|raw\/)?(.*)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/${t[2]}/${t[3]?"":"master/"}${t[4]}`:(t=/^(https?:)\/\/www\.aozora\.gr\.jp\/(cards\/[^/]+\/files\/[^/.]+\.html)$/.exec(e))?e=`${t[1]}//raw.githubusercontent.com/aozorabunko/aozorabunko/master/${t[2]}`:(t=/^(https?:)\/\/gist\.github\.com\/([^/]+\/\w+)(\/|$)(raw(\/|$))?(.*)$/.exec(e))?e=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[6]}`:(t=/^(https?:)\/\/(?:[^/.]+\.)?jsbin\.com\/(?!(?:blog|help)\b)(\w+)((\/\d+)?).*$/.exec(e))&&(e=`${t[1]}//output.jsbin.com/${t[2]}${t[3]}/`),e}function da(e){return e==null?e:e.toString()}var Ad=class{constructor(){u(this,"queue",[null])}length(){return this.queue.length-1}add(e){let t=this.queue.length;for(;t>1;){let i=Math.floor(t/2),n=this.queue[i];if(n.compare(e)>0){this.queue[t]=e;return}this.queue[t]=n,t=i}this.queue[1]=e}peek(){return this.queue[1]}remove(){let e=this.queue[1],t=this.queue.pop(),i=this.queue.length;if(i>1){let n=1;for(;;){let r=n*2;if(r>=i)break;if(this.queue[r].compare(t)>0)r+1<i&&this.queue[r+1].compare(this.queue[r])>0&&r++;else if(r+1<i&&this.queue[r+1].compare(t)>0)r++;else break;this.queue[n]=this.queue[r],n=r}this.queue[n]=t}return e}},Rd=["","-webkit-","-moz-"],Pi={};function eo(e,t){return CSS.supports(e+t,"unset")}function Wl(e){let t=Pi[e];if(t||t===null)return t;switch(e){case"behavior":case"template":case"ua-list-item-count":case"x-first-pseudo":return Pi[e]=null,null;case"text-combine-upright":if(eo("-webkit-","text-combine")&&!eo("","text-combine-upright"))return Pi[e]=["-webkit-text-combine"],["-webkit-text-combine"];break}for(let i of Rd)if(eo(i,e))return t=[i+e],Pi[e]=t,t;return U.warn("Property not supported by the browser: ",e),Pi[e]=null,null}function T(e,t,i){let n=e?.style;if(!n)return;if(t.startsWith("--")){n.setProperty(t,i||" ");return}let r=Wl(t);if(r)for(let o of r){switch(o){case"-webkit-text-combine":switch(i){case"all":i="horizontal";break}break;case"text-combine-upright":switch(i){case"all":n.setProperty("text-indent","0");break}break}n.setProperty(o,i)}}function Ai(e,t,i){try{let n=Pi[t];return e.style.getPropertyValue(n?n[0]:t)}catch{}return i||""}function wo(e){let t=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","lang");return!t&&e.namespaceURI=="http://www.w3.org/1999/xhtml"&&(t=e.getAttribute("lang")),t}var Bt=class{constructor(){u(this,"list",[])}append(e){return this.list.push(e),this}clear(){this.list=[]}toString(){let e=this.list.join("");return this.list=[e],e}};function Gl(e){return`\\${e.charCodeAt(0).toString(16)} `}function Xt(e){return e.replace(/[^-_a-zA-Z0-9\u0080-\uFFFF]/g,Gl)}function zn(e){return e.replace(/[\u0000-\u001F"\\]/g,Gl)}function pa(e){return e.replace(/[\s+&?=#\u007F-\uFFFF]+/g,encodeURIComponent)}function fa(e){return!!e.match(/^[a-zA-Z\u009E\u009F\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u024F\u037B-\u037D\u0386\u0388-\u0482\u048A-\u0527]$/)}function Ld(e,t){return t=typeof t=="string"?t:"\\u",t+(65536|e.charCodeAt(0)).toString(16).substr(1)}function jl(e,t){function i(n){return Ld(n,t)}return e.replace(/[^-a-zA-Z0-9_]/g,i)}function Wt(e){return jl(e)}function Od(e,t){return t=typeof t=="string"?t:"\\u",e.indexOf(t)===0?String.fromCharCode(parseInt(e.substring(t.length),16)):e}function Bd(e,t){t=typeof t=="string"?t:"\\u";function i(r){return Od(r,t)}let n=new RegExp(`${Wt(t)}[0-9a-fA-F]{4}`,"g");return e.replace(n,i)}function Yt(e,t){let i=0,n=e;for(;;){if(i<=n,i==0||t(i-1),n==e||t(n),i==n)return i;let r=i+n>>1;t(r)?n=r:i=r+1}}function Xl(e,t){return e-t}function ga(e,t){let i={};for(let n of e){let r=t(n);r&&!i[r]&&(i[r]=n)}return i}function _d(e){let t={};for(let i=0;i<e.length;i++)t[e[i]]=!0;return t}function to(e,t){let i={};for(let n of e){let r=t(n);r&&(i[r]?i[r].push(n):i[r]=[n])}return i}function Md(e,t){let i={};for(let n in e)i[n]=t(e[n],n);return i}var cs=class{constructor(){u(this,"listeners",{})}dispatchEvent(e){let t=this.listeners[e.type];if(t){e.target=this,e.currentTarget=this;for(let i=0;i<t.length;i++)t[i](e)}}addEventListener(e,t,i){if(i)return;let n=this.listeners[e];n?n.includes(t)||n.push(t):this.listeners[e]=[t]}removeEventListener(e,t,i){if(i)return;let n=this.listeners[e];if(n){let r=n.indexOf(t);r>=0&&n.splice(r,1)}}},li={audio:!0,canvas:!0,embed:!0,iframe:!0,img:!0,math:!0,object:!0,picture:!0,svg:!0,video:!0};function ql(e){if(e.nodeType==1){let t=e.getAttribute("id");if(t)return t}return null}function zd(e){return`^${e}`}function ma(e){return e.replace(/[\[\]\(\),=;^]/g,zd)}function Dd(e){return e.substr(1)}function bo(e){return e&&e.replace(/\^[\[\]\(\),=;^]/g,Dd)}function Vd(e){let t=[];do{let i=e.match(/^(\^,|[^,])*/),n=bo(i[0]);if(e=e.substr(i[0].length+1),!e&&!t.length)return n;t.push(n)}while(e);return t}function wa(e){let t={};for(;e;){let i=e.match(/^;([^;=]+)=(([^;]|\^;)*)/);if(!i)return t;t[i[1]]=Vd(i[2]),e=e.substr(i[0].length)}return t}var ba=class{appendTo(e){e.append("!")}applyTo(e){return!1}},va=class{constructor(e,t,i){this.index=e,this.id=t,this.sideBias=i}appendTo(e){e.append("/"),e.append(this.index.toString()),(this.id||this.sideBias)&&(e.append("["),this.id&&e.append(this.id),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}applyTo(e){if(e.node.nodeType!=1)throw new Error("E_CFI_NOT_ELEMENT");let t=e.node,i=t.children,n=i.length,r,o=Math.floor(this.index/2)-1;if(o<0||n==0)r=t.firstChild,e.node=r||t;else{if(r=i[Math.min(o,n-1)],this.index&1){let s=r.nextSibling;!s||s.nodeType==1?e.after=!0:r=s}e.node=r}if(this.id&&(e.after||this.id!=ql(e.node))){let s=t.ownerDocument.getElementById(this.id);s?e.node=s:U.warn("E_CFI_ID_MISMATCH:",this.id)}return e.sideBias=this.sideBias,!0}},xa=class{constructor(e,t,i,n){this.offset=e,this.textBefore=t,this.textAfter=i,this.sideBias=n}applyTo(e){if(this.offset>0&&!e.after){let t=this.offset,i=e.node;for(;;){let n=i.nodeType;if(n==1)break;let r=i.nextSibling;if(3<=n&&n<=5){let o=i.textContent.length;if(t<=o)break;if(!r){t=o;break}t-=o}if(!r){t=0;break}i=r}e.node=i,e.offset=t}return e.sideBias=this.sideBias,!0}appendTo(e){e.append(":"),e.append(this.offset.toString()),(this.textBefore||this.textAfter||this.sideBias)&&(e.append("["),(this.textBefore||this.textAfter)&&(this.textBefore&&e.append(ma(this.textBefore)),e.append(","),this.textAfter&&e.append(ma(this.textAfter))),this.sideBias&&(e.append(";s="),e.append(this.sideBias)),e.append("]"))}},ya=class Yl{constructor(){u(this,"steps",null)}fromString(t){let i=t.match(/^#?epubcfi\((.*)\)$/);if(!i)throw new Error("E_CFI_NOT_CFI");let n=decodeURIComponent(i[1]),r=0,o=[];for(;;){let s;switch(n.charAt(r)){case"/":{if(r++,i=n.substr(r).match(/^(0|[1-9][0-9]*)(\[(.*?)(;([^\]]|\^\])*)?\])?/),!i)throw new Error("E_CFI_NUMBER_EXPECTED");r+=i[0].length;let a=parseInt(i[1],10),h=i[3];s=wa(i[4]),o.push(new va(a,h,da(s.s)));break}case":":{if(r++,i=n.substr(r).match(/^(0|[1-9][0-9]*)(\[((([^\];,]|\^[\];,])*)(,(([^\];,]|\^[\];,])*))?)(;([^]]|\^\])*)?\])?/),!i)throw new Error("E_CFI_NUMBER_EXPECTED");r+=i[0].length;let a=parseInt(i[1],10),h=i[4];h&&(h=bo(h));let l=i[7];l&&(l=bo(l)),s=wa(i[10]),o.push(new xa(a,h,l,da(s.s)));break}case"!":r++,o.push(new ba);break;case"~":case"@":case"":this.steps=o;return;default:throw new Error("E_CFI_PARSE_ERROR")}}}navigate(t){let i={node:t.documentElement,offset:0,after:!1,sideBias:null,ref:null};for(let n=0;n<this.steps.length;n++)if(!this.steps[n].applyTo(i)){i.ref=new Yl,i.ref.steps=this.steps.slice(n+1);break}return i}trim(t,i){return t.replace(/\s+/g," ").match(i?/^[ -\uD7FF\uE000-\uFFFF]{0,8}/:/[ -\uD7FF\uE000-\uFFFF]{0,8}$/)[0].replace(/^\s/,"").replace(/\s$/,"")}prependPathFromNode(t,i,n,r){let o=[],s=t.parentNode,a="",h="";for(;t;){switch(t.nodeType){case 3:case 4:case 5:{let l=t.textContent,c=l.length;n?(i+=c,a||(a=l)):(i>c&&(i=c),n=!0,a=l.substr(0,i),h=l.substr(i)),t=t.previousSibling;continue}case 8:t=t.previousSibling;continue}break}for((i>0||a||h)&&(a=this.trim(a,!1),h=this.trim(h,!0),o.push(new xa(i,a,h,r)),r=null);s&&!(!s||s.nodeType==9);){let l=n?null:ql(t),c=n?1:0;for(;t;)t.nodeType==1&&(c+=2),t=t.previousSibling;o.push(new va(c,l,r)),r=null,t=s,s=s.parentNode,n=!1}o.reverse(),this.steps?(o.push(new ba),this.steps=o.concat(this.steps)):this.steps=o}toString(){if(!this.steps)return"";let t=new Bt;t.append("epubcfi(");for(let i=0;i<this.steps.length;i++)this.steps[i].appendTo(t);return t.append(")"),t.toString().replace(/%/g,"%25")}};function Kl(){return{fontFamily:"serif",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0}}function Zl(e){return{fontFamily:e.fontFamily,lineHeight:e.lineHeight,margin:e.margin,hyphenate:e.hyphenate,columnWidth:e.columnWidth,horizontal:e.horizontal,nightMode:e.nightMode,spreadView:e.spreadView,pageBorder:e.pageBorder,enabledMediaTypes:Object.assign({},e.enabledMediaTypes),defaultPaperSize:e.defaultPaperSize?Object.assign({},e.defaultPaperSize):void 0}}var Hd=Kl(),Sa={PENDING:{}};function Ql(e,t,i,n){let r=Math.min((e-0)/i,(t-0)/n);return`matrix(${r},0,0,${r},0,0)`}function io(e){return`"${zn(`${e}`)}"`}function Ud(e){return Xt(`${e}`)}function vo(e,t){return e?`${Xt(e)}.${Xt(t)}`:Xt(t)}var Jl=0,xo=class{constructor(e,t){if(this.parent=e,this.resolver=t,u(this,"scopeKey"),u(this,"children",[]),u(this,"zero"),u(this,"one"),u(this,"_true"),u(this,"_false"),u(this,"values",{}),u(this,"funcs",{}),u(this,"builtIns",{}),this.scopeKey=`S${Jl++}`,this.zero=new ze(this,0),this.one=new ze(this,1),this._true=new ze(this,!0),this._false=new ze(this,!1),e&&e.children.push(this),!e){let i=this.builtIns;i.floor=Math.floor,i.ceil=Math.ceil,i.round=Math.round,i.sqrt=Math.sqrt,i.min=Math.min,i.max=Math.max,i.letterbox=Ql,i["css-string"]=io,i["css-name"]=Ud,i.typeof=n=>typeof n,this.defineBuiltInName("page-width",function(){return this.pageWidth()}),this.defineBuiltInName("page-height",function(){return this.pageHeight()}),this.defineBuiltInName("pref-font-family",function(){return this.pref.fontFamily}),this.defineBuiltInName("pref-night-mode",function(){return this.pref.nightMode}),this.defineBuiltInName("pref-hyphenate",function(){return this.pref.hyphenate}),this.defineBuiltInName("pref-margin",function(){return this.pref.margin}),this.defineBuiltInName("pref-line-height",function(){return this.pref.lineHeight}),this.defineBuiltInName("pref-column-width",function(){return this.pref.columnWidth*this.fontSize}),this.defineBuiltInName("pref-horizontal",function(){return this.pref.horizontal}),this.defineBuiltInName("pref-spread-view",function(){return this.pref.spreadView}),this.defineBuiltInName("pub-title",function(){return io(this.pubTitle?this.pubTitle:"")}),this.defineBuiltInName("doc-title",function(){return io(this.docTitle?this.docTitle:"")})}}defineBuiltInName(e,t){this.values[e]=new We(this,t,e)}defineName(e,t){this.values[e]=t}defineFunc(e,t){this.funcs[e]=t}defineBuiltIn(e,t){this.builtIns[e]=t}};function $d(e){switch(e?.toLowerCase()){case"px":case"in":case"pt":case"pc":case"cm":case"mm":case"q":return!0;default:return!1}}function eh(e){switch(e?.toLowerCase()){case"vw":case"vh":case"vi":case"vb":case"vmin":case"vmax":case"pvw":case"pvh":case"pvi":case"pvb":case"pvmin":case"pvmax":return!0;default:return!1}}function Wd(e){switch(e?.toLowerCase()){case"em":case"ex":case"rem":case"lh":case"rlh":return!0;default:return!1}}function Gd(e){switch(e?.toLowerCase()){case"rem":case"rlh":return!0;default:return!1}}var xe={px:1,in:96,pt:4/3,pc:96/6,cm:96/2.54,mm:96/25.4,q:96/2.54/40,em:16,rem:16,ex:8,lh:20,rlh:20,dppx:1,dpi:1/96,dpcm:2.54/96};function th(e){switch(e){case"q":return!CSS.supports("font-size","1q");case"lh":return!CSS.supports("line-height","1lh");case"rem":case"rlh":return!0;default:return!1}}var yo=class{constructor(e,t,i,n){this.rootScope=e,this.viewportWidth=t,this.viewportHeight=i,u(this,"actualPageWidth",null),u(this,"pageWidth"),u(this,"actualPageHeight",null),u(this,"pageHeight"),u(this,"initialFontSize"),u(this,"rootFontSize",null),u(this,"isRelativeRootFontSize",null),u(this,"fontSize"),u(this,"rootLineHeight",null),u(this,"pref"),u(this,"scopes",{}),u(this,"pageAreaWidth",null),u(this,"pageAreaHeight",null),u(this,"pageVertical",null),u(this,"pubTitle",null),u(this,"docTitle",null),this.pageWidth=function(){return this.actualPageWidth?this.actualPageWidth:this.pref.spreadView?Math.floor(t/2)-this.pref.pageBorder:t},this.pageHeight=function(){return this.actualPageHeight?this.actualPageHeight:i},this.initialFontSize=n,this.fontSize=function(){return this.rootFontSize?this.rootFontSize:n},this.pref=Hd}getScopeContext(e){let t=this.scopes[e.scopeKey];return t||(t={},this.scopes[e.scopeKey]=t),t}clearScope(e){this.scopes[e.scopeKey]={};for(let t=0;t<e.children.length;t++)this.clearScope(e.children[t])}queryUnitSize(e,t,i){if(eh(e)){let n=this.pageWidth()/100,r=this.pageHeight()/100,o=this.pageAreaWidth!=null?this.pageAreaWidth/100:n,s=this.pageAreaHeight!=null?this.pageAreaHeight/100:r,a=i??this.pageVertical;switch(e){case"vw":return o;case"vh":return s;case"vi":return a?s:o;case"vb":return a?o:s;case"vmin":return o<s?o:s;case"vmax":return o>s?o:s;case"pvw":return n;case"pvh":return r;case"pvi":return a?r:n;case"pvb":return a?n:r;case"pvmin":return n<r?n:r;case"pvmax":return n>r?n:r}}return e=="em"||e=="rem"?t?this.initialFontSize:this.fontSize():e=="ex"?xe.ex*(t?this.initialFontSize:this.fontSize())/xe.em:e=="lh"||e=="rlh"?this.rootLineHeight:xe[e]}evalName(e,t){do{let i=e.values[t];if(i||e.resolver&&(i=e.resolver.call(this,t,!1),i))return i;e=e.parent}while(e);throw new Error(`Name '${t}' is undefined`)}evalCall(e,t,i,n){do{let r=e.funcs[t];if(r||e.resolver&&(r=e.resolver.call(this,t,!0),r))return r;let o=e.builtIns[t];if(o){if(n)return e.zero;let s=Array(i.length);for(let a=0;a<i.length;a++)s[a]=i[a].evaluate(this);return new ze(e,o.apply(this,s))}e=e.parent}while(e);throw new Error(`Function '${t}' is undefined`)}evalMediaName(e,t){let i=e==="all"||!!this.pref.enabledMediaTypes[e];return t?!i:i}evalMediaTest(e,t){let i="",n=e.match(/^(min|max)-(.*)$/);n&&(i=n[1],e=n[2]);let r=null,o=null;switch(e){case"width":case"height":case"device-width":case"device-height":case"color":t&&(r=t.evaluate(this));break}switch(e){case"width":o=this.pageWidth();break;case"height":o=this.pageHeight();break;case"device-width":o=window.screen.availWidth;break;case"device-height":o=window.screen.availHeight;break;case"color":o=window.screen.pixelDepth;break}if(o!=null&&r!=null)switch(i){case"min":return o>=Number(r);case"max":return o<=Number(r);default:return o==r}else if(o!=null&&t==null)return o!==0;return!1}evalSupportsTest(e,t,i){return!1}queryVal(e,t){let i=e&&this.scopes[e.scopeKey];return i?i[t]:void 0}storeVal(e,t,i){this.getScopeContext(e)[t]=i}},wt=class{constructor(e){this.scope=e,u(this,"key"),this.scope=e,this.key=`_${Jl++}`}toString(){let e=new Bt;return this.appendTo(e,0),e.toString()}appendTo(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){throw new Error("F_ABSTRACT")}expand(e,t){return this}dependCore(e,t,i){return e===this}dependOuter(e,t,i){let n=i[this.key];if(n!=null)return n===Sa.PENDING?!1:n;{i[this.key]=Sa.PENDING;let r=this.dependCore(e,t,i);return i[this.key]=r,r}}depend(e,t){return this.dependOuter(e,t,{})}evaluate(e){let t=e.queryVal(this.scope,this.key);return typeof t<"u"||(t=this.evaluateCore(e),this.scope&&e.storeVal(this.scope,this.key,t)),t}isMediaName(){return!1}},ih=class extends wt{constructor(e,t){super(e),this.val=t}getOp(){throw new Error("F_ABSTRACT")}evalPrefix(e){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.val.evaluate(e);return this.evalPrefix(t)}dependCore(e,t,i){return e===this||this.val.dependOuter(e,t,i)}appendTo(e,t){10<t&&e.append("("),e.append(this.getOp()),this.val.appendTo(e,10),10<t&&e.append(")")}expand(e,t){let i=this.val.expand(e,t);return i===this.val?this:new this.constructor(this.scope,i)}},Or=class extends wt{constructor(e,t,i){super(e),this.lhs=t,this.rhs=i}getPriority(){throw new Error("F_ABSTRACT")}getOp(){throw new Error("F_ABSTRACT")}evalInfix(e,t){throw new Error("F_ABSTRACT")}evaluateCore(e){let t=this.lhs.evaluate(e),i=this.rhs.evaluate(e);return this.evalInfix(t,i)}dependCore(e,t,i){return e===this||this.lhs.dependOuter(e,t,i)||this.rhs.dependOuter(e,t,i)}appendTo(e,t){let i=this.getPriority();i<=t&&e.append("("),this.lhs.appendTo(e,i),e.append(this.getOp()),this.rhs.appendTo(e,i),i<=t&&e.append(")")}expand(e,t){let i=this.lhs.expand(e,t),n=this.rhs.expand(e,t);return i===this.lhs&&n===this.rhs?this:new this.constructor(this.scope,i,n)}},nh=class extends Or{constructor(e,t,i){super(e,t,i)}getPriority(){return 1}},ji=class extends Or{constructor(e,t,i){super(e,t,i)}getPriority(){return 2}},rh=class extends Or{constructor(e,t,i){super(e,t,i)}getPriority(){return 3}},ds=class extends Or{constructor(e,t,i){super(e,t,i)}getPriority(){return 4}},qt=class extends ih{constructor(e,t){super(e,t)}getOp(){return"!"}evalPrefix(e){return!e}},jd=class extends qt{constructor(e,t){super(e,t)}getOp(){return"not "}},oh=class extends ih{constructor(e,t){super(e,t)}getOp(){return"-"}evalPrefix(e){return-e}},ps=class extends nh{constructor(e,t,i){super(e,t,i)}getOp(){return"&&"}evaluateCore(e){return this.lhs.evaluate(e)&&this.rhs.evaluate(e)}},Xd=class extends ps{constructor(e,t,i){super(e,t,i)}getOp(){return" and "}},fs=class extends nh{constructor(e,t,i){super(e,t,i)}getOp(){return"||"}evaluateCore(e){return this.lhs.evaluate(e)||this.rhs.evaluate(e)}},qd=class extends fs{constructor(e,t,i){super(e,t,i)}getOp(){return", "}},Yd=class extends fs{constructor(e,t,i){super(e,t,i)}getOp(){return" or "}},Kd=class extends ji{constructor(e,t,i){super(e,t,i)}getOp(){return"<"}evalInfix(e,t){return e<t}},Zd=class extends ji{constructor(e,t,i){super(e,t,i)}getOp(){return"<="}evalInfix(e,t){return e<=t}},Qd=class extends ji{constructor(e,t,i){super(e,t,i)}getOp(){return">"}evalInfix(e,t){return e>t}},So=class extends ji{constructor(e,t,i){super(e,t,i)}getOp(){return">="}evalInfix(e,t){return e>=t}},gs=class extends ji{constructor(e,t,i){super(e,t,i)}getOp(){return"=="}evalInfix(e,t){return e==t}},Jd=class extends ji{constructor(e,t,i){super(e,t,i)}getOp(){return"!="}evalInfix(e,t){return e!=t}},sh=class extends rh{constructor(e,t,i){super(e,t,i)}getOp(){return"+"}evalInfix(e,t){return e+t}},ah=class extends rh{constructor(e,t,i){super(e,t,i)}getOp(){return" - "}evalInfix(e,t){return e-t}},ms=class extends ds{constructor(e,t,i){super(e,t,i)}getOp(){return"*"}evalInfix(e,t){return e*t}},lh=class extends ds{constructor(e,t,i){super(e,t,i)}getOp(){return"/"}evalInfix(e,t){return e/t}},hh=class extends ds{constructor(e,t,i){super(e,t,i)}getOp(){return"%"}evalInfix(e,t){return e%t}},fi=class extends wt{constructor(e,t,i){var n;super(e),this.num=t,u(this,"unit"),this.unit=(n=i?.toLowerCase())!=null?n:""}appendTo(e,t){e.append(this.num.toString()),e.append(Xt(this.unit))}evaluateCore(e){return this.num*e.queryUnitSize(this.unit,!1)}},$e=class extends wt{constructor(e,t){super(e),this.qualifiedName=t}appendTo(e,t){e.append(this.qualifiedName)}evaluateCore(e){return e.evalName(this.scope,this.qualifiedName).evaluate(e)}dependCore(e,t,i){return e===this||t.evalName(this.scope,this.qualifiedName).dependOuter(e,t,i)}},Ca=class extends wt{constructor(e,t,i){super(e),this.not=t,this.name=i}appendTo(e,t){this.not&&e.append("not "),e.append(Xt(this.name))}evaluateCore(e){return e.evalMediaName(this.name,this.not)}isMediaName(){return!0}},We=class extends wt{constructor(e,t,i){super(e),this.fn=t,this.str=i}appendTo(e,t){e.append(this.str)}evaluateCore(e){return this.fn.call(e)}};function ep(e,t){e.append("(");for(let i=0;i<t.length;i++)i&&e.append(","),t[i].appendTo(e,0);e.append(")")}function tp(e,t,i){let n=t;for(let r=0;r<t.length;r++){let o=t[r].expand(e,i);if(t!==n)n[r]=o;else if(o!==t[r]){n=Array(t.length);for(let s=0;s<r;s++)n[s]=t[s];n[r]=o}}return n}var gn=class uh extends wt{constructor(t,i,n){super(t),this.qualifiedName=i,this.params=n}appendTo(t,i){t.append(this.qualifiedName),ep(t,this.params)}evaluateCore(t){return t.evalCall(this.scope,this.qualifiedName,this.params,!1).expand(t,this.params).evaluate(t)}dependCore(t,i,n){if(t===this)return!0;for(let r=0;r<this.params.length;r++)if(this.params[r].dependOuter(t,i,n))return!0;return i.evalCall(this.scope,this.qualifiedName,this.params,!0).dependOuter(t,i,n)}expand(t,i){let n=tp(t,this.params,i);return n===this.params?this:new uh(this.scope,this.qualifiedName,n)}},ip=class ch extends wt{constructor(t,i,n,r){super(t),this.cond=i,this.ifTrue=n,this.ifFalse=r}appendTo(t,i){i>0&&t.append("("),this.cond.appendTo(t,0),t.append("?"),this.ifTrue.appendTo(t,0),t.append(":"),this.ifFalse.appendTo(t,0),i>0&&t.append(")")}evaluateCore(t){return this.cond.evaluate(t)?this.ifTrue.evaluate(t):this.ifFalse.evaluate(t)}dependCore(t,i,n){return t===this||this.cond.dependOuter(t,i,n)||this.ifTrue.dependOuter(t,i,n)||this.ifFalse.dependOuter(t,i,n)}expand(t,i){let n=this.cond.expand(t,i),r=this.ifTrue.expand(t,i),o=this.ifFalse.expand(t,i);return n===this.cond&&r===this.ifTrue&&o===this.ifFalse?this:new ch(this.scope,n,r,o)}},ze=class extends wt{constructor(e,t){super(e),this.val=t}appendTo(e,t){switch(typeof this.val){case"number":case"boolean":e.append(this.val.toString());break;case"string":e.append('"'),e.append(zn(this.val)),e.append('"');break;default:throw new Error("F_UNEXPECTED_STATE")}}evaluateCore(e){return this.val}},Ea=class dh extends wt{constructor(t,i,n){super(t),this.name=i,this.value=n}appendTo(t,i){t.append("("),t.append(zn(this.name.name)),t.append(":"),this.value.appendTo(t,0),t.append(")")}evaluateCore(t){return t.evalMediaTest(this.name.name,this.value)}dependCore(t,i,n){return t===this||this.value.dependOuter(t,i,n)}expand(t,i){let n=this.value.expand(t,i);return n===this.value?this:new dh(this.scope,this.name,n)}},np=class extends wt{constructor(e,t,i,n){super(e),this.name=t,this.value=i,this.isFunc=n}appendTo(e,t){this.isFunc&&e.append(this.name),e.append("("),!this.isFunc&&this.name&&(e.append(this.name),e.append(":")),e.append(this.value),e.append(")")}evaluateCore(e){return e.evalSupportsTest(this.name,this.value,this.isFunc)}},ph=class extends wt{constructor(e,t){super(e),this.index=t}appendTo(e,t){e.append("$"),e.append(this.index.toString())}expand(e,t){let i=t[this.index];if(!i)throw new Error(`Parameter missing: ${this.index}`);return i}};function gt(e,t,i){return t===e._false||t===e.zero||i==e._false||i==e.zero?e._false:t===e._true||t===e.one?i:i===e._true||i===e.one?t:new ps(e,t,i)}function Y(e,t,i){return t===e.zero?i:i===e.zero?t:new sh(e,t,i)}function ue(e,t,i){return t===e.zero?new oh(e,i):i===e.zero?t:new ah(e,t,i)}function cr(e,t,i){return t===e.zero||i===e.zero?e.zero:t===e.one?i:i===e.one?t:new ms(e,t,i)}function Co(e,t,i){return t===e.zero?e.zero:i===e.one?t:new lh(e,t,i)}var Dt=class{visitValues(e){for(let t=0;t<e.length;t++)e[t].visit(this);return null}visitEmpty(e){return null}visitSlash(e){return null}visitStr(e){return null}visitIdent(e){return null}visitNumeric(e){return null}visitNum(e){return null}visitInt(e){return this.visitNum(e)}visitHexColor(e){return null}visitURL(e){return null}visitURange(e){return null}visitSpaceList(e){return this.visitValues(e.values),null}visitCommaList(e){return this.visitValues(e.values),null}visitFunc(e){return this.visitValues(e.values),null}visitExpr(e){return null}},Xi=class extends Dt{constructor(){super(),u(this,"error",!1)}visitValues(e){let t=null;for(let i=0;i<e.length;i++){let n=e[i],r=n.visit(this);if(this.error)return[];if(t)t[i]=r;else if(n!==r){t=new Array(e.length);for(let o=0;o<i;o++)t[o]=e[o];t[i]=r}}return t||e}visitEmpty(e){return e}visitStr(e){return e}visitIdent(e){return e}visitSlash(e){return e}visitNumeric(e){return e}visitNum(e){return e}visitInt(e){return e}visitHexColor(e){return e}visitURL(e){return e}visitURange(e){return e}visitSpaceList(e){let t=this.visitValues(e.values);return this.error?X:t===e.values?e:new Ie(t)}visitCommaList(e){let t=this.visitValues(e.values);return this.error?X:t===e.values?e:new et(t)}visitFunc(e){let t=this.visitValues(e.values);return this.error?X:t===e.values?e:new qi(e.name,t)}visitExpr(e){return e}},Ye=class{toString(){let e=new Bt;return this.appendTo(e,!0),e.toString()}stringValue(){let e=new Bt;return this.appendTo(e,!1),e.toString()}toExpr(e,t){return null}appendTo(e,t){e.append("[error]")}isExpr(){return!1}isNumeric(){return!1}isNum(){return!1}isIdent(){return!1}isSpaceList(){return!1}visit(e){return this}},fh=class gh extends Ye{static get instance(){return this.empty||(this.empty=new gh),this.empty}constructor(){super()}toExpr(t,i){return new ze(t,"")}appendTo(t,i){}visit(t){return t.visitEmpty(this)}};u(fh,"empty");var rp=fh,X=rp.instance,mh=class wh extends Ye{static get instance(){return this.slash||(this.slash=new wh),this.slash}constructor(){super()}toExpr(t,i){return new ze(t,"/")}appendTo(t,i){t.append("/")}visit(t){return t.visitSlash(this)}};u(mh,"slash");var op=mh,Br=op.instance,_e=class extends Ye{constructor(e){super(),this.str=e}toExpr(e,t){return new ze(e,this.str)}appendTo(e,t){t?(e.append('"'),e.append(zn(this.str)),e.append('"')):e.append(this.str)}visit(e){return e.visitStr(this)}},Eo={},yt=class extends Ye{constructor(e){if(super(),this.name=e,Eo[e])throw new Error("E_INVALID_CALL");Eo[e]=this}toExpr(e,t){return new ze(e,this.name)}appendTo(e,t){t?e.append(Xt(this.name)):e.append(this.name)}visit(e){return e.visitIdent(this)}isIdent(){return!0}};function z(e){let t=Eo[e];return t||(t=new yt(e)),t}var A=class extends Ye{constructor(e,t){var i;super(),this.num=e,u(this,"unit"),this.unit=(i=t?.toLowerCase())!=null?i:""}toExpr(e,t){return this.num==0?e.zero:t&&this.unit=="%"?this.num==100?t:new ms(e,t,new ze(e,this.num/100)):new fi(e,this.num,this.unit)}appendTo(e,t){e.append(this.num.toString()),e.append(this.unit)}visit(e){return e.visitNumeric(this)}isNumeric(){return!0}},wi=class extends Ye{constructor(e){super(),this.num=e}toExpr(e,t){return this.num==0?e.zero:this.num==1?e.one:new ze(e,this.num)}appendTo(e,t){e.append(this.num.toString())}visit(e){return e.visitNum(this)}isNum(){return!0}},gi=class extends wi{constructor(e){super(e)}visit(e){return e.visitInt(this)}},bh=class extends Ye{constructor(e){super(),this.hex=e}appendTo(e,t){e.append("#"),e.append(this.hex)}visit(e){return e.visitHexColor(this)}},bt=class extends Ye{constructor(e){super(),this.url=e}appendTo(e,t){e.append('url("'),e.append(zn(this.url)),e.append('")')}visit(e){return e.visitURL(this)}},vh=class extends Ye{constructor(e){super(),this.urangeText=e}appendTo(e,t){e.append(this.urangeText)}visit(e){return e.visitURange(this)}};function ws(e,t,i,n){var r,o;let s=t.length;if(s>0){(r=t[0])==null||r.appendTo(e,n);for(let a=1;a<s;a++)e.append(i),(o=t[a])==null||o.appendTo(e,n)}}var Ie=class extends Ye{constructor(e){super(),this.values=e}appendTo(e,t){ws(e,this.values," ",t)}visit(e){return e.visitSpaceList(this)}isSpaceList(){return!0}},et=class extends Ye{constructor(e){super(),this.values=e}appendTo(e,t){ws(e,this.values,",",t)}visit(e){return e.visitCommaList(this)}},qi=class extends Ye{constructor(e,t){super(),this.name=e,this.values=t}appendTo(e,t){e.append(Xt(this.name)),e.append("("),ws(e,this.values,",",t),e.append(")")}visit(e){return e.visitFunc(this)}},$=class extends Ye{constructor(e){super(),this.expr=e}toExpr(){return this.expr}appendTo(e,t){this.expr instanceof ze||this.expr instanceof fi?this.expr.appendTo(e,0):(e.append("-epubx-expr("),this.expr.appendTo(e,0),e.append(")"))}visit(e){return e.visitExpr(this)}isExpr(){return!0}},nn=class extends Ye{constructor(e){super(),this.text=e}appendTo(e,t){e.append(this.text||" ")}};function Ze(e,t){if(e){if(e.isNumeric()){let i=e;return t.queryUnitSize(i.unit,!1)*i.num}if(e.isNum())return e.num}return 0}function xh(e,t){return new A(Ze(e,t),"px")}var x={absolute:z("absolute"),all:z("all"),always:z("always"),anywhere:z("anywhere"),auto:z("auto"),avoid:z("avoid"),balance:z("balance"),balance_all:z("balance-all"),block:z("block"),block_end:z("block-end"),block_start:z("block-start"),both:z("both"),bottom:z("bottom"),border_box:z("border-box"),break_all:z("break-all"),break_word:z("break-word"),clip:z("clip"),crop:z("crop"),cross:z("cross"),column:z("column"),discard:z("discard"),exclusive:z("exclusive"),_false:z("false"),fixed:z("fixed"),flex:z("flex"),flow_root:z("flow-root"),footnote:z("footnote"),footer:z("footer"),grid:z("grid"),header:z("header"),hidden:z("hidden"),horizontal_tb:z("horizontal-tb"),inherit:z("inherit"),initial:z("initial"),inline:z("inline"),inline_block:z("inline-block"),inline_end:z("inline-end"),inline_start:z("inline-start"),keep:z("keep"),landscape:z("landscape"),left:z("left"),line:z("line"),list_item:z("list-item"),ltr:z("ltr"),manual:z("manual"),max_content:z("max-content"),min_content:z("min-content"),none:z("none"),normal:z("normal"),oeb_page_foot:z("oeb-page-foot"),oeb_page_head:z("oeb-page-head"),padding_box:z("padding-box"),page:z("page"),relative:z("relative"),revert:z("revert"),right:z("right"),same:z("same"),scale:z("scale"),snap_block:z("snap-block"),solid:z("solid"),spread:z("spread"),_static:z("static"),rtl:z("rtl"),table:z("table"),table_caption:z("table-caption"),table_cell:z("table-cell"),table_footer_group:z("table-footer-group"),table_header_group:z("table-header-group"),table_row:z("table-row"),top:z("top"),transparent:z("transparent"),unset:z("unset"),vertical_lr:z("vertical-lr"),vertical_rl:z("vertical-rl"),visible:z("visible"),_true:z("true")},ka=new A(100,"%"),Yi=new A(100,"pvw"),Ki=new A(100,"pvh"),ce=new A(0,"px"),sp=new vh("U+0-10FFFF"),Pa={"font-size":1,"line-height":2,color:3};function te(e){return e===x.inherit||e===x.initial||e===x.revert||e===x.unset}function Na(e,t){let i=Pa[e]||Number.MAX_VALUE,n=Pa[t]||Number.MAX_VALUE;return i-n}function _t(e){return e?.length>2&&e.startsWith("--")}var ht=class{constructor(e,t,i,n){this.x1=e,this.y1=t,this.x2=i,this.y2=n}},Gt=class{constructor(e,t){this.x=e,this.y=t}},no=class{constructor(e,t,i,n){this.left=e,this.top=t,this.right=i,this.bottom=n}},Ta=class{constructor(e,t,i,n){this.low=e,this.high=t,this.winding=i,this.shapeId=n}},Ot=class{constructor(e,t,i,n){this.y1=e,this.y2=t,this.x1=i,this.x2=n,u(this,"left",null),u(this,"right",null)}};function ap(e,t){return e.low.y-t.low.y||e.low.x-t.low.x}var _r=class yh{constructor(t){this.points=t}addSegments(t,i){let n=this.points,r=n.length,o=n[r-1];for(let s=0;s<r;s++){let a=n[s],h;o.y<a.y?h=new Ta(o,a,1,i):h=new Ta(a,o,-1,i),t.push(h),o=a}}withOffset(t,i){let n=[];for(let r of this.points)n.push(new Gt(r.x+t,r.y+i));return new yh(n)}};function Ia(e,t,i,n){let r=[];for(let o=0;o<20;o++){let s=o*2*Math.PI/20;r.push(new Gt(e+i*Math.sin(s),t+n*Math.cos(s)))}return new _r(r)}function bs(e,t,i,n){return new _r([new Gt(e,t),new Gt(i,t),new Gt(i,n),new Gt(e,n)])}var nr=class{constructor(e,t,i,n){this.x=e,this.winding=t,this.shapeId=i,this.lowOrHigh=n}};function Fa(e,t){let i=e.low.x+(e.high.x-e.low.x)*(t-e.low.y)/(e.high.y-e.low.y);if(isNaN(i))throw new Error("Bad intersection");return i}function lp(e,t,i,n){let r,o,s,a;t.high.y<i&&U.warn("Error: inconsistent segment (1)"),t.low.y<=i?(r=Fa(t,i),o=t.winding):(r=t.low.x,o=0),t.high.y>=n?(s=Fa(t,n),a=t.winding):(s=t.high.x,a=0),r<s?(e.push(new nr(r,o,t.shapeId,-1)),e.push(new nr(s,a,t.shapeId,1))):(e.push(new nr(s,a,t.shapeId,-1)),e.push(new nr(r,o,t.shapeId,1)))}function hp(e,t,i){let n=t+i,r=Array(n),o=Array(n),s;for(s=0;s<=n;s++)r[s]=0,o[s]=0;let a=[],h=!1,l=e.length;for(let c=0;c<l;c++){let p=e[c];r[p.shapeId]+=p.winding,o[p.shapeId]+=p.lowOrHigh;let d=!1;for(s=0;s<t;s++)if(r[s]&&!o[s]){d=!0;break}if(d){for(s=t;s<=n;s++)if(r[s]||o[s]){d=!1;break}}h!=d&&(a.push(p.x),h=d)}return a}function up(e,t){return t?Math.ceil(e/t)*t:e}function Aa(e,t){return t?Math.floor(e/t)*t:e}function cp(e){return new Gt(e.y,-e.x)}function xr(e){return new ht(e.y1,-e.x2,e.y2,-e.x1)}function Sh(e){return new ht(-e.y2,e.x1,-e.y1,e.x2)}function Ra(e){return new _r(e.points.map(t=>cp(t)))}function dp(e,t,i,n,r,o){o&&(e=xr(e),t=t.map(w=>Ra(w)),i=i.map(w=>Ra(w)));let s=t.length,a=i?i.length:0,h=[],l=[],c,p,d;for(c=0;c<s;c++)t[c].addSegments(l,c);for(c=0;c<a;c++)i[c].addSegments(l,c+s);let f=l.length;l.sort(ap);let g=0;for(;l[g].shapeId>=s;)g++;let m=l[g].low.y;m>e.y1&&h.push(new Ot(e.y1,m,e.x2,e.x2));let v=0,b=[];for(;v<f&&(d=l[v]).low.y<m;)d.high.y>m&&b.push(d),v++;for(;v<f||b.length>0;){let w=e.y2,S=Math.min(up(Math.ceil(m+n),r),e.y2);for(p=0;p<b.length&&w>S;p++)d=b[p],d.low.x==d.high.x?d.high.y<w&&(w=Math.max(Aa(d.high.y,r),S)):d.low.x!=d.high.x&&(w=S);for(w>e.y2&&(w=e.y2);v<f&&(d=l[v]).low.y<w;){if(d.high.y<m){v++;continue}if(d.low.y<S)d.low.y==d.high.y&&d.low.y==m||(b.push(d),w=S),v++;else{let D=Aa(d.low.y,r);D<w&&(w=D);break}}let L=[];for(p=0;p<b.length;p++)lp(L,b[p],m,w);L.sort((D,W)=>D.x-W.x||D.lowOrHigh-W.lowOrHigh);let B=hp(L,s,a);if(B.length==0)h.push(new Ot(m,w,e.x2,e.x2));else{let D=0,W=e.x1;for(p=0;p<B.length;p+=2){let q=Math.max(e.x1,B[p]),ye=Math.min(e.x2,B[p+1])-q;ye>D&&(D=ye,W=q)}D==0?h.push(new Ot(m,w,e.x2,e.x2)):h.push(new Ot(m,w,Math.max(W,e.x1),Math.min(W+D,e.x2)))}if(w==e.y2)break;for(m=w,p=b.length-1;p>=0;p--)b[p].high.y<=w&&b.splice(p,1)}return Ch(e,h),h}function Ch(e,t){let i=t.length-1,n=new Ot(e.y2,e.y2,e.x1,e.x2);for(;i>=0;){let r=n;n=t[i],(n.y2-n.y1<1||n.x1==r.x1&&n.x2==r.x2)&&(r.y1=n.y1,t.splice(i,1),n=r),i--}}function Eh(e,t){let i=0,n=e.length;for(;i<n;){let r=Math.floor((i+n)/2);t>=e[r].y2?i=r+1:n=r}return i}function pp(e,t){if(!e.length)return t;let i=t.y1,n,r;for(r=0;r<e.length&&(n=e[r],!(n.y2>t.y1&&n.x1-.1<=t.x1&&n.x2+.1>=t.x2));r++)i=Math.max(i,n.y2);let o=i;for(;r<e.length&&(n=e[r],!(n.y1>=t.y2||n.x1-.1>t.x1||n.x2+.1<t.x2));r++)o=n.y2;return r===e.length?o=t.y2:o=Math.min(o,t.y2),o<=i?null:new ht(t.x1,i,t.x2,o)}function fp(e,t){if(!e.length)return t;let i=t.y2,n,r;for(r=e.length-1;r>=0&&(n=e[r],!(r===e.length-1&&n.y2<t.y2))&&!(n.y1<t.y2&&n.x1-.1<=t.x1&&n.x2+.1>=t.x2);r--)i=Math.min(i,n.y1);let o=Math.min(i,n.y2);for(;r>=0&&(n=e[r],!(n.y2<=t.y1||n.x1-.1>t.x1||n.x2+.1<t.x2));r--)o=n.y1;return o=Math.max(o,t.y1),i<=o?null:new ht(t.x1,o,t.x2,i)}function gp(e,t,i,n){let r=i.y1,o=i.x2-i.x1,s=i.y2-i.y1,a=Eh(t,r);for(;;){let h=r+s;if(h>e.y2)return!1;let l=e.x1,c=e.x2;for(let p=a;p<t.length&&t[p].y1<h;p++){let d=t[p];d.x1>l&&(l=d.x1),d.x2<c&&(c=d.x2)}if(l+o<=c||a>=t.length)return n=="left"?(i.x1=l,i.x2=l+o):(i.x1=c-o,i.x2=c),i.y2+=r-i.y1,i.y1=r,!0;r=t[a].y2,a++}}function mp(e,t,i,n,r){for(n||(n=[new Ot(i.y1,i.y2,i.x1,i.x2)]);n.length>0&&n[0].y2<=e.y1;)n.shift();if(n.length==0)return;n[0].y1<e.y1&&(n[0].y1=e.y1);let o,s=t.length==0?e.y1:t[t.length-1].y2;s<e.y2&&t.push(new Ot(s,e.y2,e.x1,e.x2));let a=Eh(t,n[0].y1);for(let h of n){if(a==t.length)break;for(t[a].y1<h.y1&&(o=t[a],a++,t.splice(a,0,new Ot(h.y1,o.y2,o.x1,o.x2)),o.y2=h.y1);a<t.length&&(o=t[a++],o.y2>h.y2&&(t.splice(a,0,new Ot(h.y2,o.y2,o.x1,o.x2)),o.y2=h.y2),h.x1!=h.x2&&(r=="left"?o.x1=Math.min(h.x2,e.x2):o.x2=Math.max(h.x1,e.x1)),o.y2!=h.y2););}Ch(e,t)}var wp=class extends Dt{constructor(){super(),u(this,"propSet",{})}visitIdent(e){return this.propSet[e.name]=!0,e}visitSpaceList(e){return this.visitValues(e.values),e}};function bp(e){if(e){let t=new wp;try{return e.visit(t),t.propSet}catch(i){U.warn(i,"toSet:")}}return{}}var vp=class extends Dt{constructor(e){super(),this.value=e}visitInt(e){return this.value=e.num,e}};function La(e,t){if(e){let i=new vp(t);try{return e.visit(i),i.value}catch(n){U.warn(n,"toInt: ")}}return t}var xp=class extends Dt{constructor(){super(),u(this,"collect",!1),u(this,"coords",[]),u(this,"name",null)}visitNumeric(e){return this.collect&&this.coords.push(e),null}visitNum(e){return this.collect&&e.num==0&&this.coords.push(new A(0,"px")),null}visitSpaceList(e){return this.visitValues(e.values),null}visitFunc(e){return this.collect||(this.collect=!0,this.visitValues(e.values),this.collect=!1,this.name=e.name.toLowerCase()),null}getShape(e,t,i,n,r){if(this.coords.length>0){let o=[];switch(this.coords.forEach((s,a)=>{if(s.unit=="%"){let h=a%2==0?i:n;a==3&&this.name=="circle"&&(h=Math.sqrt((i*i+n*n)/2)),o.push(s.num*h/100)}else o.push(s.num*r.queryUnitSize(s.unit,!1))}),this.name){case"polygon":if(o.length%2==0){let s=[];for(let a=0;a<o.length;a+=2)s.push(new Gt(e+o[a],t+o[a+1]));return new _r(s)}break;case"rectangle":if(o.length==4)return bs(e+o[0],t+o[1],e+o[0]+o[2],t+o[1]+o[3]);break;case"ellipse":if(o.length==4)return Ia(e+o[0],t+o[1],o[2],o[3]);break;case"circle":if(o.length==3)return Ia(e+o[0],t+o[1],o[2],o[2]);break}}return null}};function kh(e,t,i,n,r,o){if(e){let s=new xp;try{return e.visit(s),s.getShape(t,i,n,r,o)}catch(a){U.warn(a,"toShape:")}}return bs(t,i,t+n,i+r)}var yp=class extends Dt{constructor(e){super(),this.reset=e,u(this,"counters",{}),u(this,"name",null)}visitIdent(e){return this.name=e.toString(),this.reset?this.counters[this.name]=0:this.counters[this.name]=(this.counters[this.name]||0)+1,e}visitInt(e){return this.name&&(this.counters[this.name]+=e.num-(this.reset?0:1)),e}visitSpaceList(e){return this.visitValues(e.values),e}};function mn(e,t){let i=new yp(t);try{e.visit(i)}catch(n){U.warn(n,"toCounters:")}return i.counters}var Sp=class extends Xi{constructor(e,t){super(),this.baseUrl=e,this.transformer=t}visitURL(e){return new bt(this.transformer.transformURL(e.url,this.baseUrl))}};function ro(e){let t={};return Object.keys(e).forEach(i=>{t[i]=Array.from(e[i])}),t}var Cp=class{constructor(e,t){this.targetId=e,this.resolved=t,u(this,"pageCounters",null),u(this,"spineIndex",-1),u(this,"pageIndex",-1)}equals(e){return this===e?!0:e?this.targetId===e.targetId&&this.resolved===e.resolved&&this.spineIndex===e.spineIndex&&this.pageIndex===e.pageIndex:!1}isResolved(){return this.resolved}resolve(){this.resolved=!0}unresolve(){this.resolved=!1}},Ep=class{constructor(e,t){this.counterStore=e,this.baseURL=t}countersOfId(e,t){e=this.counterStore.documentURLTransformer.transformFragment(e,this.baseURL),this.counterStore.countersById[e]=t}getExprContentListener(){return this.counterStore.getExprContentListener()}},kp=class{constructor(e,t,i,n){this.counterStore=e,this.baseURL=t,this.rootScope=i,this.pageScope=n,u(this,"styler",null),u(this,"namedStringValues",{}),u(this,"runningElements",{})}setStyler(e){this.styler=e}getFragment(e){let t=e.match(/^[^#]*#(.*)$/);return t?t[1]:null}getTransformedId(e){let t=this.counterStore.documentURLTransformer.transformURL(Te(e,this.baseURL),this.baseURL);return t.charAt(0)==="#"&&(t=t.substring(1)),t}getPageCounterVal(e,t){let i=()=>{let o=this.counterStore.currentPageCounters[e];return o&&o.length?o[o.length-1]:null},n=new We(this.pageScope,()=>t(i()),`page-counter-${e}`),r=o=>t(o[o.length-1]);return this.counterStore.registerPageCounterExpr(e,r,n),n}getPageCountersVal(e,t){let i=()=>this.counterStore.currentPageCounters[e]||[],n=new We(this.pageScope,()=>t(i()),`page-counters-${e}`);return this.counterStore.registerPageCounterExpr(e,t,n),n}getTargetCounters(e,t,i){let n=this.counterStore.countersById[t];return!n&&i&&e&&(this.styler.styleUntilIdIsReached(e),n=this.counterStore.countersById[t]),n||null}getTargetPageCounters(e){return this.counterStore.currentPage.elementsById[e]?this.counterStore.currentPageCounters:this.counterStore.pageCountersById[e]||null}getTargetCounterVal(e,t,i){let n=this.getFragment(e),r=this.getTransformedId(e),o=this.getTargetCounters(n,r,!1);if(o&&o[t]){let a=o[t];return new ze(this.rootScope,i(a[a.length-1]||null))}let s=new We(this.pageScope,()=>{if(o=this.getTargetCounters(n,r,!0),o)if(o[t]){let a=o[t];return i(a[a.length-1]||null)}else{let a=this.getTargetPageCounters(r);if(a)if(this.counterStore.resolveReference(r),a[t]){let h=a[t];return i(h[h.length-1]||null)}else return i(0);else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"}else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"},`target-counter-${t}-of-${e}`);return this.counterStore.registerTargetCounterExpr(t,i,s,r),s}getTargetCountersVal(e,t,i){let n=this.getFragment(e),r=this.getTransformedId(e);return new We(this.pageScope,()=>{let o=this.getTargetPageCounters(r);if(o){this.counterStore.resolveReference(r);let s=o[t]||[],a=this.getTargetCounters(n,r,!0)[t]||[];return i(s.concat(a))}else return this.counterStore.saveReferenceOfCurrentPage(r,!1),"??"},`target-counters-${t}-of-${e}`)}getNamedStringVal(e,t){return new We(this.pageScope,()=>this.getRunningValue(this.namedStringValues,e,t),`named-string-${t}-${e}`)}getRunningElementVal(e,t){return new We(this.pageScope,()=>this.getRunningValue(this.runningElements,e,t),`running-element-${t}-${e}`)}getRunningValue(e,t,i){let n=e[t];if(!n)return"";let r=Object.keys(n).map(d=>parseInt(d,10)).sort(Xl),o=this.counterStore.currentPage,s=o.isBlankPage?o.offset-1:o.offset,a=o.isBlankPage?s:Math.max(s,...Array.from(o.container.querySelectorAll(`[${At}]`)).map(d=>parseInt(d.getAttribute(At),10))),h=-1,l=-1,c=-1,p=-1;for(let d=0;d<r.length;d++){let f=r[d],g=d>0?r[d-1]:-1,m=d<r.length-1?r[d+1]:-1;if(f>a)break;if(f>=s){if(h<0&&(h=f,p=-1),l<0)if(f===s)l=f;else{g<h&&(l=g);let v=o.container.querySelector(`[${At}="${f}"]`);if(!v)l<0&&(l=f);else{let b=o.container.querySelector(`[${At}="${s}"]`);if(b||(b=o.container.querySelector(`[${At}="0"]`)),b){for(let w=b;w;w=w.firstElementChild)if(w===v){l=f;break}}}}c=f}else(m>a||m<0)&&(h=l=c=p=f)}return n[{first:h,start:l,last:c,"first-except":p}[i]]||""}setNamedString(e,t,i){let n=this.namedStringValues[e]||(this.namedStringValues[e]={});n[i]=t}setRunningElement(e,t){let i=this.runningElements[e]||(this.runningElements[e]={});i[t]=String(t)}},Pp=class{constructor(e){this.documentURLTransformer=e,u(this,"countersById",{}),u(this,"pageCountersById",{}),u(this,"currentPageCounters",{}),u(this,"previousPageCounters",{}),u(this,"currentPageCountersStack",[]),u(this,"pageIndicesById",{}),u(this,"currentPage",null),u(this,"newReferencesOfCurrentPage",[]),u(this,"referencesToSolve",[]),u(this,"referencesToSolveStack",[]),u(this,"unresolvedReferences",{}),u(this,"resolvedReferences",{}),u(this,"pagesCounterExprs",[]),u(this,"pageCounterExprs",[]),u(this,"targetCounterExprs",[]),this.currentPageCounters.page=[0]}createCounterListener(e){return new Ep(this,e)}createCounterResolver(e,t,i){return new kp(this,e,t,i)}setCurrentPage(e){this.currentPage=e}definePageCounter(e,t){this.currentPageCounters[e]?this.currentPageCounters[e].push(t):this.currentPageCounters[e]=[t]}forceSetPageCounter(e){let t=this.currentPageCounters.page;!t||!t.length?this.currentPageCounters.page=[e]:t[t.length-1]=e}updatePageCounters(e,t){this.previousPageCounters=ro(this.currentPageCounters);let i,n=e["counter-reset"];if(n){let s=n.evaluate(t);s&&(i=mn(s,!0))}if(i)for(let s in i)this.definePageCounter(s,i[s]);let r,o=e["counter-increment"];if(o){let s=o.evaluate(t);s&&(r=mn(s,!1))}r?"page"in r||(r.page=1):(r={},r.page=1);for(let s in r){this.currentPageCounters[s]||this.definePageCounter(s,0);let a=this.currentPageCounters[s];a[a.length-1]+=r[s]}}pushPageCounters(e){this.currentPageCountersStack.push(this.currentPageCounters),this.currentPageCounters=ro(e)}popPageCounters(){this.currentPageCounters=this.currentPageCountersStack.pop()}resolveReference(e){let t=this.unresolvedReferences[e],i=this.resolvedReferences[e];i||(i=this.resolvedReferences[e]=[]);let n=!1;for(let r=0;r<this.referencesToSolve.length;){let o=this.referencesToSolve[r];if(o.targetId===e){if(o.resolve(),this.referencesToSolve.splice(r,1),t){let s=t.indexOf(o);s>=0&&t.splice(s,1)}i.push(o),n=!0}else r++}n||this.saveReferenceOfCurrentPage(e,!0)}saveReferenceOfCurrentPage(e,t){if(!this.newReferencesOfCurrentPage.some(i=>i.targetId===e)){let i=new Cp(e,t);this.newReferencesOfCurrentPage.push(i)}}finishPage(e,t){let i=Object.keys(this.currentPage.elementsById);if(i.length>0){let o=ro(this.currentPageCounters);i.forEach(s=>{this.pageCountersById[s]=o;let a=this.pageIndicesById[s];if(a&&a.pageIndex<t){let h=this.resolvedReferences[s];if(h){let l=this.unresolvedReferences[s];l||(l=this.unresolvedReferences[s]=[]);let c;for(;c=h.shift();)c.unresolve(),l.push(c)}}this.pageIndicesById[s]={spineIndex:e,pageIndex:t}})}let n=this.previousPageCounters,r;for(;r=this.newReferencesOfCurrentPage.shift();){r.pageCounters=n,r.spineIndex=e,r.pageIndex=t;let o;r.isResolved()?(o=this.resolvedReferences[r.targetId],o||(o=this.resolvedReferences[r.targetId]=[])):(o=this.unresolvedReferences[r.targetId],o||(o=this.unresolvedReferences[r.targetId]=[])),o.every(s=>!r.equals(s))&&o.push(r)}this.currentPage=null}getUnresolvedRefsToPage(e){let t=[];Object.keys(e.elementsById).forEach(r=>{let o=this.unresolvedReferences[r];o&&(t=t.concat(o))}),t.sort((r,o)=>r.spineIndex-o.spineIndex||r.pageIndex-o.pageIndex);let i=[],n=null;return t.forEach(r=>{!n||n.spineIndex!==r.spineIndex||n.pageIndex!==r.pageIndex?(n={spineIndex:r.spineIndex,pageIndex:r.pageIndex,pageCounters:r.pageCounters,refs:[r]},i.push(n)):n.refs.push(r)}),i}pushReferencesToSolve(e){this.referencesToSolveStack.push(this.referencesToSolve),this.referencesToSolve=e}popReferencesToSolve(){this.referencesToSolve=this.referencesToSolveStack.pop()}registerPageCounterExpr(e,t,i){e==="pages"?this.pagesCounterExprs.push({expr:i,format:t}):this.pageCounterExprs.push({expr:i,format:t})}registerTargetCounterExpr(e,t,i,n){this.targetCounterExprs.push({name:e,expr:i,format:t,transformedId:n})}getExprContentListener(){return this.exprContentListener.bind(this)}exprContentListener(e,t,i){if(e instanceof We){if(e.str=="viv-leader"){let o=i.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute("data-viv-leader",e.key),o.setAttribute("data-viv-leader-value",t),o}else if(e.str.startsWith("running-element-")){let o=t&&i.querySelectorAll(`[${At}="${t}"]`);if(!o||o.length===0)return null;let s=o[o.length-1].cloneNode(!0);return this.fixPageCounterInRunningElement(s),s.style.position="",s.style.visibility="",s}else if(e.str.startsWith("target-counter-")){let o=i.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute(ao,e.key),o}}let n=this.pagesCounterExprs.findIndex(o=>o.expr===e)>=0,r=!n&&this.pageCounterExprs.findIndex(o=>o.expr===e)>=0;if(n||r){let o=i.createElementNS("http://www.w3.org/1999/xhtml","span");return o.textContent=t,o.setAttribute(n?oo:so,e.key),o}else return null}fixPageCounterInRunningElement(e){let t=e.querySelectorAll(`[${so}]`);for(let n of t){let r=n.getAttribute(so),o=this.pageCounterExprs.find(l=>l.expr.key===r),s=(o?.expr).str,a=s?.replace(/^page-counters?-/,""),h=this.currentPageCounters[a];h&&(n.textContent=o.format(h))}let i=e.querySelectorAll(`[${ao}]`);for(let n of i)n.setAttribute(Oa,!0)}finishLastPage(e){let t=e.root.querySelectorAll(`[${oo}]`),i=e.contentContainer.childElementCount;for(let r of t){let o=r.getAttribute(oo),s=this.pagesCounterExprs.findIndex(a=>a.expr.key===o);s>=0,r.textContent=this.pagesCounterExprs[s].format([i])}let n=e.root.querySelectorAll(`[${Oa}]`);for(let r of n){let o=r.getAttribute(ao),s=this.targetCounterExprs.find(a=>a.expr.key===o);if(s&&s.transformedId){let a=this.pageCountersById[s.transformedId];if(a){let h=a[s.name];h&&(r.textContent=s.format(h[h.length-1]))}}}}createLayoutConstraint(e){return new Np(this,e)}},oo="data-vivliostyle-pages-counter",so="data-vivliostyle-page-counter",ao="data-vivliostyle-target-counter",Oa="data-vivliostyle-target-counter-in-running",Np=class{constructor(e,t){this.counterStore=e,this.pageIndex=t}allowLayout(e){if(!e||e.after)return!0;let t=e.viewNode;if(!t||t.nodeType!==1)return!0;let i=t.getAttribute("data-vivliostyle-id")||t.getAttribute("id")||t.getAttribute("name");if(!i||!this.counterStore.resolvedReferences[i]&&!this.counterStore.unresolvedReferences[i])return!0;let n=this.counterStore.pageIndicesById[i];return n?this.pageIndex>=n.pageIndex:!0}};function Tp(e){if(e=e.substr(1),e.match(/^[^0-9a-fA-F\n\r]$/))return e;let t=parseInt(e,16);return isNaN(t)?"":t===0||t>=55296&&t<=57343||t>1114111?"\uFFFD":String.fromCodePoint(t)}function ri(e){return e.replace(/\\([0-9a-fA-F]{1,6}(\r\n|[ \n\r\t\f])?|[^0-9a-fA-F\n\r])/g,Tp)}var Ip=class{constructor(){u(this,"type"),u(this,"precededBySpace",!1),u(this,"num",0),u(this,"text",""),u(this,"position",0),this.type=0}toString(){switch(this.type){case 10:return"(";case 11:return")";case 12:return"{";case 13:return"}";case 14:return"[";case 15:return"]";case 16:return",";case 17:return";";case 18:return":";case 19:return"/";case 21:return"%";case 22:return"?";case 23:return"+";case 24:return"-";case 25:return"||";case 26:return"&&";case 31:return"!";case 32:return"$";case 33:return"^";case 34:return"|";case 35:return"~";case 36:return"*";case 37:return">";case 38:return"<";case 39:return"=";case 41:return"!=";case 42:return"$=";case 43:return"^=";case 44:return"|=";case 45:return"~=";case 46:return"*=";case 47:return">=";case 48:return"<=";case 49:return"==";case 50:return"::";case 51:return"<!--";case 52:return"-->";case 3:return this.num.toString()+this.text;case 4:case 5:return this.num.toString();case 20:return"@"+this.text;case 7:return"#"+this.text;case 6:return this.text+"(";case 9:return"."+this.text;case 0:return"/*EOF*/";default:return this.text}}};function De(e,t){let i=Array(128),n;for(n=0;n<128;n++)i[n]=e;for(i[NaN]=e==35?35:72,n=0;n<t.length;n+=2)i[t[n]]=t[n+1];return i}var Ft=[72,72,72,72,72,72,72,72,72,1,1,72,1,1,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,1,4,34,6,7,8,9,33,10,11,12,13,14,15,16,17,2,2,2,2,2,2,2,2,2,2,18,19,20,21,22,23,24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,29,26,30,3,72,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,27,31,28,32,72];Ft[NaN]=80;var Pt=[43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,52,43,43,43,43,39,43,43,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43,43,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,44,43,43,39,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43];Pt[NaN]=43;var Fp=[72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,78,59,72,59,59,59,59,59,59,59,59,59,59,72,72,72,72,72,72,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,61,72,72,78,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,72,72,72,72];Pt[NaN]=43;var Ph=[35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,57,59,35,58,58,58,58,58,58,58,58,58,58,35,35,35,35,35,35,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,61,35,35,60,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,35,35,35,35];Ph[NaN]=35;var Nh=[45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,53,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,44,45,45,39,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45];Nh[NaN]=45;var ko=[37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,41,37,37,37,37,37,37,37,37,42,37,39,39,39,39,39,39,39,39,39,39,37,37,37,37,37,37,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,40,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,37];ko[NaN]=37;var Po=[38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,38,38,38,38,38,38,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,40,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,38];Po[NaN]=38;var oi=De(35,[61,36]),Ap=De(35,[58,77]),Rp=De(35,[61,36,124,50]),Lp=De(35,[38,51]),Op=De(35,[42,54]),Bp=De(39,[42,55]),_p=De(54,[42,55,47,56]),Mp=De(62,[62,82]),zp=De(35,[61,36,33,70]),Dp=De(62,[45,71]),Vp=De(63,[45,81]),lo=De(76,[10,72,13,72]),Hp=De(39,[39,46,10,72,13,72,92,48]),Up=De(39,[34,46,10,72,13,72,92,49]),$p=De(39,[39,47,10,74,13,74,92,48]),Wp=De(39,[34,47,10,74,13,74,92,49]),Ba=De(64,[9,39,32,39,34,66,39,65,41,72,10,39,13,39]),Gp=De(39,[41,67,9,79,10,79,13,79,32,79,92,75,40,72,91,72,93,72,123,72,125,72,NaN,67]),jp=De(39,[39,68,10,74,13,74,92,75,NaN,67]),Xp=De(39,[34,68,10,74,13,74,92,75,NaN,67]),qp=De(72,[9,39,10,39,13,39,32,39,41,69]),Yp=15,St=class{constructor(e,t){this.input=e,this.handler=t,u(this,"indexMask"),u(this,"buffer"),u(this,"tail",0),u(this,"curr",0),u(this,"position",0),this.indexMask=Yp,this.buffer=Array(this.indexMask+1);for(let i=0;i<=this.indexMask;i++)this.buffer[i]=new Ip}token(){return this.tail==this.curr&&this.fillBuffer(),this.buffer[this.curr]}nthToken(e){return(this.tail-this.curr&this.indexMask)<=e&&this.fillBuffer(),this.buffer[this.curr+e&this.indexMask]}consume(){this.curr=this.curr+1&this.indexMask}fillBuffer(){let e=this.tail,t=this.curr,i=this.indexMask;if(e>=t?t+=i:t--,t==e)throw new Error("F_CSSTOK_INTERNAL");let n=Ft,r=this.input,o=this.position,s=this.buffer,a=0,h=0,l="",c=0,p=!1,d=s[e],f=-9;for(;;){let g=r.charCodeAt(o);switch(n[g]||n[65]){case 72:l=r.substring(h,o),isNaN(g)?a=0:a=54,n=Ft;break;case 1:o++,p=!0;continue;case 2:h=o++,n=ko;continue;case 3:a=1,h=o++,n=Pt;continue;case 4:h=o++,a=31,n=oi;continue;case 33:a=2,h=++o,n=Hp;continue;case 34:a=2,h=++o,n=Up;continue;case 6:h=++o,a=7,n=Pt;continue;case 7:h=o++,a=32,n=oi;continue;case 8:h=o++,a=21;break;case 9:h=o++,a=32,n=Lp;continue;case 10:h=o++,a=10;break;case 11:h=o++,a=11;break;case 12:h=o++,a=36,n=oi;continue;case 13:h=o++,a=23;break;case 14:h=o++,a=16;break;case 15:a=24,h=o++,n=Ph;continue;case 16:h=o++,n=Fp;continue;case 78:h=o++,a=9,n=Pt;continue;case 17:h=o++,a=19,n=Op;continue;case 18:h=o++,a=18,n=Ap;continue;case 77:o++,a=50;break;case 19:h=o++,a=17;break;case 20:h=o++,a=38,n=zp;continue;case 21:h=o++,a=39,n=oi;continue;case 22:h=o++,a=37,n=oi;continue;case 23:h=o++,a=22;break;case 24:h=++o,a=20,n=Pt;continue;case 25:h=o++,a=14;break;case 26:h=o++,a=15;break;case 27:h=o++,a=12;break;case 28:h=o++,a=13;break;case 29:h=o++,f=h,a=1,n=lo;continue;case 30:h=o++,a=33,n=oi;continue;case 31:h=o++,a=34,n=Rp;continue;case 32:h=o++,a=35,n=oi;continue;case 35:break;case 36:o++,a=a+41-31;break;case 37:a=5,c=parseInt(r.substring(h,o),10);break;case 38:a=4,c=parseFloat(r.substring(h,o));break;case 39:o++;continue;case 40:a=3,c=parseFloat(r.substring(h,o)),h=o++,n=Pt;continue;case 41:a=3,c=parseFloat(r.substring(h,o)),l="%",h=o++;break;case 42:o++,n=Po;continue;case 43:if(l=ri(r.substring(h,o)),a===27&&g===63||a===1&&l.toLowerCase()==="u"&&/^(\bu\+[?0-9a-f]+(-[?0-9a-f]+)?|,|\s+|\/\*([^*]|\*[^/])*\*\/)+[;}]/i.test(r.substring(o-1))){a=27,o++;continue}break;case 44:f=o++,n=lo;continue;case 45:l=ri(r.substring(h,o));break;case 46:l=r.substring(h,o),o++;break;case 47:l=ri(r.substring(h,o)),o++;break;case 48:f=o,o+=2,n=$p;continue;case 49:f=o,o+=2,n=Wp;continue;case 50:o++,a=25;break;case 51:o++,a=26;break;case 52:if(l=r.substring(h,o),a==1){if(o++,l.toLowerCase()=="url"){n=Ba;continue}a=6}break;case 53:if(l=ri(r.substring(h,o)),a==1){if(o++,l.toLowerCase()=="url"){n=Ba;continue}a=6}break;case 54:n=Bp,o++;continue;case 55:n=_p,o++;continue;case 56:n=Ft,o++;continue;case 57:n=Mp,o++,r[o]!==">"&&(a=1,n=Pt);continue;case 81:a=51,l=r.substring(h,++o),n=Ft;break;case 82:a=52,l=r.substring(h,++o),n=Ft;break;case 58:a=5,n=ko,o++;continue;case 59:a=4,n=Po,o++;continue;case 60:a=1,n=Pt,o++;continue;case 61:a=1,n=lo,f=o++;continue;case 62:o--;break;case 63:o-=2;break;case 64:h=o++,n=Gp;continue;case 65:h=++o,n=jp;continue;case 66:h=++o,n=Xp;continue;case 67:a=8,l=ri(r.substring(h,o)),o++;break;case 69:o++;break;case 70:n=Dp,o++;continue;case 71:n=Vp,o++;continue;case 79:if(o-f<8&&r.substring(f+1,o+1).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])|[ \t]$/)){o++;continue}case 68:a=8,l=ri(r.substring(h,o)),o++,n=qp;continue;case 74:if(o++,o-f<9&&r.substring(f+1,o).match(/^[0-9a-fA-F]{0,6}(\r\n|[\n\r])$/))continue;a=54,l="E_CSS_UNEXPECTED_NEWLINE",n=Ft;break;case 73:if(o-f<9&&r.substring(f+1,o+1).match(/^[0-9a-fA-F]{0,6}[ \t]$/)){o++,n=Pt;continue}l=ri(r.substring(h,o));break;case 75:f=o++;continue;case 76:o++,n=Nh;continue;default:if(n!==Ft){a=54,l="E_CSS_UNEXPECTED_STATE";break}h=o,a=0}if(d.type=a,d.precededBySpace=p,d.num=c,d.text=l,d.position=h,e++,e>=t)break;n=Ft,p=!1,d=s[e&i]}this.position=o,this.tail=e&i}},Oe=null,No=null;function To(){return Oe}function _(e){if(!Oe)throw new Error("E_TASK_NO_CONTEXT");Oe.name||(Oe.name=e);let t=Oe,i=new Mr(t,t.top,e);return t.top=i,i.state=1,i}function Kp(e){return new Jp(e||new Qp)}function P(e){return new Io(e)}function $i(e,t,i){let n=_(e);n.handler=i;try{t(n)}catch(r){n.task.raise(r,n)}return n.result()}function Zp(e,t){return(Oe?Oe.getScheduler():No||Kp()).run(e,t)}var Qp=class{currentTime(){return new Date().valueOf()}setTimeout(e,t){return setTimeout(e,t)}clearTimeout(e){clearTimeout(e)}},Jp=class{constructor(e){this.timer=e,u(this,"timeout",1),u(this,"slice",25),u(this,"sliceOverTime",0),u(this,"queue"),u(this,"wakeupTime",null),u(this,"timeoutToken",null),u(this,"inTimeSlice",!1),u(this,"order",0),this.queue=new Ad,No||(No=this)}setSlice(e){this.slice=e}setTimeout(e){this.timeout=e}isTimeSliceOver(){return this.timer.currentTime()>=this.sliceOverTime}arm(){if(this.inTimeSlice)return;let e=this.queue.peek().scheduledTime,t=this.timer.currentTime();if(this.timeoutToken!=null){if(t+this.timeout>this.wakeupTime)return;this.timer.clearTimeout(this.timeoutToken)}let i=e-t;i<=this.timeout&&(i=this.timeout),this.wakeupTime=t+i,this.timeoutToken=this.timer.setTimeout(()=>{this.timeoutToken=null,this.doTimeSlice()},i)}schedule(e,t){let i=e,n=this.timer.currentTime();i.order=this.order++,i.scheduledTime=n+(t||0),this.queue.add(i),this.arm()}doTimeSlice(){this.timeoutToken!=null&&(this.timer.clearTimeout(this.timeoutToken),this.timeoutToken=null),this.inTimeSlice=!0;try{let e=this.timer.currentTime();for(this.sliceOverTime=e+this.slice;this.queue.length();){let t=this.queue.peek();if(t.scheduledTime>e||(this.queue.remove(),t.canceled||t.resumeInternal(),e=this.timer.currentTime(),e>=this.sliceOverTime))break}}catch(e){U.error(e)}this.inTimeSlice=!1,this.queue.length()&&this.arm()}run(e,t){let i=new ef(this,t||"");i.top=new Mr(i,null,"bootstrap"),i.top.state=1,i.top.then(()=>{let r=()=>{i.running=!1;for(let o of i.callbacks)try{o()}catch(s){U.error(s)}};try{e().then(o=>{i.result=o,r()})}catch(o){i.raise(o),r()}});let n=Oe;return Oe=i,this.schedule(i.top.suspend("bootstrap")),Oe=n,i}},Th=class{constructor(e){this.task=e,u(this,"scheduledTime",0),u(this,"order",0),u(this,"result",null),u(this,"canceled",!1)}compare(e){let t=e;return t.scheduledTime-this.scheduledTime||t.order-this.order}getTask(){return this.task}schedule(e,t){this.result=e,this.task.scheduler.schedule(this,t)}resumeInternal(){let e=this.task;if(this.task=null,e&&e.continuation==this){e.continuation=null;let t=Oe;return Oe=e,e.top.finish(this.result),Oe=t,!0}return!1}cancel(){this.canceled=!0}},ef=class{constructor(e,t){this.scheduler=e,this.name=t,u(this,"callbacks",[]),u(this,"exception",null),u(this,"running",!0),u(this,"result",null),u(this,"waitTarget",null),u(this,"top",null),u(this,"continuation",null)}getName(){return this.name}interrupt(e){if(this.raise(e||new Error("E_TASK_INTERRUPT")),this!==Oe&&this.continuation){this.continuation.cancel();let t=new Th(this);this.waitTarget="interrupt",this.continuation=t,this.scheduler.schedule(t)}}getScheduler(){return this.scheduler}isRunning(){return this.running}whenDone(e){this.callbacks.push(e)}join(){let e=_("Task.join");if(!this.running)e.finish(this.result);else{let t=e.suspend(this);this.whenDone(()=>{t.schedule(this.result)})}return e.result()}unwind(){for(;this.top&&!this.top.handler;)this.top=this.top.parent;if(this.top&&this.top.handler&&this.exception){let e=this.exception;this.exception=null,this.top.handler(this.top,e)}else this.exception&&U.error(this.exception,"Unhandled exception in task",this.name)}raise(e,t){if(this.fillStack(e),t){let i=this.top;for(;i&&i!=t;)i=i.parent;i==t&&(this.top=i)}this.exception=e,this.unwind()}fillStack(e){let t=e.frameTrace;if(!t){t=e.stack?`${e.stack}
	---- async ---
`:"";for(let i=this.top;i;i=i.parent)t+="	",t+=i.getName(),t+=`
`;e.frameTrace=t}}},Io=class Ih{constructor(t){this.value=t}then(t){t(this.value)}thenAsync(t){return t(this.value)}thenReturn(t){return new Ih(t)}thenFinish(t){t.finish(this.value)}isPending(){return!1}get(){return this.value}},tf=class{constructor(e){this.frame=e}then(e){this.frame.then(e)}thenAsync(e){if(this.isPending()){let t=new Mr(this.frame.task,this.frame.parent,"AsyncResult.thenAsync");return t.state=1,this.frame.parent=t,this.frame.then(i=>{e(i).then(n=>{t.finish(n)})}),t.result()}else return e(this.frame.res)}thenReturn(e){return this.isPending()?this.thenAsync(()=>new Io(e)):new Io(e)}thenFinish(e){this.isPending()?this.then(t=>{e.finish(t)}):e.finish(this.frame.res)}isPending(){return this.frame.state==1}get(){if(this.isPending())throw new Error("Result is pending");return this.frame.res}},Mr=class{constructor(e,t,i){this.task=e,this.parent=t,this.name=i,u(this,"res",null),u(this,"state"),u(this,"callback",null),u(this,"handler",null),this.state=0}checkEnvironment(){if(!Oe)throw new Error("F_TASK_NO_CONTEXT");if(this!==Oe.top)throw new Error("F_TASK_NOT_TOP_FRAME")}result(){return new tf(this)}finish(e){this.checkEnvironment(),Oe&&!Oe.exception&&(this.res=e),this.state=2;let t=this.parent;if(Oe&&(Oe.top=t),this.callback){try{this.callback(e)}catch(i){this.task.raise(i,t)}this.state=3}}getTask(){return this.task}getName(){return this.name}getScheduler(){return this.task.scheduler}then(e){switch(this.state){case 1:if(this.callback)throw new Error("F_TASK_FRAME_ALREADY_HAS_CALLBACK");this.callback=e;break;case 2:{let t=this.task,i=this.parent;try{e(this.res),this.state=3}catch(n){this.state=3,t.raise(n,i)}break}case 3:throw new Error("F_TASK_DEAD_FRAME");default:throw new Error(`F_TASK_UNEXPECTED_FRAME_STATE ${this.state}`)}}timeSlice(){let e=_("Frame.timeSlice");return e.getScheduler().isTimeSliceOver()?(U.debug("-- time slice --"),e.suspend().schedule(!0)):e.finish(!0),e.result()}sleep(e){let t=_("Frame.sleep");return t.suspend().schedule(!0,e),t.result()}loop(e){let t=_("Frame.loop"),i=n=>{try{for(;n;){let r=e();if(r.isPending()){r.then(i);return}else r.then(o=>{n=o})}t.finish(!0)}catch(r){t.task.raise(r,t)}};return i(!0),t.result()}loopWithFrame(e){let t=Oe;if(!t)throw new Error("E_TASK_NO_CONTEXT");return this.loop(()=>{let i;do{let n=new nf(t,t.top);t.top=n,n.state=1,e(n),i=n.result()}while(!i.isPending()&&i.get());return i})}suspend(e){if(this.checkEnvironment(),this.task.continuation)throw new Error("E_TASK_ALREADY_SUSPENDED");let t=new Th(this.task);return this.task.continuation=t,Oe=null,this.task.waitTarget=e||null,t}},nf=class extends Mr{constructor(e,t){super(e,t,"loop")}continueLoop(){this.finish(!0)}breakLoop(){this.finish(!1)}},Dn=class{constructor(e,t){this.fetch=e,u(this,"name"),u(this,"arrived",!1),u(this,"resource",null),u(this,"task",null),u(this,"piggybacks",[]),this.name=t}start(){this.task||(this.task=To().getScheduler().run(()=>{let e=_("Fetcher.run");return this.fetch().then(t=>{let i=this.piggybacks;if(this.arrived=!0,this.resource=t,this.task=null,this.piggybacks=[],i)for(let n=0;n<i.length;n++)try{i[n](t)}catch(r){U.error(r,"Error:")}e.finish(t)}),e.result()},this.name))}piggyback(e){this.arrived?e(this.resource):this.piggybacks.push(e)}get(){return this.arrived?P(this.resource):(this.start(),this.task.join())}hasArrived(){return this.arrived}},zr=e=>{if(e.length==0)return P(!0);if(e.length==1)return e[0].get().thenReturn(!0);let t=_("waitForFetches"),i=0;return t.loop(()=>{for(;i<e.length;){let n=e[i++];if(!n.hasArrived())return n.get().thenReturn(!0)}return P(!1)}).then(()=>{t.finish(!0)}),t.result()},Fh=`
@media screen {
  [data-vivliostyle-viewer-viewport] {
    background: #aaaaaa;
  }

  [data-vivliostyle-page-container] {
    background: white;
    z-index: 0;
  }

  [data-vivliostyle-viewer-viewport] {
    box-sizing: border-box;
    display: flex;
    overflow: auto;
    position: relative;
  }

  [data-vivliostyle-outer-zoom-box] {
    margin: auto;
    overflow: hidden;
    flex: none;
  }

  [data-vivliostyle-viewer-viewport] [data-vivliostyle-spread-container] {
    display: flex;
    flex: none;
    justify-content: center;
    transform-origin: left top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="ltr"]
    [data-vivliostyle-spread-container] {
    flex-direction: row;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression="rtl"]
    [data-vivliostyle-spread-container] {
    flex-direction: row-reverse;
  }

  [data-vivliostyle-viewer-viewport] [data-vivliostyle-page-container] {
    margin: 0 auto;
    flex: none;
    transform-origin: center top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-page-side="left"] {
    margin-right: 1px;
    transform-origin: right top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-page-side="right"] {
    margin-left: 1px;
    transform-origin: left top;
  }

  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view="true"]
    [data-vivliostyle-page-container][data-vivliostyle-unpaired-page="true"] {
    margin-left: auto;
    margin-right: auto;
    transform-origin: center top;
  }
}
`,Ah=`
[data-vivliostyle-layout-box] {
  position: absolute;
  left: 0;
  top: 0;
  right: 0;
  bottom: 0;
  overflow: hidden;
  z-index: -1;
  transform-origin: left top;
}

[data-vivliostyle-debug] [data-vivliostyle-layout-box] {
  right: auto;
  bottom: auto;
  overflow: visible;
  z-index: auto;
}

[data-vivliostyle-spread-container] {
  transform: scale(var(--viv-outputScale,1));
  transform-origin: left top;
}

/* Emulate high pixel ratio using zoom & transform:scale() */
@supports (zoom: 8) {
  [data-vivliostyle-layout-box] {
    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));
    transform: scale(calc(var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));
  }
  [data-vivliostyle-spread-container] {
    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));
    transform: scale(calc(var(--viv-outputScale,1) * var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));
  }
  /* Workaround for Chromium's default border etc. widths not zoomed but scaled down */
  [data-vivliostyle-spread-container] :where([style*=border],[style*=outline],[style*=rule]) {
    border-width: medium;
    outline-width: medium;
    column-rule-width: medium;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar {
    width: 8px;
    height: 8px;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-track {
    background-color: #f4f4f4;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb {
    border-radius: 4px;
    background: #c7c7c7;
  }
  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb:hover {
    background: #7d7d7d;
  }
}

[data-vivliostyle-page-container] {
  position: relative;
}

[data-vivliostyle-bleed-box] {
  position: absolute;
  overflow: hidden;
  background-origin: content-box !important;
  box-sizing: border-box;
}

[data-vivliostyle-page-box] ~ [data-vivliostyle-page-box] {
  display: none;
}

[data-vivliostyle-toc-box] {
  position: absolute;
  left: 3px;
  top: 3px;
  overflow: scroll;
  overflow-x: hidden;
  background: rgba(248, 248, 248, 0.9);
  border-radius: 2px;
  box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);
}

@media print {
  [data-vivliostyle-toc-box] {
    display: none;
  }

  [data-vivliostyle-outer-zoom-box],
  [data-vivliostyle-spread-container] {
    width: 100% !important;
    height: 100% !important;
  }

  [data-vivliostyle-spread-container] {
    --viv-outputScale: 1 !important;
    --viv-devicePixelRatio: 1 !important;
    zoom: normal !important;
    transform: none !important;
  }

  @supports (zoom: 8) {
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
      zoom: var(--viv-outputPixelRatio,1);
      transform: scale(calc(1 / var(--viv-outputPixelRatio,1)));
      transform-origin: left top;
    }
  }

  [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
    display: block !important;
    max-height: 100vh;
  }

  [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:not(:last-child) {
    break-after: page;
  }

  /* Gecko-only hack, see https://bugzilla.mozilla.org/show_bug.cgi?id=267029#c17 */
  @-moz-document url-prefix()  {
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:nth-last-child(n + 2) {
      top: -1px;
      margin-top: 1px;
      margin-bottom: -1px;
    }
    /* Workaround Gecko problem on page break */
    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {
      break-after: auto !important;
      height: 100% !important;
    }
  }
}
`,Rh=`
/*
 * Copyright 2013 Google, Inc.
 * Copyright 2015 Daishinsha Inc.
 * Copyright 2019 Vivliostyle Foundation
 *
 * CSS property validation.
 */
NUM = POS_NUM | ZERO | NEGATIVE;
NNEG_NUM = POS_NUM | ZERO;
INT = POS_INT | ZERO | NEGATIVE;
NNEG_INT = POS_INT | ZERO;
PERCENTAGE = POS_PERCENTAGE | ZERO | NEGATIVE;
STRICT_PERCENTAGE = POS_PERCENTAGE | ZERO_PERCENTAGE | NEGATIVE;
NNEG_PERCENTAGE = POS_PERCENTAGE | ZERO;
LENGTH = POS_LENGTH | ZERO | NEGATIVE;
NNEG_LENGTH = POS_LENGTH | ZERO;
PLENGTH = LENGTH | PERCENTAGE;
PPLENGTH = POS_LENGTH | ZERO | POS_PERCENTAGE;
ALENGTH = LENGTH | auto;
APLENGTH = PLENGTH | auto;
PAPLENGTH = PPLENGTH | auto;
ANGLE = POS_ANGLE | ZERO | NEGATIVE;
LENGTH_OR_NUM = LENGTH | NUM;
ANGLE_OR_NUM = ANGLE | NUM;
MIN_MAX_FIT_CONTENT = min-content | max-content | fit-content;
BG_POSITION_TERM = PLENGTH | left | center | right | top | bottom;
URI_OR_NONE = URI | none;
IMAGE = URI | IMAGE_FUNCTION | none;
background-attachment = COMMA( [scroll | fixed | local]+ );
background-color = COLOR;
background-image = COMMA( IMAGE+ );
background-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */
background-repeat = COMMA( [repeat | repeat-x | repeat-y | no-repeat]+ );
border-collapse = collapse | separate;
BORDER_SIDE_COLOR = COLOR;
BORDER_SIDE_STYLE = none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset;
BORDER_SIDE_WIDTH = thin: 1px | medium: 3px | thick: 5px | NNEG_LENGTH;
border-spacing = LENGTH LENGTH?;
border-top-color = BORDER_SIDE_COLOR;
border-right-color = BORDER_SIDE_COLOR;
border-bottom-color = BORDER_SIDE_COLOR;
border-left-color = BORDER_SIDE_COLOR;
border-top-style = BORDER_SIDE_STYLE;
border-right-style = BORDER_SIDE_STYLE;
border-bottom-style = BORDER_SIDE_STYLE;
border-left-style = BORDER_SIDE_STYLE;
border-top-width = BORDER_SIDE_WIDTH;
border-right-width = BORDER_SIDE_WIDTH;
border-bottom-width = BORDER_SIDE_WIDTH;
border-left-width = BORDER_SIDE_WIDTH;
BORDER_RADIUS = PLENGTH{1,2};
border-top-left-radius = BORDER_RADIUS;
border-top-right-radius = BORDER_RADIUS;
border-bottom-right-radius = BORDER_RADIUS;
border-bottom-left-radius = BORDER_RADIUS;
border-image-source = IMAGE;
border-image-slice = [NUM | PERCENTAGE]{1,4} || fill; /* relaxed */
border-image-width = [NUM | PLENGTH | auto]{1,4};
border-image-outset = [NUM | LENGTH]{1,4};
border-image-repeat = [ stretch | repeat | round | space ]{1,2};
bottom = APLENGTH;
caption-side = top | bottom;
clear = none | left | right | top | bottom | both | all | same;
clip = rect(ALENGTH{4}) | rect(SPACE(ALENGTH{4})) | auto;
color = COLOR;
LIST_STYLE_TYPE = IDENT;
TYPE_OR_UNIT_IN_ATTR = string | color | url | integer | number | length | angle | time | frequency;
ATTR = attr(SPACE(IDENT TYPE_OR_UNIT_IN_ATTR?) [ STRING | IDENT | COLOR | INT | NUM | PLENGTH | ANGLE | POS_TIME | FREQUENCY]?);
CONTENT_LIST = [ STRING | URI | counter(IDENT LIST_STYLE_TYPE?) |
    counters(IDENT STRING LIST_STYLE_TYPE?) | ATTR |
    target-counter([ STRING | URI ] IDENT LIST_STYLE_TYPE?) |
    target-counter(ATTR IDENT LIST_STYLE_TYPE?) |
    target-counters([ STRING | URI ] IDENT STRING LIST_STYLE_TYPE?) |
    target-counters(ATTR IDENT STRING LIST_STYLE_TYPE?) |
    leader([ dotted | solid | space ] | STRING ) |
    open-quote | close-quote | no-open-quote | no-close-quote |
    content([ text | before | after | first-letter ]?) |
    string(IDENT [first | start | last | first-except]?) |
    element(IDENT [first | start | last | first-except]?) ]+;
CONTENT = normal | none | CONTENT_LIST;
content = CONTENT;
COUNTER = [ IDENT INT? ]+ | none;
counter-increment = COUNTER;
counter-reset = COUNTER;
counter-set = COUNTER;
cursor = COMMA(URI* [ auto | crosshair | default | pointer | move | e-resize | ne-resize | nw-resize |
    n-resize | se-resize | sw-resize | s-resize | w-resize | text | wait | help | progress ]);
direction = ltr | rtl;
display = inline | block | list-item | inline-block | table | inline-table | table-row-group |
    table-header-group | table-footer-group | table-row | table-column-group | table-column |
    table-cell | table-caption | none | oeb-page-head | oeb-page-foot | flex | inline-flex |
    ruby | ruby-base | ruby-text | ruby-base-container | ruby-text-container | run-in | compact | marker |
    flow-root | grid | inline-grid | contents;
empty-cells = show | hide;
FAMILY = SPACE(IDENT+) | STRING;
FAMILY_LIST = COMMA( FAMILY+ );
font-family = FAMILY_LIST;
font-size = xx-small | x-small | small | medium | large | x-large | xx-large | larger | smaller | PPLENGTH;
font-style = normal | italic | oblique;
font-weight = normal | bold | bolder | lighter | POS_NUM;
height = PAPLENGTH | MIN_MAX_FIT_CONTENT;
left = APLENGTH;
letter-spacing = normal | LENGTH_OR_NUM;
line-height = normal | POS_NUM | PPLENGTH;
list-style-image = IMAGE;
list-style-position = inside | outside;
list-style-type = LIST_STYLE_TYPE;
margin-right = APLENGTH;
margin-left = APLENGTH;
margin-top = APLENGTH;
margin-bottom = APLENGTH;
NPLENGTH = none | PLENGTH;
max-height = NPLENGTH | MIN_MAX_FIT_CONTENT;
max-width = NPLENGTH | MIN_MAX_FIT_CONTENT;
min-height = APLENGTH | MIN_MAX_FIT_CONTENT;
min-width = APLENGTH | MIN_MAX_FIT_CONTENT;
orphans = POS_INT;
outline-offset = LENGTH;
outline-color = COLOR | invert;
outline-style = BORDER_SIDE_STYLE;
outline-width = BORDER_SIDE_WIDTH;
overflow = visible | hidden | scroll | auto | clip;
padding-right = PPLENGTH;
padding-left = PPLENGTH;
padding-top = PPLENGTH;
padding-bottom = PPLENGTH;
PAGE_BREAK = auto | always | avoid | left | right | recto | verso;
page-break-after = PAGE_BREAK;
page-break-before = PAGE_BREAK;
page-break-inside = avoid | auto;
position = static | relative | absolute | fixed | running(IDENT);
quotes = [STRING STRING]+ | none | auto;
right = APLENGTH;
table-layout = auto | fixed;
text-align = left | right | center | justify | start | end;
text-indent = PLENGTH;
text-transform = capitalize | uppercase | lowercase | none;
top = APLENGTH;
vertical-align = baseline | sub | super | top | text-top | middle | bottom | text-bottom | PLENGTH;
visibility = visible | hidden | collapse;
white-space = normal | pre | nowrap | pre-wrap | pre-line | break-spaces;
widows = POS_INT;
width = PAPLENGTH | MIN_MAX_FIT_CONTENT;
word-spacing = normal | LENGTH_OR_NUM;
z-index = auto | INT;

[epub,moz,webkit]hyphens = auto | manual | none;
[webkit]hyphenate-character = auto | STRING;

/* css-logical */
margin-block-start = APLENGTH;
margin-block-end = APLENGTH;
margin-inline-start = APLENGTH;
margin-inline-end = APLENGTH;
padding-block-start = APLENGTH;
padding-block-end = APLENGTH;
padding-inline-start = APLENGTH;
padding-inline-end = APLENGTH;
border-block-start-color = BORDER_SIDE_COLOR;
border-block-end-color = BORDER_SIDE_COLOR;
border-inline-start-color = BORDER_SIDE_COLOR;
border-inline-end-color = BORDER_SIDE_COLOR;
border-block-start-style = BORDER_SIDE_STYLE;
border-block-end-style = BORDER_SIDE_STYLE;
border-inline-start-style = BORDER_SIDE_STYLE;
border-inline-end-style = BORDER_SIDE_STYLE;
border-block-start-width = BORDER_SIDE_WIDTH;
border-block-end-width = BORDER_SIDE_WIDTH;
border-inline-start-width = BORDER_SIDE_WIDTH;
border-inline-end-width = BORDER_SIDE_WIDTH;
block-start = APLENGTH;
block-end = APLENGTH;
inline-start = APLENGTH;
inline-end = APLENGTH;
block-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;
inline-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;
max-block-size = NPLENGTH | MIN_MAX_FIT_CONTENT;
max-inline-size = NPLENGTH | MIN_MAX_FIT_CONTENT;
min-block-size = APLENGTH | MIN_MAX_FIT_CONTENT;
min-inline-size = APLENGTH | MIN_MAX_FIT_CONTENT;

SHAPE = auto | rectangle( PLENGTH{4} ) |  ellipse( PLENGTH{4} ) |  circle( PLENGTH{3} ) |
    polygon( SPACE(PLENGTH+)+ );
[epubx]shape-inside = SHAPE;
[epubx,webkit]shape-outside = SHAPE;
[epubx]wrap-flow = auto | both | start | end | maximum | clear | around /* epub al */;

TRANSFORM_FUNCTION = matrix(NUM{6}) | translate(PLENGTH{1,2}) | translateX(PLENGTH) | translateY(PLENGTH) |
 scale(NUM{1,2}) | scaleX(NUM) | scaleY(NUM) | rotate(ANGLE) | skewX(ANGLE) | skewY(ANGLE);
[epub]transform = none | TRANSFORM_FUNCTION+;
[epub]transform-origin = [[[ top | bottom | left | right] PLENGTH?] | center | PLENGTH]{1,2}; /* relaxed */

BOX = border-box | padding-box | content-box;
SHADOW = SPACE(inset || LENGTH{2,4} || COLOR); /* relaxed */
[webkit]background-size = COMMA( SPACE( [PLENGTH | auto ]{1,2} | cover | contain)+ );
[webkit]background-origin = COMMA( BOX+ );
[webkit]background-clip = COMMA( BOX+ );
[webkit]box-shadow = none | COMMA( SHADOW+ );
text-shadow = none |  COMMA( SHADOW+ );
[webkit]box-decoration-break = slice | clone;
FILTER_FUNCTION = blur(LENGTH) | brightness(NUM | PERCENTAGE) | contrast(NUM | PERCENTAGE) | drop-shadow(SPACE(LENGTH{2,3} COLOR?))
                | grayscale(NUM | PERCENTAGE) | hue-rotate(ANGLE) | invert(NUM | PERCENTAGE) | opacity(NUM | PERCENTAGE)
                | saturate(NUM | PERCENTAGE) | sepia(NUM | PERCENTAGE);
FILTER_FUNCTION_LIST = FILTER_FUNCTION+;
[webkit]filter = none | FILTER_FUNCTION_LIST;

opacity = NUM;

[moz,webkit]column-width = LENGTH | auto;
[moz,webkit]column-count = INT | auto;
[moz,webkit]column-gap = LENGTH | normal;
[moz,webkit]column-rule-color = COLOR;
[moz,webkit]column-rule-style = BORDER_SIDE_STYLE;
[moz,webkit]column-rule-width = BORDER_SIDE_WIDTH;
BREAK = auto | avoid | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region;
break-before = BREAK;
break-after = BREAK;
break-inside = auto | avoid | avoid-page | avoid-column | avoid-region;
[webkit]column-span = none | auto | all;
[moz]column-fill = auto | balance | balance-all;
margin-break = auto | keep | discard;

src = COMMA([SPACE(URI format(STRING+)?) | local(FAMILY)]+); /* for font-face */

[epubx,webkit]flow-from = IDENT;
[epubx,webkit]flow-into = IDENT;
[epubx]flow-linger = INT | none;
[epubx]flow-priority = INT;
[epubx]flow-options = none | [ exclusive || last || static ];
[epubx]page = INT | auto | IDENT; /* page: IDENT is for CSS Paged Media */
[epubx]min-page-width = LENGTH;
[epubx]min-page-height = LENGTH;
[epubx]required = true | false;
[epubx]enabled = true | false;
[epubx]conflicting-partitions = COMMA(IDENT+);
[epubx]required-partitions = COMMA(IDENT+);
[epubx]snap-height = LENGTH | none;
[epubx]snap-width = LENGTH | none;
[epubx]flow-consume = all | some;
[epubx]utilization = NUM;
[epubx]text-zoom = font-size | scale;

[adapt]template = URI_OR_NONE | footnote;
[adapt]behavior = IDENT;

/* CSS Fonts */
COMMON_LIG_VALUES        = [ common-ligatures | no-common-ligatures ];
DISCRETIONARY_LIG_VALUES = [ discretionary-ligatures | no-discretionary-ligatures ];
HISTORICAL_LIG_VALUES    = [ historical-ligatures | no-historical-ligatures ];
CONTEXTUAL_ALT_VALUES    = [ contextual | no-contextual ];
font-variant-ligatures = normal | none | [ COMMON_LIG_VALUES || DISCRETIONARY_LIG_VALUES || HISTORICAL_LIG_VALUES || CONTEXTUAL_ALT_VALUES ];
font-variant-caps = normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps;
NUMERIC_FIGURE_VALUES   = [ lining-nums | oldstyle-nums ];
NUMERIC_SPACING_VALUES  = [ proportional-nums | tabular-nums ];
NUMERIC_FRACTION_VALUES = [ diagonal-fractions | stacked-fractions ];
font-variant-numeric = normal | [ NUMERIC_FIGURE_VALUES || NUMERIC_SPACING_VALUES || NUMERIC_FRACTION_VALUES || ordinal || slashed-zero ];
EAST_ASIAN_VARIANT_VALUES = [ jis78 | jis83 | jis90 | jis04 | simplified | traditional ];
EAST_ASIAN_WIDTH_VALUES   = [ full-width | proportional-width ];
font-variant-east-asian = normal | [ EAST_ASIAN_VARIANT_VALUES || EAST_ASIAN_WIDTH_VALUES || ruby ];
font-variant_css2 = normal | small-caps; /* for font shorthand */
font-size-adjust = none | NNEG_NUM;
[webkit]font-kerning = auto | normal | none;
font-feature-settings = COMMA( normal | SPACE( STRING [ on | off | INT ]? )+ );
FONT_STRETCH_CSS3_VALUES = normal | wider | narrower | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded;
font-stretch = FONT_STRETCH_CSS3_VALUES | PERCENTAGE;
font-stretch_css3 = FONT_STRETCH_CSS3_VALUES; /* for font shorthand */
font-display = [ auto | block | swap | fallback | optional ];
unicode-range = COMMA( URANGE+ );

/* CSS Images */
image-resolution = RESOLUTION;
object-fit = fill | contain | cover | none | scale-down;
object-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */

/* CSS Paged Media */
PAGE_SIZE = a10 | a9 | a8 | a7 | a6 | a5 | a4 | a3 | a2 | a1 | a0
          | b10 | b9 | b8 | b7 | b6 | b5 | b4 | b3 | b2 | b1 | b0
          | c10 | c9 | c8 | c7 | c6 | c5 | c4 | c3 | c2 | c1 | c0
          | jis-b10 | jis-b9 | jis-b8 | jis-b7 | jis-b6 | jis-b5 | jis-b4 | jis-b3 | jis-b2 | jis-b1 | jis-b0
          | letter | legal | ledger;
bleed = auto | LENGTH;
marks = none | [ crop || cross ];
size = POS_LENGTH{1,2} | auto | [ PAGE_SIZE || [ portrait | landscape ] ];
crop-offset = auto | LENGTH;

/* CSS Page Floats */
float-reference = inline | column | region | page;
float = block-start | block-end | inline-start | inline-end | snap-block | snap-inline | left | right | top | bottom | none | footnote;
float-min-wrap-block = PPLENGTH;

/* CSS Ruby */
ruby-align = start | center | space-between | space-around;
ruby-position = over | under | inter-character;

/* CSS Size Adjust */
[moz]text-size-adjust = auto | none | POS_PERCENTAGE;

/* CSS Text */
[webkit]line-break = auto | loose | normal | strict | anywhere;
overflow-wrap = normal | break-word | anywhere;
[moz]tab-size = NNEG_INT | NNEG_LENGTH;
[moz]text-align-last = auto | start | end | left | right | center | justify;
text-justify = auto | none | inter-word | inter-character;
word-break = normal | keep-all | break-all | break-word;
text-spacing-trim = auto | normal | space-all | trim-both | trim-auto |
    [[ trim-start | space-start | space-first ] ||
     [ trim-end | space-end | allow-end ] ||
     [ trim-adjacent | space-adjacent ]];
text-autospace = normal | auto | no-autospace |
    [[ ideograph-alpha || ideograph-numeric || punctuation ] || [ insert | replace ]];
hanging-punctuation = none | [ first || [ force-end | allow-end ] || last ];

/* CSS Text Decoration */
[webkit]text-decoration-color = COLOR;
[webkit]text-decoration-line = none | [ underline || overline || line-through || blink ];
[webkit]text-decoration-skip = none | [ objects || spaces || ink || edges || box-decoration ];
[webkit]text-decoration-style = solid | double | dotted | dashed | wavy;
[webkit]text-decoration-thickness = from-font | APLENGTH;
[epub,webkit]text-emphasis-color = COLOR;
[webkit]text-emphasis-position = [ over | under ] [ right | left ];
[epub,webkit]text-emphasis-style = none | [[ filled | open ] || [ dot | circle | double-circle | triangle | sesame ]] | STRING;
[webkit]text-underline-position = auto | [ under || [ left | right ]];

/* CSS Transforms */
[webkit]backface-visibility = visible | hidden;

/* CSS UI */
box-sizing = content-box | padding-box | border-box;
text-overflow = [clip | ellipsis | STRING]{1,2};

/* CSS Writing Modes */
[epub,webkit]text-combine = none | horizontal;
text-combine-upright = none | all; /* relaxed */
[epub,webkit]text-orientation = mixed | upright | sideways-right | sideways-left | sideways | use-glyph-orientation /* the following values are kept for backward-compatibility */ | vertical-right | rotate-right | rotate-left | rotate-normal | auto;
unicode-bidi = normal | embed | isolate | bidi-override | isolate-override | plaintext;
[epub,webkit]writing-mode = horizontal-tb | vertical-rl | lr-tb | rl-tb | tb-rl | lr | rl | tb;

/* CSS Flex box */
FLEX_BASIS = content | PAPLENGTH;
flex-direction = row | row-reverse | column | column-reverse;
flex-wrap = nowrap | wrap | wrap-reverse;
order = INT;
flex-grow = NNEG_NUM;
flex-shrink = NNEG_NUM;
flex-basis = FLEX_BASIS;
flex = none | [ [ NNEG_NUM NNEG_NUM? ] || FLEX_BASIS ];
justify-content = flex-start | flex-end | center | space-between | space-around;
align-items = flex-start | flex-end | center | baseline | stretch;
align-self = auto | flex-start | flex-end | center | baseline | stretch;
align-content = flex-start | flex-end | center | space-between | space-around | stretch;

/* Pointer Events */
touch-action = auto | none | [ pan-x || pan-y ] | manipulation;

/* SVG 2 */
OPACITY_VALUE = NUM | PERCENTAGE;
DASH_ARRAY = COMMA( SPACE( [ LENGTH | PERCENTAGE | NUM ]+ )+ );
PAINT = none | child | child(INT) | COLOR | SPACE( URI [none | COLOR]? ) | context-fill | context-stroke;
color-interpolation = auto | sRGB | linearRGB;
color-rendering = auto | optimizeSpeed | optimizeQuality;
fill = PAINT;
fill-opacity = OPACITY_VALUE;
fill-rule = nonzero | evenodd;
glyph-orientation-vertical = auto | NUM | ANGLE;
image-rendering = auto | optimizeSpeed | optimizeQuality | crisp-edges | pixelated;
marker-start = none | URI;
marker-mid = none | URI;
marker-end = none | URI;
pointer-events = bounding-box | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | none;
paint-order = normal | [ fill || stroke || markers ];
shape-rendering = auto | optimizeSpeed | crispEdges | geometricPrecision;
stop-color = COLOR;
stop-opacity = OPACITY_VALUE;
stroke = PAINT;
stroke-dasharray = none | DASH_ARRAY;
stroke-dashoffset = PERCENTAGE | LENGTH_OR_NUM;
stroke-linecap = butt | round | square;
stroke-linejoin = miter | round | bevel;
stroke-miterlimit = NUM;
stroke-opacity = OPACITY_VALUE;
stroke-width = PERCENTAGE | LENGTH_OR_NUM;
text-anchor = start | middle | end;
text-rendering = auto | optimizeSpeed | optimizeLegibility | geometricPrecision;
vector-effect = none | SPACE( [ non-scaling-stroke | non-scaling-size | non-rotation | fixed-position ]+ [ viewport | screen ]? );

/* SVG 1.1 */
alignment-baseline = auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical;
baseline-shift = baseline | sub | super | PERCENTAGE | LENGTH_OR_NUM;
dominant-baseline = auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge;
mask = none | URI;

/* css-masking-1 */
SHAPE_RADIUS = PLENGTH | closest-side | farthest-side;
FILL_RULE = nonzero | evenodd;
SHAPE_BOX = BOX | margin-box;
GEOMETRY_BOX = SHAPE_BOX | fill-box | stroke-box | view-box;
BASIC_SHAPE =
    inset( SPACE( PLENGTH{1,4} [ round PLENGTH{1,4} [ SLASH PLENGTH{1,4} ]? ]? ) )
  | circle(  SPACE( [SHAPE_RADIUS]?    [at BG_POSITION_TERM{1,4}]? ) )
  | ellipse( SPACE( SHAPE_RADIUS{2}? [at BG_POSITION_TERM{1,4}]? ) )
  | polygon( FILL_RULE? COMMA( SPACE( PLENGTH{2} )+ )+ );
[webkit]clip-path = none | URI | [ BASIC_SHAPE || GEOMETRY_BOX ];
clip-rule = nonzero | evenodd;

/* filters */
flood-color = COLOR;
flood-opacity = OPACITY_VALUE;
lighting-color = COLOR;

/* compositing-1 */
BLEND_MODE = normal | multiply | screen | overlay | darken | lighten | color-dodge | color-burn | hard-light | soft-light | difference | exclusion | hue | saturation | color | luminosity;
mix-blend-mode = BLEND_MODE;
isolation = auto | isolate;
background-blend-mode = COMMA( BLEND_MODE+ );

/* CSS GCPM */
string-set = COMMA( SPACE( IDENT CONTENT_LIST )+ | none );
footnote-policy = auto | line;

/* CSS Repeated Headers and Footers */
[viv]repeat-on-break = auto | none | header | footer;

/* Compatibility */
[webkit]text-fill-color = COLOR;
[webkit]text-stroke-color = COLOR;
[webkit]text-stroke-width = BORDER_SIDE_WIDTH;

DEFAULTS

background-attachment: scroll;
background-color: transparent;
background-image: none;
background-repeat: repeat;
background-position: 0% 0%;
background-clip: border-box;
background-origin: padding-box;
background-size: auto;
border-top-color: currentColor;
border-right-color: currentColor;
border-bottom-color: currentColor;
border-left-color: currentColor;
border-top-style: none;
border-right-style: none;
border-bottom-style: none;
border-left-style: none;
border-top-width: 3px;
border-right-width: 3px;
border-bottom-width: 3px;
border-left-width: 3px;
border-top-left-radius: 0;
border-top-right-radius: 0;
border-bottom-right-radius: 0;
border-bottom-left-radius: 0;
border-image-source: none;
border-image-slice: 100%;
border-image-width: 1;
border-image-outset: 0;
border-image-repeat: stretch;
column-count: auto;
column-gap: normal;
column-width: auto;
column-rule-color: currentColor;
column-rule-style: none;
column-rule-width: 3px;
column-fill: balance;
outline-color: currentColor;
outline-style: none;
outline-width: 3px;
flex-direction: row;
flex-wrap: nowrap;
font-family: serif;
font-style: normal;
font-size: medium;
font-size-adjust: none;
font-kerning: auto;
font-feature-settings: normal;
font-variant-ligatures: normal;
font-variant-caps: normal;
font-variant-numeric: normal;
font-variant-east-asian: normal;
font-weight: normal;
font-stretch: normal;
line-height: normal;
list-style-image: none;
list-style-position: outside;
list-style-type: disc;
margin-bottom: auto;
margin-left: auto;
margin-right: auto;
margin-top: auto;
padding-bottom: auto;
padding-left: auto;
padding-right: auto;
padding-top: auto;
text-autospace: normal;
text-emphasis-color: currentColor;
text-emphasis-style: none;
text-spacing-trim: normal;
text-stroke-color: currentColor;
text-stroke-width: 0;
marker-start: none;
marker-mid: none;
marker-end: none;

/* css-logical */
border-block-start-color: currentColor;
border-block-end-color: currentColor;
border-inline-start-color: currentColor;
border-inline-end-color: currentColor;
border-block-start-style: none;
border-block-end-style: none;
border-inline-start-style: none;
border-inline-end-style: none;
border-block-start-width: 3px;
border-block-end-width: 3px;
border-inline-start-width: 3px;
border-inline-end-width: 3px;

SHORTHANDS

all = ALL;
background = COMMA background-image [background-position [ / background-size ]] background-repeat
     background-attachment [background-origin background-clip] background-color; /* background-color is a special case, see the code */
border-top = border-top-width border-top-style border-top-color;
border-right = border-right-width border-right-style border-right-color;
border-bottom = border-bottom-width border-bottom-style border-bottom-color;
border-left = border-left-width border-left-style border-left-color;
border-width = INSETS border-top-width border-right-width border-bottom-width border-left-width;
border-style = INSETS border-top-style border-right-style border-bottom-style border-left-style;
border-color = INSETS border-top-color border-right-color border-bottom-color border-left-color;
border = border-width border-style border-color;
border-image = border-image-source border-image-slice [ / border-image-width [ / border-image-outset ] ]
     border-image-repeat;
border-radius = INSETS_SLASH border-top-left-radius border-top-right-radius
     border-bottom-right-radius border-bottom-left-radius;
[moz,webkit]columns = column-width column-count;
[moz,webkit]column-rule = column-rule-width column-rule-style column-rule-color;
flex-flow = flex-direction flex-wrap;
oeb-column-number = column-count;
outline = outline-width outline-style outline-color;
list-style = list-style-position list-style-type list-style-image;
margin = INSETS margin-top margin-right margin-bottom margin-left;
padding = INSETS padding-top padding-right padding-bottom padding-left;
font = FONT font-style font-variant_css2 font-weight font-stretch_css3 /* font-size line-height font-family are special-cased */;
font-variant = font-variant-ligatures font-variant-caps font-variant-numeric font-variant-east-asian;
[epub,webkit]text-emphasis = text-emphasis-style text-emphasis-color;
marker = INSETS marker-start marker-mid marker-end;
[webkit]text-stroke = text-stroke-width text-stroke-color;
text-decoration = text-decoration-line text-decoration-color text-decoration-style text-decoration-thickness;
text-spacing = TEXT_SPACING text-autospace text-spacing-trim;

/* css-logical */
margin-block = INSETS margin-block-start margin-block-end;
margin-inline = INSETS margin-inline-start margin-inline-end;
padding-block = INSETS padding-block-start padding-block-end;
padding-inline = INSETS padding-inline-start padding-inline-end;
border-block-width = INSETS border-block-start-width border-block-end-width;
border-block-style = INSETS border-block-start-style border-block-end-style;
border-block-color = INSETS border-block-start-color border-block-end-color;
border-inline-width = INSETS border-inline-start-width border-inline-end-width;
border-inline-style = INSETS border-inline-start-style border-inline-end-style;
border-inline-color = INSETS border-inline-start-color border-inline-end-color;
border-block = border-block-width border-block-style border-block-color;
border-inline = border-inline-width border-inline-style border-inline-color;
border-block-start = border-block-start-width border-block-start-style border-block-start-color;
border-block-end = border-block-end-width border-block-end-style border-block-end-color;
border-inline-start = border-inline-start-width border-inline-start-style border-inline-start-color;
border-inline-end = border-inline-end-width border-inline-end-style border-inline-end-color;
inset-block-start = block-start;
inset-block-end = block-end;
inset-inline-start = inline-start;
inset-inline-end = inline-end;
inset-block = INSETS block-start block-end;
inset-inline = INSETS inline-start inline-end;
inset = INSETS top right bottom left;

/* old names  */
word-wrap = overflow-wrap;
[adapt,webkit]margin-before = margin-block-start;
[adapt,webkit]margin-after = margin-block-end;
[adapt,webkit]margin-start = margin-inline-start;
[adapt,webkit]margin-end = margin-inline-end;
[adapt,webkit]padding-before = padding-block-start;
[adapt,webkit]padding-after = padding-block-end;
[adapt,webkit]padding-start = padding-inline-start;
[adapt,webkit]padding-end = padding-inline-end;
[adapt,webkit]border-before-color = border-block-start-color;
[adapt,webkit]border-after-color = border-block-end-color;
[adapt,webkit]border-start-color = border-inline-start-color;
[adapt,webkit]border-end-color = border-inline-end-color;
[adapt,webkit]border-before-style = border-block-start-style;
[adapt,webkit]border-after-style = border-block-end-style;
[adapt,webkit]border-start-style = border-inline-start-style;
[adapt,webkit]border-end-style = border-inline-end-style;
[adapt,webkit]border-before-width = border-block-start-width;
[adapt,webkit]border-after-width = border-block-end-width;
[adapt,webkit]border-start-width = border-inline-start-width;
[adapt,webkit]border-end-width = border-inline-end-width;
[adapt,webkit]before = block-start;
[adapt,webkit]after = block-end;
[adapt,webkit]start = inline-start;
[adapt,webkit]end = inline-end;

`,Lh=`
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:s="http://www.pyroxy.com/ns/shadow">
<head>
<style><![CDATA[

.-vivliostyle-footnote-content {
  float: footnote;
}

.-vivliostyle-table-cell-container {
  display: block;
}

]]></style>
</head>
<body>

<s:template id="footnote"><s:content/><s:include class="-vivliostyle-footnote-content"/></s:template>

<s:template id="table-cell"><div data-vivliostyle-flow-root="true" class="-vivliostyle-table-cell-container"><s:content/></div></s:template>

</body>
</html>`,Oh=`
@namespace "http://www.w3.org/1999/xhtml";

:root {
  hyphens: -epubx-expr(pref-hyphenate? "auto": "manual");
}
:root[data-vivliostyle-epub-spine-properties~="page-spread-left"] {
  break-before: left;
}
:root[data-vivliostyle-epub-spine-properties~="page-spread-right"] {
  break-before: right;
}

@-adapt-footnote-area {
  display: block;
  margin-block-start: 0.5em;
  margin-block-end: 0.5em;
}

@-adapt-footnote-area ::before {
  display: block;
  border-block-start-width: 1px;
  border-block-start-style: solid;
  border-block-start-color: black;
  margin-block-end: 0.4em;
  margin-inline-start: 0;
  margin-inline-end: 60%;
}

/* default page master */
@-epubx-page-master :background-host {
  @-epubx-partition :layout-host {
    -epubx-flow-from: body;
    top: -epubx-expr(header.margin-bottom-edge);
    bottom: -epubx-expr(page-height - footer.margin-top-edge);
    left: 0px;
    right: 0px;
    column-width: 25em;
  }
  @-epubx-partition footer :oeb-page-foot {
    writing-mode: horizontal-tb;
    -epubx-flow-from: oeb-page-foot;
    bottom: 0px;
    left: 0px;
    right: 0px;
  }
  @-epubx-partition header :oeb-page-head {
    writing-mode: horizontal-tb;
    -epubx-flow-from: oeb-page-head;
    top: 0px;
    left: 0px;
    right: 0px;
  }
}

@page {
  @top-left-corner {
    text-align: right;
    vertical-align: middle;
  }
  @top-left {
    text-align: left;
    vertical-align: middle;
  }
  @top-center {
    text-align: center;
    vertical-align: middle;
  }
  @top-right {
    text-align: right;
    vertical-align: middle;
  }
  @top-right-corner {
    text-align: left;
    vertical-align: middle;
  }
  @left-top {
    text-align: center;
    vertical-align: top;
  }
  @left-middle {
    text-align: center;
    vertical-align: middle;
  }
  @left-bottom {
    text-align: center;
    vertical-align: bottom;
  }
  @right-top {
    text-align: center;
    vertical-align: top;
  }
  @right-middle {
    text-align: center;
    vertical-align: middle;
  }
  @right-bottom {
    text-align: center;
    vertical-align: bottom;
  }
  @bottom-left-corner {
    text-align: right;
    vertical-align: middle;
  }
  @bottom-left {
    text-align: left;
    vertical-align: middle;
  }
  @bottom-center {
    text-align: center;
    vertical-align: middle;
  }
  @bottom-right {
    text-align: right;
    vertical-align: middle;
  }
  @bottom-right-corner {
    text-align: left;
    vertical-align: middle;
  }
}

@media print {
  @page {
    margin: 10%;
  }
}
`,Bh=`
@namespace "http://www.w3.org/1999/xhtml";
@namespace m "http://www.w3.org/1998/Math/MathML";
@namespace epub "http://www.idpf.org/2007/ops";

html,
address,
blockquote,
body,
dd,
div,
dl,
dt,
fieldset,
form,
frame,
frameset,
h1,
h2,
h3,
h4,
h5,
h6,
noframes,
ol,
p,
ul,
center,
dir,
hr,
menu,
pre,
details,
dialog,
legend,
listing,
optgroup,
option,
plaintext,
search,
xmp,
article,
section,
nav,
aside,
hgroup,
footer,
header,
figure,
figcaption,
main {
  display: block;
}
li {
  display: list-item;
}
head {
  display: none !important;
}
table {
  display: table;
}
tr {
  display: table-row;
}
thead {
  display: table-header-group;
  break-after: avoid;
}
tbody {
  display: table-row-group;
}
tfoot {
  display: table-footer-group;
  break-before: avoid;
}
col {
  display: table-column;
}
colgroup {
  display: table-column-group;
}
td,
th {
  display: table-cell;
}
caption {
  display: table-caption;
  text-align: center;
}
th {
  font-weight: bolder;
  text-align: center;
}
*[hidden],
link,
style,
script {
  display: none;
}
h1 {
  font-size: 2em;
  margin-block: 0.67em;
}
h2 {
  font-size: 1.5em;
  margin-block: 0.83em;
}
h3 {
  font-size: 1.17em;
  margin-block: 1em;
}
h4 {
  font-size: 1em;
  margin-block: 1.33em;
}
h5 {
  font-size: 0.83em;
  margin-block: 1.67em;
}
h6 {
  font-size: 0.67em;
  margin-block: 2.33em;
}
h1,
h2,
h3,
h4,
h5,
h6 {
  font-weight: bold;
  break-after: avoid;
}
p,
blockquote,
figure,
ul,
ol,
dl,
dir,
menu {
  margin-block: 1em;
}
b,
strong {
  font-weight: bolder;
}
blockquote,
figure {
  margin-inline: 40px;
}
i,
cite,
dfn,
em,
var,
address {
  font-style: italic;
}
pre,
tt,
code,
kbd,
samp {
  font-family: monospace;
  text-spacing: none;
  hanging-punctuation: none;
}
listing,
plaintext,
xmp,
pre {
  white-space: pre;
}
pre[wrap] {
  white-space: pre-wrap;
}
button,
textarea,
input,
select {
  display: inline-block;
}
big {
  font-size: 1.17em;
}
small,
sub,
sup {
  font-size: 0.83em;
}
sub {
  vertical-align: sub;
}
sup {
  vertical-align: super;
}
table {
  box-sizing: border-box;
  border-spacing: 2px;
  border-collapse: separate;
  text-indent: initial;
}
thead,
tbody,
tfoot,
table > tr {
  vertical-align: middle;
}
tr,
td,
th {
  vertical-align: inherit;
}
s,
strike,
del {
  text-decoration: line-through;
}
hr {
  border-style: inset;
  border-width: 1px;
  margin-block: 0.5em;
}
hr[color],
hr[noshade] {
  border-style: solid;
}
ol,
ul,
dir,
menu {
  padding-inline-start: 40px;
}
dd {
  margin-inline-start: 40px;
}
ol ul,
ul ol,
ul ul,
ol ol {
  margin-block: 0;
}
u,
ins {
  text-decoration: underline;
}
center {
  text-align: center;
}
q::before {
  content: open-quote;
}
q::after {
  content: close-quote;
}

ruby {
  display: ruby;
}
rp {
  display: none;
}
rbc {
  display: ruby-base-container;
}
rtc {
  display: ruby-text-container;
}
rb {
  display: ruby-base;
  white-space: nowrap;
}
rt {
  display: ruby-text;
}
rtc,
rt {
  text-emphasis: none;
  white-space: nowrap;
  line-height: 1;
}
rtc,
rt {
  font-size: 50%;
}
rtc:lang(zh-TW),
rt:lang(zh-TW) {
  font-size: 30%;
}
rtc > rt,
rtc > rt:lang(zh-TW) {
  font-size: 100%;
}

/* Bidi settings */
bdo[dir="ltr"] {
  direction: ltr;
  unicode-bidi: bidi-override;
}
bdo[dir="rtl"] {
  direction: rtl;
  unicode-bidi: bidi-override;
}
*[dir="ltr"] {
  direction: ltr;
  unicode-bidi: isolate;
}
*[dir="rtl"] {
  direction: rtl;
  unicode-bidi: isolate;
}

/* MathML */
m|math[display="block"] {
  display: block;
  display: block math;
}

/*------------------ epub-specific ---------------------*/

a[epub|type="noteref"],
a[epub\\:type="noteref"] {
  font-size: 0.75em;
  vertical-align: super;
  line-height: 0.01;
}

a[epub|type="noteref"]:href-epub-type(footnote, aside),
a[epub\\:type="noteref"]:href-epub-type(footnote, aside) {
  -adapt-template: footnote;
  text-decoration: none;
}

aside[epub|type="footnote"],
aside[epub\\:type="footnote"] {
  display: none;
}

aside[epub|type="footnote"]:footnote-content,
aside[epub\\:type="footnote"]:footnote-content {
  display: block;
  margin: 0.25em;
  font-size: 1.2em;
  line-height: 1.2;
}

epub|trigger {
  display: none;
}

epub|switch {
  display: inline;
}

epub|default {
  display: inline;
}

epub|case {
  display: none;
}

epub|case[required-namespace::supported] {
  display: inline;
}

epub|case[required-namespace::supported] ~ epub|case {
  display: none;
}

epub|case[required-namespace::supported] ~ epub|default {
  display: none;
}
`,_h=`
@namespace "http://www.w3.org/1999/xhtml";

*:not([data-vivliostyle-role=doc-toc],
  [data-vivliostyle-role=doc-toc] *,
  :has([data-vivliostyle-role=doc-toc]),
  :is(h1,h2,h3,h4,h5,h6):has(+:not(nav)[data-vivliostyle-role=doc-toc])) {
  display: none;
}

[hidden] {
  display: revert;
}

[data-vivliostyle-role=doc-toc] li a {
  -adapt-behavior: toc-node-anchor;
}

[data-vivliostyle-role=doc-toc] li {
  -adapt-behavior: toc-node;
}

[data-vivliostyle-role=doc-toc] li > :not(ul,ol):first-child {
  -adapt-behavior: toc-node-first-child;
}

[data-vivliostyle-role=doc-toc] :is(ol,ul),
[data-vivliostyle-role=doc-toc]:is(ol,ul) {
  -adapt-behavior: toc-container;
}
`,Mh=`
[data-viv-margin-discard~="block-start"] {
  margin-block-start: 0 !important;
}
[data-viv-margin-discard~="block-end"] {
  margin-block-end: 0 !important;
}
[data-viv-margin-discard~="inline-start"] {
  margin-inline-start: 0 !important;
}
[data-viv-margin-discard~="inline-end"] {
  margin-inline-end: 0 !important;
}

[data-viv-box-break~="inline-start"]:not([data-viv-box-break~="clone"]) {
  margin-inline-start: 0 !important;
  padding-inline-start: 0 !important;
  border-inline-start-width: 0 !important;
  border-start-start-radius: 0 !important;
  border-end-start-radius: 0 !important;
}
[data-viv-box-break~="inline-end"]:not([data-viv-box-break~="clone"]) {
  margin-inline-end: 0 !important;
  padding-inline-end: 0 !important;
  border-inline-end-width: 0 !important;
  border-start-end-radius: 0 !important;
  border-end-end-radius: 0 !important;
}
[data-viv-box-break~="block-start"]:not([data-viv-box-break~="clone"]) {
  margin-block-start: 0 !important;
  padding-block-start: 0 !important;
  border-block-start-width: 0 !important;
  border-start-start-radius: 0 !important;
  border-start-end-radius: 0 !important;
}
[data-viv-box-break~="block-end"]:not([data-viv-box-break~="clone"]) {
  margin-block-end: 0 !important;
  padding-block-end: 0 !important;
  border-block-end-width: 0 !important;
  border-end-start-radius: 0 !important;
  border-end-end-radius: 0 !important;
}
[data-viv-box-break~="block-start"][data-viv-box-break~="text-start"] {
  text-indent: 0 !important;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] {
  text-align-last: justify !important;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"][data-viv-box-break~="justify"] > * {
  text-align-last: auto;
}
[data-viv-box-break~="block-end"][data-viv-box-break~="text-end"]:not([data-viv-box-break~="justify"]) {
  text-align-last: auto !important;
}

span.viv-anonymous-block {
  display: block;
}

[data-vivliostyle-page-container] {
  text-spacing-trim: space-all;
  text-autospace: no-autospace;
}
viv-ts-open.viv-ts-auto > viv-ts-inner,
viv-ts-open.viv-ts-trim > viv-ts-inner {
  margin-inline-start: -0.5em;
}
viv-ts-close.viv-ts-auto > viv-ts-inner,
viv-ts-close.viv-ts-trim > viv-ts-inner {
  letter-spacing: -0.5em;
}
viv-ts-close.viv-hang-end > viv-ts-inner,
viv-ts-close.viv-hang-last > viv-ts-inner {
  letter-spacing: -1em;
}
viv-ts-open.viv-ts-auto::before,
viv-ts-close.viv-ts-auto::after,
viv-ts-close.viv-hang-end::after {
  content: " ";
  font-family: Courier, monospace;
  word-spacing: normal;
  letter-spacing: -0.11em;
  line-height: 0;
  text-orientation: mixed;
  visibility: hidden;
}
viv-ts-close.viv-hang-end:not(.viv-hang-hw)::after {
  letter-spacing: 0.4em;
}
viv-ts-close.viv-hang-hw > viv-ts-inner {
  letter-spacing: -0.5em;
}
viv-ts-open.viv-hang-first > viv-ts-inner {
  display: inline-block;
  line-height: 1;
  inline-size: 1em;
  text-indent: 0;
  text-align: end;
  text-align-last: end;
  margin-inline-start: -1em;
}
viv-ts-thin-sp::after {
  content: " ";
  font-family: Times, serif;
  word-spacing: normal;
  letter-spacing: -0.125em;
  line-height: 0;
  text-orientation: mixed;
  visibility: hidden;
}

span[data-viv-leader] {
  text-combine-upright: none;
  text-orientation: mixed;
  white-space: pre;
}
`;function Dr(e,t,i,n,r){let o=_("ajax"),s=new XMLHttpRequest,a=o.suspend(s),h={status:0,statusText:"",url:e,contentType:null,responseText:null,responseXML:null,responseBlob:null};s.open(i||"GET",e,!0),t&&(s.responseType=t),s.onreadystatechange=()=>{if(s.readyState===4){if(h.status=s.status,h.url=s.responseURL,h.statusText=s.statusText||s.status==404&&"Not Found"||"",h.status==200||h.status==0)if((!t||t==="document")&&s.responseXML&&s.responseXML.documentElement.localName!="parsererror")h.responseXML=s.responseXML,h.contentType=s.responseXML.contentType;else if((!t||t==="document")&&s.response instanceof Document)h.responseXML=s.response,h.contentType=s.response.contentType;else{let l=s.response;(!t||t==="text")&&typeof l=="string"?h.responseText=l:l?typeof l=="string"?h.responseBlob=zh([l]):h.responseBlob=l:U.warn("Unexpected empty success response for",e);let c=s.getResponseHeader("Content-Type");c&&(h.contentType=c.replace(/(.*);.*$/,"$1"))}a.schedule(h)}};try{n?(s.setRequestHeader("Content-Type",r||"text/plain; charset=UTF-8"),s.send(n)):(/^file:|^https?:\/\/[^/]+\.githubusercontent\.com|\.(xhtml|xht|opf)$/i.test(e)?/\/aozorabunko\/[^/]+\/cards\/[^/]+\/files\/[^/.]+\.html$/.test(e)?s.overrideMimeType("text/html; charset=Shift_JIS"):/\.(html|htm)$/i.test(e)?s.overrideMimeType("text/html; charset=UTF-8"):/\.(xhtml|xht|xml|opf)$/i.test(e)?s.overrideMimeType("application/xml; charset=UTF-8"):/\.(txt|css)$/i.test(e)?s.overrideMimeType("text/plain; charset=UTF-8"):s.overrideMimeType("text/html; charset=UTF-8"):/^data:,(<|%3c)/i.test(e)?s.overrideMimeType("text/html; charset=UTF-8"):/^data:,/i.test(e)&&s.overrideMimeType("text/plain; charset=UTF-8"),s.send(null))}catch(l){U.warn(l,`Error fetching ${e}`),a.schedule(h)}return o.result()}function zh(e,t){let i=t||"application/octet-stream";return new Blob(e,{type:i})}function rf(e){let t=_("readBlob"),i=new FileReader,n=t.suspend(i);return i.addEventListener("load",()=>{n.schedule(i.result)},!1),i.readAsArrayBuffer(e),t.result()}function of(e){return URL.createObjectURL(e)}var vs=class{constructor(e,t){this.parser=e,this.type=t,u(this,"resources",{}),u(this,"fetchers",{})}load(e,t,i){e=Lt(e);let n=this.resources[e];return typeof n<"u"?P(n):this.fetch(e,t,i).get()}fetchInner(e,t,i){let n=_("fetch"),r=e.endsWith("?viv-toc-box");r&&(e=e.replace("?viv-toc-box",""));let o=Te("user-agent.xml",pi),s=!r&&e===o;return s&&(e=`data:application/xml,${encodeURIComponent(Lh)}`),Dr(e,this.type).then(a=>{if(a.status>=400&&t)throw new Error((i||`Failed to fetch required resource: ${e}`)+` (${a.status}${a.statusText?" "+a.statusText:""})`);r?(e+="?viv-toc-box",a.url+="?viv-toc-box"):s&&(a.url=e=o),this.parser(a,this).then(h=>{delete this.fetchers[e],this.resources[e]=h,n.finish(h)})}),n.result()}fetch(e,t,i){if(e=Lt(e),this.resources[e])return null;let n=this.fetchers[e];return n||(n=new Dn(()=>this.fetchInner(e,t,i),`Fetch ${e}`),this.fetchers[e]=n,n.start()),n}get(e){return this.resources[Lt(e)]}delete(e){delete this.resources[Lt(e)]}};function sf(e,t){let i=e.responseText;return P(i?us(i):null)}function af(){return new vs(sf,"text")}function Ni(e,t,i){let n=new Dn(()=>{let r=_("loadElement"),o=r.suspend(e),s=!1,a=h=>{s||(s=!0,o.schedule(h?h.type:"timeout"))};return e.addEventListener("load",a,!1),e.addEventListener("error",a,!1),e.addEventListener("abort",a,!1),e.namespaceURI=="http://www.w3.org/2000/svg"?(t&&e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",t),setTimeout(a,300)):e.localName==="script"?setTimeout(a,3e3):t&&(e.src=t,i&&(e.alt=i)),r.result()},`loadElement ${t||e.localName}`);return n.start(),n}var _a=0,lf=16777216,Dh=33554432,Vh=50331648,Hh=67108864,hf=83886080,uf=100663296,xs=class{constructor(e){this.scope=e,u(this,"flavor"),this.flavor="Author"}getCurrentToken(){return null}getScope(){return this.scope}error(e,t){}startStylesheet(e){this.flavor=e}tagSelector(e,t){}classSelector(e){}pseudoclassSelector(e,t){}pseudoelementSelector(e,t){}idSelector(e){}attributeSelector(e,t,i,n){}descendantSelector(){}childSelector(){}adjacentSiblingSelector(){}followingSiblingSelector(){}nextSelector(){}startSelectorRule(){}startFontFaceRule(){}startFootnoteRule(e){}startViewportRule(){}startDefineRule(){}startRegionRule(){}startPageRule(){}startPageMarginBoxRule(e){}startWhenRule(e){}startMediaRule(e){this.startWhenRule(e)}startFlowRule(e){}startPageTemplateRule(){}startPageMasterRule(e,t,i){}startPartitionRule(e,t,i){}startPartitionGroupRule(e,t,i){}startRuleBody(){}property(e,t,i){}endRule(){}startFuncWithSelector(e){}endFuncWithSelector(){}pushSelectorText(e){}getImportantSpecificity(){switch(this.flavor){case"UA":return _a;case"User":return uf;default:return hf}}getBaseSpecificity(){switch(this.flavor){case"UA":return _a;case"User":return lf;default:return Dh}}},cf=class extends xs{constructor(){super(null),u(this,"stack",[]),u(this,"tokenizer",null),u(this,"slave",null)}pushHandler(e){this.stack.push(this.slave),this.slave=e}popHandler(){this.slave=this.stack.pop()}getCurrentToken(){return this.tokenizer?this.tokenizer.token():null}getScope(){return this.slave.getScope()}error(e,t){this.slave.error(e,t)}errorMsg(e,t){var i;U.warn(e,(i=t?.toString())!=null?i:"")}startStylesheet(e){super.startStylesheet(e),this.stack.length>0&&(this.slave=this.stack[0],this.stack=[]),this.slave.startStylesheet(e)}tagSelector(e,t){this.slave.tagSelector(e,t)}classSelector(e){this.slave.classSelector(e)}pseudoclassSelector(e,t){this.slave.pseudoclassSelector(e,t)}pseudoelementSelector(e,t){this.slave.pseudoelementSelector(e,t)}idSelector(e){this.slave.idSelector(e)}attributeSelector(e,t,i,n){this.slave.attributeSelector(e,t,i,n)}descendantSelector(){this.slave.descendantSelector()}childSelector(){this.slave.childSelector()}adjacentSiblingSelector(){this.slave.adjacentSiblingSelector()}followingSiblingSelector(){this.slave.followingSiblingSelector()}nextSelector(){this.slave.nextSelector()}startSelectorRule(){this.slave.startSelectorRule()}startFontFaceRule(){this.slave.startFontFaceRule()}startFootnoteRule(e){this.slave.startFootnoteRule(e)}startViewportRule(){this.slave.startViewportRule()}startDefineRule(){this.slave.startDefineRule()}startRegionRule(){this.slave.startRegionRule()}startPageRule(){this.slave.startPageRule()}startPageMarginBoxRule(e){this.slave.startPageMarginBoxRule(e)}startWhenRule(e){this.slave.startWhenRule(e)}startFlowRule(e){this.slave.startFlowRule(e)}startPageTemplateRule(){this.slave.startPageTemplateRule()}startPageMasterRule(e,t,i){this.slave.startPageMasterRule(e,t,i)}startPartitionRule(e,t,i){this.slave.startPartitionRule(e,t,i)}startPartitionGroupRule(e,t,i){this.slave.startPartitionGroupRule(e,t,i)}startRuleBody(){this.slave.startRuleBody()}property(e,t,i){this.slave.property(e,t,i)}endRule(){this.slave.endRule()}startFuncWithSelector(e){this.slave.startFuncWithSelector(e)}endFuncWithSelector(){this.slave.endFuncWithSelector()}pushSelectorText(e){this.slave.pushSelectorText(e)}},Ma=class extends xs{constructor(e,t,i){super(e),this.owner=t,this.topLevel=i,u(this,"depth",0),t&&(this.flavor=t.flavor)}getCurrentToken(){var e;return(e=this.owner)==null?void 0:e.getCurrentToken()}error(e,t){var i;(i=this.owner)==null||i.errorMsg(e,t)}startRuleBody(){this.depth++}endRule(){--this.depth==0&&!this.topLevel&&this.owner.popHandler()}},Vn=class extends Ma{constructor(e,t,i){super(e,t,i)}report(e){this.error(e,this.getCurrentToken())}reportAndSkip(e){this.report(e),this.owner.pushHandler(new Ma(this.scope,this.owner,!1))}startSelectorRule(){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR")}startFontFaceRule(){this.reportAndSkip("E_CSS_UNEXPECTED_FONT_FACE")}startFootnoteRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FOOTNOTE")}startViewportRule(){this.reportAndSkip("E_CSS_UNEXPECTED_VIEWPORT")}startDefineRule(){this.reportAndSkip("E_CSS_UNEXPECTED_DEFINE")}startRegionRule(){this.reportAndSkip("E_CSS_UNEXPECTED_REGION")}startPageRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE")}startWhenRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_WHEN")}startFlowRule(e){this.reportAndSkip("E_CSS_UNEXPECTED_FLOW")}startPageTemplateRule(){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_TEMPLATE")}startPageMasterRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PAGE_MASTER")}startPartitionRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION")}startPartitionGroupRule(e,t,i){this.reportAndSkip("E_CSS_UNEXPECTED_PARTITION_GROUP")}startFuncWithSelector(e){this.reportAndSkip("E_CSS_UNEXPECTED_SELECTOR_FUNC")}endFuncWithSelector(){this.reportAndSkip("E_CSS_UNEXPECTED_END_SELECTOR_FUNC")}property(e,t,i){this.error("E_CSS_UNEXPECTED_PROPERTY",this.getCurrentToken())}},Ne=[],yr=[],we=[],Pe=[],pt=[],ot=[],ke=[],Me=[],fe=[],Ue=[],Qe=[],He=[],Ee=[],Ti=55,Ii=56,rr=57;Ne[1]=28,Ne[36]=29,Ne[7]=29,Ne[9]=29,Ne[14]=29,Ne[18]=29,Ne[50]=29,Ne[20]=30,Ne[13]=27,Ne[0]=200,yr[1]=46,yr[0]=200,ot[1]=2,ot[36]=4,ot[7]=6,ot[9]=8,ot[14]=10,ot[18]=14,ot[50]=42,we[37]=11,we[23]=12,we[35]=56,we[1]=1,we[36]=3,we[7]=5,we[9]=7,we[14]=9,we[12]=13,we[18]=55,we[50]=58,we[16]=41,Pe[37]=11,Pe[23]=12,Pe[35]=56,Pe[1]=1,Pe[36]=3,Pe[7]=5,Pe[9]=7,Pe[14]=9,Pe[18]=55,pt[1]=2,pt[36]=4,pt[7]=6,pt[9]=8,pt[18]=14,pt[50]=42,pt[14]=10,pt[12]=13,ke[1]=15,ke[7]=16,ke[4]=17,ke[5]=18,ke[3]=19,ke[2]=20,ke[8]=21,ke[27]=57,ke[16]=22,ke[19]=23,ke[6]=24,ke[11]=25,ke[17]=26,ke[13]=48,ke[31]=47,ke[23]=54,ke[0]=44,Me[1]=31,Me[4]=32,Me[5]=32,Me[3]=33,Me[2]=34,Me[10]=40,Me[6]=38,Me[31]=36,Me[24]=36,Me[32]=35,fe[1]=45,fe[16]=37,fe[37]=37,fe[38]=37,fe[47]=37,fe[48]=37,fe[39]=37,fe[49]=37,fe[41]=37,fe[26]=37,fe[25]=37,fe[23]=37,fe[24]=37,fe[19]=37,fe[21]=37,fe[36]=37,fe[18]=37,fe[22]=37,fe[11]=39,fe[12]=43,fe[17]=49,Ue[0]=200,Ue[12]=50,Ue[13]=51,Ue[14]=50,Ue[15]=51,Ue[10]=50,Ue[11]=51,Ue[17]=53,Qe[0]=200,Qe[12]=50,Qe[13]=52,Qe[14]=50,Qe[15]=51,Qe[10]=50,Qe[11]=51,Qe[17]=53,He[0]=200,He[12]=50,He[13]=51,He[14]=50,He[15]=51,He[10]=50,He[11]=51,Ee[11]=0,Ee[16]=0,Ee[22]=1,Ee[18]=1,Ee[26]=2,Ee[25]=2,Ee[38]=3,Ee[37]=3,Ee[48]=3,Ee[47]=3,Ee[39]=3,Ee[49]=3,Ee[41]=3,Ee[23]=4,Ee[24]=4,Ee[36]=5,Ee[19]=5,Ee[21]=5,Ee[0]=6,Ee[Ti]=2,Ee[Ii]=2;var Hn=class{constructor(e,t,i,n){this.actions=e,this.tokenizer=t,this.handler=i,this.baseURL=n,u(this,"valStack",[]),u(this,"namespacePrefixToURI",{}),u(this,"defaultNamespaceURI",null),u(this,"propName",null),u(this,"propImportant",!1),u(this,"exprContext"),u(this,"result",null),u(this,"importReady",!1),u(this,"importURL",null),u(this,"importCondition",null),u(this,"errorBrackets",[]),u(this,"ruleStack",[]),u(this,"regionRule",!1),u(this,"pageRule",!1),u(this,"inStyleDeclaration",!1),this.exprContext=2}extractVals(e,t){let i=[],n=this.valStack;for(;t<n.length&&(i.push(n[t++]),t!==n.length);){if(n[t++]!==e)throw new Error("Unexpected state");t===n.length&&i.push(X)}return i}valStackReduce(e,t){let i=this.valStack,n=i.length,r=0,o;do if(o=i[--n],e===")"&&o instanceof nn){if(o.text===")")r++;else if(o.text==="("){if(r===0)return null;r--}}while(typeof o<"u"&&typeof o!="string");let s=i.length-(n+1);if(s>1&&i.splice(n+1,s,new Ie(i.slice(n+1,i.length))),e==",")return null;n++;do o=i[--n];while(typeof o<"u"&&(typeof o!="string"||o==","));if(s=i.length-(n+1),o=="("){e!=")"&&t.type!==0&&(this.handler.error("E_CSS_MISMATCHED_C_PAR",t),this.actions=Qe);let h=new qi(i[n-1],this.extractVals(",",n+1));if(i.splice(n-1,s+2,h),h.name==="var"){let l=h.values[0]instanceof yt&&h.values[0].name;(!_t(l)||l===this.propName)&&(this.handler.error(`E_CSS_INVALID_VAR ${h.toString()}`,t),this.actions=Qe)}return h}if(e!=";"||n>=0)return this.handler.error("E_CSS_UNEXPECTED_VAL_END",t),this.actions=Qe,null;if(s>1)return new et(this.extractVals(",",n+1));let a=i[0];return a instanceof Ye?a:a?new nn(a.toString()):X}exprError(e,t){this.actions=this.propName?Qe:Ue,U.warn(e,t.toString())}exprStackReduce(e,t){let i=this.valStack,n=this.handler,r=i.pop(),o;for(;;){let s=i.pop();if(e==11){let a=[r];for(;s==16;)a.unshift(i.pop()),s=i.pop();if(typeof s=="string"){if(s=="{"){for(;a.length>=2;){let h=a.shift(),l=a.shift(),c=new qd(n.getScope(),h,l);a.unshift(c)}return i.push(new $(a[0])),!0}else if(s=="("){let h=i.pop(),l=i.pop();r=new gn(n.getScope(),vo(l,h),a),e=0;continue}}if(s==10){r.isMediaName()&&(r=new Ea(n.getScope(),r,null)),e=0;continue}}else if(typeof s=="string"){i.push(s);break}if(s<0)if(s==-31)r=new qt(n.getScope(),r);else if(s==-24)r=new oh(n.getScope(),r);else if(s==-rr)r=new jd(n.getScope(),r);else return this.exprError("F_UNEXPECTED_STATE",t),!1;else{if(Ee[e]>Ee[s]){i.push(s);break}switch(o=i.pop(),s){case 26:r=new ps(n.getScope(),o,r);break;case Ti:r=new Xd(n.getScope(),o,r);break;case Ii:r=new Yd(n.getScope(),o,r);break;case 25:r=new fs(n.getScope(),o,r);break;case 38:r=new Kd(n.getScope(),o,r);break;case 37:r=new Qd(n.getScope(),o,r);break;case 48:r=new Zd(n.getScope(),o,r);break;case 47:r=new So(n.getScope(),o,r);break;case 39:case 49:r=new gs(n.getScope(),o,r);break;case 41:r=new Jd(n.getScope(),o,r);break;case 23:r=new sh(n.getScope(),o,r);break;case 24:r=new ah(n.getScope(),o,r);break;case 36:r=new ms(n.getScope(),o,r);break;case 19:r=new lh(n.getScope(),o,r);break;case 21:r=new hh(n.getScope(),o,r);break;case 18:if(i.length>1)switch(i[i.length-1]){case 22:i.pop(),r=new ip(n.getScope(),i.pop(),o,r);break;case 10:if(o.isMediaName())r=new Ea(n.getScope(),o,r);else return this.exprError("E_CSS_MEDIA_TEST",t),!1;break}else return this.exprError("E_CSS_EXPR_COND",t),!1;break;case 22:if(e!=18)return this.exprError("E_CSS_EXPR_COND",t),!1;case 10:return i.push(o),i.push(s),i.push(r),!1;default:return this.exprError("F_UNEXPECTED_STATE",t),!1}}}return i.push(r),!1}readSupportsTest(e){let t=e.type===6,i=this.tokenizer,n,r;if(t)r=e.text,n=e.position+r.length+1;else if(e.type===10){let c=i.nthToken(1),p=i.nthToken(2);if(c.type===1&&p.type===18)i.consume(),i.consume(),r=c.text,n=p.position+1;else{if(c.type===10||c.type===6||c.type===1&&c.text.toLowerCase()==="not"&&(p.type===10||p.type===6))return null;n=e.position+1}}else return null;let o=0,s,a=0;for(;o>=0;)switch(i.consume(),s=i.token(),s.type){case 11:o--;break;case 10:case 6:o++;break;case 16:o===0&&a++;break;case 0:return this.exprError("E_CSS_UNEXPECTED_EOF",s),null}i.consume();let h=s.position,l=t&&r==="selector"&&a>0?"":i.input.substring(n,h).trim();return new np(this.handler.getScope(),r,l,t)}readPseudoParams(){let e=[];for(;;){let t=this.tokenizer.token();switch(t.type){case 1:e.push(t.text);break;case 23:e.push("+");break;case 4:case 5:e.push(t.num);break;default:return e}this.tokenizer.consume()}}readNthPseudoParams(){let e=!1,t=this.tokenizer.token();if(t.type===23)e=!0,this.tokenizer.consume(),t=this.tokenizer.token();else if(t.type===1&&(t.text==="even"||t.text==="odd"))return this.tokenizer.consume(),[2,t.text==="odd"?1:0];switch(t.type){case 3:if(e&&t.num<0)return null;case 1:if(e&&t.text.charAt(0)==="-")return null;if(t.text==="n"||t.text==="-n"){if(e&&t.precededBySpace)return null;let i=t.text==="-n"?-1:1;t.type===3&&(i=t.num);let n=0;this.tokenizer.consume(),t=this.tokenizer.token();let r=t.type===24,o=t.type===23||r;if(o&&(this.tokenizer.consume(),t=this.tokenizer.token()),t.type===5){if(n=t.num,1/n===-1/0){if(n=0,o)return null}else if(n<0){if(o)return null}else if(n>=0&&!o)return null;this.tokenizer.consume()}else if(o)return null;return[i,r&&n>0?-n:n]}else if(t.text==="n-"||t.text==="-n-"){if(e&&t.precededBySpace)return null;let i=t.text==="-n-"?-1:1;if(t.type===3&&(i=t.num),this.tokenizer.consume(),t=this.tokenizer.token(),t.type===5)return t.num<0||1/t.num===-1/0?null:(this.tokenizer.consume(),[i,t.num])}else{let i=t.text.match(/^n(-[0-9]+)$/);if(i)return e&&t.precededBySpace?null:(this.tokenizer.consume(),[t.type===3?t.num:1,parseInt(i[1],10)]);if(i=t.text.match(/^-n(-[0-9]+)$/),i)return this.tokenizer.consume(),[-1,parseInt(i[1],10)]}return null;case 5:return e&&(t.precededBySpace||t.num<0)?null:(this.tokenizer.consume(),[0,t.num])}return null}makeCondition(e,t){let i=this.handler.getScope();if(!i)return null;if(t=t||i._true,e){let n=e.split(/\s+/);for(let r of n)switch(r){case"vertical":t=gt(i,t,new qt(i,new $e(i,"pref-horizontal")));break;case"horizontal":t=gt(i,t,new $e(i,"pref-horizontal"));break;case"day":t=gt(i,t,new qt(i,new $e(i,"pref-night-mode")));break;case"night":t=gt(i,t,new $e(i,"pref-night-mode"));break;default:t=i._false}}return t===i._true?null:new $(t)}isInsidePropertyOnlyRule(){switch(this.ruleStack[this.ruleStack.length-1]){case"[selector]":case"font-face":case"-epubx-flow":case"-epubx-viewport":case"-epubx-define":case"-adapt-footnote-area":return!0}return!1}runParser(e,t,i,n,r,o){let s=this.handler,a=this.tokenizer,h=this.valStack,l,c,p,d,f,g,m,v=null;for(i&&(this.inStyleDeclaration=!0),n&&(this.exprContext=2,this.valStack.push("{"));e>0;--e){if(l=a.token(),r&&v===null&&(v=l.position-1,a.input[v]==="("&&v++),this.actions===ke&&this.errorBrackets.length>0&&(l.type===this.errorBrackets[this.errorBrackets.length-1]||l.type===17||l.type===31)){if(l.type===this.errorBrackets[this.errorBrackets.length-1]&&(this.errorBrackets.pop(),l.type===11&&this.valStackReduce(")",l))){a.consume();continue}h.push(new nn(l.toString())),a.consume();continue}switch(this.actions[l.type]){case 28:if(!this.inStyleDeclaration||a.nthToken(1).type!=18){this.isInsidePropertyOnlyRule()?(s.error("E_CSS_COLON_EXPECTED",a.nthToken(1)),this.actions=Qe):(this.actions=ot,s.startSelectorRule());continue}this.propName=l.text,this.propImportant=!1,a.consume(),a.consume(),this.actions=ke,h.splice(0,h.length);continue;case 46:if(a.nthToken(1).type!=18){this.actions=Qe,s.error("E_CSS_COLON_EXPECTED",a.nthToken(1));continue}this.propName=l.text,this.propImportant=!1,a.consume(),a.consume(),this.actions=ke,h.splice(0,h.length);continue;case 29:this.actions=ot,s.startSelectorRule();continue;case 1:if(!l.precededBySpace){this.actions=He,s.error("E_CSS_SPACE_EXPECTED",l);continue}s.descendantSelector();case 2:if(a.nthToken(1).type==34)if(a.consume(),a.consume(),p=this.namespacePrefixToURI[l.text],p!=null)switch(l=a.token(),l.type){case 1:s.tagSelector(p,l.text),r?this.actions=Pe:this.actions=we,a.consume();break;case 36:s.tagSelector(p,null),r?this.actions=Pe:this.actions=we,a.consume();break;default:this.actions=Ue,s.error("E_CSS_NAMESPACE",l)}else this.actions=Ue,s.error("E_CSS_UNDECLARED_PREFIX",l);else s.tagSelector(this.defaultNamespaceURI,l.text),r?this.actions=Pe:this.actions=we,a.consume();continue;case 3:if(!l.precededBySpace){this.actions=He,s.error("E_CSS_SPACE_EXPECTED",l);continue}s.descendantSelector();case 4:if(a.nthToken(1).type==34)switch(a.consume(),a.consume(),l=a.token(),l.type){case 1:s.tagSelector(null,l.text),r?this.actions=Pe:this.actions=we,a.consume();break;case 36:s.tagSelector(null,null),r?this.actions=Pe:this.actions=we,a.consume();break;default:this.actions=Ue,s.error("E_CSS_NAMESPACE",l)}else s.tagSelector(this.defaultNamespaceURI,null),r?this.actions=Pe:this.actions=we,a.consume();continue;case 5:l.precededBySpace&&s.descendantSelector();case 6:if(!l.text){s.error("E_CSS_SYNTAX",l),a.consume();continue}s.idSelector(l.text),r?this.actions=Pe:this.actions=we,a.consume();continue;case 7:l.precededBySpace&&s.descendantSelector();case 8:s.classSelector(l.text),r?this.actions=Pe:this.actions=we,a.consume();continue;case 55:l.precededBySpace&&s.descendantSelector();case 14:a.consume(),l=a.token();e:switch(l.type){case 1:s.pseudoclassSelector(l.text,null),a.consume(),r?this.actions=Pe:this.actions=we;continue;case 6:switch(d=l.text,a.consume(),d){case"is":case"not":case"where":case"has":this.actions=ot,s.startFuncWithSelector(d),this.runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!0,d==="has")?this.actions=we:this.actions=He;continue;case"lang":case"href-epub-type":if(l=a.token(),l.type===1){m=[l.text],a.consume(),d==="href-epub-type"&&a.token().type===16&&(a.consume(),l=a.token(),l.type===1&&(m.push(l.text),a.consume()));break}else break e;case"nth-child":case"nth-of-type":case"nth-last-child":case"nth-last-of-type":case"nth":if(m=this.readNthPseudoParams(),m)break;break e;default:m=this.readPseudoParams()}if(l=a.token(),l.type==11){s.pseudoclassSelector(d,m),a.consume(),r?this.actions=Pe:this.actions=we;continue}break}s.error("E_CSS_PSEUDOCLASS_SYNTAX",l),this.actions=Ue;continue;case 58:l.precededBySpace&&s.descendantSelector();case 42:switch(a.consume(),l=a.token(),l.type){case 1:s.pseudoelementSelector(l.text,null),r?this.actions=Pe:this.actions=we,a.consume();continue;case 6:if(d=l.text,a.consume(),d=="nth-fragment"){if(m=this.readNthPseudoParams(),m===null)break}else m=this.readPseudoParams();if(l=a.token(),l.type==11){s.pseudoelementSelector(d,m),r?this.actions=Pe:this.actions=we,a.consume();continue}break}s.error("E_CSS_PSEUDOELEM_SYNTAX",l),this.actions=Ue;continue;case 9:l.precededBySpace&&s.descendantSelector();case 10:if(a.consume(),l=a.token(),l.type==1)d=l.text,a.consume();else if(l.type==36)d=null,a.consume();else if(l.type==34)d="";else{this.actions=He,s.error("E_CSS_ATTR",l),a.consume();continue}if(l=a.token(),l.type==34){if(p=d&&this.namespacePrefixToURI[d],p===void 0){this.actions=He,s.error("E_CSS_UNDECLARED_PREFIX",l),a.consume();continue}if(a.consume(),l=a.token(),l.type!=1){this.actions=He,s.error("E_CSS_ATTR_NAME_EXPECTED",l);continue}d=l.text,a.consume(),l=a.token()}else p="";switch(l.type){case 39:case 45:case 44:case 43:case 42:case 46:case 50:f=l.type,a.consume(),l=a.token();break;case 15:s.attributeSelector(p,d,0,null),r?this.actions=Pe:this.actions=we,a.consume();continue;default:this.actions=He,s.error("E_CSS_ATTR_OP_EXPECTED",l);continue}switch(l.type){case 1:case 2:s.attributeSelector(p,d,f,l.text),a.consume(),l=a.token();break;default:this.actions=He,s.error("E_CSS_ATTR_VAL_EXPECTED",l);continue}if(l.type!=15){this.actions=He,s.error("E_CSS_ATTR",l);continue}r?this.actions=Pe:this.actions=we,a.consume();continue;case 11:s.childSelector(),this.actions=pt,a.consume();continue;case 12:s.adjacentSiblingSelector(),this.actions=pt,a.consume();continue;case 56:s.followingSiblingSelector(),this.actions=pt,a.consume();continue;case 13:this.regionRule?(this.ruleStack.push("-epubx-region"),this.regionRule=!1):this.pageRule?(this.ruleStack.push("page"),this.pageRule=!1,this.inStyleDeclaration=!0):(this.ruleStack.push("[selector]"),this.inStyleDeclaration=!0),s.startRuleBody(),this.actions=Ne,a.consume();continue;case 41:s.nextSelector(),this.actions=ot,a.consume();continue;case 15:h.push(z(l.text)),a.consume();continue;case 16:f=parseInt(l.text,16),h.push(new bh(l.text)),a.consume();continue;case 17:h.push(new wi(l.num)),a.consume();continue;case 18:h.push(new gi(l.num)),a.consume();continue;case 19:h.push(new A(l.num,l.text)),a.consume();continue;case 20:h.push(new _e(l.text)),a.consume();continue;case 21:h.push(new bt(Te(l.text,this.baseURL))),a.consume();continue;case 57:h.push(new vh(l.text)),a.consume();continue;case 22:this.valStackReduce(",",l),h.push(","),a.consume();continue;case 23:h.push(Br),a.consume();continue;case 24:d=l.text.toLowerCase(),d=="-epubx-expr"||d=="env"?(this.actions=Me,this.exprContext=0,h.push("{")):(h.push(d),h.push("("),this.errorBrackets.length>0&&this.errorBrackets.push(11)),a.consume();continue;case 25:this.valStackReduce(")",l),a.consume();continue;case 47:if(a.consume(),l=a.token(),c=a.nthToken(1),l.type==1&&l.text.toLowerCase()=="important"&&(c.type==17||c.type==0||c.type==13)){a.consume(),this.propImportant=!0;continue}this.exprError("E_CSS_SYNTAX",l);continue;case 54:switch(c=a.nthToken(1),c.type){case 4:case 3:case 5:if(!c.precededBySpace){a.consume();continue}}h.push(new nn("+")),a.consume();continue;case 26:a.consume();case 48:g=this.valStackReduce(";",l),g&&this.propName&&s.property(this.propName,g,this.propImportant),this.actions=i?yr:Ne;continue;case 44:for(a.consume();h.length>0;){let b=h.length;if(g=this.valStackReduce(";",l),!g||h.length===b)break}return t?(this.result=g,!0):(this.propName&&g&&s.property(this.propName,g,this.propImportant),!0);case 31:if(c=a.nthToken(1),c.type==9)a.nthToken(2).type==10&&!a.nthToken(2).precededBySpace?(h.push(l.text,c.text,"("),a.consume()):(h.push(new $e(s.getScope(),vo(l.text,c.text))),this.actions=fe),a.consume();else{if(this.exprContext==2||this.exprContext==3)l.text.toLowerCase()=="not"?(a.consume(),h.push(new Ca(s.getScope(),!0,c.text))):(l.text.toLowerCase()=="only"&&(a.consume(),l=c),h.push(new Ca(s.getScope(),!1,l.text)));else if(this.exprContext===4&&l.text.toLowerCase()==="not"&&h[h.length-1]!==Ti&&h[h.length-1]!==Ii&&(c.type===10||c.type===6)){h.push(-rr),a.consume();continue}else h.push(new $e(s.getScope(),l.text));this.actions=fe}a.consume();continue;case 38:if(this.exprContext===4){h.push(this.readSupportsTest(l)),this.actions=fe;continue}h.push(null,l.text,"("),a.consume();continue;case 32:h.push(new ze(s.getScope(),l.num)),a.consume(),this.actions=fe;continue;case 33:d=l.text,d=="%"&&(this.propName&&this.propName.match(/height|^(top|bottom)$/)?d="vh":d="vw"),h.push(new fi(s.getScope(),l.num,d)),a.consume(),this.actions=fe;continue;case 34:h.push(new ze(s.getScope(),l.text)),a.consume(),this.actions=fe;continue;case 35:a.consume(),l=a.token(),l.type!=5||l.precededBySpace?this.exprError("E_CSS_SYNTAX",l):(h.push(new ph(s.getScope(),l.num)),a.consume(),this.actions=fe);continue;case 36:h.push(-l.type),a.consume();continue;case 37:this.actions=Me,this.exprStackReduce(l.type,l),h.push(l.type),a.consume();continue;case 45:l.text.toLowerCase()==="and"&&h[h.length-2]!==Ii&&h[h.length-2]!==-rr?(this.actions=Me,this.exprStackReduce(Ti,l),h.push(Ti),a.consume()):l.text.toLowerCase()==="or"&&h[h.length-2]!==Ti&&h[h.length-2]!==-rr?(this.actions=Me,this.exprStackReduce(Ii,l),h.push(Ii),a.consume()):this.exprError("E_CSS_SYNTAX",l);continue;case 39:this.exprStackReduce(l.type,l)&&(this.actions=ke),a.consume();continue;case 43:this.exprStackReduce(11,l)&&(this.propName||this.exprContext==3?this.exprError("E_CSS_UNEXPECTED_BRC",l):(this.exprContext==1?s.startWhenRule(h.pop()):s.startMediaRule(h.pop()),this.ruleStack.push("media"),s.startRuleBody(),this.actions=Ne)),a.consume();continue;case 49:if(this.exprStackReduce(11,l))return this.propName||this.exprContext!=3?(this.exprError("E_CSS_UNEXPECTED_SEMICOL",l),this.actions=Ne,a.consume(),!1):(this.importCondition=h.pop(),this.importReady=!0,this.actions=Ne,a.consume(),!1);a.consume();continue;case 40:if(this.exprContext===4){let b=this.readSupportsTest(l);if(b){h.push(b),this.actions=fe;continue}}h.push(l.type),a.consume();continue;case 27:if(this.actions=Ne,a.consume(),s.endRule(),this.inStyleDeclaration=!1,this.ruleStack.length)switch(this.ruleStack.pop(),this.ruleStack[this.ruleStack.length-1]){case"page":case"-epubx-page-master":case"-epubx-partition-group":this.inStyleDeclaration=!0}continue;case 30:switch(d=l.text.toLowerCase(),d){case"import":if(a.consume(),l=a.token(),l.type==2||l.type==8){if(this.importURL=l.text,a.consume(),l=a.token(),l.type==17||l.type==0)return this.importReady=!0,a.consume(),!1;this.propName=null,this.exprContext=3,this.actions=Me,h.push("{");continue}s.error("E_CSS_IMPORT_SYNTAX",l),this.actions=Ue;continue;case"namespace":switch(a.consume(),l=a.token(),l.type){case 1:if(d=l.text,a.consume(),l=a.token(),(l.type==2||l.type==8)&&a.nthToken(1).type==17){this.namespacePrefixToURI[d]=l.text,a.consume(),a.consume();continue}break;case 2:case 8:if(a.nthToken(1).type==17){this.defaultNamespaceURI=l.text,a.consume(),a.consume();continue}break}s.error("E_CSS_NAMESPACE_SYNTAX",l),this.actions=Ue;continue;case"charset":if(a.consume(),l=a.token(),l.type==2&&a.nthToken(1).type==17){d=l.text.toLowerCase(),d!="utf-8"&&d!="utf-16"&&s.error(`E_CSS_UNEXPECTED_CHARSET ${d}`,l),a.consume(),a.consume();continue}s.error("E_CSS_CHARSET_SYNTAX",l),this.actions=Ue;continue;case"font-face":case"-epubx-page-template":case"-epubx-define":case"-epubx-viewport":if(a.nthToken(1).type==12){switch(a.consume(),a.consume(),d){case"font-face":s.startFontFaceRule(),this.inStyleDeclaration=!0;break;case"-epubx-page-template":s.startPageTemplateRule();break;case"-epubx-define":s.startDefineRule(),this.inStyleDeclaration=!0;break;case"-epubx-viewport":s.startViewportRule(),this.inStyleDeclaration=!0;break}this.ruleStack.push(d),s.startRuleBody();continue}break;case"-adapt-footnote-area":switch(a.consume(),l=a.token(),l.type){case 12:a.consume(),s.startFootnoteRule(null),this.ruleStack.push(d),s.startRuleBody(),this.inStyleDeclaration=!0;continue;case 50:if(a.consume(),l=a.token(),l.type==1&&a.nthToken(1).type==12){d=l.text,a.consume(),a.consume(),s.startFootnoteRule(d),this.ruleStack.push("-adapt-footnote-area"),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break}break;case"-epubx-region":a.consume(),s.startRegionRule(),this.regionRule=!0,this.actions=ot;continue;case"page":a.consume(),s.startPageRule(),this.pageRule=!0,this.actions=pt;continue;case"top-left-corner":case"top-left":case"top-center":case"top-right":case"top-right-corner":case"right-top":case"right-middle":case"right-bottom":case"bottom-right-corner":case"bottom-right":case"bottom-center":case"bottom-left":case"bottom-left-corner":case"left-bottom":case"left-middle":case"left-top":if(a.consume(),l=a.token(),l.type==12){a.consume(),s.startPageMarginBoxRule(d),this.ruleStack.push(d),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-when":a.consume(),this.propName=null,this.exprContext=1,this.actions=Me,h.push("{");continue;case"media":a.consume(),this.propName=null,this.exprContext=2,this.actions=Me,h.push("{");continue;case"supports":a.consume(),this.propName=null,this.exprContext=4,this.actions=Me,h.push("{");continue;case"-epubx-flow":if(a.nthToken(1).type==1&&a.nthToken(2).type==12){s.startFlowRule(a.nthToken(1).text),a.consume(),a.consume(),a.consume(),this.ruleStack.push(d),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case"-epubx-page-master":case"-epubx-partition":case"-epubx-partition-group":{a.consume(),l=a.token();let b=null,w=null,S=[];for(l.type==1&&(b=l.text,a.consume(),l=a.token()),l.type==18&&a.nthToken(1).type==1&&(w=a.nthToken(1).text,a.consume(),a.consume(),l=a.token());l.type==6&&l.text.toLowerCase()=="class"&&a.nthToken(1).type==1&&a.nthToken(2).type==11;)S.push(a.nthToken(1).text),a.consume(),a.consume(),a.consume(),l=a.token();if(l.type==12){switch(a.consume(),d){case"-epubx-page-master":s.startPageMasterRule(b,w,S);break;case"-epubx-partition":s.startPartitionRule(b,w,S);break;case"-epubx-partition-group":s.startPartitionGroupRule(b,w,S);break}this.ruleStack.push(d),s.startRuleBody(),this.inStyleDeclaration=!0;continue}break}case"":s.error(`E_CSS_UNEXPECTED_AT${d}`,l),this.actions=He;continue;default:s.error(`E_CSS_AT_UNKNOWN ${d}`,l),this.actions=Ue;continue}s.error(`E_CSS_AT_SYNTAX ${d}`,l),this.actions=Ue;continue;case 50:this.errorBrackets.push(l.type+1),a.consume();continue;case 52:if(this.errorBrackets.length==0){this.actions=Ne;continue}case 51:if(r&&this.errorBrackets.length==0&&l.type==11)return a.consume(),s.endFuncWithSelector(),!0;this.errorBrackets.length>0&&this.errorBrackets[this.errorBrackets.length-1]==l.type&&this.errorBrackets.pop(),this.errorBrackets.length==0&&l.type==13&&(this.actions=Ne),a.consume();continue;case 53:this.errorBrackets.length==0&&(this.actions=Ne),a.consume();continue;case 200:return!0;default:if(n)return this.exprStackReduce(11,l)?(this.result=h.pop(),!0):!1;if(r){switch(l.type){case 16:case 11:if(this.actions===ot)s.error("E_CSS_SYNTAX",l);else{let b=a.input.substring(v,l.position);s.pushSelectorText(b),v=l.position+1}if(l.type===16){s.nextSelector(),this.actions=ot,a.consume();continue}else return s.endFuncWithSelector(),a.consume(),!0;case 37:case 23:case 35:if(o){this.actions=we;continue}break;case 12:case 14:case 10:this.errorBrackets.push(l.type+1);break}s.error("E_CSS_SYNTAX",l),a.consume(),this.actions=He;continue}if(this.actions!==Ue&&this.actions!==He&&this.actions!==Qe){if(l.type==54)s.error("E_CSS_SYNTAX",l);else if(this.actions===ke){switch(l.type){case 10:case 12:case 14:this.errorBrackets.push(l.type+1);break}h.push(new nn(l.toString())),a.consume();continue}else if(l.type===12&&this.actions==Me&&h.length>0){s.startMediaRule(h.pop()),this.ruleStack.push("media"),s.startRuleBody(),this.actions=Ne,a.consume();continue}else{if(l.type===17&&this.actions==Me)return this.actions=Ne,a.consume(),!1;s.error("E_CSS_SYNTAX",l)}this.isInsidePropertyOnlyRule()?this.actions=Qe:this.actions=He;continue}a.consume();continue}}return!1}},Uh=class extends xs{constructor(e){super(null),this.scope=e}error(e,t){U.warn(e,t.toString())}getScope(){return this.scope}};function df(e,t,i,n,r){let o=_("parseStylesheet"),s=new Hn(Ne,e,t,i),a=null;return r&&(a=ff(new St(r,t),t,i)),a=s.makeCondition(n,a&&a.toExpr()),a&&(t.startMediaRule(a),t.startRuleBody()),o.loop(()=>{for(;!s.runParser(100,!1,!1,!1,!1);){if(s.importReady){let l=Te(s.importURL,i);s.importCondition&&(t.startMediaRule(s.importCondition),t.startRuleBody());let c=_("parseStylesheet.import");return $h(l,t,null,null).then(()=>{s.importCondition&&t.endRule(),s.importReady=!1,s.importURL=null,s.importCondition=null,c.finish(!0)}),c.result()}let h=o.timeSlice();if(h.isPending)return h}return P(!1)}).then(()=>{a&&t.endRule(),o.finish(!0)}),o.result()}function ys(e,t,i,n,r){return $i("parseStylesheetFromText",o=>{let s=new St(e,t);df(s,t,i,n,r).thenFinish(o)},(o,s)=>{U.warn(s,`Failed to parse stylesheet text: ${e}`),o.finish(!1)})}function $h(e,t,i,n){return $i("parseStylesheetFromURL",r=>{Dr(e).then(o=>{o.responseText?ys(o.responseText,t,e,i,n).then(s=>{s||U.warn(`Failed to parse stylesheet from ${e}`),r.finish(!0)}):r.finish(!0)})},(r,o)=>{U.warn(o,"Exception while fetching and parsing:",e),r.finish(!0)})}function Zi(e,t,i){let n=new Hn(ke,t,new Uh(e),i);return n.runParser(Number.POSITIVE_INFINITY,!0,!1,!1,!1),n.result}function pf(e,t,i){new Hn(yr,e,t,i).runParser(Number.POSITIVE_INFINITY,!1,!0,!1,!1)}function ff(e,t,i){let n=new Hn(Me,e,t,i);return n.runParser(Number.POSITIVE_INFINITY,!1,!1,!0,!1),n.result}var gf={"z-index":!0,"column-count":!0,"flow-linger":!0,opacity:!0,page:!0,"flow-priority":!0,utilization:!0};function mf(e){return!!gf[e]}function wf(e,t,i){let n=t.evaluate(e);switch(typeof n){case"number":return mf(i)?n==Math.round(n)?new gi(n):new wi(n):new A(n,"px");case"string":return n?Zi(t.scope,new St(n,null),""):X;case"boolean":return n?x._true:x._false;case"undefined":return X}throw new Error("E_UNEXPECTED")}function Wh(e,t){let i={};return Object.keys(e).forEach(n=>{let r=i[n]={},o=e[n];Object.keys(o).forEach(s=>{r[s]=o[s].map(a=>{let h=t?a.logical:a.physical,l=t?a.physical:a.logical;return{regexp:new RegExp(`(-?)${h}(-?)`),to:`$1${l}$2`}})})}),i}function Gh(e,t,i,n){let r=n[t];if(!r)throw new Error(`unknown writing-mode: ${t}`);let o=r[i||"ltr"];if(!o)throw new Error(`unknown direction: ${i}`);for(let s of o){let a=e.replace(s.regexp,s.to);if(a!==e)return a}return e}var jh={"horizontal-tb":{ltr:[{logical:"inline-start",physical:"left"},{logical:"inline-end",physical:"right"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}],rtl:[{logical:"inline-start",physical:"right"},{logical:"inline-end",physical:"left"},{logical:"block-start",physical:"top"},{logical:"block-end",physical:"bottom"},{logical:"inline-size",physical:"width"},{logical:"block-size",physical:"height"}]},"vertical-rl":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"right"},{logical:"block-end",physical:"left"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]},"vertical-lr":{ltr:[{logical:"inline-start",physical:"top"},{logical:"inline-end",physical:"bottom"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}],rtl:[{logical:"inline-start",physical:"bottom"},{logical:"inline-end",physical:"top"},{logical:"block-start",physical:"left"},{logical:"block-end",physical:"right"},{logical:"inline-size",physical:"height"},{logical:"block-size",physical:"width"}]}},bf=Wh(jh,!0);function Xh(e,t,i){return Gh(e,t,i||null,bf)}var vf=Wh(jh,!1);function qh(e,t,i){return Gh(e,t,i||null,vf)}var xf={"horizontal-tb":[{logical:"line-left",physical:"left"},{logical:"line-right",physical:"right"},{logical:"over",physical:"top"},{logical:"under",physical:"bottom"}],"vertical-rl":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}],"vertical-lr":[{logical:"line-left",physical:"top"},{logical:"line-right",physical:"bottom"},{logical:"over",physical:"right"},{logical:"under",physical:"left"}]};function yf(e,t){let i=xf[t];if(!i)throw new Error(`unknown writing-mode: ${t}`);for(let n=0;n<i.length;n++)if(i[n].physical===e)return i[n].logical;return e}function Ss(e,t,i){let n={display:t.style.display,position:t.style.position,width:t.style.width,maxWidth:t.style.maxWidth,minWidth:t.style.minWidth,height:t.style.height,maxHeight:t.style.maxHeight,minHeight:t.style.minHeight},r=t.ownerDocument,o=t.parentNode,s=r.createElement("div");T(s,"position",n.position),o.insertBefore(s,t),s.appendChild(t),T(t,"width","auto"),T(t,"max-width","none"),T(t,"min-width","0"),T(t,"height","auto"),T(t,"max-height","none"),T(t,"min-height","0");function a(L){return e.getElementComputedStyle(t).getPropertyValue(L)}let h=Wl("writing-mode"),l=(h?a(h[0]):null)||a("writing-mode"),c=l==="vertical-rl"||l==="tb-rl"||l==="vertical-lr"||l==="tb-lr",p=c?"height":"width",d=c?"width":"height";function f(){return T(t,"display","block"),T(t,"position","static"),a(p)}function g(){T(t,"display","inline-block"),T(s,p,"99999999px");let L=a(p);return T(s,p,""),L}function m(){T(t,"display","inline-block"),T(s,p,"0");let L=a(p);return T(s,p,""),L}function v(){let L=f(),B=m(),D=parseFloat(L);if(D<=parseFloat(B))return B;{let W=g();return D<=parseFloat(W)?L:W}}function b(){return a(d)}function w(){throw new Error("Getting fill-available block size is not implemented")}let S={};return i.forEach(L=>{var B;let D;switch(L){case"fill-available inline size":D=f();break;case"max-content inline size":D=g();break;case"min-content inline size":D=m();break;case"fit-content inline size":D=v();break;case"fill-available block size":D=w();break;case"max-content block size":case"min-content block size":case"fit-content block size":D=b();break;case"fill-available width":D=c?w():f();break;case"fill-available height":D=c?f():w();break;case"max-content width":D=c?b():g();break;case"max-content height":D=c?g():b();break;case"min-content width":D=c?b():m();break;case"min-content height":D=c?m():b();break;case"fit-content width":D=c?b():v();break;case"fit-content height":D=c?v():b();break}D==="0px"&&t.childNodes.length===1&&((B=t.firstElementChild)==null?void 0:B.localName)==="img"&&!t.firstElementChild.complete&&(D="1px"),S[L]=parseFloat(D),T(t,"position",n.position),T(t,"display",n.display)}),T(t,"width",n.width),T(t,"max-width",n.maxWidth),T(t,"min-width",n.minWidth),T(t,"height",n.height),T(t,"max-height",n.maxHeight),T(t,"min-height",n.minHeight),o.insertBefore(t,s),o.removeChild(s),S}function ln(e){var t,i;return((t=e?.style)==null?void 0:t["box-decoration-break"])==="clone"||((i=e?.style)==null?void 0:i["-webkit-box-decoration-break"])==="clone"}function Yh(e){let t=e.getAttribute("data-viv-box-break");return t?t.split(" "):[]}function Kh(e,t){e.setAttribute("data-viv-box-break",t.join(" "))}function lt(e,t){let i=Yh(e);i.includes(t)||(i.push(t),Kh(e,i))}function Sf(e){let t=e.getAttribute("data-viv-margin-discard");return t?t.split(" "):[]}function Cf(e,t){e.setAttribute("data-viv-margin-discard",t.join(" "))}function ho(e,t){let i=Sf(e);i.includes(t)||(i.push(t),Cf(e,i))}function Ef(e){let t=e.name,i=e.value;switch(t){case"page-break-before":case"page-break-after":case"page-break-inside":return{name:t.replace(/^page-/,""),value:i===x.always?x.page:i,important:e.important};default:return e}}var Fo={page:!0,left:!0,right:!0,recto:!0,verso:!0,column:!0,region:!0};function it(e){return!!Fo[e]}var kf={left:!0,right:!0,recto:!0,verso:!0};function Nn(e){return!!kf[e]}var Pf={avoid:!0,"avoid-page":!0,"avoid-column":!0,"avoid-region":!0};function Sr(e){return!!Pf[e]}function Je(e,t){if(e)if(t){if(Nn(t))return t;if(Nn(e))return e;{let i=it(e),n=it(t);if(i&&n)switch(t){case"column":return e;case"region":return e==="column"?t:e;default:return t}else return n?t:i?e:Sr(t)?t:Sr(e)?e:t}}else return e;else return t}function za(e){return it(e)?e:"auto"}mt("SIMPLE_PROPERTY",Ef);var wn=xd(Sd());function Nf(e,t){return(0,wn.default)(e,t,0)}function Da(e){return e.reduce((t,i)=>i[0]===wn.default.DELETE?t:t+i[1],"")}function Tf(e,t){return Zh(e,t,1)}function If(e,t){return Zh(e,t,-1)}function Zh(e,t,i){let n=0,r=0;return e.some(o=>{for(let s=0;s<o[1].length;s++){switch(o[0]*i){case wn.default.INSERT:n++;break;case wn.default.DELETE:n--,r++;break;case wn.default.EQUAL:r++;break}if(r>t)return!0}return!1}),Math.max(Math.min(t,r-1)+n,0)}var Ao;(e=>{function t(i){return i&&i.formattingContextType==="Block"}e.isInstanceOfBlockFormattingContext=t})(Ao||(Ao={}));var Mi;(e=>{let t;(i=>(i.INLINE="inline",i.COLUMN="column",i.REGION="region",i.PAGE="page"))(t=e.FloatReference||(e.FloatReference={}))})(Mi||(Mi={}));var Cr;(e=>{function t(i){return i&&i.flagmentLayoutConstraintType=="AfterIfContinue"}e.isInstanceOfAfterIfContinuesLayoutConstraint=t})(Cr||(Cr={}));var ui;(e=>{function t(n){return n?n.formattingContextType==="RepetitiveElementsOwner"||Kt.isInstanceOfTableFormattingContext(n):!1}e.isInstanceOfRepetitiveElementsOwnerFormattingContext=t;function i(n){return n?n.flagmentLayoutConstraintType==="RepetitiveElementsOwner"||Kt.isInstanceOfTableRowLayoutConstraint(n):!1}e.isInstanceOfRepetitiveElementsOwnerLayoutConstraint=i})(ui||(ui={}));var Kt;(e=>{function t(n){return n&&n.formattingContextType==="Table"}e.isInstanceOfTableFormattingContext=t;function i(n){return n&&n.flagmentLayoutConstraintType==="TableRow"}e.isInstanceOfTableRowLayoutConstraint=i})(Kt||(Kt={}));var Mt;(e=>{let t;(n=>(n[n.IGNORE=0]="IGNORE",n[n.NEWLINE=1]="NEWLINE",n[n.PRESERVE=2]="PRESERVE"))(t=e.Whitespace||(e.Whitespace={}));let i;(n=>(n[n.NONE=0]="NONE",n[n.CONTENT=1]="CONTENT",n[n.ROOTLESS=2]="ROOTLESS",n[n.ROOTED=3]="ROOTED"))(i=e.ShadowType||(e.ShadowType={}))})(Mt||(Mt={}));var Ff={transform:!0,"transform-origin":!0},Af={top:!0,bottom:!0,left:!0,right:!0},Cs=class{constructor(e,t,i){this.target=e,this.name=t,this.value=i}},Rf={show:function(e){e.style.visibility="visible"},hide:function(e){e.style.visibility="hidden"},play:function(e){e.currentTime=0,e.play()},pause:function(e){e.pause()},resume:function(e){e.play()},mute:function(e){e.muted=!0},unmute:function(e){e.muted=!1}};function Lf(e,t){let i=Rf[t];return i?()=>{for(let n=0;n<e.length;n++)try{i(e[n])}catch{}}:null}var Ro=class hn extends cs{constructor(t,i){super(),this.container=t,this.bleedBox=i,u(this,"pageAreaElement",null),u(this,"delayedItems",[]),u(this,"hrefHandler"),u(this,"elementsById",{}),u(this,"dimensions",{width:0,height:0}),u(this,"isFirstPage",!1),u(this,"isLastPage",!1),u(this,"isBlankPage",!1),u(this,"isAutoPageWidth",!0),u(this,"isAutoPageHeight",!0),u(this,"spineIndex",0),u(this,"position",null),u(this,"offset",-1),u(this,"side",null),u(this,"fetchers",[]),u(this,"marginBoxes",{top:{},bottom:{},left:{},right:{}}),u(this,"pageType",null),this.hrefHandler=n=>{let r=n.currentTarget,o=r.getAttribute("href")||r.getAttributeNS("http://www.w3.org/1999/xlink","href");if(o){let s={type:"hyperlink",target:null,currentTarget:null,anchorElement:r,href:o,preventDefault(){n.preventDefault()}};this.dispatchEvent(s)}}}setAutoPageWidth(t){this.isAutoPageWidth=t,t?this.container.setAttribute(hn.AUTO_PAGE_WIDTH_ATTRIBUTE,"true"):this.container.removeAttribute(hn.AUTO_PAGE_WIDTH_ATTRIBUTE)}setAutoPageHeight(t){this.isAutoPageHeight=t,t?this.container.setAttribute(hn.AUTO_PAGE_HEIGHT_ATTRIBUTE,"true"):this.container.removeAttribute(hn.AUTO_PAGE_HEIGHT_ATTRIBUTE)}registerElementWithId(t,i){let n=this.elementsById[i];n?n.push(t):this.elementsById[i]=[t]}finish(t,i){Object.keys(this.elementsById).forEach(o=>{let s=this.elementsById[o];for(let a=0;a<s.length;)this.container.contains(s[a])?a++:s.splice(a,1);s.length===0&&delete this.elementsById[o]});let n=this.delayedItems;for(let o=0;o<n.length;o++){let s=n[o];s.target===this.container&&s.name==="transform"&&!this.isAutoPageWidth&&!this.isAutoPageHeight||T(s.target,s.name,s.value.toString())}let r=i.getElementClientRect(this.container);this.dimensions.width=r.width,this.dimensions.height=r.height;for(let o=0;o<t.length;o++){let s=t[o],a=this.elementsById[s.ref],h=this.elementsById[s.observer];if(a&&h){let l=Lf(a,s.action);if(l)for(let c=0;c<h.length;c++)h[c].addEventListener(s.event,l,!1)}}}};u(Ro,"AUTO_PAGE_WIDTH_ATTRIBUTE","data-vivliostyle-auto-page-width"),u(Ro,"AUTO_PAGE_HEIGHT_ATTRIBUTE","data-vivliostyle-auto-page-height");var Qh=Ro,Wi="data-adapt-spec",nt=Mt.Whitespace;function Jh(e){switch(e){case"normal":case"nowrap":return nt.IGNORE;case"pre-line":return nt.NEWLINE;case"pre":case"pre-wrap":case"break-spaces":return nt.PRESERVE;default:return null}}function je(e,t){if(!e)return!0;if(e.nodeType==1)return!1;let i=e.textContent;switch(t){case nt.PRESERVE:return i.length==0;case nt.NEWLINE:return!!i.match(/^[ \t]*$/);case nt.IGNORE:default:return!!i.match(/^[ \t\r\n\f]*$/)}}var Of=class{constructor(e,t){this.flowName=e,this.parentFlowName=t,u(this,"forcedBreakOffsets",[]),u(this,"formattingContext",null)}},Bf=class{constructor(e,t,i,n,r,o,s,a,h){this.flowName=e,this.element=t,this.startOffset=i,this.priority=n,this.linger=r,this.exclusive=o,this.repeated=s,this.last=a,this.breakBefore=h,u(this,"startPage",-1)}isBetter(e){return this.exclusive?!e.exclusive||this.priority>e.priority?!0:this.last:!1}};function _f(e,t){return e.top-t.top}function Mf(e,t){return t.right-e.right}function eu(e,t){var i,n;return e===t?!0:!e||!t?!1:(e.node===t.node||!!e.shadowContext&&!!t.shadowContext&&e.shadowType===Mt.ShadowType.ROOTLESS&&t.shadowType===Mt.ShadowType.ROOTLESS&&((i=e.node)==null?void 0:i.outerHTML)===((n=t.node)==null?void 0:n.outerHTML))&&e.shadowType===t.shadowType&&Oo(e.shadowContext,t.shadowContext)&&Oo(e.nodeShadow,t.nodeShadow)&&eu(e.shadowSibling,t.shadowSibling)}function Zt(e,t){if(e===t)return!0;if(!e||!t||e.offsetInNode!==t.offsetInNode||e.after!==t.after||e.steps.length!==t.steps.length)return!1;for(let i=0;i<e.steps.length;i++)if(!eu(e.steps[i],t.steps[i]))return!1;return!0}function zf(e){return{steps:[{node:e,shadowType:dt.NONE,shadowContext:null,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:0}],offsetInNode:0,after:!1,preprocessedTextContent:null}}function Er(e,t){return{steps:[{node:e.sourceNode,shadowType:dt.NONE,shadowContext:e.shadowContext,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:t??e.fragmentIndex}],offsetInNode:0,after:!1,preprocessedTextContent:e.preprocessedTextContent}}function kr(e,t){let i=new un(e.node,t,0);return i.shadowType=e.shadowType,i.shadowContext=e.shadowContext,i.nodeShadow=e.nodeShadow,i.shadowSibling=e.shadowSibling?kr(e.shadowSibling,t.copy()):null,i.formattingContext=e.formattingContext,i.fragmentIndex=e.fragmentIndex+1,i}var dt=Mt.ShadowType,Lo=class{constructor(e,t,i,n,r,o,s){this.owner=e,this.root=t,this.xmldoc=i,this.parentShadow=n,this.type=o,this.styler=s,u(this,"subShadow",null),r&&(r.subShadow=this)}equals(e){return e?this.owner===e.owner&&this.xmldoc===e.xmldoc&&this.type===e.type&&Oo(this.parentShadow,e.parentShadow):!1}};function Oo(e,t){return e===t||!!e&&!!t&&e.equals(t)}var Df=class{constructor(e,t){this.outer=e,this.count=t}},un=class tu{constructor(t,i,n){this.sourceNode=t,this.parent=i,this.boxOffset=n,u(this,"offsetInNode",0),u(this,"after",!1),u(this,"shadowType"),u(this,"shadowContext"),u(this,"nodeShadow",null),u(this,"shadowSibling",null),u(this,"shared",!1),u(this,"inline",!0),u(this,"overflow",!1),u(this,"breakPenalty"),u(this,"display",null),u(this,"floatReference"),u(this,"floatSide",null),u(this,"clearSide",null),u(this,"floatMinWrapBlock",null),u(this,"columnSpan",null),u(this,"verticalAlign","baseline"),u(this,"captionSide","top"),u(this,"inlineBorderSpacing",0),u(this,"blockBorderSpacing",0),u(this,"flexContainer",!1),u(this,"whitespace"),u(this,"hyphenateCharacter"),u(this,"breakWord"),u(this,"establishesBFC",!1),u(this,"containingBlockForAbsolute",!1),u(this,"breakBefore",null),u(this,"breakAfter",null),u(this,"viewNode",null),u(this,"clearSpacer",null),u(this,"inheritedProps"),u(this,"vertical"),u(this,"direction"),u(this,"firstPseudo"),u(this,"lang",null),u(this,"preprocessedTextContent",null),u(this,"formattingContext"),u(this,"repeatOnBreak",null),u(this,"pluginProps",{}),u(this,"fragmentIndex",1),u(this,"afterIfContinues",null),u(this,"footnotePolicy",null),u(this,"pageType"),this.shadowType=dt.NONE,this.shadowContext=i?i.shadowContext:null,this.breakPenalty=i?i.breakPenalty:0,this.floatReference=Mi.FloatReference.INLINE,this.whitespace=i?i.whitespace:nt.IGNORE,this.hyphenateCharacter=i?i.hyphenateCharacter:null,this.breakWord=i?i.breakWord:!1,this.inheritedProps=i?i.inheritedProps:{},this.vertical=i?i.vertical:!1,this.direction=i?i.direction:"ltr",this.firstPseudo=i?i.firstPseudo:null,this.formattingContext=i?i.formattingContext:null,this.pageType=i?i.pageType:null}resetView(){this.inline=!0,this.breakPenalty=this.parent?this.parent.breakPenalty:0,this.viewNode=null,this.clearSpacer=null,this.offsetInNode=0,this.after=!1,this.display=null,this.floatReference=Mi.FloatReference.INLINE,this.floatSide=null,this.clearSide=null,this.floatMinWrapBlock=null,this.columnSpan=null,this.verticalAlign="baseline",this.flexContainer=!1,this.whitespace=this.parent?this.parent.whitespace:nt.IGNORE,this.hyphenateCharacter=this.parent?this.parent.hyphenateCharacter:null,this.breakWord=this.parent?this.parent.breakWord:!1,this.breakBefore=null,this.breakAfter=null,this.nodeShadow=null,this.establishesBFC=!1,this.containingBlockForAbsolute=!1,this.vertical=this.parent?this.parent.vertical:!1,this.nodeShadow=null,this.preprocessedTextContent=null,this.formattingContext=this.parent?this.parent.formattingContext:null,this.repeatOnBreak=null,this.pluginProps={},this.fragmentIndex=1,this.afterIfContinues=null,this.footnotePolicy=null}cloneItem(){let t=new tu(this.sourceNode,this.parent,this.boxOffset);return t.offsetInNode=this.offsetInNode,t.after=this.after,t.nodeShadow=this.nodeShadow,t.shadowType=this.shadowType,t.shadowContext=this.shadowContext,t.shadowSibling=this.shadowSibling,t.inline=this.inline,t.breakPenalty=this.breakPenalty,t.display=this.display,t.floatReference=this.floatReference,t.floatSide=this.floatSide,t.clearSide=this.clearSide,t.floatMinWrapBlock=this.floatMinWrapBlock,t.columnSpan=this.columnSpan,t.verticalAlign=this.verticalAlign,t.captionSide=this.captionSide,t.inlineBorderSpacing=this.inlineBorderSpacing,t.blockBorderSpacing=this.blockBorderSpacing,t.establishesBFC=this.establishesBFC,t.containingBlockForAbsolute=this.containingBlockForAbsolute,t.flexContainer=this.flexContainer,t.whitespace=this.whitespace,t.hyphenateCharacter=this.hyphenateCharacter,t.breakWord=this.breakWord,t.breakBefore=this.breakBefore,t.breakAfter=this.breakAfter,t.viewNode=this.viewNode,t.clearSpacer=this.clearSpacer,t.firstPseudo=this.firstPseudo,t.vertical=this.vertical,t.overflow=this.overflow,t.preprocessedTextContent=this.preprocessedTextContent,t.formattingContext=this.formattingContext,t.repeatOnBreak=this.repeatOnBreak,t.pluginProps=Object.create(this.pluginProps),t.fragmentIndex=this.fragmentIndex,t.afterIfContinues=this.afterIfContinues,t.footnotePolicy=this.footnotePolicy,t}modify(){return this.shared?this.cloneItem():this}copy(){let t=this;do{if(t.shared)break;t.shared=!0,t=t.parent}while(t);return this}clone(){let t=this.cloneItem(),i=t,n;for(;(n=i.parent)!=null;)n=n.cloneItem(),i.parent=n,i=n;return t}toNodePositionStep(){return{node:this.sourceNode,shadowType:this.shadowType,shadowContext:this.shadowContext,nodeShadow:this.nodeShadow,shadowSibling:this.shadowSibling?this.shadowSibling.toNodePositionStep():null,formattingContext:this.formattingContext,fragmentIndex:this.fragmentIndex}}toNodePosition(){var t,i,n;let r=this,o=[];r.shadowType===Mt.ShadowType.ROOTLESS&&(r.floatReference!==Mi.FloatReference.INLINE||r.floatSide==="footnote")&&(n=(i=(t=r.shadowContext)==null?void 0:t.styler)==null?void 0:i.style)!=null&&n._pseudos&&(r=r.parent);do(!r.firstPseudo||!r.parent||r.parent.firstPseudo===r.firstPseudo)&&o.push(r.toNodePositionStep()),r=r.parent;while(r);let s=this.preprocessedTextContent?If(this.preprocessedTextContent,this.offsetInNode):this.offsetInNode;return{steps:o,offsetInNode:s,after:this.after,preprocessedTextContent:this.preprocessedTextContent}}isInsideBFC(){let t=this.parent;for(;t;){if(t.establishesBFC)return!0;t=t.parent}return!1}getContainingBlockForAbsolute(){let t=this.parent;for(;t;){if(t.containingBlockForAbsolute)return t;t=t.parent}return null}belongsTo(t){return this.formattingContext===t&&!!this.parent&&this.parent.formattingContext===t}},Qt=class iu{constructor(t){this.primary=t,u(this,"floats",null)}clone(){let t=new iu(this.primary);if(this.floats){t.floats=[];for(let i=0;i<this.floats.length;++i)t.floats[i]=this.floats[i]}return t}isSamePosition(t){if(!t)return!1;if(this===t)return!0;if(!Zt(this.primary,t.primary))return!1;if(this.floats){if(!t.floats||this.floats.length!==t.floats.length)return!1;for(let i=0;i<this.floats.length;i++)if(!Zt(this.floats[i],t.floats[i]))return!1}else if(t.floats)return!1;return!0}},Vf=class nu{constructor(t,i){this.chunkPosition=t,this.flowChunk=i}clone(){return new nu(this.chunkPosition.clone(),this.flowChunk)}isSamePosition(t){return!!t&&(this===t||this.chunkPosition.isSamePosition(t.chunkPosition))}},Hf=class ru{constructor(){u(this,"positions",[]),u(this,"startBreakType",null),u(this,"breakAfter",null)}clone(){let t=new ru,i=this.positions,n=t.positions;for(let r=0;r<i.length;r++)n[r]=i[r].clone();return t.startBreakType=this.startBreakType,t.breakAfter=this.breakAfter,t}isSamePosition(t){if(this===t)return!0;if(!t||this.positions.length!==t.positions.length)return!1;for(let i=0;i<this.positions.length;i++)if(!this.positions[i].isSamePosition(t.positions[i]))return!1;return!0}hasContent(t){return this.positions.length>0&&this.positions[0].flowChunk.startOffset<=t}},Uf=class ou{constructor(){u(this,"page",0),u(this,"flows",{}),u(this,"flowPositions",{}),u(this,"isBlankPage",!1),u(this,"highestSeenOffset",0),u(this,"highestSeenNode"),u(this,"lookupPositionOffset")}clone(){let t=new ou;t.page=this.page,t.isBlankPage=this.isBlankPage,t.highestSeenNode=this.highestSeenNode,t.highestSeenOffset=this.highestSeenOffset,t.lookupPositionOffset=this.lookupPositionOffset,t.flows=this.flows;for(let i in this.flowPositions)t.flowPositions[i]=this.flowPositions[i].clone();return t}isSamePosition(t){if(this===t)return!0;if(!t||this.page!==t.page)return!1;let i=Object.keys(this.flowPositions),n=Object.keys(t.flowPositions);if(i.length!==n.length)return!1;for(let r of i)if(!this.flowPositions[r].isSamePosition(t.flowPositions[r]))return!1;return!0}hasContent(t,i){let n=this.flowPositions[t];return n?n.hasContent(i):!1}startSideOfFlow(t){var i;let n=(i=this.flowPositions[t])==null?void 0:i.startBreakType;return n&&Nn(n)?n:"any"}firstFlowChunkOfFlow(t){let i=this.flowPositions[t];if(!i)return null;let n=i.positions[0];return n?n.flowChunk:null}},su=class{constructor(e){this.element=e,u(this,"left",0),u(this,"top",0),u(this,"marginLeft",0),u(this,"marginRight",0),u(this,"marginTop",0),u(this,"marginBottom",0),u(this,"borderLeft",0),u(this,"borderRight",0),u(this,"borderTop",0),u(this,"borderBottom",0),u(this,"paddingLeft",0),u(this,"paddingRight",0),u(this,"paddingTop",0),u(this,"paddingBottom",0),u(this,"width",0),u(this,"height",0),u(this,"originX",0),u(this,"originY",0),u(this,"exclusions",null),u(this,"innerShape",null),u(this,"computedBlockSize",0),u(this,"snapWidth",0),u(this,"snapHeight",0),u(this,"snapOffsetX",0),u(this,"snapOffsetY",0),u(this,"vertical",!1),u(this,"rtl",!1)}getInsetTop(){return this.marginTop+this.borderTop+this.paddingTop}getInsetBottom(){return this.marginBottom+this.borderBottom+this.paddingBottom}getInsetLeft(){return this.marginLeft+this.borderLeft+this.paddingLeft}getInsetRight(){return this.marginRight+this.borderRight+this.paddingRight}getInsetBefore(){return this.vertical?this.getInsetRight():this.getInsetTop()}getInsetAfter(){return this.vertical?this.getInsetLeft():this.getInsetBottom()}getInsetStart(){return this.vertical?this.getInsetTop():this.getInsetLeft()}getInsetEnd(){return this.vertical?this.getInsetBottom():this.getInsetRight()}getBeforeEdge(e){return this.vertical?e.right:e.top}getAfterEdge(e){return this.vertical?e.left:e.bottom}getStartEdge(e){return this.vertical?this.rtl?e.bottom:e.top:this.rtl?e.right:e.left}getEndEdge(e){return this.vertical?this.rtl?e.top:e.bottom:this.rtl?e.left:e.right}getInlineSize(e){return this.vertical?e.bottom-e.top:e.right-e.left}getBoxSize(e){return this.vertical?e.right-e.left:e.bottom-e.top}getBoxDir(){return this.vertical?-1:1}getInlineDir(){return this.rtl?-1:1}copyFrom(e){this.element=e.element,this.left=e.left,this.top=e.top,this.marginLeft=e.marginLeft,this.marginRight=e.marginRight,this.marginTop=e.marginTop,this.marginBottom=e.marginBottom,this.borderLeft=e.borderLeft,this.borderRight=e.borderRight,this.borderTop=e.borderTop,this.borderBottom=e.borderBottom,this.paddingLeft=e.paddingLeft,this.paddingRight=e.paddingRight,this.paddingTop=e.paddingTop,this.paddingBottom=e.paddingBottom,this.width=e.width,this.height=e.height,this.originX=e.originX,this.originY=e.originY,this.innerShape=e.innerShape,this.exclusions=e.exclusions,this.computedBlockSize=e.computedBlockSize,this.snapWidth=e.snapWidth,this.snapHeight=e.snapHeight,this.vertical=e.vertical,this.rtl=e.rtl}setVerticalPosition(e,t){this.top=e,this.height=t,T(this.element,"top",`${e}px`),T(this.element,"height",`${t}px`)}setHorizontalPosition(e,t){this.left=e,this.width=t,T(this.element,"left",`${e}px`),T(this.element,"width",`${t}px`)}setBlockPosition(e,t){if(this.vertical){let i=t+this.marginLeft+this.marginRight+this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight;this.setHorizontalPosition(e+i*this.getBoxDir(),t)}else this.setVerticalPosition(e,t)}setInlinePosition(e,t){if(this.vertical)if(this.rtl){let i=t+this.marginTop+this.marginBottom+this.paddingTop+this.paddingBottom+this.borderTop+this.borderBottom;this.setVerticalPosition(e+i*this.getInlineDir(),t)}else this.setVerticalPosition(e,t);else if(this.rtl){let i=t+this.marginLeft+this.marginRight+this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight;this.setHorizontalPosition(e+i*this.getInlineDir(),t)}else this.setHorizontalPosition(e,t)}clear(){let e=this.element,t;for(;t=e.lastChild;)e.removeChild(t)}getInnerShape(){let e=this.getInnerRect();return this.innerShape?this.innerShape.withOffset(e.x1,e.y1):bs(e.x1,e.y1,e.x2,e.y2)}getInnerRect(){let e=this.originX+this.left+this.getInsetLeft(),t=this.originY+this.top+this.getInsetTop();return new ht(e,t,e+this.width,t+this.height)}getPaddingRect(){let e=this.originX+this.left+this.marginLeft+this.borderLeft,t=this.originY+this.top+this.marginTop+this.borderTop,i=this.paddingLeft+this.width+this.paddingRight,n=this.paddingTop+this.height+this.paddingBottom;return new ht(e,t,e+i,t+n)}getOuterShape(e,t){let i=this.getOuterRect();return kh(e,i.x1,i.y1,i.x2-i.x1,i.y2-i.y1,t)}getOuterRect(){let e=this.originX+this.left,t=this.originY+this.top,i=this.getInsetLeft()+this.width+this.getInsetRight(),n=this.getInsetTop()+this.height+this.getInsetBottom();return new ht(e,t,e+i,t+n)}},Pr=class extends Dt{constructor(e,t,i,n){super(),this.elem=e,this.context=t,this.rootContentValue=i,this.exprContentListener=n}visitStrInner(e,t){var i;if(!t){if(((i=this.elem.lastChild)==null?void 0:i.nodeType)===3){this.elem.lastChild.textContent+=e;return}t=this.elem.ownerDocument.createTextNode(e)}this.elem.appendChild(t)}visitStr(e){return this.visitStrInner(e.str),null}visitURL(e){if(this.rootContentValue.url)this.elem.setAttribute("src",e.url);else{let t=this.elem.ownerDocument.createElementNS("http://www.w3.org/1999/xhtml","img");t.setAttribute("src",e.url),this.elem.appendChild(t)}return null}visitSpaceList(e){return this.visitValues(e.values),null}visitExpr(e){let t=e.toExpr(),i=t.evaluate(this.context);if(typeof i=="string"){t instanceof $e&&(i=Zi(t.scope,new St(i,null),"").stringValue()),this.elem.ownerDocument;let n=this.exprContentListener(t,i,this.elem.ownerDocument);!n&&i&&t instanceof We&&t.str.startsWith("running-element-")&&(i=""),this.visitStrInner(i,n)}return null}};function Jt(e){return e!=null&&e!==X&&e!==x.normal&&e!==x.none&&!te(e)}var Be=Mi.FloatReference;function $f(e){switch(e){case"inline":return Be.INLINE;case"column":return Be.COLUMN;case"region":return Be.REGION;case"page":return Be.PAGE;default:throw new Error(`Unknown float-reference: ${e}`)}}function zi(e){switch(e){case Be.INLINE:return!1;case Be.COLUMN:case Be.REGION:case Be.PAGE:return!0;default:throw new Error(`Unknown float-reference: ${e}`)}}function Wf(e,t,i){let n=t?"vertical-rl":"horizontal-tb";if((e==="top"||e==="bottom")&&(e=qh(e,n,i)),e==="block-start"&&(e="inline-start"),e==="block-end"&&(e="inline-end"),e==="inline-start"||e==="inline-end"){let r=Xh(e,n,i),o=yf(r,n);o==="line-left"?e="left":o==="line-right"&&(e="right")}return e!=="left"&&e!=="right"&&(U.warn(`Invalid float value: ${e}. Fallback to left.`),e="left"),e}var au=class{constructor(e,t,i,n,r,o){this.nodePosition=e,this.floatReference=t,this.floatSide=i,this.clearSide=n,this.flowName=r,this.floatMinWrapBlock=o,u(this,"order",null),u(this,"id",null)}getOrder(){if(this.order===null)throw new Error("The page float is not yet added");return this.order}getId(){if(!this.id)throw new Error("The page float is not yet added");return this.id}isAllowedOnContext(e){return e.isAnchorAlreadyAppeared(this.getId())}isAllowedToPrecede(e){return!1}},Gf=class{constructor(){u(this,"floats",[]),u(this,"nextPageFloatIndex",0)}nextOrder(){return this.nextPageFloatIndex++}createPageFloatId(e){return`pf${e}`}addPageFloat(e){if(this.floats.findIndex(t=>Zt(t.nodePosition,e.nodePosition))>=0)throw new Error("A page float with the same source node is already registered");{let t=e.order=this.nextOrder();e.id=this.createPageFloatId(t),this.floats.push(e)}}findPageFloatByNodePosition(e){let t=this.floats.findIndex(i=>Zt(i.nodePosition,e));return t>=0?this.floats[t]:null}findPageFloatById(e){let t=this.floats.findIndex(i=>i.id===e);return t>=0?this.floats[t]:null}},lu=class{constructor(e,t,i,n,r){this.floatReference=e,this.floatSide=t,this.continuations=i,this.area=n,this.continues=r}hasFloat(e){return this.continuations.some(t=>t.float===e)}findNotAllowedFloat(e){for(let t=this.continuations.length-1;t>=0;t--){let i=this.continuations[t].float;if(!i.isAllowedOnContext(e))return i}return null}getOuterShape(){return this.area.getOuterShape(null,null)}getOuterRect(){return this.area.getOuterRect()}getOrder(){let e=this.continuations.map(t=>t.float);return Math.min.apply(null,e.map(t=>t.getOrder()))}shouldBeStashedBefore(e){return this.getOrder()<e.getOrder()}addContinuations(e){e.forEach(t=>{this.continuations.push(t)})}getFlowName(){let e=this.continuations[0].float.flowName;return this.continuations.every(t=>t.float.flowName===e),e}},Va=class{constructor(e,t){this.float=e,this.nodePosition=t}equals(e){return e?this===e?!0:this.float===e.float&&Zt(this.nodePosition,e.nodePosition):!1}},cn=class{constructor(e,t,i,n,r,o,s){this.parent=e,this.floatReference=t,this.container=i,this.flowName=n,this.generatingNodePosition=r,u(this,"children",[]),u(this,"writingMode"),u(this,"direction"),u(this,"invalidated",!1),u(this,"floatStore"),u(this,"forbiddenFloats",[]),u(this,"floatFragments",[]),u(this,"stashedFloatFragments",[]),u(this,"floatAnchors",{}),u(this,"floatsDeferredToNext",[]),u(this,"floatsDeferredFromPrevious"),u(this,"layoutConstraints",[]),u(this,"locked",!1),e&&e.children.push(this),this.writingMode=o||e&&e.writingMode||x.horizontal_tb,this.direction=s||e&&e.direction||x.ltr,this.floatStore=e?e.floatStore:new Gf;let a=this.getPreviousSibling();this.floatsDeferredFromPrevious=a?[].concat(a.floatsDeferredToNext):[]}getParent(e){if(!this.parent)throw new Error(`No PageFloatLayoutContext for ${e}`);return this.parent}getPreviousSiblingOf(e,t,i,n){let r=this.children.indexOf(e);r<0&&(r=this.children.length);for(let o=r-1;o>=0;o--){let s=this.children[o];if(s.floatReference===t&&s.flowName===i&&Zt(s.generatingNodePosition,n)||(s=s.getPreviousSiblingOf(null,t,i,n),s))return s}return null}getPreviousSibling(){let e=this,t=this.parent,i;for(;t;){if(i=t.getPreviousSiblingOf(e,this.floatReference,this.flowName,this.generatingNodePosition),i)return i;e=t,t=t.parent}return null}getContainer(e){return!e||e===this.floatReference?this.container:this.getParent(e).getContainer(e)}setContainer(e){this.container=e,this.reattachFloatFragments()}addPageFloat(e){this.floatStore.addPageFloat(e)}getPageFloatLayoutContext(e){return e===this.floatReference?this:this.getParent(e).getPageFloatLayoutContext(e)}findPageFloatByNodePosition(e){return this.floatStore.findPageFloatByNodePosition(e)}forbid(e){let t=e.getId(),i=e.floatReference;i===this.floatReference?this.forbiddenFloats.includes(t)||(this.forbiddenFloats.push(t),new Gi().findByFloat(e).forbid(e,this)):this.getParent(i).forbid(e)}isForbidden(e){let t=e.getId(),i=e.floatReference;return i===this.floatReference?this.forbiddenFloats.includes(t):this.getParent(i).isForbidden(e)}addPageFloatFragment(e,t){let i=e.floatReference;i!==this.floatReference?this.getParent(i).addPageFloatFragment(e,t):this.floatFragments.includes(e)||(this.floatFragments.push(e),this.floatFragments.sort((n,r)=>n.getOrder()-r.getOrder())),t||this.invalidate()}removePageFloatFragment(e,t){let i=e.floatReference;if(i!==this.floatReference)this.getParent(i).removePageFloatFragment(e,t);else{let n=this.floatFragments.indexOf(e);if(n>=0){let r=this.floatFragments.splice(n,1)[0],o=r.area&&r.area.element;o&&o.parentNode&&o.parentNode.removeChild(o),t||this.invalidate()}}}findPageFloatFragment(e){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).findPageFloatFragment(e);let t=this.floatFragments.findIndex(i=>i.hasFloat(e));return t>=0?this.floatFragments[t]:null}hasFloatFragments(e){return this.floatFragments.length>0&&(!e||this.floatFragments.some(e))?!0:this.parent?this.parent.hasFloatFragments(e):!1}hasContinuingFloatFragmentsInFlow(e){return this.hasFloatFragments(t=>t.continues&&t.getFlowName()===e)}registerPageFloatAnchor(e,t){this.floatAnchors[e.getId()]=t}collectPageFloatAnchors(){let e=Object.assign({},this.floatAnchors);return this.children.reduce((t,i)=>Object.assign(t,i.collectPageFloatAnchors()),e)}isAnchorAlreadyAppeared(e){if(this.getDeferredPageFloatContinuations().some(i=>i.float.getId()===e))return!0;let t=this.collectPageFloatAnchors()[e];return t&&this.container&&this.container.element?this.container.element.contains(t):!1}deferPageFloat(e){let t=e.float;if(t.floatReference===this.floatReference){let i=this.floatsDeferredToNext.findIndex(n=>n.float===t);i>=0?this.floatsDeferredToNext.splice(i,1,e):this.floatsDeferredToNext.push(e)}else this.getParent(t.floatReference).deferPageFloat(e)}hasPrecedingFloatsDeferredToNext(e,t){if(!t&&e.floatReference!==this.floatReference)return this.getParent(e.floatReference).hasPrecedingFloatsDeferredToNext(e,!1);let i=e.getOrder();return this.floatsDeferredToNext.some(n=>n.float.getOrder()<i&&!e.isAllowedToPrecede(n.float))?!0:this.parent?this.parent.hasPrecedingFloatsDeferredToNext(e,!0):!1}getLastFollowingFloatInFragments(e){let t=e.getOrder(),i=null;if(this.floatFragments.forEach(n=>{n.continuations.forEach(r=>{let o=r.float,s=o.getOrder();s>t&&(!i||s>i.getOrder())&&(i=o)})}),this.parent){let n=this.parent.getLastFollowingFloatInFragments(e);n&&(!i||n.getOrder()>i.getOrder())&&(i=n)}return i}getDeferredPageFloatContinuations(e){e=e||this.flowName;let t=this.floatsDeferredFromPrevious.filter(i=>!e||i.float.flowName===e);return this.parent&&(t=this.parent.getDeferredPageFloatContinuations(e).concat(t)),t.sort((i,n)=>i.float.getOrder()-n.float.getOrder())}getPageFloatContinuationsDeferredToNext(e){e=e||this.flowName;let t=this.floatsDeferredToNext.filter(i=>!e||i.float.flowName===e);return this.parent?this.parent.getPageFloatContinuationsDeferredToNext(e).concat(t):t}getFloatsDeferredToNextInChildContexts(){let e=[],t=[];for(let i=this.children.length-1;i>=0;i--){let n=this.children[i];t.includes(n.flowName)||(t.push(n.flowName),e=e.concat(n.floatsDeferredToNext.map(r=>r.float)),e=e.concat(n.getFloatsDeferredToNextInChildContexts()))}return e}checkAndForbidNotAllowedFloat(){if(this.checkAndForbidFloatFollowingDeferredFloat())return!0;for(let e=this.floatFragments.length-1;e>=0;e--){let t=this.floatFragments[e],i=t.findNotAllowedFloat(this);if(i)return this.locked?this.invalidate():(this.removePageFloatFragment(t),this.forbid(i),this.removeEndFloatFragments(t.floatSide)),!0}return this.floatReference===Be.REGION&&this.parent.locked?this.parent.checkAndForbidNotAllowedFloat():!1}checkAndForbidFloatFollowingDeferredFloat(){let e=this.getFloatsDeferredToNextInChildContexts(),t=this.floatFragments.reduce((i,n)=>i.concat(n.continuations.map(r=>r.float)),[]);t.sort((i,n)=>n.getOrder()-i.getOrder());for(let i of t){let n=i.getOrder();if(e.some(r=>!i.isAllowedToPrecede(r)&&n>r.getOrder())){if(this.locked)this.invalidate();else{this.forbid(i);let r=this.findPageFloatFragment(i);this.removePageFloatFragment(r)}return!0}}return!1}finish(){if(!this.checkAndForbidNotAllowedFloat()){for(let e=this.floatsDeferredToNext.length-1;e>=0;e--)if(!this.floatsDeferredToNext[e].float.isAllowedOnContext(this)){if(this.locked){this.invalidate();return}this.floatsDeferredToNext.splice(e,1)}this.floatsDeferredFromPrevious.forEach(e=>{this.floatsDeferredToNext.findIndex(t=>e.equals(t))>=0||this.floatFragments.some(t=>t.hasFloat(e.float))||this.floatsDeferredToNext.push(e)})}}hasSameContainerAs(e){return!!this.container&&!!e.container&&this.container.element===e.container.element}invalidate(){this.invalidated=!0,!this.locked&&(this.container&&(this.children.forEach(e=>{this.hasSameContainerAs(e)&&e.floatFragments.forEach(t=>{let i=t.area.element;i&&i.parentNode&&i.parentNode.removeChild(i)})}),this.container.clear()),this.children.forEach(e=>{e.layoutConstraints.splice(0)}),this.children.splice(0),Object.keys(this.floatAnchors).forEach(e=>{delete this.floatAnchors[e]}))}detachChildren(){let e=this.children.splice(0);return e.forEach(t=>{t.floatFragments.forEach(i=>{let n=i.area.element;n&&n.parentNode&&n.parentNode.removeChild(n)})}),e}attachChildren(e){e.forEach(t=>{this.children.push(t),t.reattachFloatFragments()})}isInvalidated(){return this.invalidated||!!this.parent&&this.parent.isInvalidated()}validate(){this.invalidated=!1}toLogical(e){let t=this.writingMode.toString(),i=this.direction.toString();return qh(e,t,i)}toPhysical(e){let t=this.writingMode.toString(),i=this.direction.toString();return Xh(e,t,i)}removeEndFloatFragments(e){let t=this.toLogical(e);if(t==="block-end"||t==="inline-end"){let i=0;for(;i<this.floatFragments.length;){let n=this.floatFragments[i];this.toLogical(n.floatSide)===t?this.removePageFloatFragment(n):i++}}}stashEndFloatFragments(e){let t=e.floatReference;if(t!==this.floatReference){this.getParent(t).stashEndFloatFragments(e);return}let i=this.toLogical(e.floatSide);if(i==="block-end"||i==="snap-block"||i==="inline-end"){let n=0;for(;n<this.floatFragments.length;){let r=this.floatFragments[n],o=this.toLogical(r.floatSide);(o===i||i==="snap-block"&&o==="block-end")&&r.shouldBeStashedBefore(e)?(this.stashedFloatFragments.push(r),this.floatFragments.splice(n,1)):n++}}}restoreStashedFragments(e){if(e!==this.floatReference){this.getParent(e).restoreStashedFragments(e);return}this.stashedFloatFragments.forEach(t=>{this.addPageFloatFragment(t,!0)}),this.stashedFloatFragments.splice(0)}discardStashedFragments(e){if(e!==this.floatReference){this.getParent(e).discardStashedFragments(e);return}this.stashedFloatFragments.splice(0)}getStashedFloatFragments(e){return e===this.floatReference?this.stashedFloatFragments.concat().sort((t,i)=>i.getOrder()-t.getOrder()):this.getParent(e).getStashedFloatFragments(e)}getLimitValue(e,t,i,n){this.container;let r=this.toLogical(e),o=this.toPhysical(e),s=this.getLimitValueInner(r,t,i,n);if(this.parent&&this.parent.container){let a=this.parent.getLimitValue(o,t,i,n);switch(o){case"top":return Math.max(s,a);case"left":return Math.max(s,a);case"bottom":return Math.min(s,a);case"right":return Math.min(s,a);default:}}return s}getLimitValueInner(e,t,i,n){this.container;let r=this.getLimitValuesInner(t,i,n);switch(e){case"block-start":return this.container.vertical?r.right:r.top;case"block-end":return this.container.vertical?r.left:r.bottom;case"inline-start":return this.container.vertical?this.container.rtl?r.bottom:r.top:this.container.rtl?r.right:r.left;case"inline-end":return this.container.vertical?this.container.rtl?r.top:r.bottom:this.container.rtl?r.left:r.right;default:throw new Error(`Unknown logical side: ${e}`)}}getLimitValuesInner(e,t,i){this.container;let n=this.container.originX,r=this.container.originY,o=this.container.getPaddingRect(),s={top:o.y1-r,left:o.x1-n,bottom:o.y2-r,right:o.x2-n,floatMinWrapBlockStart:0,floatMinWrapBlockEnd:0};function a(l,c,p){return l.unit==="%"?p*l.num/100:e.convertLengthToPx(l,c,t)}let h=this.floatFragments;return h.length>0&&(s=h.reduce((l,c)=>{if(i&&!i(c,this))return l;let p=this.toLogical(c.floatSide),d=c.area,f=c.continuations[0].float.floatMinWrapBlock,g=l.top,m=l.left,v=l.bottom,b=l.right,w=l.floatMinWrapBlockStart,S=l.floatMinWrapBlockEnd;switch(p){case"inline-start":d.vertical?g=Math.max(g,d.top+d.height):m=Math.max(m,d.left+d.width);break;case"block-start":d.vertical?(f&&d.left<b&&(w=a(f,d.rootViewNodes[0],o.x2-o.x1)),b=Math.min(b,d.left)):(f&&d.top+d.height>g&&(w=a(f,d.rootViewNodes[0],o.y2-o.y1)),g=Math.max(g,d.top+d.height));break;case"inline-end":d.vertical?v=Math.min(v,d.top):b=Math.min(b,d.left);break;case"block-end":d.vertical?(f&&d.left+d.width>m&&(S=a(f,d.rootViewNodes[0],o.x2-o.x1)),m=Math.max(m,d.left+d.width)):(f&&d.top<v&&(S=a(f,d.rootViewNodes[0],o.y2-o.y1)),v=Math.min(v,d.top));break;default:throw new Error(`Unknown logical float side: ${p}`)}return{top:g,left:m,bottom:v,right:b,floatMinWrapBlockStart:w,floatMinWrapBlockEnd:S}},s)),s.left+=n,s.right+=n,s.top+=r,s.bottom+=r,s}setFloatAreaDimensions(e,t,i,n,r,o,s){if(t!==this.floatReference)return this.getParent(t).setFloatAreaDimensions(e,t,i,n,r,o,s);let a=this.toLogical(i);if(a==="snap-block"){if(!s["block-start"]&&!s["block-end"])return null}else if(!s[a])return null;e.clientLayout;let h=this.getLimitValue("block-start",e.layoutContext,e.clientLayout),l=this.getLimitValue("block-end",e.layoutContext,e.clientLayout),c=this.getLimitValue("inline-start",e.layoutContext,e.clientLayout),p=this.getLimitValue("inline-end",e.layoutContext,e.clientLayout),d=e.vertical?e.originX:e.originY,f=e.vertical?e.originY:e.originX;h=e.vertical?Math.min(h,e.left+e.getInsetLeft()+e.width+e.getInsetRight()+d):Math.max(h,e.top+d),l=e.vertical?Math.max(l,e.left+d):Math.min(l,e.top+e.getInsetTop()+e.height+e.getInsetBottom()+d);function g(S,L){let B=S(e.bands,L);return B?(e.vertical&&(B=Sh(B)),h=e.vertical?Math.min(h,B.x2):Math.max(h,B.y1),l=e.vertical?Math.max(l,B.x1):Math.min(l,B.y2),!0):o}let m,v,b,w;if(r){let S=e.vertical?xr(new ht(l,c,h,p)):new ht(c,h,p,l);if((a==="block-start"||a==="snap-block"||a==="inline-start")&&!g(pp,S)||(a==="block-end"||a==="snap-block"||a==="inline-end")&&!g(fp,S)||(b=(l-h)*e.getBoxDir(),m=b-e.getInsetBefore()-e.getInsetAfter(),w=(p-c)*e.getInlineDir(),v=w-e.getInsetStart()-e.getInsetEnd(),!o&&(m<=0||v<=0)))return null}else{m=e.computedBlockSize,b=m+e.getInsetBefore()+e.getInsetAfter();let S=(l-h)*e.getBoxDir();if(a==="snap-block"){if(n===null)a="block-start";else{let B=this.container.getPaddingRect(),D=this.container.getBoxDir()*(n-(this.container.vertical?B.x2:B.y1)),W=this.container.getBoxDir()*((this.container.vertical?B.x1:B.y2)-n-b);D<=W?a="block-start":a="block-end"}if(!s[a])if(s["block-end"])a="block-end";else return null}if(!o&&S<b)return null;a==="inline-start"||a==="inline-end"?v=Ss(e.clientLayout,e.element,["fit-content inline size"])["fit-content inline size"]:e.adjustContentRelativeSize?v=e.getContentInlineSize():v=e.vertical?e.height:e.width,w=v+e.getInsetStart()+e.getInsetEnd();let L=(p-c)*e.getInlineDir();if(!o&&L<w)return null}switch(h-=d,l-=d,c-=f,p-=f,a){case"inline-start":case"block-start":case"snap-block":e.setInlinePosition(c,v),e.setBlockPosition(h,m);break;case"inline-end":case"block-end":e.setInlinePosition(p-w*e.getInlineDir(),v),e.setBlockPosition(l-b*e.getBoxDir(),m);break;default:throw new Error(`unknown float direction: ${i}`)}return a}getFloatFragmentExclusions(){let e=this.floatFragments.map(t=>t.getOuterShape());return this.parent?this.parent.getFloatFragmentExclusions().concat(e):e}reattachFloatFragments(){let e=this.container.element&&this.container.element.parentNode;e&&this.floatFragments.forEach(t=>{e.appendChild(t.area.element)})}getMaxReachedAfterEdge(){let e=this.getContainer().vertical;return this.floatFragments.reduce((t,i)=>{let n=i.getOuterRect();return e?Math.min(t,n.x1):Math.max(t,n.y2)},e?1/0:0)}getBlockStartEdgeOfBlockEndFloats(){let e=this.getContainer().vertical;return this.floatFragments.filter(t=>t.floatSide==="block-end").reduce((t,i)=>{let n=i.getOuterRect();return e?Math.max(t,n.x2):Math.min(t,n.y1)},e?0:1/0)}getPageFloatClearEdge(e,t){function i(h){return l=>h.isAnchorAlreadyAppeared(l.float.getId())}function n(h,l){return h.continuations.some(i(l))}let r=t.getPaddingRect(),o=t.vertical?r.x1:r.y2,s=this;for(;s;){if(s.floatsDeferredToNext.some(i(s)))return o;s=s.parent}t.clientLayout;let a=this.getLimitValue("block-start",t.layoutContext,t.clientLayout,n);return this.getLimitValue("block-end",t.layoutContext,t.clientLayout,n)*t.getBoxDir()<o*t.getBoxDir()?o:a}getPageFloatPlacementCondition(e,t,i){if(e.floatReference!==this.floatReference)return this.getParent(e.floatReference).getPageFloatPlacementCondition(e,t,i);let n={"block-start":!0,"block-end":!0,"inline-start":!0,"inline-end":!0};if(!i)return n;let r=this.toLogical(t),o=this.toLogical(i),s;o==="all"?s=["block-start","block-end","inline-start","inline-end"]:o==="both"?s=["inline-start","inline-end"]:o==="same"?r==="snap-block"?s=["block-start","block-end"]:s=[r]:s=[o];let a=e.getOrder();function h(p){return d=>d.floatSide===p&&d.getOrder()<a}function l(p,d){return p.children.some(f=>f.floatFragments.some(h(d))||l(f,d))}function c(p,d){let f=p.parent;return!!f&&(f.floatFragments.some(h(d))||c(f,d))}return s.forEach(p=>{switch(p){case"block-start":case"inline-start":n[p]=!l(this,p);break;case"block-end":case"inline-end":n[p]=!c(this,p);break;default:throw new Error(`Unexpected side: ${p}`)}}),n}getLayoutConstraints(){return(this.parent?this.parent.getLayoutConstraints():[]).concat(this.layoutConstraints)}addLayoutConstraint(e,t){t===this.floatReference?this.layoutConstraints.push(e):this.getParent(t).addLayoutConstraint(e,t)}isColumnFullWithPageFloats(e){let t=e.layoutContext,i=e.clientLayout,n=this,r=null;for(;n&&n.container;){let s=n.getLimitValuesInner(t,i);r?e.vertical?(s.right<r.right&&(r.right=s.right,r.floatMinWrapBlockStart=s.floatMinWrapBlockStart),s.left>r.left&&(r.left=s.left,r.floatMinWrapBlockEnd=s.floatMinWrapBlockEnd)):(s.top>r.top&&(r.top=s.top,r.floatMinWrapBlockStart=s.floatMinWrapBlockStart),s.bottom<r.bottom&&(r.bottom=s.bottom,r.floatMinWrapBlockEnd=s.floatMinWrapBlockEnd)):r=s,n=n.parent}let o=Math.max(r.floatMinWrapBlockStart,r.floatMinWrapBlockEnd);return(e.vertical?r.right-r.left:r.bottom-r.top)<=o}getMaxBlockSizeOfPageFloats(){let e=this.getContainer().vertical;return this.floatFragments.length?Math.max.apply(null,this.floatFragments.map(t=>{let i=t.area;return e?i.width:i.height})):0}lock(){this.locked=!0}unlock(){this.locked=!1}isLocked(){return this.locked}},rn=[],Gi=class{static register(e){rn.push(e)}findByNodeContext(e){for(let t=rn.length-1;t>=0;t--){let i=rn[t];if(i.appliesToNodeContext(e))return i}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}findByFloat(e){for(let t=rn.length-1;t>=0;t--){let i=rn[t];if(i.appliesToFloat(e))return i}throw new Error(`No PageFloatLayoutStrategy found for ${e}`)}},jf=class{appliesToNodeContext(e){return zi(e.floatReference)}appliesToFloat(e){return!0}createPageFloat(e,t,i){let n=e.floatReference;e.floatSide;let r=e.floatSide,o=e.toNodePosition();return i.resolveFloatReferenceFromColumnSpan(n,e.columnSpan,e).thenAsync(s=>{n=s,t.flowName;let a=new au(o,n,r,e.clearSide,t.flowName,e.floatMinWrapBlock);return t.addPageFloat(a),P(a)})}createPageFloatFragment(e,t,i,n){let r=e[0].float;return new lu(r.floatReference,t,e,i,n)}findPageFloatFragment(e,t){return t.findPageFloatFragment(e)}adjustPageFloatArea(e,t,i){}forbid(e,t){}};Gi.register(new jf);var Xf=lu,Bo=class hu extends au{constructor(t,i,n,r,o){super(t,i,"block-end",null,n,o),this.footnotePolicy=r}isAllowedToPrecede(t){return!(t instanceof hu)}},Ha=class extends Xf{constructor(e,t,i,n){super(e,"block-end",t,i,n)}getOrder(){return 1/0}shouldBeStashedBefore(e){return e instanceof Bo?!0:this.getOrder()<e.getOrder()}},qf=class{constructor(e){this.footnote=e}allowLayout(e){let t=e.toNodePosition();return!Zt(t,this.footnote.nodePosition)}},Yf=class{appliesToNodeContext(e){return e.floatSide==="footnote"}appliesToFloat(e){return e instanceof Bo}createPageFloat(e,t,i){let n=Be.REGION,r=t.getPageFloatLayoutContext(n);t.getPageFloatLayoutContext(Be.PAGE).hasSameContainerAs(r)&&(n=Be.PAGE);let o=e.toNodePosition();t.flowName;let s=new Bo(o,n,t.flowName,e.footnotePolicy,e.floatMinWrapBlock);return t.addPageFloat(s),P(s)}createPageFloatFragment(e,t,i,n){let r=e[0].float;return new Ha(r.floatReference,e,i,n)}findPageFloatFragment(e,t){let i=t.getPageFloatLayoutContext(e.floatReference).floatFragments.filter(n=>n instanceof Ha);return i.length<=1,i[0]||null}adjustPageFloatArea(e,t,i){e.isFootnote=!0,e.adjustContentRelativeSize=!1;let n=e.element;e.vertical=i.layoutContext.applyFootnoteStyle(t.vertical,i.layoutContext.nodeContext&&i.layoutContext.nodeContext.direction==="rtl",n),e.convertPercentageSizesToPx(n),i.setComputedInsets(n,e),i.setComputedWidthAndHeight(n,e)}forbid(e,t){let i=e;switch(i.footnotePolicy){case x.line:{let n=new qf(i);t.addLayoutConstraint(n,i.floatReference);break}}}};Gi.register(new Yf);var Kf="data-vivliostyle-flow-root";function Zf(e){return e.getAttribute(Kf)==="true"}function Ua(e){let t=e?.toString()||"block",i;switch(t){case"inline-flex":i="flex";break;case"inline-grid":i="grid";break;case"inline-table":i="table";break;case"inline":case"table-row-group":case"table-column":case"table-column-group":case"table-header-group":case"table-footer-group":case"table-row":case"table-cell":case"table-caption":case"inline-block":i="block";break;default:i=t}return z(i)}function Es(e){return e===x.absolute||e===x.fixed}function $a(e){return e instanceof qi&&e.name==="running"}function uu(e,t,i,n){return e===x.none||(Es(t)?(i=x.none,e=Ua(e)):(i&&i!==x.none&&!te(i)||n)&&(e=Ua(e))),{display:e,position:t,float:i}}function cu(e,t,i,n){return uu(e,t,i,n).display===x.block}function hi(e){switch(e.toString()){case"inline":case"inline-block":case"inline-list-item":case"inline-flex":case"inline-grid":case"ruby":case"inline-table":return!0;default:return!1}}function du(e){switch(e.toString()){case"ruby-base":case"ruby-text":case"ruby-base-container":case"ruby-text-container":return!0;default:return!1}}function Qf(e,t,i,n,r,o,s){return r=r||o||x.horizontal_tb,!!s||!!i&&i!==x.none&&!te(i)||Es(t)||e===x.inline_block||e===x.table_cell||e===x.table_caption||e==x.flex||e==x.grid||e==x.flow_root||(e===x.block||e===x.list_item)&&!!n&&n!==x.visible&&n!==x.clip&&!te(n)||!!o&&r!==o}function Jf(e){return e===x.relative||e===x.absolute||e===x.fixed}function Fi(e,t,i,n){let r=e.viewNode;if(!r)return NaN;let o=r.nodeType===1?r:r.parentElement;if(o&&o.namespaceURI==="http://www.w3.org/1999/xhtml"){let s=o.style;if(s&&hi(s.display)&&/^([\d\.]|super|(text-)?top)/.test(s.verticalAlign))return NaN}if(r===o){if(e.after||!e.inline){if(e.after&&!e.inline&&o.querySelector("ruby")){let a=o.parentNode,h=o.nextSibling;a.removeChild(o),a.insertBefore(o,h)}let s=t.getElementClientRect(o);if(s.left===0&&s.top===0&&s.right===0&&s.bottom===0)return NaN;if(s.right>=s.left&&s.bottom>=s.top)return e.after?n?s.left:s.bottom:n?s.right:s.top}return NaN}else{let s=NaN,a=r.ownerDocument.createRange(),h=r.textContent.length;if(!h)return NaN;e.after&&(i+=h),i>=h&&(i=h-1),a.setStart(r,i),a.setEnd(r,i+1);let l=t.getRangeClientRects(a);return l=l.filter(c=>c.right>c.left&&c.bottom>c.top),l.length?(n?s=Math.min.apply(null,l.map(c=>c.left)):s=Math.max.apply(null,l.map(c=>c.bottom)),s):NaN}}function _o(e,t,i){let n=t.clientLayout.getElementClientRect(e),r=t.getComputedMargin(e);return i?n.width+r.left+r.right:n.height+r.top+r.bottom}function Ri(e){for(;e;){if(e.parentNode===e.ownerDocument)return!1;e=e.parentNode}return!0}function pu(e,t){var i;if(e)for(let n=e.lastChild,r=n;n!==t;n=r)r=n.previousSibling,!(n.nodeType===1&&n.hasAttribute("data-vivliostyle-float-box-moved")&&((i=t.style)==null?void 0:i.display)==="inline")&&e.removeChild(n)}function ks(e){return!!e.getAttribute(Wi)}function fu(e){var t;if(e?.nodeType!==1)return!1;let i=e;if(ks(i))return!0;let n=(t=i.style)==null?void 0:t.position;return n==="absolute"||n==="fixed"}function Li(e){let t=e?.viewNode;return t?.nodeType===1&&ks(t)}function eg(e){return e!=="inline"&&(hi(e)||du(e))}function Wa(e){for(let t=e.parent;t;t=t.parent)if(t.display!=="inline"&&hi(t.display))return t;return null}var Ps=class{calculateOffset(e){return Di(this.getNodeContext(),e.collectElementsOffset())}breakPositionChosen(e){}getNodeContext(){return null}};function Di(e,t){return{current:t.reduce((i,n)=>i+n.calculateOffset(e),0),minimum:t.reduce((i,n)=>i+n.calculateMinimumOffset(e),0)}}var Vr=class extends Ps{constructor(e,t,i,n){super(),this.position=e,this.breakOnEdge=t,this.overflows=i,this.computedBlockSize=n,u(this,"overflowIfRepetitiveElementsDropped"),u(this,"isEdgeUpdated",!1),u(this,"edge",0),this.overflowIfRepetitiveElementsDropped=i}findAcceptableBreak(e,t){return this.updateOverflows(e),t<this.getMinBreakPenalty()?null:e.findEdgeBreakPosition(this)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");let e=this.isFirstContentOfRepetitiveElementsOwner()&&!this.overflowIfRepetitiveElementsDropped;return(Sr(this.breakOnEdge)?1:0)+(this.overflows&&!e?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}updateEdge(e){var t;let i=e.calculateClonedPaddingBorder(this.position);if(this.edge=Fi(this.position,e.clientLayout,0,e.vertical)+i,!this.position.after&&!this.position.inline){let n=e.parseComputedLength(e.clientLayout.getElementComputedStyle(this.position.viewNode).marginBlockStart);this.edge-=(e.vertical?-1:1)*n}else if(this.position.after&&((t=this.position.shadowContext)==null?void 0:t.root.id)==="table-cell"){let n=e.element.parentElement,r=n?.closest("table, [style*='display: table;']");if(r){let o=r.style.borderCollapse==="collapse",s=0,a=0;for(let h=n;h;h=h.parentElement){let l=e.clientLayout.getElementComputedStyle(h);if((h===n||h===r&&!o)&&(s+=e.parseComputedLength(l.paddingBlockEnd)),h===r&&!o&&(s+=e.parseComputedLength(l.borderSpacing.replace(/^\S+ (\S+)$/,"$1"))),o?a=Math.max(a,e.parseComputedLength(l.borderBlockEndWidth)):(h===n||h===r)&&(a+=e.parseComputedLength(l.borderBlockEndWidth)),h===r)break}this.edge+=(e.vertical?-1:1)*(s+a)}}this.isEdgeUpdated=!0}updateOverflows(e){this.isEdgeUpdated||this.updateEdge(e);let t=this.edge,i=this.calculateOffset(e);this.overflowIfRepetitiveElementsDropped=e.isOverflown(t+(e.vertical?-1:1)*i.minimum),this.overflows=this.position.overflow=e.isOverflown(t+(e.vertical?-1:1)*i.current)}getNodeContext(){return this.position}isFirstContentOfRepetitiveElementsOwner(){let e=this.getNodeContext();if(!e||!e.parent)return!1;let{formattingContext:t}=e.parent;if(!ui.isInstanceOfRepetitiveElementsOwnerFormattingContext(t))return!1;let i=t.getRepetitiveElements();return i?i.isFirstContentNode(e):!1}},on=class{find(e){let t=xt("RESOLVE_LAYOUT_PROCESSOR");for(let i=0;i<t.length;i++){let n=t[i](e);if(n)return n}throw new Error(`No processor found for a formatting context: ${e.getName()}`)}},Oi=class{layout(e,t,i){return t.isFloatNodeContext(e)?t.layoutFloatOrFootnote(e):t.isBreakable(e)?t.layoutBreakableBlock(e):t.layoutUnbreakable(e)}createEdgeBreakPosition(e,t,i,n){return new Vr(e.copy(),t,i,n)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return!1}clearOverflownViewNodes(e,t,i,n){var r;if(!i.viewNode||!i.viewNode.parentNode||i.shadowType===Mt.ShadowType.ROOTLESS&&Li(i))return;let o=i.viewNode;((r=o.parentElement)==null?void 0:r.localName)==="viv-ts-inner"&&(o=o.parentElement.parentElement);let s=o.parentNode;pu(s,o),n&&s.removeChild(o)}finishBreak(e,t,i,n){let r=i||t.viewNode!=null&&t.viewNode.nodeType==1&&!t.after;return e.clearOverflownViewNodes(t,r),n&&e.layoutContext.processFragmentedBlockEdge(t),P(!0)}},Ns=class{constructor(e){this.parent=e,u(this,"formattingContextType","Block")}getName(){return"Block formatting context (BlockFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}saveState(){}restoreState(e){}},Ts=new Oi,tg=Ao.isInstanceOfBlockFormattingContext;mt("RESOLVE_FORMATTING_CONTEXT",(e,t,i,n,r,o)=>{let s=e.parent;return!s&&e.formattingContext||s&&e.formattingContext!==s.formattingContext?null:e.establishesBFC||!e.formattingContext&&cu(i,n,r,o)?new Ns(s?s.formattingContext:null):null});mt("RESOLVE_LAYOUT_PROCESSOR",e=>e instanceof Ns?Ts:null);var Is=class{constructor(){u(this,"initialBreakPositions",null),u(this,"initialStateOfFormattingContext",null),u(this,"initialPosition"),u(this,"initialFragmentLayoutConstraints")}layout(e,t){return this.prepareLayout(e,t),this.tryLayout(e,t)}tryLayout(e,t){let i=_("AbstractLayoutRetryer.tryLayout");this.saveState(e,t);let n=this.resolveLayoutMode(e);return n.doLayout(e,t).then(r=>{let o=n.accept(r,t);o=n.postLayout(r,this.initialPosition,t,o),o?i.finish(r):(this.initialPosition,this.clearNodes(this.initialPosition),this.restoreState(e,t),this.tryLayout(this.initialPosition,t).thenFinish(i))}),i.result()}prepareLayout(e,t){}clearNodes(e){let t=e.viewNode||e.parent.viewNode,i;for(;i=t.lastChild;)t.removeChild(i);let n;for(;n=t.nextSibling;)n.parentNode.removeChild(n)}saveState(e,t){this.initialPosition=e.copy(),this.initialBreakPositions=[].concat(t.breakPositions),this.initialFragmentLayoutConstraints=[].concat(t.fragmentLayoutConstraints),e.formattingContext&&(this.initialStateOfFormattingContext=e.formattingContext.saveState())}restoreState(e,t){t.breakPositions=this.initialBreakPositions,t.fragmentLayoutConstraints=this.initialFragmentLayoutConstraints,e.formattingContext&&e.formattingContext.restoreState(this.initialStateOfFormattingContext)}},ig=class{initialState(e){return{nodeContext:e,atUnforcedBreak:!1,break:!1}}startNonDisplayableNode(e){}afterNonDisplayableNode(e){}startIgnoredTextNode(e){}afterIgnoredTextNode(e){}startNonElementNode(e){}afterNonElementNode(e){}startInlineElementNode(e){}afterInlineElementNode(e){}startNonInlineElementNode(e){}afterNonInlineElementNode(e){}finish(e){}},Mo=class{constructor(e,t){this.strategy=e,this.layoutContext=t}iterate(e){let t=this.strategy,i=t.initialState(e),n=_("LayoutIterator");return n.loopWithFrame(r=>{let o;for(;i.nodeContext;){i.nodeContext.viewNode?i.nodeContext.viewNode.nodeType!==1?je(i.nodeContext.viewNode,i.nodeContext.whitespace)?i.nodeContext.after?o=t.afterIgnoredTextNode(i):o=t.startIgnoredTextNode(i):i.nodeContext.after?o=t.afterNonElementNode(i):o=t.startNonElementNode(i):i.nodeContext.inline?i.nodeContext.after?o=t.afterInlineElementNode(i):o=t.startInlineElementNode(i):i.nodeContext.after?o=t.afterNonInlineElementNode(i):o=t.startNonInlineElementNode(i):i.nodeContext.after?o=t.afterNonDisplayableNode(i):o=t.startNonDisplayableNode(i);let s=(o&&o.isPending()?o:P(!0)).thenAsync(()=>i.break?P(null):this.layoutContext.nextInTree(i.nodeContext,i.atUnforcedBreak));if(s.isPending()){s.then(a=>{i.break?r.breakLoop():(i.nodeContext=a,r.continueLoop())});return}else if(i.break){r.breakLoop();return}else i.nodeContext=s.get()}t.finish(i),r.breakLoop()}).then(()=>{n.finish(i.nodeContext)}),n.result()}},bn=class extends ig{constructor(e){super(),this.leadingEdge=e}startNonInlineBox(e){}endEmptyNonInlineBox(e){}endNonInlineBox(e){}initialState(e){return{nodeContext:e,atUnforcedBreak:!!this.leadingEdge&&e.after,break:!1,leadingEdge:this.leadingEdge,breakAtTheEdge:null,onStartEdges:!1,leadingEdgeContexts:[],lastAfterNodeContext:null}}processForcedBreak(e,t){let i=!e.leadingEdge&&it(e.breakAtTheEdge);if(i){let n=e.nodeContext=e.leadingEdgeContexts[0]||e.nodeContext;n.viewNode.parentNode.removeChild(n.viewNode),t.pageBreakType=e.breakAtTheEdge}return i}saveEdgeAndProcessOverflow(e,t){let i=t.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge);return i&&(e.nodeContext=(e.lastAfterNodeContext||e.nodeContext).modify(),e.nodeContext.overflow=!0),i}processLayoutConstraint(e,t,i){let n=e.nodeContext,r=!t.allowLayout(n);return r&&(i.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!1,e.breakAtTheEdge),n=e.nodeContext=n.modify(),n.overflow=!0),r}startNonElementNode(e){e.onStartEdges=!1}startNonInlineElementNode(e){return e.leadingEdgeContexts.push(e.nodeContext.copy()),e.breakAtTheEdge=Je(e.breakAtTheEdge,e.nodeContext.breakBefore),e.onStartEdges=!0,this.startNonInlineBox(e)}afterNonInlineElementNode(e){let t,i;return e.onStartEdges?(t=this.endEmptyNonInlineBox(e),i=t&&t.isPending()?t:P(!0),i=i.thenAsync(()=>(e.break||(e.leadingEdgeContexts=[],e.leadingEdge=!1,e.atUnforcedBreak=!1,e.breakAtTheEdge=null),P(!0)))):(t=this.endNonInlineBox(e),i=t&&t.isPending()?t:P(!0)),i.thenAsync(()=>(e.break||(e.onStartEdges=!1,e.lastAfterNodeContext=e.nodeContext.copy(),e.breakAtTheEdge=Je(e.breakAtTheEdge,e.nodeContext.breakAfter)),P(!0)))}},zo=[];function ng(){zo=[]}function gu(e,t,i){return e-=i,t===0?e===0:e%t===0&&e/t>=0}var rg=class{constructor(e){this.matchers=e}matches(){return this.matchers.some(e=>e.matches())}},og=class{constructor(e){this.matchers=e}matches(){return this.matchers.every(e=>e.matches())}},mu=class dr{constructor(t,i,n){this.elementOffset=t,this.a=i,this.b=n}static registerFragmentIndex(t,i,n){let r=dr.fragmentIndices;(!r[t]||r[t].priority<=n)&&(r[t]={fragmentIndex:i,priority:n})}static clearFragmentIndices(){dr.fragmentIndices={}}matches(){let t=dr.fragmentIndices[this.elementOffset];return t!=null&&t.fragmentIndex!=null&&gu(t.fragmentIndex,this.a,this.b)}};u(mu,"fragmentIndices",{});var Hr=mu,or=class{static buildViewConditionMatcher(e,t){let i=t.split("_");return i[0]=="NFS"?new Hr(e,parseInt(i[1],10),parseInt(i[2],10)):(`${t}`,null)}static buildAllMatcher(e){return new og(e)}static buildAnyMatcher(e){return new rg(e)}},wu={"border-collapse":!0,"border-spacing":!0,"caption-side":!0,"clip-rule":!0,color:!0,"color-interpolation":!0,"color-rendering":!0,cursor:!0,direction:!0,"empty-cells":!0,fill:!0,"fill-opacity":!0,"fill-rule":!0,"font-kerning":!0,"font-size":!0,"font-size-adjust":!0,"font-family":!0,"font-feature-settings":!0,"font-style":!0,"font-stretch":!0,"font-variant-ligatures":!0,"font-variant-caps":!0,"font-variant-numeric":!0,"font-variant-east-asian":!0,"font-weight":!0,"glyph-orientation-vertical":!0,"hanging-punctuation":!0,hyphens:!0,"hyphenate-character":!0,"hyphenate-limit-chars":!0,"hyphenate-limit-last":!0,"image-rendering":!0,"image-resolution":!0,"letter-spacing":!0,"line-break":!0,"line-height":!0,"list-style-image":!0,"list-style-position":!0,"list-style-type":!0,marker:!0,"marker-end":!0,"marker-mid":!0,"marker-start":!0,orphans:!0,"overflow-wrap":!0,"paint-order":!0,"pointer-events":!0,quotes:!0,"ruby-align":!0,"ruby-position":!0,"shape-rendering":!0,stroke:!0,"stroke-dasharray":!0,"stroke-dashoffset":!0,"stroke-linecap":!0,"stroke-linejoin":!0,"stroke-miterlimit":!0,"stroke-opacity":!0,"stroke-width":!0,"tab-size":!0,"text-align":!0,"text-align-last":!0,"text-anchor":!0,"text-autospace":!0,"text-decoration-skip":!0,"text-emphasis-color":!0,"text-emphasis-position":!0,"text-emphasis-style":!0,"text-fill-color":!0,"text-combine-upright":!0,"text-indent":!0,"text-justify":!0,"text-orientation":!0,"text-rendering":!0,"text-size-adjust":!0,"text-spacing-trim":!0,"text-stroke-color":!0,"text-stroke-width":!0,"text-transform":!0,"text-underline-position":!0,visibility:!0,"white-space":!0,widows:!0,"word-break":!0,"word-spacing":!0,"writing-mode":!0},sg=["image-resolution","orphans","widows"];function ag(){return xt("POLYFILLED_INHERITED_PROPS").reduce((e,t)=>e.concat(t()),[].concat(sg))}var lg={"http://www.idpf.org/2007/ops":!0,"http://www.w3.org/1999/xhtml":!0,"http://www.w3.org/2000/svg":!0,"http://www.w3.org/1998/Math/MathML":!0},Do=["margin-%","padding-%","border-%-width","border-%-style","border-%-color","%"],hg=["max-%","min-%","%"],ug=(()=>{let e=["left","right","top","bottom"],t={width:!0,height:!0,"max-width":!0,"max-height":!0,"min-width":!0,"min-height":!0};for(let i=0;i<Do.length;i++)for(let n=0;n<e.length;n++){let r=Do[i].replace("%",e[n]);t[r]=!0}return t})();function Ur(e,t){let i={};for(let n of Do)for(let r in e){let o=n.replace("%",r),s=n.replace("%",e[r]);i[o]=s,i[s]=o}for(let n of hg)for(let r in t){let o=n.replace("%",r),s=n.replace("%",t[r]);i[o]=s,i[s]=o}return i}var bu=Ur({"block-start":"right","block-end":"left","inline-start":"top","inline-end":"bottom"},{"block-size":"width","inline-size":"height"}),vu=Ur({"block-start":"top","block-end":"bottom","inline-start":"left","inline-end":"right"},{"block-size":"height","inline-size":"width"}),cg=Ur({"block-start":"right","block-end":"left","inline-start":"bottom","inline-end":"top"},{"block-size":"width","inline-size":"height"}),dg=Ur({"block-start":"top","block-end":"bottom","inline-start":"right","inline-end":"left"},{"block-size":"height","inline-size":"width"}),J=class Vo{constructor(t,i){this.value=t,this.priority=i}getBaseValue(){return this}filterValue(t){let i=this.value.visit(t);return i===this.value?this:new Vo(i,this.priority)}increaseSpecificity(t){return t==0?this:new Vo(this.value,this.priority+t)}evaluate(t,i,n,r){return i&&_t(i)?this.value:Tr(t,this.value,i,n,r)}isEnabled(t){return!0}},Ho=class Uo extends J{constructor(t,i,n){super(t,i),this.condition=n}getBaseValue(){return new J(this.value,this.priority)}filterValue(t){let i=this.value.visit(t);return i===this.value?this:new Uo(i,this.priority,this.condition)}increaseSpecificity(t){return t==0?this:new Uo(this.value,this.priority+t,this.condition)}isEnabled(t){try{return!!this.condition.evaluate(t)}catch(i){U.warn(i)}return!1}};function $o(e,t,i){return(!t||i.priority>=t.priority)&&i.isEnabled(e)?i.getBaseValue():t}function zt(e,t,i,n){if(e)if(!i)delete e[t];else{let r=e[t];(!r||i.priority>=r.priority)&&(n?i.isEnabled(n)&&(e[t]=i.getBaseValue()):e[t]=i)}}var xu={"region-id":!0,"fragment-selector-id":!0};function pg(e){return!!xu[e]}function Wo(e){return e.charAt(0)==="_"&&e!=="_viewConditionalStyles"}function Vi(e){return e.charAt(0)!=="_"&&!xu[e]}function vn(e){return!!wu[e]||_t(e)}function Ge(e,t){return e[t]}function ci(e,t,i){i?e[t]=i:delete e[t]}function vt(e,t){return e[t]}function $r(e,t){let i=e[t];return i||(i={},e[t]=i),i}var yu=e=>{let t=e._viewConditionalStyles;return t||(t=[],e._viewConditionalStyles=t),t};function Su(e,t){return e[t]}function Cu(e,t){let i=e[t];return i||(i=[],e[t]=i),i}function Nr(e,t,i,n,r,o,s){var a,h;if([{id:r,styleKey:"_pseudos"},{id:o,styleKey:"_regions"}].forEach(l=>{if(l.id){let c=$r(t,l.styleKey);t=c[l.id],t||(t={},c[l.id]=t)}}),s){let l=yu(t);t={},l.push({styles:t,matcher:s})}for(let l in i)if(!Wo(l))if(pg(l)){let c=Su(i,l),p=Cu(t,l);Array.prototype.push.apply(p,c)}else{let c=Ge(i,l);if(!c.isEnabled(e))continue;let p=c.increaseSpecificity(n);zt(t,l,p,e);let d=(h=(a=e.style)==null?void 0:a.validatorSet.shorthands[l])==null?void 0:h.propList;if(d)for(let f of d){let g=new J(X,p.priority);zt(t,f,g,e)}}}function fg(e,t){let i={};for(let n=0;n<t.length;n++)Nr(e,i,t[n],0,null,null,null);return i}function Eu(e,t){if(e.length>0){e.sort((n,r)=>r.getPriority()-n.getPriority());let i=null;for(let n=e.length-1;n>=0;n--)i=e[n],i.chained=t,t=i;return i}return t}var gg=class extends Xi{constructor(e,t){super(),this.props=e,this.context=t,u(this,"propName","")}setPropName(e){this.propName=e}getFontSize(){let e=Ge(this.props,"font-size");if(!e.value.isNumeric())return xe.em;let t=e.value;if(!$d(t.unit))throw new Error("Unexpected state");return t.num*xe[t.unit]}visitNumeric(e){return this.context,this.propName==="font-size"?ku(e,this.getFontSize(),this.context):e.unit==="em"||e.unit==="ex"||e.unit==="rem"||e.unit==="lh"||e.unit==="rlh"?Fs(e,this.getFontSize(),this.context):e}visitExpr(e){return this.propName=="font-size"?Tr(this.context,e,this.propName).visit(this):e}};function Fs(e,t,i){let n=e.unit,r=e.num;if(n==="em"||n==="ex"){let o=xe[n]/xe.em;return new A(r*o*t,"px")}else return n==="rem"?new A(r*i.fontSize(),"px"):n==="rlh"?new A(r*i.rootLineHeight,"px"):e}function ku(e,t,i){e=Fs(e,t,i);let n=e.unit,r=e.num;return n==="px"?e:n==="%"?new A(r/100*t,"px"):new A(r*i.queryUnitSize(n,!1),"px")}var Qi=class{apply(e){}mergeWith(e){return new mg([this,e])}clone(){return this}},sr=class extends Qi{constructor(e){super(),this.conditionItem=e}apply(e){e.pushConditionItem(this.conditionItem.fresh(e))}},mg=class Pu extends Qi{constructor(t){super(),this.list=t}apply(t){for(let i=0;i<this.list.length;i++)this.list[i].apply(t)}mergeWith(t){return this.list.push(t),this}clone(){return new Pu([].concat(this.list))}},As=class extends Qi{constructor(e,t,i,n,r){super(),this.style=e,this.specificity=t,this.pseudoelement=i,this.regionId=n,this.viewConditionId=r}apply(e){Nr(e.context,e.currentStyle,this.style,this.specificity,this.pseudoelement,this.regionId,e.buildViewConditionMatcher(this.viewConditionId))}},be=class extends Qi{constructor(){super(),u(this,"chained",null)}apply(e){this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},wg=class extends be{constructor(e){super(),this.className=e}apply(e){e.currentClassNames.includes(this.className)&&this.chained.apply(e)}getPriority(){return 10}makePrimary(e){return this.chained&&e.insertInTable(e.classes,this.className,this.chained),!0}},bg=class extends be{constructor(e){super(),this.id=e}apply(e){(e.currentId==this.id||e.currentXmlId==this.id)&&this.chained.apply(e)}getPriority(){return 11}makePrimary(e){return this.chained&&e.insertInTable(e.ids,this.id,this.chained),!0}},Ga=class extends be{constructor(e){super(),this.localName=e}apply(e){e.currentLocalName==this.localName&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){return this.chained&&e.insertInTable(e.tags,this.localName,this.chained),!0}},vg=class extends be{constructor(e,t){super(),this.ns=e,this.localName=t}apply(e){e.currentLocalName==this.localName&&e.currentNamespace==this.ns&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){if(this.chained){let t=e.nsPrefix[this.ns];t||(t=`ns${e.nsCount++}:`,e.nsPrefix[this.ns]=t);let i=t+this.localName;e.insertInTable(e.nstags,i,this.chained)}return!0}},xg=class extends be{constructor(e,t){super(),this.epubTypePatt=e,this.targetLocalName=t}apply(e){let t=e.currentElement;if(t instanceof HTMLAnchorElement&&t.hash&&t.href==t.baseURI+t.hash){let i=t.hash.substring(1),n=t.ownerDocument.getElementById(i);if(n&&(!this.targetLocalName||n.localName==this.targetLocalName)){let r=n.getAttributeNS("http://www.idpf.org/2007/ops","type")||n.getAttribute("epub:type");r&&r.match(this.epubTypePatt)&&this.chained.apply(e)}}}},yg=class extends be{constructor(e){super(),this.ns=e}apply(e){e.currentNamespace==this.ns&&this.chained.apply(e)}};function Wr(e,t,i,n){if(!e)return!1;if(t!==null)return n(e,t,i);for(let r of e.getAttributeNames())if((r===i||r.endsWith(`:${i}`))&&n(e,r===i?"":e.lookupNamespaceURI(r.split(":")[0]),i))return!0;return!1}var ja=class extends be{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){Wr(e.currentElement,this.ns,this.name,(t,i,n)=>t.hasAttributeNS(i,n))&&this.chained.apply(e)}},Sg=class extends be{constructor(e,t,i){super(),this.ns=e,this.name=t,this.value=i}apply(e){Wr(e.currentElement,this.ns,this.name,(t,i,n)=>t.getAttributeNS(i,n)==this.value)&&this.chained.apply(e)}getPriority(){return this.name=="type"&&this.ns=="http://www.idpf.org/2007/ops"?9:0}makePrimary(e){return this.name=="type"&&this.ns=="http://www.idpf.org/2007/ops"?(this.chained&&e.insertInTable(e.epubtypes,this.value,this.chained),!0):!1}},Cg=class extends be{constructor(e,t){super(),this.ns=e,this.name=t}apply(e){Wr(e.currentElement,this.ns,this.name,(t,i,n)=>!!lg[t.getAttributeNS(i,n)])&&this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},sn=class extends be{constructor(e,t,i){super(),this.ns=e,this.name=t,this.regexp=i}apply(e){Wr(e.currentElement,this.ns,this.name,(t,i,n)=>{var r;return!!((r=t.getAttributeNS(i,n))!=null&&r.match(this.regexp))})&&this.chained.apply(e)}},Eg=class extends be{constructor(e){super(),this.langRegExp=e}apply(e){e.lang.match(this.langRegExp)&&this.chained.apply(e)}},Xa=class extends be{constructor(){super()}apply(e){e.isFirst&&this.chained.apply(e)}getPriority(){return 6}},kg=class extends be{constructor(){super()}apply(e){e.isRoot&&this.chained.apply(e)}getPriority(){return 12}},Un=class extends be{constructor(e,t){super(),this.a=e,this.b=t}matchANPlusB(e){return gu(e,this.a,this.b)}},Pg=class extends Un{constructor(e,t){super(e,t)}apply(e){this.matchANPlusB(e.currentSiblingOrder)&&this.chained.apply(e)}getPriority(){return 5}},Go=class extends Un{constructor(e,t){super(e,t)}apply(e){let t=e.currentSiblingTypeCounts[e.currentNamespace][e.currentLocalName];this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 5}},jo=class extends Un{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingOrder;t===null&&(t=e.currentFollowingSiblingOrder=e.currentElement.parentNode.childElementCount-e.currentSiblingOrder+1),this.matchANPlusB(t)&&this.chained.apply(e)}getPriority(){return 4}},Xo=class extends Un{constructor(e,t){super(e,t)}apply(e){let t=e.currentFollowingSiblingTypeCounts;if(!t[e.currentNamespace]){let i=e.currentElement;do{let n=i.namespaceURI,r=i.localName,o=t[n];o||(o=t[n]={}),o[r]=(o[r]||0)+1}while(i=i.nextElementSibling)}this.matchANPlusB(t[e.currentNamespace][e.currentLocalName])&&this.chained.apply(e)}getPriority(){return 4}},Ng=class extends be{constructor(){super()}apply(e){let t=e.currentElement.firstChild;for(;t;){switch(t.nodeType){case Node.ELEMENT_NODE:return;case Node.TEXT_NODE:if(t.length>0)return}t=t.nextSibling}this.chained.apply(e)}getPriority(){return 4}},Tg=class extends be{constructor(){super()}apply(e){e.currentElement.disabled===!1&&this.chained.apply(e)}getPriority(){return 5}},Ig=class extends be{constructor(){super()}apply(e){e.currentElement.disabled===!0&&this.chained.apply(e)}getPriority(){return 5}},Fg=class extends be{constructor(){super()}apply(e){let t=e.currentElement;(t.selected===!0||t.checked===!0)&&this.chained.apply(e)}getPriority(){return 5}},Ke=class extends be{constructor(e){super(),this.condition=e}apply(e){if(e.conditions[this.condition])try{e.dependentConditions.push(this.condition),this.chained.apply(e)}finally{e.dependentConditions.pop()}}getPriority(){return 5}},Ag=class Nu extends Qi{constructor(){super(),u(this,"applied",!1)}apply(t){this.applied=!0}clone(){let t=new Nu;return t.applied=this.applied,t}},Rs=class extends be{constructor(e){super(),u(this,"checkAppliedAction"),u(this,"firstActions",[]),this.checkAppliedAction=new Ag;for(let t of e)this.firstActions.push(Eu(t,this.checkAppliedAction))}apply(e){for(let t of this.firstActions)if(t.apply(e),this.checkAppliedAction.applied)break;this.checkAppliedAction.applied===this.positive()&&this.chained.apply(e),this.checkAppliedAction.applied=!1}getPriority(){return Math.max(...this.firstActions.map(e=>e instanceof be?e.getPriority():0))}positive(){return!0}relational(){return!1}},Rg=class extends Rs{positive(){return!1}},Lg=class extends Rs{constructor(e){super([]),this.selectorTexts=e}apply(e){for(let t of this.selectorTexts){let i,n;/^\s*[+~]/.test(t)?(n=e.currentElement.parentNode,i=`:scope > :nth-child(${Array.from(n.children).indexOf(e.currentElement)+1}) ${t}`):(n=e.currentElement,i=`:scope ${t}`);try{if(n.querySelector(i)){this.checkAppliedAction.apply(e);break}}catch{}}this.checkAppliedAction.applied&&this.chained.apply(e),this.checkAppliedAction.applied=!1}relational(){return!0}},Gr=class{constructor(e,t,i){this.condition=e,this.viewConditionId=t,this.viewCondition=i}increment(e){e.increment(this.condition,this.viewCondition)}decrement(e){e.decrement(this.condition,this.viewCondition)}buildViewConditionMatcher(e){return e.buildViewConditionMatcher(this.viewConditionId)}},Og=class Tu extends Gr{constructor(t,i,n){super(t,i,n)}fresh(t){return new Tu(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,i){return i==0&&this.increment(t),!1}pop(t,i){return i==0?(this.decrement(t),!0):!1}},Bg=class Iu extends Gr{constructor(t,i,n){super(t,i,n)}fresh(t){return new Iu(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,i){return i==0?this.increment(t):i==1&&this.decrement(t),!1}pop(t,i){return i==0?(this.decrement(t),!0):(i==1&&this.increment(t),!1)}},_g=class Fu extends Gr{constructor(t,i,n){super(t,i,n),u(this,"fired",!1)}fresh(t){return new Fu(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,i){return this.fired?(this.decrement(t),!0):!1}pop(t,i){return this.fired?(this.decrement(t),!0):(i==0&&(this.fired=!0,this.increment(t)),!1)}},Mg=class Au extends Gr{constructor(t,i,n){super(t,i,n),u(this,"fired",!1)}fresh(t){return new Au(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,i){return this.fired&&(i==-1?this.increment(t):i==0&&this.decrement(t)),!1}pop(t,i){if(this.fired){if(i==-1)return this.decrement(t),!0;i==0&&this.increment(t)}else i==0&&(this.fired=!0,this.increment(t));return!1}},zg=class{constructor(e,t){this.afterprop=e,this.element=t}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.processPseudoelementProps(this.afterprop,this.element),!0):!1}},Dg=class{constructor(e){this.lang=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.lang=this.lang,!0):!1}},Vg=class{constructor(e){this.oldQuotes=e}fresh(e){return this}push(e,t){return!1}pop(e,t){return t==0?(e.quotes=this.oldQuotes,!0):!1}},Hg=class extends Xi{constructor(e){super(),this.element=e}createValueFromString(e,t){switch(t){case"url":return e?new bt(e):new bt("about:invalid");case"string":default:return e?new _e(e):new _e("")}}visitFunc(e){if(e.name!=="attr")return super.visitFunc(e);let t="string",i=null,n=null;if(e.values[0]instanceof Ie){let r=e.values[0].values;r.length>=2&&(t=r[1].stringValue()),i=r[0].stringValue()}else i=e.values[0].stringValue();return e.values.length>1?n=this.createValueFromString(e.values[1].stringValue(),t):n=this.createValueFromString(null,t),this.element&&this.element.hasAttribute(i)?this.createValueFromString(this.element.getAttribute(i),t):n}};function xn(e){if(Jt(e)){if(e instanceof _e)return e.stringValue();if(e instanceof Ie)return e.values.map(t=>xn(t)).join("")}return""}var qo=class extends Xi{constructor(e,t,i){super(),this.cascade=e,this.element=t,this.counterResolver=i}visitIdent(e){let t=this.cascade,i=t.quotes,n=Math.floor(i.length/2)-1;switch(e.name){case"open-quote":{let r=i[2*Math.min(n,t.quoteDepth)];return t.quoteDepth++,r}case"close-quote":return t.quoteDepth>0&&t.quoteDepth--,i[2*Math.min(n,t.quoteDepth)+1];case"no-open-quote":return t.quoteDepth++,new _e("");case"no-close-quote":return t.quoteDepth>0&&t.quoteDepth--,new _e("")}return e}format(e,t){let i=!1,n=!1,r;(r=t.match(/^upper-(.*)/))!=null?(i=!0,t=r[1]):(r=t.match(/^lower-(.*)/))!=null&&(n=!0,t=r[1]);let o="";return qa[t]?o=$g(qa[t],e):Ya[t]?o=Gg(Ya[t],e):Ka[t]!=null?o=Ka[t]:t=="decimal-leading-zero"?(o=`${e}`,o.length==1&&(o=`0${o}`)):t=="cjk-ideographic"||t=="trad-chinese-informal"?o=Xg(e,jg):o=`${e}`,i?o.toUpperCase():n?o.toLowerCase():o}visitFuncCounter(e){let t=e[0].toString(),i=e.length>1?e[1].stringValue():"decimal",n=this.cascade.counters[t];if(n&&n.length){let r=n&&n.length&&n[n.length-1]||0;return new _e(this.format(r,i))}else{let r=new $(this.counterResolver.getPageCounterVal(t,o=>this.format(o||0,i)));return new Ie([r])}}visitFuncCounters(e){let t=e[0].toString(),i=e[1].stringValue(),n=e.length>2?e[2].stringValue():"decimal",r=this.cascade.counters[t],o=new Bt;if(r&&r.length)for(let a=0;a<r.length;a++)a>0&&o.append(i),o.append(this.format(r[a],n));let s=new $(this.counterResolver.getPageCountersVal(t,a=>{let h=[];if(a.length)for(let c=0;c<a.length;c++)h.push(this.format(a[c],n));let l=o.toString();return l.length&&h.push(l),h.length?h.join(i):this.format(0,n)}));return new Ie([s])}visitFuncTargetCounter(e){let t=e[0],i;t instanceof bt?i=t.url:i=t.stringValue();let n=e[1].toString(),r=e.length>2?e[2].stringValue():"decimal",o=new $(this.counterResolver.getTargetCounterVal(i,n,s=>this.format(s||0,r)));return new Ie([o])}visitFuncTargetCounters(e){let t=e[0],i;t instanceof bt?i=t.url:i=t.stringValue();let n=e[1].toString(),r=e[2].stringValue(),o=e.length>3?e[3].stringValue():"decimal",s=new $(this.counterResolver.getTargetCountersVal(i,n,a=>{let h=a.map(l=>this.format(l,o));return h.length?h.join(r):this.format(0,o)}));return new Ie([s])}visitFuncString(e){let t=e.length>0?e[0].stringValue():"",i=e.length>1?e[1].stringValue():"first";return new $(this.counterResolver.getNamedStringVal(t,i))}visitFuncElement(e){let t=e.length>0?e[0].stringValue():"",i=e.length>1?e[1].stringValue():"first";return new $(this.counterResolver.getRunningElementVal(t,i))}visitFuncContent(e){var t,i,n,r,o,s;let a=e.length>0?e[0].stringValue():"text",h="";switch(a){case"text":h=this.element.textContent;break;case"before":case"after":{let l=vt(this.cascade.currentStyle,"_pseudos"),c=(i=(t=l?.[a])==null?void 0:t.content)==null?void 0:i.value;h=xn(c)}break;case"first-letter":{let l=vt(this.cascade.currentStyle,"_pseudos"),c=(xn((r=(n=l?.before)==null?void 0:n.content)==null?void 0:r.value)||this.element.textContent||xn((s=(o=l?.after)==null?void 0:o.content)==null?void 0:s.value)).match(mo);h=c?c[0]:""}break}return new _e(h)}visitFuncLeader(e){let t="";if(e[0]instanceof yt)switch(e[0].stringValue()){case"dotted":t=".";break;case"solid":t="_";break;case"space":t=" ";break}else e[0]instanceof _e&&(t=e[0].stringValue());return t.length==0?new _e(""):new $(new We(null,()=>t,"viv-leader"))}visitFunc(e){switch(e.name){case"counter":if(e.values.length<=2)return this.visitFuncCounter(e.values);break;case"counters":if(e.values.length<=3)return this.visitFuncCounters(e.values);break;case"target-counter":if(e.values.length<=3)return this.visitFuncTargetCounter(e.values);break;case"target-counters":if(e.values.length<=4)return this.visitFuncTargetCounters(e.values);break;case"string":if(e.values.length<=2)return this.visitFuncString(e.values);break;case"element":if(e.values.length<=2)return this.visitFuncElement(e.values);break;case"content":if(e.values.length<=1)return this.visitFuncContent(e.values);break;case"leader":if(e.values.length<=1)return this.visitFuncLeader(e.values);break}return e}},Ug=(e,t,i)=>{let n=t.filter(h=>h.after&&h.viewNode.nodeType===1&&h.viewNode.getAttribute("data-viv-leader"));for(let h of n){let l=function(ge){if(S==="rtl"){let me="\u200F";g.textContent=(ge.startsWith(me)?"":me)+ge+(ge.endsWith(me)?"":me)}else g.textContent=ge},c=function(){let ge=i.clientLayout.getElementClientRect(m);return B.left>ge.left||B.right<ge.right||B.top>ge.top||B.bottom<ge.bottom},p=function(){let ge,me;if(l(b),c())ge=1,me=b.length/v.length;else{ge=b.length/v.length,me=ge;for(let y=0;y<16;y++){let I=b;for(let C=0;C<1<<y;C++)I+=v;if(l(I),c()){me+=1<<y;break}}}for(let y=0;y<16;y++){let I="",C=Math.floor((ge+me)/2);for(let E=0;E<C;E++)I+=v;if(l(I),c())me=C;else{if(ge==C)return;ge=C}}l(v)},d=function(ge){let me=0,y=m.parentElement;for(;y&&y!==f.viewNode;)me+=i.getComputedInsets(y)[ge],y=y.parentElement;return me};var r=l,o=c,s=p,a=d;let f=h.parent;for(;f&&f.inline;)f=f.parent;let g=h.viewNode,m=g.parentElement,v=g.getAttribute("data-viv-leader-value"),b=g.textContent||v,{writingMode:w,direction:S,marginInlineEnd:L}=i.clientLayout.getElementComputedStyle(m);g.style.marginInlineStart="1px",l(v),m.style.display="inline-block",m.style.textIndent="0";let B=i.clientLayout.getElementClientRect(f.viewNode),D=i.clientLayout.getElementClientRect(m),W=i.parseComputedLength(L);w==="vertical-rl"||w==="vertical-lr"?(S==="rtl"?B.top+=W:B.bottom-=W,B.left=D.left,B.right=D.right,B.top=Math.min(D.top,B.top),B.bottom=Math.max(D.bottom,B.bottom)):(S==="rtl"?B.left+=W:B.right-=W,B.top=D.top,B.bottom=D.bottom,B.left=Math.min(D.left,B.left),B.right=Math.max(D.right,B.right)),p();let q=i.clientLayout.getElementClientRect(m);S=="rtl"?m.style.float="left":m.style.float="right";let ye=i.clientLayout.getElementClientRect(m),Xe=0;S=="rtl"?w=="vertical-rl"||w=="vertical-lr"?Xe=q.top-ye.top-d("top"):Xe=q.left-ye.left-d("left"):w=="vertical-rl"||w=="vertical-lr"?Xe=ye.bottom-q.bottom-d("bottom"):Xe=ye.right-q.right-d("right"),Xe=Math.max(0,Xe-.1),m.style.float="",g.style.marginInlineStart=`${Xe}px`}};mt("POST_LAYOUT_BLOCK",Ug);var qa={roman:[4999,1e3,"M",900,"CM",500,"D",400,"CD",100,"C",90,"XC",50,"L",40,"XL",10,"X",9,"IX",5,"V",4,"IV",1,"I"],armenian:[9999,9e3,"\u0584",8e3,"\u0583",7e3,"\u0582",6e3,"\u0581",5e3,"\u0580",4e3,"\u057F",3e3,"\u057E",2e3,"\u057D",1e3,"\u057C",900,"\u057B",800,"\u057A",700,"\u0579",600,"\u0578",500,"\u0577",400,"\u0576",300,"\u0575",200,"\u0574",100,"\u0573",90,"\u0572",80,"\u0571",70,"\u0570",60,"\u056F",50,"\u056E",40,"\u056D",30,"\u056C",20,"\u056B",10,"\u056A",9,"\u0569",8,"\u0568",7,"\u0567",6,"\u0566",5,"\u0565",4,"\u0564",3,"\u0563",2,"\u0562",1,"\u0561"],georgian:[19999,1e4,"\u10F5",9e3,"\u10F0",8e3,"\u10EF",7e3,"\u10F4",6e3,"\u10EE",5e3,"\u10ED",4e3,"\u10EC",3e3,"\u10EB",2e3,"\u10EA",1e3,"\u10E9",900,"\u10E8",800,"\u10E7",700,"\u10E6",600,"\u10E5",500,"\u10E4",400,"\u10F3",300,"\u10E2",200,"\u10E1",100,"\u10E0",90,"\u10DF",80,"\u10DE",70,"\u10DD",60,"\u10F2",50,"\u10DC",40,"\u10DB",30,"\u10DA",20,"\u10D9",10,"\u10D8",9,"\u10D7",8,"\u10F1",7,"\u10D6",6,"\u10D5",5,"\u10D4",4,"\u10D3",3,"\u10D2",2,"\u10D1",1,"\u10D0"],hebrew:[999,400,"\u05EA",300,"\u05E9",200,"\u05E8",100,"\u05E7",90,"\u05E6",80,"\u05E4",70,"\u05E2",60,"\u05E1",50,"\u05E0",40,"\u05DE",30,"\u05DC",20,"\u05DB",19,"\u05D9\u05D8",18,"\u05D9\u05D7",17,"\u05D9\u05D6",16,"\u05D8\u05D6",15,"\u05D8\u05D5",10,"\u05D9",9,"\u05D8",8,"\u05D7",7,"\u05D6",6,"\u05D5",5,"\u05D4",4,"\u05D3",3,"\u05D2",2,"\u05D1",1,"\u05D0"]},Ya={latin:"a-z",alpha:"a-z",greek:"\u03B1-\u03C1\u03C3-\u03C9",russian:"\u0430-\u0438\u043A-\u0449\u044D-\u044F"},Ka={square:"\u25A0",disc:"\u2022",circle:"\u25E6",none:""};function $g(e,t){let i=e[0];if(t>i||t<=0||t!=Math.round(t))return"";let n="";for(let r=1;r<e.length;r+=2){let o=e[r],s=Math.floor(t/o);if(s>20)return"";for(t-=s*o;s>0;)n+=e[r+1],s--}return n}function Wg(e){let t=[],i=0;for(;i<e.length;)if(e.substr(i+1,1)=="-"){let n=e.charCodeAt(i),r=e.charCodeAt(i+2);i+=3;for(let o=n;o<=r;o++)t.push(String.fromCharCode(o))}else t.push(e.substr(i++,1));return t}function Gg(e,t){if(t<=0||t!=Math.round(t))return"";let i=Wg(e),n="";do{t--;let r=t%i.length;n=i[r]+n,t=(t-r)/i.length}while(t>0);return n}var jg={formal:!1,digits:"\u96F6\u4E00\u4E8C\u4E09\u56DB\u4E94\u516D\u4E03\u516B\u4E5D",markers:"\u5341\u767E\u5343",negative:"\u8CA0"};function Xg(e,t){if(e>9999||e<-9999)return`${e}`;if(e==0)return t.digits.charAt(0);let i=new Bt;if(e<0&&(i.append(t.negative),e=-e),e<10)i.append(t.digits.charAt(e));else if(!t.formal&&e<=19)i.append(t.markers.charAt(0)),e!=0&&i.append(t.digits.charAt(e-10));else{let n=Math.floor(e/1e3);n&&(i.append(t.digits.charAt(n)),i.append(t.markers.charAt(2)));let r=Math.floor(e/100)%10;r&&(i.append(t.digits.charAt(r)),i.append(t.markers.charAt(1)));let o=Math.floor(e/10)%10;o&&(i.append(t.digits.charAt(o)),i.append(t.markers.charAt(0)));let s=e%10;s&&i.append(t.digits.charAt(s))}return i.toString()}var Ls=1/1048576;function ki(e,t){for(let i in e)t[i]=e[i].clone()}var qg=class Ru{constructor(){u(this,"nsCount",0),u(this,"nsPrefix",{}),u(this,"tags",{}),u(this,"nstags",{}),u(this,"epubtypes",{}),u(this,"classes",{}),u(this,"ids",{}),u(this,"pagetypes",{}),u(this,"order",0)}clone(){let t=new Ru;t.nsCount=this.nsCount;for(let i in this.nsPrefix)t.nsPrefix[i]=this.nsPrefix[i];return ki(this.tags,t.tags),ki(this.nstags,t.nstags),ki(this.epubtypes,t.epubtypes),ki(this.classes,t.classes),ki(this.ids,t.ids),ki(this.pagetypes,t.pagetypes),t.order=this.order,t}insertInTable(t,i,n){let r=t[i];r&&(n=r.mergeWith(n)),t[i]=n}createInstance(t,i,n,r){return new Yg(this,t,i,n,r)}nextOrder(){return this.order+=Ls}},Yg=class{constructor(e,t,i,n,r){this.context=t,this.counterListener=i,this.counterResolver=n,u(this,"code"),u(this,"stack",[[],[]]),u(this,"conditions",{}),u(this,"currentElement",null),u(this,"currentElementOffset",null),u(this,"currentStyle",null),u(this,"currentClassNames",null),u(this,"currentLocalName",""),u(this,"currentNamespace",""),u(this,"currentId",""),u(this,"currentXmlId",""),u(this,"currentNSTag",""),u(this,"currentEpubTypes",null),u(this,"currentPageType",null),u(this,"previousPageType",null),u(this,"firstPageType",null),u(this,"isFirst",!0),u(this,"isRoot",!0),u(this,"counters",{}),u(this,"counterScoping",[{}]),u(this,"quotes"),u(this,"quoteDepth",0),u(this,"lang",""),u(this,"siblingOrderStack",[0]),u(this,"currentSiblingOrder",0),u(this,"siblingTypeCountsStack",[{}]),u(this,"currentSiblingTypeCounts"),u(this,"currentFollowingSiblingOrder",null),u(this,"followingSiblingOrderStack"),u(this,"followingSiblingTypeCountsStack",[{}]),u(this,"currentFollowingSiblingTypeCounts"),u(this,"viewConditions",{}),u(this,"dependentConditions",[]),u(this,"elementStack"),this.code=e,this.quotes=[new _e("\u201C"),new _e("\u201D"),new _e("\u2018"),new _e("\u2019")],this.currentSiblingTypeCounts=this.siblingTypeCountsStack[0],this.followingSiblingOrderStack=[this.currentFollowingSiblingOrder],this.currentFollowingSiblingTypeCounts=this.siblingTypeCountsStack[0]}pushConditionItem(e){this.stack[this.stack.length-1].push(e)}increment(e,t){this.conditions[e]=(this.conditions[e]||0)+1,t&&(this.viewConditions[e]?this.viewConditions[e].push(t):this.viewConditions[e]=[t])}decrement(e,t){this.conditions[e]--,this.viewConditions[e]&&(this.viewConditions[e]=this.viewConditions[e].filter(i=>i!==t),this.viewConditions[e].length===0&&delete this.viewConditions[e])}buildViewConditionMatcher(e){let t=null;e&&(this.currentElementOffset,t=or.buildViewConditionMatcher(this.currentElementOffset,e));let i=this.dependentConditions.map(n=>{let r=this.viewConditions[n];return r&&r.length>0?r.length===1?r[0]:or.buildAnyMatcher([].concat(r)):null}).filter(n=>n);return i.length<=0?t:t===null?i.length===1?i[0]:or.buildAllMatcher(i):or.buildAllMatcher([t].concat(i))}applyAction(e,t){let i=e[t];i&&i.apply(this)}pushRule(e,t,i){this.currentElement=null,this.currentElementOffset=null,this.currentStyle=i,this.currentNamespace="",this.currentLocalName="",this.currentId="",this.currentXmlId="",this.currentClassNames=e,this.currentNSTag="",this.currentEpubTypes=uo,this.currentPageType=t,this.applyActions()}defineCounter(e,t){let i=this.counterScoping[this.counterScoping.length-1];i||(i={},this.counterScoping[this.counterScoping.length-1]=i),this.counters[e]?(i[e]&&this.counters[e].pop(),this.counters[e].push(t)):this.counters[e]=[t],i[e]=!0}pushCounters(e){var t,i,n,r,o,s,a;let h=x.inline,l=e.display;if(l&&(h=l.evaluate(this.context)),h===x.none){this.currentElement.setAttribute("data-viv-display-none","true"),this.counterScoping.push(null);return}else if(this.currentElement.closest("[data-viv-display-none]")){this.counterScoping.push(null);return}let c=x.inline,p=e.float;p&&(c=p.evaluate(this.context));let d=null,f=null,g=null,m=e["counter-reset"];if(m){let w=m.evaluate(this.context);w&&(d=mn(w,!0))}let v=e["counter-set"];if(v){let w=v.evaluate(this.context);w&&(g=mn(w,!1))}let b=e["counter-increment"];if(b){let w=b.evaluate(this.context);w&&(f=mn(w,!1))}if((this.currentLocalName=="ol"||this.currentLocalName=="ul")&&this.currentNamespace=="http://www.w3.org/1999/xhtml"&&(d||(d={}),d["list-item"]=((i=(t=this.currentElement)==null?void 0:t.start)!=null?i:1)-1),h===x.list_item&&(f||(f={}),f["list-item"]=(n=f["list-item"])!=null?n:1,/^\s*[-+]?\d/.test((o=(r=this.currentElement)==null?void 0:r.getAttribute("value"))!=null?o:"")&&(g||(g={}),g["list-item"]=this.currentElement.value)),((s=this.currentElement)==null?void 0:s.parentNode.nodeType)===Node.DOCUMENT_NODE&&(d||(d={}),d.footnote===void 0&&(d.footnote=0)),c===x.footnote&&(f||(f={}),f.footnote===void 0)){let w=(a=this.currentStyle["counter-increment"])==null?void 0:a.value;(!w||!(w===x.footnote||w instanceof Ie&&w.values.includes(x.footnote)))&&(f.footnote=1)}if(d)for(let w in d)this.defineCounter(w,d[w]);if(f)for(let w in f){this.counters[w]||this.defineCounter(w,0);let S=this.counters[w];S[S.length-1]+=f[w]}if(g)for(let w in g)if(!this.counters[w])this.defineCounter(w,g[w]);else{let S=this.counters[w];S[S.length-1]=g[w]}if(h===x.list_item){let w=this.counters["list-item"],S=w[w.length-1];e["ua-list-item-count"]=new J(new wi(S),0)}this.counterScoping.push(null)}popCounters(){let e=this.counterScoping.pop();if(e)for(let t in e){let i=this.counters[t];i&&(i.length==1?delete this.counters[t]:i.pop())}}setNamedStrings(e){let t=e["string-set"];if(!t)return;t=t.filterValue(new qo(this,this.currentElement,this.counterResolver));let i=t.value instanceof et?t.value.values:[t.value];for(let n of i)if(n instanceof Ie){let r=n.values[0].stringValue(),o=n.values.slice(1).map(s=>xn(s)).join("");this.counterResolver.setNamedString(r,o,this.currentElementOffset)}delete e["string-set"]}setRunningElement(e){let t=e.position;if(t?.value instanceof qi&&t.value.name==="running"){let i=t.value.values[0].stringValue();this.counterResolver.setRunningElement(i,this.currentElementOffset)}}processPseudoelementProps(e,t){this.pushCounters(e);let i=e.content;i&&(e.content=i.filterValue(new qo(this,t,this.counterResolver))),this.popCounters()}pushElement(e,t,i,n){var r,o;this.currentPageType=null,this.currentElement=t,this.currentElementOffset=n,this.currentStyle=i,this.currentNamespace=t.namespaceURI,this.currentLocalName=t.localName;let s=this.code.nsPrefix[this.currentNamespace];s?this.currentNSTag=s+this.currentLocalName:this.currentNSTag="",this.currentId=t.getAttribute("id"),this.currentXmlId=t.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");let a=t.getAttribute("class");a?this.currentClassNames=a.split(/\s+/):this.currentClassNames=uo;let h=t.getAttributeNS("http://www.idpf.org/2007/ops","type");h?this.currentEpubTypes=h.split(/\s+/):this.currentEpubTypes=uo;let l=wo(t);l&&(this.stack[this.stack.length-1].push(new Dg(this.lang)),this.lang=l.toLowerCase());let c=this.isRoot,p=this.siblingOrderStack;this.currentSiblingOrder=++p[p.length-1],p.push(0);let d=this.siblingTypeCountsStack,f=this.currentSiblingTypeCounts=d[d.length-1],g=f[this.currentNamespace];g||(g=f[this.currentNamespace]={}),g[this.currentLocalName]=(g[this.currentLocalName]||0)+1,d.push({});let m=this.followingSiblingOrderStack;m[m.length-1]!==null?this.currentFollowingSiblingOrder=--m[m.length-1]:this.currentFollowingSiblingOrder=null,m.push(null);let v=this.followingSiblingTypeCountsStack,b=this.currentFollowingSiblingTypeCounts=v[v.length-1];b&&b[this.currentNamespace]&&b[this.currentNamespace][this.currentLocalName]--,v.push({}),this.applyActions(),this.applyVarFilter([this.currentStyle],e,t),this.applyCalcFilter(this.currentStyle,this.context),this.applyAttrFilter(t);let w=i.quotes,S=null;if(w){let D=w.evaluate(this.context);D&&(S=new Vg(this.quotes),D===x.none?this.quotes=[new _e(""),new _e("")]:D===x.auto||D===x.initial?this.quotes=[new _e("\u201C"),new _e("\u201D"),new _e("\u2018"),new _e("\u2019")]:D instanceof Ie&&(this.quotes=D.values))}this.pushCounters(this.currentStyle);let L=this.currentId||this.currentXmlId||t.getAttribute("name")||"";if(c||L){let D={};Object.keys(this.counters).forEach(W=>{D[W]=Array.from(this.counters[W])}),this.counterListener.countersOfId(L,D)}let B=vt(this.currentStyle,"_pseudos");if(B){let D=!0;for(let W of Kg){W||(D=!1);let q=B[W];q&&((W==="before"||W==="after")&&!Jt((r=q.content)==null?void 0:r.value)||(W==="footnote-call"||W==="footnote-marker")&&((o=Ge(this.currentStyle,"float"))==null?void 0:o.value)!==x.footnote?delete B[W]:D?this.processPseudoelementProps(q,t):this.stack[this.stack.length-2].push(new zg(q,t)))}}this.setNamedStrings(this.currentStyle),this.setRunningElement(this.currentStyle),S&&this.stack[this.stack.length-2].push(S)}applyAttrFilterInner(e,t){for(let i in t)Vi(i)&&!_t(i)&&(t[i]=t[i].filterValue(e))}applyAttrFilter(e){let t=new Hg(e),i=this.currentStyle,n=vt(i,"_pseudos");for(let r in n)this.applyAttrFilterInner(t,n[r]);this.applyAttrFilterInner(t,i)}applyVarFilter(e,t,i){var n,r,o;let s=e[0],a=new om(e,t,i),h=32,l={};for(let c in s)if(Wo(c)){let p=vt(s,c);for(let d in p)this.applyVarFilter([p[d],...e],t,i)}else if(Vi(c)){let p=Ge(s,c),d=p.value;for(let f=0;;f++){if(f>=h){d=X;break}let g=d.visit(a);if(a.error){d=X,a.error=!1;break}if(g===d)break;d=g}if(d!==p.value){let f=t.validatorSet,g=(n=f?.shorthands[c])==null?void 0:n.clone();if(g)if(te(d)){for(let m of g.propList){let v=new J(d,p.priority),b=Ge(s,m);ci(l,m,$o(this.context,b,v))}delete s[c]}else{let m=Zi(t.scope,new St(d.toString(),null),"");if(m&&(m.visit(g),!g.error)){for(let v of g.propList){let b=new J((o=(r=g.values[v])!=null?r:f.defaultValues[v])!=null?o:x.initial,p.priority),w=Ge(s,v);ci(l,v,$o(this.context,w,b))}delete s[c]}}else s[c]=new J(d,p.priority)}if(l[c]){let f=Ge(s,c);f&&f.value!==X&&zt(l,c,f,this.context)}}for(let c in l)s[c]=l[c]}applyCalcFilter(e,t){let i=new Vu(t);for(let n in e)if(Wo(n)){let r=vt(e,n);for(let o in r)this.applyCalcFilter(r[o],t)}else if(Vi(n)&&!_t(n)){let r=Ge(e,n),o=r.value.visit(i);o!==r.value&&(e[n]=new J(o,r.priority))}}applyActions(){let e;for(e=0;e<this.currentClassNames.length;e++)this.applyAction(this.code.classes,this.currentClassNames[e]);for(e=0;e<this.currentEpubTypes.length;e++)this.applyAction(this.code.epubtypes,this.currentEpubTypes[e]);this.applyAction(this.code.ids,this.currentId),this.applyAction(this.code.tags,this.currentLocalName),this.currentLocalName!=""&&this.applyAction(this.code.tags,"*"),this.applyAction(this.code.nstags,this.currentNSTag),this.currentPageType!==null&&(this.applyAction(this.code.pagetypes,this.currentPageType),this.applyAction(this.code.pagetypes,"*")),this.stack.push([]);for(let t=1;t>=-1;--t){let i=this.stack[this.stack.length-t-2];for(e=0;e<i.length;)i[e].push(this,t)?i.splice(e,1):e++}this.isFirst=!0,this.isRoot=!1}pop(){for(let e=1;e>=-1;--e){let t=this.stack[this.stack.length-e-2],i=0;for(;i<t.length;)t[i].pop(this,e)?t.splice(i,1):i++}this.stack.pop(),this.isFirst=!1}popRule(){this.pop()}popElement(e){this.siblingOrderStack.pop(),this.siblingTypeCountsStack.pop(),this.followingSiblingOrderStack.pop(),this.followingSiblingTypeCountsStack.pop(),this.pop(),this.popCounters()}},uo=[],Kg=["before","transclusion-before","footnote-call","footnote-marker","inner","first-letter","first-line","","transclusion-after","after"],Yo=null;function Zg(e){Yo=e}var Tn=class extends Vn{constructor(e,t,i,n,r,o,s){super(e,t,s),this.condition=i,this.regionId=r,this.validatorSet=o,u(this,"chain",null),u(this,"specificity",0),u(this,"elementStyle",null),u(this,"conditionCount",0),u(this,"pseudoelement",null),u(this,"footnoteContent",!1),u(this,"cascade"),u(this,"state"),u(this,"viewConditionId",null),u(this,"insideSelectorRule"),u(this,"invalid",!1),this.cascade=n?n.cascade:Yo?Yo.clone():new qg,this.state=0}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.tags,"*",e)}processChain(e){let t=Eu(this.chain,e);t!==e&&t.makePrimary(this.cascade)||this.insertNonPrimary(t)}isInsideSelectorRule(e){return this.state!=0?(this.reportAndSkip(e),!0):!1}tagSelector(e,t){!t&&!e||(t&&(this.specificity+=1),t&&e?this.chain.push(new vg(e,t.toLowerCase())):t?this.chain.push(new Ga(t.toLowerCase())):this.chain.push(new yg(e)))}invalidSelector(e){U.warn(e),this.chain.push(new Ke("")),this.setInvalid()}setInvalid(){this.invalid=!0;for(let e=this;e instanceof In;e=e.parent)e.parent.invalid=!0}classSelector(e){if(this.pseudoelement){this.invalidSelector(`::${this.pseudoelement} followed by .${e}`);return}this.specificity+=256,this.chain.push(new wg(e))}pseudoclassSelector(e,t){if(this.pseudoelement){this.invalidSelector(`::${this.pseudoelement} followed by :${e}`);return}switch(e.toLowerCase()){case"enabled":this.chain.push(new Tg);break;case"disabled":this.chain.push(new Ig);break;case"checked":this.chain.push(new Fg);break;case"root":case"scope":this.chain.push(new kg);break;case"link":this.chain.push(new Ga("a")),this.chain.push(new ja("","href"));break;case"-adapt-href-epub-type":case"href-epub-type":if(t&&t.length>=1&&typeof t[0]=="string"){let i=t[0],n=new RegExp(`(^|\\s)${Wt(i)}($|\\s)`),r=t[1];this.chain.push(new xg(n,r))}else this.chain.push(new Ke(""));break;case"-adapt-footnote-content":case"footnote-content":this.footnoteContent=!0;break;case"visited":case"active":case"hover":case"focus":this.chain.push(new Ke(""));break;case"lang":if(t&&t.length==1&&typeof t[0]=="string"){let i=t[0];this.chain.push(new Eg(new RegExp(`^${Wt(i.toLowerCase())}($|-)`)))}else this.chain.push(new Ke(""));break;case"nth-child":case"nth-last-child":case"nth-of-type":case"nth-last-of-type":{let i=Qg[e.toLowerCase()];t&&t.length==2?this.chain.push(new i(t[0],t[1])):this.chain.push(new Ke(""));break}case"first-child":this.chain.push(new Xa);break;case"last-child":this.chain.push(new jo(0,1));break;case"first-of-type":this.chain.push(new Go(0,1));break;case"last-of-type":this.chain.push(new Xo(0,1));break;case"only-child":this.chain.push(new Xa),this.chain.push(new jo(0,1));break;case"only-of-type":this.chain.push(new Go(0,1)),this.chain.push(new Xo(0,1));break;case"empty":this.chain.push(new Ng);break;case"before":case"after":case"first-line":case"first-letter":this.pseudoelementSelector(e,t);return;default:this.invalidSelector(`Unknown pseudo-class :${e}`);return}this.specificity+=256}pseudoelementSelector(e,t){switch(e){case"before":case"after":case"first-line":case"first-letter":case"footnote-call":case"footnote-marker":case"inner":case"after-if-continues":if(!this.pseudoelement)this.pseudoelement=e;else{this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);return}break;case"first-n-lines":if(t&&t.length==1&&typeof t[0]=="number"){let i=Math.round(t[0]);if(i>0&&i==t[0]){if(!this.pseudoelement)this.pseudoelement=`first-${i}-lines`;else{this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);return}break}}this.chain.push(new Ke(""));break;case"nth-fragment":t&&t.length==2?this.viewConditionId=`NFS_${t[0]}_${t[1]}`:this.chain.push(new Ke(""));break;default:this.invalidSelector(`Unknown pseudo-element ::${e}`);return}this.specificity+=1}idSelector(e){this.specificity+=65536,this.chain.push(new bg(e))}attributeSelector(e,t,i,n){this.specificity+=256,t=t.toLowerCase(),n=n||"";let r;switch(i){case 0:r=new ja(e,t);break;case 39:r=new Sg(e,t,n);break;case 45:!n||n.match(/\s/)?r=new Ke(""):r=new sn(e,t,new RegExp(`(^|\\s)${Wt(n)}($|\\s)`));break;case 44:r=new sn(e,t,new RegExp(`^${Wt(n)}($|-)`));break;case 43:n?r=new sn(e,t,new RegExp(`^${Wt(n)}`)):r=new Ke("");break;case 42:n?r=new sn(e,t,new RegExp(`${Wt(n)}$`)):r=new Ke("");break;case 46:n?r=new sn(e,t,new RegExp(Wt(n))):r=new Ke("");break;case 50:if(n=="supported")r=new Cg(e,t);else{this.invalidSelector(`Unsupported :: attr selector op: ${n}`);return}break;default:this.invalidSelector(`Unsupported attr selector: ${i}`);return}this.chain.push(r)}descendantSelector(){let e=`d${ar++}`;this.processChain(new sr(new Og(e,this.viewConditionId,null))),this.chain=[new Ke(e)],this.viewConditionId=null}childSelector(){let e=`c${ar++}`;this.processChain(new sr(new Bg(e,this.viewConditionId,null))),this.chain=[new Ke(e)],this.viewConditionId=null}adjacentSiblingSelector(){let e=`a${ar++}`;this.processChain(new sr(new _g(e,this.viewConditionId,null))),this.chain=[new Ke(e)],this.viewConditionId=null}followingSiblingSelector(){let e=`f${ar++}`;this.processChain(new sr(new Mg(e,this.viewConditionId,null))),this.chain=[new Ke(e)],this.viewConditionId=null}nextSelector(){this.finishChain(),this.pseudoelement=null,this.footnoteContent=!1,this.specificity=0,this.chain=[]}startSelectorRule(){this.isInsideSelectorRule("E_CSS_UNEXPECTED_SELECTOR")||(this.state=1,this.elementStyle={},this.pseudoelement=null,this.specificity=0,this.footnoteContent=!1,this.chain=[],this.invalid=!1)}error(e,t){super.error(e,t),this.state==1&&(this.state=0),this.setInvalid()}startStylesheet(e){super.startStylesheet(e),this.state=0}startRuleBody(){this.finishChain(),super.startRuleBody(),this.state==1&&(this.state=0)}endRule(){super.endRule(),this.insideSelectorRule=0}finishChain(){this.chain&&(this.processChain(this.makeApplyRuleAction(this.specificity)),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0)}makeApplyRuleAction(e){let t=this.regionId;return this.footnoteContent&&(t?t="xxx-bogus-xxx":t="footnote"),new As(this.elementStyle,e,this.pseudoelement,t,this.viewConditionId)}special(e,t){let i;this.condition?i=new Ho(t,0,this.condition):i=new J(t,0),Cu(this.elementStyle,e).push(i)}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,i){e=="display"&&(t===x.oeb_page_head||t===x.oeb_page_foot)&&(this.simpleProperty("flow-options",new Ie([x.exclusive,x._static]),i),this.simpleProperty("flow-into",t,i),t=x.block),xt("SIMPLE_PROPERTY").forEach(o=>{let s=o({name:e,value:t,important:i});e=s.name,t=s.value,i=s.important});let n=(i?this.getImportantSpecificity():this.getBaseSpecificity())+this.cascade.nextOrder(),r=this.condition?new Ho(t,n,this.condition):new J(t,n);zt(this.elementStyle,e,r)}finish(){return this.cascade}startFuncWithSelector(e){let t;switch(e){case"is":t=new In(this);break;case"not":t=new Jg(this);break;case"where":t=new em(this);break;case"has":t=new tm(this);break}t&&(t.startSelectorRule(),this.owner.pushHandler(t))}},Qg={"nth-child":Pg,"nth-of-type":Go,"nth-last-child":jo,"nth-last-of-type":Xo},ar=0,In=class Lu extends Tn{constructor(t){super(t.scope,t.owner,t.condition,t,t.regionId,t.validatorSet,!1),this.parent=t,u(this,"parentChain"),u(this,"chains",[]),u(this,"maxSpecificity",0),u(this,"selectorTexts",[]),this.parentChain=t.chain}nextSelector(){this.chain&&this.chains.push(this.chain),this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.chain=[],this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0}endFuncWithSelector(){this.chain&&this.chains.push(this.chain),this.chains.length>0?(this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.parentChain.push(this.relational()?new Lg(this.selectorTexts):this.positive()?new Rs(this.chains):new Rg(this.chains)),this.increasingSpecificity()&&(this.parent.specificity+=this.maxSpecificity)):this.parentChain.push(new Ke("")),this.owner.popHandler()}startRuleBody(){this.reportAndSkip("E_CSS_UNEXPECTED_RULE_BODY")}error(t,i){super.error(t,i),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0;let n=!1;for(let r=this;r instanceof Lu;r=r.parent)if(r.forgiving()){n=!0;break}n||this.owner.popHandler()}pushSelectorText(t){this.chain&&this.relational()&&this.selectorTexts.push(t)}positive(){return!0}increasingSpecificity(){return!0}forgiving(){return!0}relational(){return!1}},Jg=class extends In{positive(){return!1}forgiving(){return!1}},em=class extends In{increasingSpecificity(){return!1}},tm=class extends In{relational(){return!0}},im=class extends Vn{constructor(e,t){super(e,t,!1)}property(e,t,i){if(this.scope.values[e])this.error(`E_CSS_NAME_REDEFINED ${e}`,this.getCurrentToken());else{let n=e.match(/height|^(top|bottom)$/)?"vh":"vw",r=new fi(this.scope,100,n);this.scope.defineName(e,t.toExpr(this.scope,r))}}},lr=class extends Vn{constructor(e,t,i,n,r,o){super(e,t,!1),this.condition=i,this.elementStyle=n,this.validatorSet=r,this.ruleType=o,u(this,"order"),this.order=0}property(e,t,i){i?U.warn("E_IMPORTANT_NOT_ALLOWED"):this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){U.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){U.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,i){let n=i?this.getImportantSpecificity():this.getBaseSpecificity();n+=this.order,this.order+=Ls;let r=this.condition?new Ho(t,n,this.condition):new J(t,n);zt(this.elementStyle,e,r)}},nm=class extends Uh{constructor(e,t){super(e),this.validatorSet=t,u(this,"elementStyle",{}),u(this,"order",0)}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){U.warn("E_INVALID_PROPERTY_VALUE",`${e}:`,t.toString())}unknownProperty(e,t){U.warn("E_INVALID_PROPERTY",`${e}:`,t.toString())}simpleProperty(e,t,i){let n=i?Hh:Vh;n+=this.order,this.order+=Ls;let r=new J(t,n);zt(this.elementStyle,e,r)}};function Ou(e,t){let i=yu(e);i&&i.forEach(n=>{n.matcher.matches()&&t(n.styles)})}function Ko(e,t,i){Ou(i,n=>{yn(e,n,t)})}function rm(e,t,i,n){let r=new nm(e,t),o=new St(n,r);try{pf(o,r,i)}catch(s){U.warn(s,"Style attribute parse error:")}return r.elementStyle}function Bu(e,t,i){let n=e["writing-mode"];if(n){let r=n.evaluate(t,"writing-mode");if(r&&r!==x.inherit&&r!==x.revert&&r!==x.unset)return r===x.vertical_rl}return i}function _u(e,t,i){let n=e.direction;if(n){let r=n.evaluate(t,"direction");if(r&&r!==x.inherit&&r!==x.revert&&r!==x.unset)return r===x.rtl}return i}function Mu(e,t,i,n,r){let o={};for(let s in e)Vi(s)&&(o[s]=Ge(e,s));return Ko(o,t,e),zu(e,i,n,(s,a)=>{yn(o,a,t),Ko(o,t,a)}),o}function zu(e,t,i,n){let r=vt(e,"_regions");if((t||i)&&r){if(i){let o=["footnote"];t?t=t.concat(o):t=o}for(let o of t){let s=r[o];s&&n(o,s)}}}function yn(e,t,i){for(let n in t)if(Vi(n)){let r=Ge(t,n),o=e[n];e[n]=$o(i,o,r)}}var Du=(e,t,i,n,r)=>{let o=i?n?cg:bu:n?dg:vu;for(let s in e)if(e.hasOwnProperty(s)){let a=e[s];if(!a)continue;let h=o[s],l;if(h){let c=e[h];if(c&&c.priority>a.priority)continue;l=ug[h]?h:s}else l=s;t[l]=r(s,a)}},om=class extends Xi{constructor(e,t,i){super(),this.elementStyles=e,this.styler=t,this.element=i}getVarValue(e){var t,i,n,r,o;let s=(t=this.element)!=null?t:this.styler.root;if((i=this.elementStyles)!=null&&i.length){for(let a of this.elementStyles){let h=(n=a[e])==null?void 0:n.value;if(h)return h}this.element&&(s=this.element.parentElement)}for(;s;s=s.parentElement){let a=(o=(r=this.styler.getStyle(s,!1))==null?void 0:r[e])==null?void 0:o.value;if(a)return a}return null}visitFunc(e){if(e.name!=="var")return super.visitFunc(e);let t=e.values[0]instanceof yt&&e.values[0].name;return!t||!_t(t)?(this.error=!0,X):this.getVarValue(t)||(e.values.length<2?(this.error=!0,X):e.values.length===2?e.values[1]:new et(e.values.slice(1)))}},Vu=class extends Xi{constructor(e,t,i,n){super(),this.context=e,this.resolveViewportUnit=t,this.percentRef=i,this.vertical=n}visitFunc(e){let t=super.visitFunc(e);if(e.name!=="calc")return t;let i=t.toString().replace(/^calc\b/,"-epubx-expr");if(/\d(%|em|ex|cap|ch|ic|lh|p?v[whbi]|p?vmin|p?vmax)\W|\Wvar\(\s*--/i.test(i))return t;let n=Zi(this.context.rootScope,new St(i,null),"");if(n instanceof $)try{let r=n.expr.evaluate(this.context);typeof r=="number"&&(t=new A(r,"px"))}catch(r){U.warn(r)}return t}visitNumeric(e){return this.resolveViewportUnit&&(eh(e.unit)||Gd(e.unit))?new A(e.num*this.context.queryUnitSize(e.unit,!1,this.vertical),"px"):typeof this.percentRef=="number"&&e.unit==="%"?new A(e.num*this.percentRef/100,"px"):e}};function Tr(e,t,i,n,r){try{if(t instanceof $)return t.expr instanceof We&&(t.expr.str.startsWith("named-string-")||t.expr.str.startsWith("running-element-"))?t:wf(e,t.expr,i);if(t instanceof A||t instanceof qi||t instanceof Ie||t instanceof et)return t.visit(new Vu(e,!0,n,r))}catch(o){return U.warn(o),X}return t}var Za={first:!1,forceEnd:!1,allowEnd:!1,last:!1};function Qa(e){let t=e instanceof Ye?e:typeof e=="string"?z(e):x.none;if(t===x.none)return Za;let i=t instanceof Ie?t.values:[t],n=Object.create(Za);for(let r of i)if(r instanceof yt)switch(r.name){case"first":n.first=!0;break;case"force-end":n.forceEnd=!0,n.allowEnd=!1;break;case"allow-end":n.forceEnd=!1,n.allowEnd=!0;break;case"last":n.last=!0;break}return n}function Ja(e){return!e.first&&!e.last&&!e.forceEnd&&!e.allowEnd}var sm={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!1,trimAdjacent:!1},el={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!0,trimAdjacent:!0},tl={trimStart:!0,spaceFirst:!1,trimEnd:!0,allowEnd:!1,trimAdjacent:!0};function il(e){let t=e instanceof Ye?e:typeof e=="string"?z(e):x.normal;if(t===x.normal)return el;if(t===x.auto)return tl;let i=t instanceof Ie?t.values:[t],n=Object.create(el);for(let r of i)if(r instanceof yt)switch(r.name){case"trim-both":case"trim-auto":return tl;case"space-all":return sm;case"trim-start":n.trimStart=!0,n.spaceFirst=!1;break;case"space-start":n.trimStart=!1,n.spaceFirst=!1;break;case"space-first":n.trimStart=!1,n.spaceFirst=!0;break;case"trim-end":n.trimEnd=!0,n.allowEnd=!1;break;case"space-end":n.trimEnd=!1,n.allowEnd=!1;break;case"allow-end":n.trimEnd=!1,n.allowEnd=!0;break;case"trim-adjacent":n.trimAdjacent=!0;break;case"space-adjacent":n.trimAdjacent=!1;break}return n}var co={ideographAlpha:!1,ideographNumeric:!1},am={ideographAlpha:!0,ideographNumeric:!0};function nl(e){let t=e instanceof Ye?e:typeof e=="string"?z(e):x.normal;if(t===x.normal||t===x.auto)return am;if(t===x.none)return co;let i=t instanceof Ie?t.values:[t],n=Object.create(co);for(let r of i)if(r instanceof yt)switch(r.name){case"no-autospace":return co;case"ideograph-alpha":n.ideographAlpha=!0;break;case"ideograph-numeric":n.ideographNumeric=!0;break}return n}function rl(e,t){return!e.ideographAlpha&&!e.ideographNumeric&&!t.trimStart&&!t.spaceFirst&&!t.trimEnd&&!t.allowEnd&&!t.trimAdjacent}function ol(e){return e?(e=e.toLowerCase(),/^zh\b.*-(hant|tw|hk)\b/.test(e)?"zh-hant":/^zh\b/.test(e)?"zh-hans":/^ja\b/.test(e)?"ja":/^ko\b/.test(e)?"ko":e):null}var lm=class{getPolyfilledInheritedProps(){return["hanging-punctuation","text-autospace","text-spacing-trim"]}preprocessSingleDocument(e){e.body&&this.preprocessForTextSpacing(e.body)}preprocessForTextSpacing(e){var t;let i=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT);for(let n=i.nextNode();n;n=i.nextNode()){if(n.parentElement.namespaceURI!=="http://www.w3.org/1999/xhtml"||((t=n.parentElement.dataset)==null?void 0:t.mathTypeset)==="true")continue;let r=n.textContent.replace(new RegExp("(?![()\\[\\]{}])[\\p{Ps}\\p{Pe}\\p{Pf}\\p{Pi}\u3001\u3002\uFF0C\uFF0E\uFF1A\uFF1B\uFF64\uFF61\\u3000]\\p{M}*(?=\\P{M})|.(?=(?![()\\[\\]{}])[\\p{Ps}\\p{Pe}\\p{Pf}\\p{Pi}\u3001\u3002\uFF0C\uFF0E\uFF1A\uFF1B\uFF64\uFF61\\u3000])|(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]\\p{M}*(?=(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])[\\p{L}\\p{Nd}])|(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])[\\p{L}\\p{Nd}]\\p{M}*(?=(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF])","gsu"),"$&\0").split("\0");if(r.length>1){let o=r.length-1;for(let s=0;s<o;s++)n.parentNode.insertBefore(document.createTextNode(r[s]),n);n.textContent=r[o]}}}processGeneratedContent(e,t,i,n,r,o){r=ol(r);let s=nl(t),a=il(i),h=Qa(n);if(Ja(h)&&rl(s,a))return;this.preprocessForTextSpacing(e);let l=e.style.whiteSpace;(o?e.offsetHeight:e.offsetWidth)===0&&(e.style.whiteSpace="pre");let c=e.ownerDocument.createNodeIterator(e,NodeFilter.SHOW_TEXT),p=null,d=null;for(let f=c.nextNode();f;f=d){d=c.nextNode();let g=!p,m=!p||/\n$/.test(p.textContent),v=!d||/^\n/.test(d.textContent),b=!d;this.processTextSpacing(f,g||m,g,m,v,b,p,d,s,a,h,r,o),p=f}e.style.whiteSpace=l}postLayoutBlock(e,t){var i,n,r,o,s,a,h;let l=!e||e.fragmentIndex===1&&d(),c=l||f();function p(b){var w;if(b?.nodeType!==1)return!1;let S=b;if(S.hasAttribute(Wi))return!0;let{position:L,float:B}=(w=S.style)!=null?w:{};return L==="absolute"||L==="fixed"||B&&B!=="none"}function d(){let b=t[0];for(let w=b;;w=w.parent)if(!w||!w.inline){if(w?.fragmentIndex!==1)return!1;break}if(!b.inline)return!0;for(let w=b.viewNode.previousSibling;w;w=w.previousSibling)if(!je(w,b.whitespace)&&!p(w))return!1;return!0}function f(){var b,w;let S=t[0],L;for(;S&&S.inline&&(L=(b=S.viewNode)==null?void 0:b.previousSibling,!(L&&(L.nodeType===3&&/^[ \t\r\n\f]*$/.test(L.textContent)&&S.whitespace!==nt.PRESERVE&&(L=L.previousSibling),L)));)S=S.parent;for(;L;){if(L.nodeType===1){if(L.localName==="br")return!0;let B=(w=L.style)==null?void 0:w.display;if(B&&B!=="inline")return!/^(inline|ruby)\b/.test(B)}else if(L.nodeType===3){if(S.whitespace===nt.PRESERVE){if(/\n$/.test(L.textContent))return!0}else if(S.whitespace===nt.NEWLINE&&/\n[ \t\r\n\f]*$/.test(L.textContent))return!0}L=L.lastChild}return!1}let g=-1;for(let b=0;b<t.length;b++){let w=t[b];if(!w.after&&w.inline&&!w.display&&w.parent&&w.viewNode.parentNode&&w.viewNode.nodeType===Node.TEXT_NODE&&!je(w.viewNode,w.whitespace)){let S=function(E){var O,R,M;if(((O=E.viewNode)==null?void 0:O.nodeType)===1)return E.viewNode.localName==="br";if(((R=E.viewNode)==null?void 0:R.nodeType)===3){if(E.whitespace===nt.PRESERVE){if(/\n$/.test(E.viewNode.textContent))return!0}else if(E.whitespace===nt.NEWLINE&&/\n[ \t\r\n\f]*$/.test(E.viewNode.textContent))return!0;if(((M=E.viewNode.previousElementSibling)==null?void 0:M.localName)==="br")return je(E.viewNode,E.whitespace)}return!1},L=function(E){var O,R,M;if(((O=E.viewNode)==null?void 0:O.nodeType)===1)return E.viewNode.localName==="br";if(((R=E.viewNode)==null?void 0:R.nodeType)===3){if(E.whitespace===nt.PRESERVE){if(/^\n/.test(E.viewNode.textContent))return!0}else if(E.whitespace===nt.NEWLINE&&/^[ \t\r\n\f]*\n/.test(E.viewNode.textContent))return!0;if(((M=E.viewNode.nextElementSibling)==null?void 0:M.localName)==="br")return je(E.viewNode,E.whitespace)}return!1};var m=S,v=L;let B=ol((o=(n=(i=w.lang)!=null?i:w.parent.lang)!=null?n:e?.lang)!=null?o:(r=e?.parent)==null?void 0:r.lang),D=nl(w.inheritedProps["text-autospace"]),W=il(w.inheritedProps["text-spacing-trim"]),q=Qa(w.inheritedProps["hanging-punctuation"]);if(Ja(q)&&rl(D,W)||/\b(flex|grid)\b/.test(w.parent.display))continue;g<0&&(g=b);let ye=null,Xe=null,ge=b===g,me=b===g&&l,y=b===g&&c,I=!1,C=!1;for(let E=b-1;E>=0;E--){let O=t[E];if(S(O)){y=!0;break}if(!O.display&&O.viewNode.nodeType===Node.TEXT_NODE&&O.viewNode.textContent.length>0){ye=O.viewNode;break}if(O.display&&!/^(inline|ruby)\b/.test(O.display)||((s=O.viewNode)==null?void 0:s.nodeType)===1&&(O.viewNode.localName==="br"||li[O.viewNode.localName]))break;E===0&&(ge=!0,l&&(me=!0,y=!0))}for(let E=b+1;E<t.length;E++){let O=t[E];if(L(O)){I=!0;break}if(O.viewNode!==w.viewNode&&!O.display&&O.viewNode.nodeType===Node.TEXT_NODE&&O.viewNode.textContent.length>0){Xe=O.viewNode;break}if(O.display&&!/^(inline|ruby)\b/.test(O.display)||((a=O.viewNode)==null?void 0:a.nodeType)===1&&(O.viewNode.localName==="br"||li[O.viewNode.localName])){E===t.length-1&&p(O.viewNode)&&(C=!0);break}if(E===t.length-1){I=!0,C=!0;for(let R=O.viewNode.nextSibling;R;R=R.nextSibling)if(!p(R)){C=!1;break}}}if(((h=w.parent)==null?void 0:h.display)==="inline-block"){if(!me){let E=w.parent.viewNode.firstChild;for(;je(E,w.whitespace);)E=E.nextSibling;w.viewNode===E&&(me=!0)}if(!C){let E=w.parent.viewNode.lastChild;for(;je(E,w.whitespace);)E=E.previousSibling;w.viewNode===E&&(C=!0)}}this.processTextSpacing(w.viewNode,ge,me,y,I,C,ye,Xe,D,W,q,B,w.vertical)}}}processTextSpacing(e,t,i,n,r,o,s,a,h,l,c,p,d){let f=e.textContent,g=e.ownerDocument,m,v,b;function w(){if(t)return!0;if(!s)return!1;m||(m=g.createRange(),m.selectNode(e));let I=m.getClientRects()[0];v||(v=g.createRange(),v.selectNode(s));let C=v.getClientRects(),E=C[C.length-1];return!I||!E?!1:d?I.top<E.top+E.height-I.width||I.left+I.width<E.left+I.width/10||I.left>E.left+E.width-I.width/10:I.left<E.left+E.width-I.height||I.top>E.top+E.height-I.height/10||I.top+I.height<E.top+I.height/10}function S(){if(!a)return!1;m||(m=g.createRange(),m.selectNode(e));let I=m.getClientRects()[0];b||(b=g.createRange(),b.selectNode(a));let C=b.getClientRects()[0];return!I||!C?!1:d?I.top+I.height>C.top+I.width||I.left>C.left+C.width-I.width/10||I.left+I.width<C.left+I.width/10:I.left+I.width>C.left+I.height||I.top+I.height<C.top+I.height/10||I.top>C.top+C.height-I.height/10}let L=!1,B=!1,D=!1,W=!1,q;if(i&&c.first&&new RegExp(`^[\\p{Ps}\\p{Pf}\\p{Pi}'"\\u3000]\\p{M}*$`,"u").test(f)?(q="viv-ts-open",L=!0,B=!0):o&&c.last&&new RegExp(`^[\\p{Pe}\\p{Pf}\\p{Pi}'"]\\p{M}*$`,"u").test(f)?(q="viv-ts-close",L=!0,D=!0):(c.forceEnd||c.allowEnd)&&new RegExp("^[\u3001\u3002\uFF0C\uFF0E\uFF64\uFF61]\\p{M}*$","u").test(f)?(q="viv-ts-close",L=!0,W=!0):(l.trimStart||l.spaceFirst||l.trimAdjacent)&&new RegExp("^[\u2018\u201C\u301D\uFF08\uFF3B\uFF5B\uFF5F\u2329\u3008\u300A\u300C\u300E\u3010\u3014\u3016\u3018\u301A]\\p{M}*$","u").test(f)?(q="viv-ts-open",L=!0):(l.trimEnd||l.allowEnd||l.trimAdjacent)&&(new RegExp("^[\u2019\u201D\u301E\u301F\uFF09\uFF3D\uFF5D\uFF60\u232A\u3009\u300B\u300D\u300F\u3011\u3015\u3017\u3019\u301B]\\p{M}*$","u").test(f)||p==="zh-hans"&&new RegExp("^[\uFF1A\uFF1B]\\p{M}*$","u").test(f)||p!=="zh-hant"&&new RegExp("^[\u3001\u3002\uFF0C\uFF0E]\\p{M}*$","u").test(f))&&(q="viv-ts-close",L=!0),L){let I=function(M){let H=parseFloat(g.defaultView.getComputedStyle(M).fontSize)*.7;return(d?M.offsetHeight:M.offsetWidth)>H},C=function(){return d?E.offsetLeft:E.offsetTop};var ye=I,Xe=C;if(e.parentElement.localName==="viv-ts-inner")return;let E=g.createElement(q),O=g.createElement("viv-ts-inner");E.appendChild(O),e.parentNode.insertBefore(E,e),O.appendChild(e);let R=I(O);if(R||B||D||W){if(q==="viv-ts-open"){if(B)E.className="viv-hang-first";else if(i||n)l.trimStart?E.className="viv-ts-trim":E.className="viv-ts-space";else if(!(l.trimStart||l.spaceFirst)&&w())E.className="viv-ts-space";else if(l.trimAdjacent&&s&&new RegExp("[\\p{Ps}\\p{Pi}\\p{Pe}\\p{Pf}\\u00B7\\u2027\\u30FB\\u3000\uFF1A\uFF1B\u3001\u3002\uFF0C\uFF0E]\\p{M}*$","u").test(s.textContent)&&(!new RegExp("[\\p{Pe}\\p{Pf}]\\p{M}*$","u").test(s.textContent)||s.parentElement.localName==="viv-ts-inner"&&I(s.parentElement)))E.className="viv-ts-trim";else if((l.trimStart||l.spaceFirst)&&w()){let M=C();E.className="viv-ts-auto",M===C()&&!w()&&(E.className="viv-ts-trim")}}else if(q==="viv-ts-close"){if(D)E.className=R?"viv-hang-last":"viv-hang-last viv-hang-hw";else if(o||r){let M=C();W?(E.className=R?c.allowEnd&&l.allowEnd?"viv-ts-auto":"viv-hang-end":"viv-hang-end viv-hang-hw",c.allowEnd&&M===C()&&(l.trimEnd?E.className="viv-ts-trim":l.allowEnd?(E.className="viv-hang-end",M===C()&&(E.className="")):E.className="viv-ts-space")):l.trimEnd?E.className="viv-ts-trim":l.allowEnd?(E.className="viv-ts-auto",M===C()&&(E.className="")):E.className="viv-ts-space"}else if(a&&/^[\p{Pe}\p{Pf}\u00B7\u2027\u30FB\u3000]/u.test(a.textContent))R&&l.trimAdjacent&&(E.className="viv-ts-trim");else if(W){let M=S(),H=M&&c.allowEnd;H||(E.className=R?"viv-hang-end":"viv-hang-end viv-hang-hw"),R?H&&l.trimEnd?E.className="viv-ts-auto":!H&&!S()?E.className="":!M&&c.allowEnd&&(l.trimEnd?(E.className="viv-ts-auto",S()||(E.className="viv-hang-end")):(E.className="viv-ts-space",S()||(l.allowEnd?(E.className="viv-ts-auto",S()||(E.className="viv-hang-end")):E.className="viv-hang-end"))):!M&&!S()&&(E.className="")}else if(l.trimEnd||l.allowEnd)if(S())l.allowEnd?E.className="viv-ts-space":E.className="viv-ts-auto";else{let M=C();E.className="viv-ts-auto",M===C()&&(E.className="")}}}}let ge=!1;function me(I){var C;let E=(C=I?.ownerDocument.defaultView)==null?void 0:C.getComputedStyle(I);return!!E&&(E.textOrientation==="upright"||E.textCombineUpright==="all"||E["-webkit-text-combine"]==="horizontal")}function y(I,C){if(I.nodeType===1){let R=g.defaultView.getComputedStyle(I);if(parseFloat(R.marginInlineEnd)||parseFloat(R.borderInlineEndWidth)||parseFloat(R.paddingInlineEnd))return!0}let E=I.parentElement;if(E&&!E.contains(C))return y(E,C);if(C.nodeType===1){let R=g.defaultView.getComputedStyle(C);if(parseFloat(R.marginInlineStart)||parseFloat(R.borderInlineStartWidth)||parseFloat(R.paddingInlineStart))return!0}let O=C.parentElement;return O&&!O.contains(I)?y(I,O):!1}(h.ideographAlpha||h.ideographNumeric)&&(s&&new RegExp("^(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]","u").test(f)&&(h.ideographAlpha&&new RegExp("(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])\\p{L}\\p{M}*$","u").test(s.textContent)||h.ideographNumeric&&new RegExp("(?![\\uFF01-\\uFF60])\\p{Nd}\\p{M}*$","u").test(s.textContent))&&!(d&&me(s.parentElement))&&!y(s,e)&&(e.parentNode.insertBefore(g.createElement("viv-ts-thin-sp"),e),ge=!0),a&&new RegExp("(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]\\p{M}*$","u").test(f)&&(h.ideographAlpha&&new RegExp("^(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])\\p{L}","u").test(a.textContent)||h.ideographNumeric&&new RegExp("^(?![\\uFF01-\\uFF60])\\p{Nd}","u").test(a.textContent))&&!(d&&me(a.parentElement))&&!y(e,a)&&(e.parentNode.insertBefore(g.createElement("viv-ts-thin-sp"),e.nextSibling),ge=!0))}registerHooks(){mt("POLYFILLED_INHERITED_PROPS",this.getPolyfilledInheritedProps.bind(this)),mt("PREPROCESS_SINGLE_DOCUMENT",this.preprocessSingleDocument.bind(this)),mt("POST_LAYOUT_BLOCK",this.postLayoutBlock.bind(this),!0)}},Os=new lm;Os.registerHooks();function hm(e){Os.preprocessForTextSpacing(e)}function um(e,t,i,n,r,o){Os.processGeneratedContent(e,t,i,n,r,o)}var pr=new DOMParser().parseFromString('<root xmlns="http://www.pyroxy.com/ns/shadow"/>',"text/xml"),cm=["footnote-marker","first-5-lines","first-4-lines","first-3-lines","first-2-lines","first-line","first-letter","before","","after"],Bs="data-adapt-pseudo";function Bi(e){return e.getAttribute(Bs)||""}function Zo(e,t){e.setAttribute(Bs,t)}var sl=class{constructor(e,t,i,n,r){this.element=e,this.style=t,this.styler=i,this.context=n,this.exprContentListener=r,u(this,"contentProcessed",{})}getStyle(e,t){let i=Bi(e);this.styler&&i&&i.match(/after$/)&&(this.style=this.styler.getStyle(this.element,!0),this.styler=null);let n=vt(this.style,"_pseudos")[i]||{};if(i.match(/^first-/)&&!n["x-first-pseudo"]){let r=1,o;i=="first-letter"?r=0:(o=i.match(/^first-([0-9]+)-lines$/))!=null&&(r=o[1]-0),n["x-first-pseudo"]=new J(new gi(r),0)}return n}processContent(e,t,i){let n=Bi(e);if(!this.contentProcessed[n]){this.contentProcessed[n]=!0;let r=t.content;r&&Jt(r)&&(r.visit(new Pr(e,this.context,r,this.exprContentListener)),hm(e))}}},gb=Cr.isInstanceOfAfterIfContinuesLayoutConstraint,dm=Hr.registerFragmentIndex,mb=Hr.clearFragmentIndices,pm=class{constructor(e,t){this.sourceNode=e,this.styler=t}createElement(e,t){let i=t.viewNode.ownerDocument.createElement("div"),n=new _s(e,i,t),r=n.getColumn().pageBreakType;return n.getColumn().pageBreakType=null,n.layout(this.createNodePositionForPseudoElement(),!0).thenAsync(()=>{this.styler.contentProcessed["after-if-continues"]=!1,n.getColumn().pageBreakType=r;let o=i.firstChild;return T(o,"display","block"),P(o)})}createNodePositionForPseudoElement(){let e=pr.createElementNS("http://www.w3.org/1999/xhtml","div");Zo(e,"after-if-continues");let t=this.createShadowContext(e),i={steps:[{node:e,shadowType:t.type,shadowContext:t,nodeShadow:null,shadowSibling:null}],offsetInNode:0,after:!1,preprocessedTextContent:null};return new Qt(i)}createShadowContext(e){return new Lo(this.sourceNode,e,null,null,null,Mt.ShadowType.ROOTED,this.styler)}},fm=class Hu{constructor(t,i,n){this.nodeContext=t,this.afterIfContinues=i,this.pseudoElementHeight=n,u(this,"flagmentLayoutConstraintType","AfterIfContinue")}allowLayout(t,i,n){return!(i&&!t||t&&t.overflow)}nextCandidate(t){return!1}postLayout(t,i,n,r){}finishBreak(t,i){return this.getRepetitiveElements().affectTo(t)?this.afterIfContinues.createElement(i,this.nodeContext).thenAsync(n=>(this.nodeContext.viewNode.appendChild(n),P(!0))):P(!0)}getRepetitiveElements(){return new gm(this.nodeContext,this.pseudoElementHeight)}equalsTo(t){return t instanceof Hu?this.afterIfContinues==t.afterIfContinues:!1}getPriorityOfFinishBreak(){return 9}},gm=class{constructor(e,t){this.nodeContext=e,this.pseudoElementHeight=t}calculateOffset(e){return this.affectTo(e)?this.pseudoElementHeight:0}calculateMinimumOffset(e){return this.calculateOffset(e)}affectTo(e){if(!e)return!1;let t=e.shadowContext?e.shadowContext.owner:e.sourceNode;if(t===this.nodeContext.sourceNode)return!!e.after;for(let i=t.parentNode;i;i=i.parentNode)if(i===this.nodeContext.sourceNode)return!0;return!1}};function Uu(e,t){if(!e||!e.afterIfContinues||e.after||t.isFloatNodeContext(e))return P(e);let i=e.afterIfContinues;return i.createElement(t,e).thenAsync(n=>{let r=wm(e,t,n);return t.fragmentLayoutConstraints.push(new fm(e,i,r)),P(e)})}function $u(e,t){return e.thenAsync(i=>Uu(i,t))}function mm(e,t){let i=_("processAfterIfContinuesOfAncestors"),n=e;return i.loop(()=>{if(n!==null){let r=Uu(n,t);return n=n.parent,r.thenReturn(!0)}else return P(!1)}).then(()=>{i.finish(!0)}),i.result()}function wm(e,t,i){let n=e.viewNode;n.appendChild(i);let r=_o(i,t,e.vertical);return n.removeChild(i),r}var bm=class{constructor(e){this.constraints=e}allowLayout(e){return this.constraints.every(t=>t.allowLayout(e))}},po=class extends Ps{constructor(e,t){super(),this.checkPoints=e,this.penalty=t,u(this,"alreadyEvaluated",!1),u(this,"breakNodeContext",null)}findAcceptableBreak(e,t){return t<this.getMinBreakPenalty()?null:(this.alreadyEvaluated||(this.breakNodeContext=e.findBoxBreakPosition(this,t>0),this.alreadyEvaluated=!!this.breakNodeContext||t>0||!!e.pseudoParent),this.breakNodeContext)}getMinBreakPenalty(){return this.penalty}getNodeContext(){return this.alreadyEvaluated?this.breakNodeContext:this.checkPoints[this.checkPoints.length-1]}},Ir=class extends su{constructor(e,t,i,n,r){super(e),this.layoutContext=t,this.clientLayout=i,this.layoutConstraint=n,this.pageFloatLayoutContext=r,u(this,"last"),u(this,"viewDocument"),u(this,"flowRootFormattingContext",null),u(this,"isFloat",!1),u(this,"isFootnote",!1),u(this,"startEdge",0),u(this,"endEdge",0),u(this,"beforeEdge",0),u(this,"afterEdge",0),u(this,"footnoteEdge",0),u(this,"box",null),u(this,"chunkPositions",null),u(this,"bands",null),u(this,"overflown",!1),u(this,"breakPositions",null),u(this,"pageBreakType",null),u(this,"forceNonfitting",!0),u(this,"leftFloatEdge",0),u(this,"rightFloatEdge",0),u(this,"bottommostFloatTop",0),u(this,"stopAtOverflow",!0),u(this,"lastAfterPosition",null),u(this,"fragmentLayoutConstraints",[]),u(this,"pseudoParent",null),u(this,"nodeContextOverflowingDueToRepetitiveElements",null),u(this,"blockDistanceToBlockEndFloats",NaN),u(this,"breakAtTheEdgeBeforeFloat",null),this.last=e.lastChild,this.viewDocument=e.ownerDocument,r.setContainer(this)}getTopEdge(){return this.vertical?this.rtl?this.endEdge:this.startEdge:this.beforeEdge}getBottomEdge(){return this.vertical?this.rtl?this.startEdge:this.endEdge:this.afterEdge}getLeftEdge(){return this.vertical?this.afterEdge:this.rtl?this.endEdge:this.startEdge}getRightEdge(){return this.vertical?this.beforeEdge:this.rtl?this.startEdge:this.endEdge}isFloatNodeContext(e){return!!e.floatSide&&(!this.isFloat||!!e.parent)}stopByOverflow(e){return this.stopAtOverflow&&!!e&&e.overflow}isOverflown(e){return this.vertical?e<this.footnoteEdge:e>this.footnoteEdge}getExclusions(){let e=this.pageFloatLayoutContext.getFloatFragmentExclusions();return this.exclusions.concat(e)}openAllViews(e){let t=_("openAllViews"),i=e.steps;this.layoutContext.setViewRoot(this.element,this.isFootnote);let n=i.length-1,r=null;return t.loop(()=>{for(;n>=0;){let o=r,s=i[n];if(r=kr(s,o),n===i.length-1&&!r.formattingContext&&(r.formattingContext=this.flowRootFormattingContext),n==0&&(r.offsetInNode=this.calculateOffsetInNodeForNodeContext(e),r.after=e.after,r.preprocessedTextContent=e.preprocessedTextContent,r.after))break;let a=this.layoutContext.setCurrent(r,n==0&&r.offsetInNode==0);if(n--,a.isPending())return a}return P(!1)}).then(()=>{t.finish(r)}),t.result()}calculateOffsetInNodeForNodeContext(e){return e.preprocessedTextContent?Tf(e.preprocessedTextContent,e.offsetInNode):e.offsetInNode}maybePeelOff(e,t){var i,n;if(e.firstPseudo&&e.inline&&!e.after&&e.firstPseudo.count==0&&e.viewNode.nodeType!=1){let r=e.viewNode.textContent,o=r.match(mo),s=o?o[0].length:0;if(!o&&((i=e.sourceNode)==null?void 0:i.nodeType)===3&&((n=e.sourceNode.nextSibling)==null?void 0:n.nodeType)===3&&r===e.sourceNode.textContent){let a=r+e.sourceNode.nextSibling.textContent,h=a.match(mo);if(h){let l=h[0];s=l.length,e.sourceNode.textContent=l,e.viewNode.textContent=l,e.sourceNode.nextSibling.textContent=a.substr(s)}}return this.layoutContext.peelOff(e,s)}return P(e)}buildViewToNextBlockEdge(e,t){let i=!1,n=_("buildViewToNextBlockEdge");return n.loopWithFrame(r=>{var o;e.viewNode&&!Li(e)&&((o=e.viewNode.parentElement)==null?void 0:o.namespaceURI)==="http://www.w3.org/1999/xhtml"&&t.push(e.copy()),this.maybePeelOff(e,0).then(s=>{let a=s;a!==e&&(e=a,Li(e)||t.push(e.copy())),this.nextInTree(e).then(h=>{if(e=h,!e){r.breakLoop();return}(i||!this.layoutConstraint.allowLayout(e))&&(i=!0,e=e.modify(),e.overflow=!0),this.isFloatNodeContext(e)&&(zi(e.floatReference)||e.floatSide==="footnote")?this.layoutFloatOrFootnote(e).then(l=>{if(e=l,this.pageFloatLayoutContext.isInvalidated()&&(e=null),!e){r.breakLoop();return}r.continueLoop()}):e.inline?r.continueLoop():r.breakLoop()})})}).then(()=>{n.finish(e)}),n.result()}nextInTree(e,t){let i=this.layoutContext.nextInTree(e,t);return $u(i,this)}buildDeepElementView(e){if(!e.viewNode)return P(e);let t=[],i=e.sourceNode,n=_("buildDeepElementView");return n.loopWithFrame(r=>{e.viewNode&&e.inline&&!Li(e)?t.push(e.copy()):(t.length>0&&this.postLayoutBlock(e,t),t=[]),this.maybePeelOff(e,0).then(o=>{let s=o;if(s!==e){let a=s;for(;a&&a.sourceNode!=i;)a=a.parent;if(a==null){e=s,r.breakLoop();return}Li(s)||t.push(s.copy())}this.nextInTree(s).then(a=>{e=a,!e||e.sourceNode==i?r.breakLoop():this.layoutConstraint.allowLayout(e)?r.continueLoop():(e=e.modify(),e.overflow=!0,this.stopAtOverflow?r.breakLoop():r.continueLoop())})})}).then(()=>{t.length>0&&this.postLayoutBlock(e,t),n.finish(e)}),n.result()}createFloat(e,t,i,n){let r=this.viewDocument.createElement("div");return this.vertical?(n>=this.height&&(n-=.1),n<1&&(n=0),T(r,"height",`${i}px`),T(r,"width",`${n}px`)):(i>=this.width&&(i-=.1),i<1&&(i=0),T(r,"width",`${i}px`),T(r,"height",`${n}px`)),T(r,"float",t),T(r,"clear",t),this.element.insertBefore(r,e),r}killFloats(){let e=this.element.firstChild;for(;e;){let t=e.nextSibling;if(e.nodeType==1){let i=e,n=i.style.cssFloat;if(n=="left"||n=="right"||n==="none")this.element.removeChild(i);else break}e=t}}createFloats(){let e=this.element.firstChild,t=this.bands,i=this.vertical?this.getTopEdge():this.getLeftEdge(),n=this.vertical?this.getBottomEdge():this.getRightEdge(),r=null;for(let o of t){let s=o.y2-o.y1;o.left=this.createFloat(e,"left",o.x1-i,s),o.right=this.createFloat(e,"right",n-o.x2,s),o.x1<n&&o.x2>i?r=o:r||T(o.right,"float","none")}if(r){let o=t[t.length-1],s=this.vertical?-this.getLeftEdge():this.getBottomEdge();r!==o&&o.y2>=s&&(this.footnoteEdge=this.vertical?-r.y2:r.y2)}}calculateEdge(e,t,i,n){let r;if(e&&Ri(e.viewNode))return NaN;if(e&&e.after&&!e.inline&&(r=Fi(e,this.clientLayout,0,this.vertical),!isNaN(r)))return r;e=t[i];let o=n-e.boxOffset;for(;;){if(r=Fi(e,this.clientLayout,o,this.vertical),!isNaN(r))return r;if(o>0){o--;continue}if(i--,i<0)return this.beforeEdge;e=t[i],e.viewNode.nodeType!=1&&(o=e.viewNode.textContent.length)}}parseComputedLength(e){let t=e.match(/^(-?[0-9]*(\.[0-9]*)?)px$/);return t?this.clientLayout.adjustLengthValue(parseFloat(t[0])):0}getComputedMargin(e){let t=this.clientLayout.getElementComputedStyle(e),i=new no(0,0,0,0);return t&&(i.left=this.parseComputedLength(t.marginLeft),i.top=this.parseComputedLength(t.marginTop),i.right=this.parseComputedLength(t.marginRight),i.bottom=this.parseComputedLength(t.marginBottom)),i}getComputedPaddingBorder(e){let t=this.clientLayout.getElementComputedStyle(e),i=new no(0,0,0,0);return t&&(i.left=this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),i.top=this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),i.right=this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),i.bottom=this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)),i}getComputedInsets(e){let t=this.clientLayout.getElementComputedStyle(e),i=new no(0,0,0,0);if(t){if(t.boxSizing=="border-box")return this.getComputedMargin(e);i.left=this.parseComputedLength(t.marginLeft)+this.parseComputedLength(t.borderLeftWidth)+this.parseComputedLength(t.paddingLeft),i.top=this.parseComputedLength(t.marginTop)+this.parseComputedLength(t.borderTopWidth)+this.parseComputedLength(t.paddingTop),i.right=this.parseComputedLength(t.marginRight)+this.parseComputedLength(t.borderRightWidth)+this.parseComputedLength(t.paddingRight),i.bottom=this.parseComputedLength(t.marginBottom)+this.parseComputedLength(t.borderBottomWidth)+this.parseComputedLength(t.paddingBottom)}return i}setComputedInsets(e,t){let i=this.clientLayout.getElementComputedStyle(e);i&&(t.marginLeft=this.parseComputedLength(i.marginLeft),t.borderLeft=this.parseComputedLength(i.borderLeftWidth),t.paddingLeft=this.parseComputedLength(i.paddingLeft),t.marginTop=this.parseComputedLength(i.marginTop),t.borderTop=this.parseComputedLength(i.borderTopWidth),t.paddingTop=this.parseComputedLength(i.paddingTop),t.marginRight=this.parseComputedLength(i.marginRight),t.borderRight=this.parseComputedLength(i.borderRightWidth),t.paddingRight=this.parseComputedLength(i.paddingRight),t.marginBottom=this.parseComputedLength(i.marginBottom),t.borderBottom=this.parseComputedLength(i.borderBottomWidth),t.paddingBottom=this.parseComputedLength(i.paddingBottom))}setComputedWidthAndHeight(e,t){let i=this.clientLayout.getElementComputedStyle(e);i&&(t.width=this.parseComputedLength(i.width),t.height=this.parseComputedLength(i.height))}layoutUnbreakable(e){return this.buildDeepElementView(e)}layoutFloat(e){let t=_("layoutFloat"),i=e.viewNode,n=Wf(e.floatSide,e.vertical,e.direction);return T(i,"float","none"),T(i,"display","inline-block"),T(i,"vertical-align","top"),this.buildDeepElementView(e).then(r=>{let o=this.clientLayout.getElementClientRect(i),s=this.getComputedMargin(i),a=new ht(o.left-s.left,o.top-s.top,o.right+s.right,o.bottom+s.bottom),h=this.rtl?this.endEdge:this.startEdge,l=this.rtl?this.startEdge:this.endEdge,c=e.parent;for(;c&&c.inline;)c=c.parent;if(c){let S=c.viewNode.ownerDocument.createElement("div");S.style.left="0px",S.style.top="0px",this.vertical?(S.style.bottom="0px",S.style.width="1px"):(S.style.right="0px",S.style.height="1px"),c.viewNode.appendChild(S);let L=this.clientLayout.getElementClientRect(S);h=Math.max(this.rtl?this.getEndEdge(L):this.getStartEdge(L),h),l=Math.min(this.rtl?this.getStartEdge(L):this.getEndEdge(L),l),c.viewNode.removeChild(S);let B=this.vertical?a.y2-a.y1:a.x2-a.x1;n=="left"?l=Math.max(l,h+B):h=Math.min(h,l-B),c!==e.parent&&!e.firstPseudo&&(c.viewNode.appendChild(i),i.setAttribute("data-vivliostyle-float-box-moved","true"))}let p=new ht(h,this.getBoxDir()*this.beforeEdge,l,this.getBoxDir()*this.afterEdge),d=a;this.vertical&&(d=xr(a));let f=this.getBoxDir();if(d.y1<this.bottommostFloatTop*f){let S=d.y2-d.y1;d.y1=this.bottommostFloatTop*f,d.y2=d.y1+S}gp(p,this.bands,d,n),this.vertical&&(a=Sh(d));let g=this.getComputedInsets(i);T(i,"width",`${a.x2-a.x1-g.left-g.right}px`),T(i,"height",`${a.y2-a.y1-g.top-g.bottom}px`),T(i,"position","absolute"),e.display,T(i,"display",e.display);let m,v=null;if(c&&(c.containingBlockForAbsolute?v=c:v=c.getContainingBlockForAbsolute()),v){let S=v.viewNode.ownerDocument.createElement("div");S.style.position="absolute",v.vertical?S.style.right="0":S.style.left="0",S.style.top="0",v.viewNode.appendChild(S),m=this.clientLayout.getElementClientRect(S),v.viewNode.removeChild(S)}else m={left:this.getLeftEdge()-this.paddingLeft,right:this.getRightEdge()+this.paddingRight,top:this.getTopEdge()-this.paddingTop};(v?v.vertical:this.vertical)?T(i,"right",`${m.right-a.x2}px`):T(i,"left",`${a.x1-m.left}px`),T(i,"top",`${a.y1-m.top}px`),e.clearSpacer&&(e.clearSpacer.parentNode.removeChild(e.clearSpacer),e.clearSpacer=null);let b=this.vertical?a.x1:a.y2,w=this.vertical?a.x2:a.y1;!this.isOverflown(b)||this.breakPositions.length==0?(this.killFloats(),p=new ht(this.getLeftEdge(),this.getTopEdge(),this.getRightEdge(),this.getBottomEdge()),this.vertical&&(p=xr(p)),mp(p,this.bands,d,null,n),this.createFloats(),n=="left"?this.leftFloatEdge=b:this.rightFloatEdge=b,this.bottommostFloatTop=w,this.updateMaxReachedAfterEdge(b),t.finish(r)):(e=e.modify(),e.overflow=!0,t.finish(e))}),t.result()}setupFloatArea(e,t,i,n,r,o){let s=this.pageFloatLayoutContext,a=s.getContainer(t),h=e.element;a.element.parentNode.appendChild(h),e.isFloat=!0,e.originX=a.originX,e.originY=a.originY,e.vertical=a.vertical,e.rtl=a.rtl,e.marginLeft=e.marginRight=e.marginTop=e.marginBottom=0,e.borderLeft=e.borderRight=e.borderTop=e.borderBottom=0,e.paddingLeft=e.paddingRight=e.paddingTop=e.paddingBottom=0,e.exclusions=(a.exclusions||[]).concat(),e.forceNonfitting=!s.hasFloatFragments(),e.innerShape=null;let l=a.getPaddingRect();e.setHorizontalPosition(l.x1-a.originX,l.x2-l.x1),e.setVerticalPosition(l.y1-a.originY,l.y2-l.y1),r.adjustPageFloatArea(e,a,this),e.init();let c=!!s.setFloatAreaDimensions(e,t,i,n,!0,!s.hasFloatFragments(),o);return c?(e.killFloats(),e.init()):a.element.parentNode.removeChild(h),c}createPageFloatArea(e,t,i,n,r){let o=this.element.ownerDocument.createElement("div");T(o,"position","absolute");let s=this.pageFloatLayoutContext.getPageFloatLayoutContext(e.floatReference),a=new cn(null,Be.COLUMN,null,this.pageFloatLayoutContext.flowName,e.nodePosition,null,null),h=s.getContainer(),l=new ym(t,o,this.layoutContext.clone(),this.clientLayout,this.layoutConstraint,a,h);return a.setContainer(l),this.setupFloatArea(l,e.floatReference,t,i,n,r)?l:null}layoutSinglePageFloatFragment(e,t,i,n,r,o,s){let a=this.pageFloatLayoutContext;e=(s?s.continuations:[]).concat(e);let h=e[0].float,l=a.getPageFloatPlacementCondition(h,t,i),c=this.createPageFloatArea(h,t,o,r,l),p={floatArea:c,pageFloatFragment:null,newPosition:null};if(!c)return P(p);let d=_("layoutSinglePageFloatFragment"),f=!1,g=0;return d.loopWithFrame(m=>{if(g>=e.length){m.breakLoop();return}let v=e[g],b=new Qt(v.nodePosition);c.layout(b,!0).then(w=>{p.newPosition=w,!w||n?(g++,m.continueLoop()):(f=!0,m.breakLoop())})}).then(()=>{if(!f){let m=a.setFloatAreaDimensions(c,h.floatReference,t,o,!1,n,l);if(!m)f=!0;else{let v=r.createPageFloatFragment(e,m,c,!!p.newPosition);a.addPageFloatFragment(v,!0),p.pageFloatFragment=v}}d.finish(p)}),d.result()}layoutPageFloatInner(e,t,i,n){let r=this.pageFloatLayoutContext,o=e.float;r.stashEndFloatFragments(o);function s(h,l){l?r.removePageFloatFragment(l,!0):h&&h.element.parentNode.removeChild(h.element),r.restoreStashedFragments(o.floatReference),r.deferPageFloat(e)}let a=_("layoutPageFloatInner");return this.layoutSinglePageFloatFragment([e],o.floatSide,o.clearSide,!r.hasFloatFragments(),t,i,n).then(h=>{let l=h.floatArea,c=h.pageFloatFragment,p=h.newPosition;c?this.layoutStashedPageFloats(o.floatReference,[n]).then(d=>{if(d){if(r.addPageFloatFragment(c),r.discardStashedFragments(o.floatReference),p){let f=new Va(o,p.primary);r.deferPageFloat(f)}a.finish(!0)}else s(l,c),a.finish(!1)}):(s(l,c),a.finish(!1))}),a.result()}layoutStashedPageFloats(e,t){let i=this.pageFloatLayoutContext,n=i.getStashedFloatFragments(e),r=[],o=[],s=!1,a=_("layoutStashedPageFloats"),h=0;return a.loopWithFrame(l=>{if(h>=n.length){l.breakLoop();return}let c=n[h];if(t.includes(c)){h++,l.continueLoop();return}let p=new Gi().findByFloat(c.continuations[0].float);this.layoutSinglePageFloatFragment(c.continuations,c.floatSide,null,!1,p,null).then(d=>{let f=d.floatArea;f&&r.push(f);let g=d.pageFloatFragment;g?(o.push(g),h++,l.continueLoop()):(s=!0,l.breakLoop())})}).then(()=>{s?(o.forEach(l=>{i.removePageFloatFragment(l,!0)}),r.forEach(l=>{let c=l.element;c&&c.parentNode&&c.parentNode.removeChild(c)})):n.forEach(l=>{let c=l.area.element;c&&c.parentNode&&c.parentNode.removeChild(c)}),a.finish(!s)}),a.result()}setFloatAnchorViewNode(e){let t=e.viewNode.parentNode,i=t.ownerDocument.createElement("span");i.setAttribute(Wi,"1"),e.floatSide==="footnote"&&this.layoutContext.applyPseudoelementStyle(e,"footnote-call",i),t.appendChild(i),t.removeChild(e.viewNode);let n=e.modify();return n.after=!0,n.viewNode=i,n}resolveFloatReferenceFromColumnSpan(e,t,i){let n=_("resolveFloatReferenceFromColumnSpan"),r=this.pageFloatLayoutContext,o=r.getPageFloatLayoutContext(Be.REGION);return r.getContainer().width<o.getContainer().width&&e===Be.COLUMN?t===x.auto?this.buildDeepElementView(i.copy()).then(s=>{let a=s.viewNode,h=Ss(this.clientLayout,a,["min-content inline size"])["min-content inline size"],l=this.getComputedMargin(a);this.vertical?h+=l.top+l.bottom:h+=l.left+l.right,h>this.width?n.finish(Be.REGION):n.finish(e)}):t===x.all?n.finish(Be.REGION):n.finish(e):n.finish(e),n.result()}layoutPageFloat(e){let t=this.pageFloatLayoutContext,i=new Gi().findByNodeContext(e),n,r=t.findPageFloatByNodePosition(e.toNodePosition());return r?n=P(r):n=i.createPageFloat(e,t,this),n.thenAsync(o=>{let s=Er(e,0),a=this.setFloatAnchorViewNode(e),h=i.findPageFloatFragment(o,t),l=new Va(o,s);if(h&&h.hasFloat(o))return t.registerPageFloatAnchor(o,a.viewNode),P(a);if(t.isForbidden(o)||t.hasPrecedingFloatsDeferredToNext(o))return t.deferPageFloat(l),t.registerPageFloatAnchor(o,a.viewNode),P(a);if(this.nodeContextOverflowingDueToRepetitiveElements)return P(null);{let c=Fi(a,this.clientLayout,0,this.vertical);return this.isOverflown(c)?P(a):this.layoutPageFloatInner(l,i,c,h).thenAsync(p=>p?P(null):(t.registerPageFloatAnchor(o,a.viewNode),P(a)))}})}processLineStyling(e,t,i){let n=_("processLineStyling"),r=i.concat([]);i.splice(0,i.length);let o=0,s=e.firstPseudo;return s.count==0&&(s=s.outer),n.loopWithFrame(a=>{if(!s){a.breakLoop();return}let h=this.findLinePositions(r),l=s.count-o;if(h.length<=l){a.breakLoop();return}let c=this.findAcceptableBreakInside(r,h[l-1],!0);if(c==null){a.breakLoop();return}this.finishBreak(c,!1,!1).then(()=>{o+=l,this.layoutContext.peelOff(c,0).then(p=>{e=p,s=e.firstPseudo,r=[],this.buildViewToNextBlockEdge(e,r).then(d=>{t=d,a.continueLoop()})})})}).then(()=>{Array.prototype.push.apply(i,r),n.finish(t)}),n.result()}isLoneImage(e){return e.length!=2&&this.breakPositions.length>0?!1:e[0].sourceNode==e[1].sourceNode&&li[e[0].sourceNode.localName]}getTrailingMarginEdgeAdjustment(e){let t=0,i=0;for(let n=e.length-1;n>=0;n--){let r=e[n];if(!r.after||!r.viewNode||r.viewNode.nodeType!=1)break;let o=this.getComputedMargin(r.viewNode),s=this.vertical?-o.left:o.bottom;s>0?t=Math.max(t,s):i=Math.min(i,s)}return t+i}layoutBreakableBlock(e){let t=_("layoutBreakableBlock"),i=[];return this.buildViewToNextBlockEdge(e,i).then(n=>{let r=i.length-1;if(r<0){t.finish(n);return}this.postLayoutBlock(n,i);let o=this.calculateEdge(n,i,r,i[r].boxOffset),s=!1;if(!n||!Ri(n.viewNode)){let h=Di(n,this.collectElementsOffset());s=this.isOverflown(o+(this.vertical?-1:1)*h.minimum),this.isOverflown(o+(this.vertical?-1:1)*h.current)&&!this.nodeContextOverflowingDueToRepetitiveElements&&(this.nodeContextOverflowingDueToRepetitiveElements=n)}n==null&&(o+=this.getTrailingMarginEdgeAdjustment(i)),this.updateMaxReachedAfterEdge(o);let a;e.firstPseudo?a=this.processLineStyling(e,n,i):a=P(n),a.then(h=>{i.length>0&&(this.saveBoxBreakPosition(i),s&&!this.isLoneImage(i)&&h&&(h=h.modify(),h.overflow=!0)),t.finish(h)})}),t.result()}postLayoutBlock(e,t){xt("POST_LAYOUT_BLOCK").forEach(i=>{i(e,t,this)})}findEndOfLine(e,t,i){let n=this.vertical?e-1:e+1,r=0,o=t[0].boxOffset,s=r,a=t.length-1,h=t[a].boxOffset,l;for(;o<h;){l=o+Math.ceil((h-o)/2),s=r;let c=a;for(;s<c;){let d=s+Math.ceil((c-s)/2);t[d].boxOffset>l?c=d-1:s=d}let p=this.calculateEdge(null,t,s,l);if(this.vertical?p<=n:p>=n){for(h=l-1;t[s].boxOffset==l;)s--;a=s}else i&&this.updateMaxReachedAfterEdge(p),o=l,r=s}return{nodeContext:t[s],index:o,checkPointIndex:s}}findAcceptableBreakInside(e,t,i){var n,r;let o=this.findEndOfLine(t,e,!0),s=o.nodeContext;if(o.checkPointIndex===0&&o.index===s.boxOffset)return null;let a=s.viewNode;if(a.nodeType!=1&&((n=a.parentElement)==null?void 0:n.localName)!=="viv-ts-inner"){let h=a;s=this.resolveTextNodeBreaker(s).breakTextNode(h,s,o.index,e,o.checkPointIndex,i)}else{let h=Wa(s);if(h){if(((r=this.breakPositions)==null?void 0:r[0])instanceof po&&h!=null&&h.viewNode.contains(this.breakPositions[0].checkPoints[0].viewNode))return null;s=h}}return this.clearOverflownViewNodes(s,!1),s}resolveTextNodeBreaker(e){return xt("RESOLVE_TEXT_NODE_BREAKER").reduce((t,i)=>i(e)||t,Fr.instance)}getRangeBoxes(e,t){let i=[],n=e.ownerDocument.createRange(),r=!1,o=e,s=null,a=!1,h=!0;for(;h;){let l=!0;do{let c=null;o==t&&(t.nodeType===1?h=!(!t.firstChild||r):h=!1);let p=o.nodeType===1?o:null;p?r?r=!1:ks(p)?l=!a:!p.firstChild||li[p.localName]||/^r(uby|[bt]c?)$/.test(p.localName)||eg(this.clientLayout.getElementComputedStyle(p).display)?(l=!a,l?(p.localName==="ruby"&&o.firstChild&&(o=o.firstChild),n.setStartBefore(o),a=!0,s=o):p.localName!=="ruby"&&(s=o),o.contains(t)&&(h=!1)):c=o.firstChild:(a||(o.parentNode==null?h=!1:(n.setStartBefore(o),a=!0)),s=o),c||(c=o.nextSibling,c||(r=!0,c=o.parentNode)),o=c}while(l&&h);if(a){n.setEndAfter(s);let c=this.clientLayout.getRangeClientRects(n);for(let p=0;p<c.length;p++)i.push(c[p]);a=!1}}return i}findLinePositions(e){let t=[],i=this.getRangeBoxes(e[0].viewNode,e[e.length-1].viewNode);i.sort(this.vertical?Mf:_f);let n=0,r=0,o=0,s=0,a=0,h=this.getBoxDir();for(;;){if(a<i.length){let l=i[a],c=1;if(s>0){let p=Math.max(this.getBoxSize(l),1);h*this.getBeforeEdge(l)<h*n?c=h*(this.getAfterEdge(l)-n)/p:h*this.getAfterEdge(l)>h*r?c=h*(r-this.getBeforeEdge(l))/p:c=1}if(s==0||c>=.6||c>=.2&&this.getStartEdge(l)>=o-1){o=this.getEndEdge(l),this.vertical?(n=s==0?l.right:Math.max(n,l.right),r=s==0?l.left:Math.min(r,l.left)):(n=s==0?l.top:Math.min(n,l.top),r=s==0?l.bottom:Math.max(r,l.bottom)),s++,a++;continue}}if(s>0&&(t.push(r),s=0),a>=i.length)break}return t.sort(Xl),this.vertical&&t.reverse(),t}calculateClonedPaddingBorder(e){let t=0;for(let i=e;i;i=i.parent)if(!i.inline&&ln(i.viewNode)){let n=this.getComputedPaddingBorder(i.viewNode);t+=i.vertical?-n.left:n.bottom,i.display==="table"&&(t+=(i.vertical?-1:1)*i.blockBorderSpacing)}return t}getOffsetByRepetitiveElements(e){let t;return e?t=e.calculateOffset(this):t=Di(null,this.collectElementsOffset()),t.current}findBoxBreakPosition(e,t){let i=this.element.parentNode,n=this.element.nextSibling;i.removeChild(this.element),i.insertBefore(this.element,n);let r=e.checkPoints,o=r[0];for(;o.parent&&o.inline;)o=o.parent;let s,a;t?(s=1,a=1):(s=Math.max((o.inheritedProps.widows||2)-0,1),a=Math.max((o.inheritedProps.orphans||2)-0,1));let h=this.calculateClonedPaddingBorder(o),l=this.findLinePositions(r),c=this.footnoteEdge-h,p=this.getBoxDir(),d=this.getOffsetByRepetitiveElements(e);c-=p*d;let f=this.findFirstOverflowingEdgeAndCheckPoint(r);isNaN(f.edge)&&(f.edge=p*(1/0));let g=Yt(l.length,w=>{let S=l[w];return this.vertical?S<c||S<=f.edge:S>c||S>=f.edge}),m=g<=0;m&&(g=Yt(l.length,w=>this.vertical?l[w]<c:l[w]>c));let v=r[r.length-1].viewNode;if(v?.parentElement.localName==="viv-ts-inner"&&(v=v.parentElement.parentElement),(g===l.length&&v.nextSibling||g>=l.length-1&&v.parentElement.querySelector(".MJXc-display"))&&(s=0),g=Math.min(l.length-s,g),g<a)return null;c=l[g-1];let b;if(m?b=f.checkPoint:b=this.findAcceptableBreakInside(e.checkPoints,c,t),b){let w=this.getAfterEdgeOfBlockContainer(b);!isNaN(w)&&w<c&&(c=w),this.computedBlockSize=p*(c-this.beforeEdge)+d}return b}getAfterEdgeOfBlockContainer(e){let t=e;do t=t.parent;while(t&&t.inline);return t?(t=t.copy().modify(),t.after=!0,Fi(t,this.clientLayout,0,this.vertical)):NaN}findFirstOverflowingEdgeAndCheckPoint(e){let t=e.findIndex(n=>n.overflow);if(t<0)return{edge:NaN,checkPoint:null};let i=e[t];return{edge:this.calculateEdge(null,e,t,i.boxOffset),checkPoint:i}}findEdgeBreakPosition(e){return this.computedBlockSize=e.computedBlockSize+this.getOffsetByRepetitiveElements(e),e.position}finishBreak(e,t,i){e.formattingContext;let n=new on().find(e.formattingContext).finishBreak(this,e,t,i);return n||(n=Ts.finishBreak(this,e,t,i)),n}findAcceptableBreakPosition(){let e=null,t=null,i=0,n=0;do{i=n,n=Number.MAX_VALUE;for(let r=this.breakPositions.length-1;r>=0&&!t;--r){e=this.breakPositions[r],t=e.findAcceptableBreak(this,i);let o=e.getMinBreakPenalty();o>i&&(n=Math.min(n,o))}}while(n>i&&!t&&this.forceNonfitting);return{breakPosition:t?e:null,nodeContext:t}}doFinishBreak(e,t,i,n){if(this.pageFloatLayoutContext.isInvalidated()||this.pageBreakType||!t)return P(e);let r=_("doFinishBreak"),o=!1;if(!e){if(this.forceNonfitting)return U.warn("Could not find any page breaks?!!"),this.skipTailEdges(t).then(s=>{s?(s=s.modify(),s.overflow=!1,this.finishBreak(s,o,!0).then(()=>{r.finish(s)})):r.finish(s)}),r.result();e=i,o=!0,this.computedBlockSize=n}return this.finishBreak(e,o,!0).then(()=>{r.finish(e)}),r.result()}isBreakable(e){if(e.after)return!0;switch(e.sourceNode.namespaceURI){case"http://www.w3.org/2000/svg":return!1}return!e.flexContainer}zeroIndent(e){let t=e.toString();return t==""||t=="auto"||!!t.match(/^0+(.0*)?[^0-9]/)}checkOverflowAndSaveEdge(e,t){if(!e||Ri(e.viewNode))return!1;let i=Fi(e,this.clientLayout,0,this.vertical),n=Di(e,this.collectElementsOffset()),r=this.isOverflown(i+(this.vertical?-1:1)*n.minimum);if(this.isOverflown(i+(this.vertical?-1:1)*n.current)&&!this.nodeContextOverflowingDueToRepetitiveElements)this.nodeContextOverflowingDueToRepetitiveElements=e;else if(t){let o=i+this.getTrailingMarginEdgeAdjustment(t),s=this.footnoteEdge-this.getBoxDir()*n.current;i=this.vertical?Math.min(i,Math.max(o,s)):Math.max(i,Math.min(o,s))}return this.updateMaxReachedAfterEdge(i),r}checkOverflowAndSaveEdgeAndBreakPosition(e,t,i,n){if(!e||Ri(e.viewNode))return!1;let r=this.checkOverflowAndSaveEdge(e,t);return(i||!r)&&this.saveEdgeBreakPosition(e,n,r),r}applyClearance(e){if(!e.viewNode.parentNode)return!1;let t=this.getComputedMargin(e.viewNode),i=e.viewNode.ownerDocument.createElement("div");this.vertical?(i.style.bottom="0px",i.style.width="1px",i.style.marginRight=`${t.right}px`):(i.style.right="0px",i.style.height="1px",i.style.marginTop=`${t.top}px`),e.viewNode.parentNode.insertBefore(i,e.viewNode);let n=this.clientLayout.getElementClientRect(i),r=this.getBeforeEdge(n),o=this.getBoxDir(),s=e.clearSide,a=-this.getBoxDir()*(1/0);switch(s==="all"&&(a=this.pageFloatLayoutContext.getPageFloatClearEdge(s,this)),s){case"left":a=o*Math.max(a*o,this.leftFloatEdge*o);break;case"right":a=o*Math.max(a*o,this.rightFloatEdge*o);break;default:a=o*Math.max(a*o,Math.max(this.rightFloatEdge*o,this.leftFloatEdge*o))}if(r*o>=a*o)return e.viewNode.parentNode.removeChild(i),!1;{let h=Math.max(1,(a-r)*o);this.vertical?i.style.width=`${h}px`:i.style.height=`${h}px`,n=this.clientLayout.getElementClientRect(i);let l=this.getAfterEdge(n);if(!e.floatSide)if(this.vertical){let c=l+t.right-a;c>0==t.right>=0&&(c+=t.right),i.style.marginLeft=`${c}px`}else{let c=a-(l+t.top);c>0==t.top>=0&&(c+=t.top),i.style.marginBottom=`${c}px`}return e.clearSpacer=i,!0}}isBFC(e){return!!(tg(e)||ui.isInstanceOfRepetitiveElementsOwnerFormattingContext(e))}skipEdges(e,t,i){var n;let r=e.after?(n=e.parent)==null?void 0:n.formattingContext:e.formattingContext;if(r&&!this.isBFC(r))return P(e);let o=_("skipEdges"),s=!i&&t&&e&&e.after,a=i,h=null,l=[],c=[],p=!1;function d(){return!!i||!t&&it(a)&&!f()}function f(){var m;if(!h||e.floatSide)return!1;for(let v=h;v!=null&&v.parent;v=v.parent){let b=v.after?v.viewNode:(m=v.viewNode)==null?void 0:m.previousSibling;for(;b&&(je(b,v.parent.whitespace)||fu(b));)b=b.previousSibling;if(b)return!1}return!0}let g=()=>{e=l[0]||e,e.viewNode.parentNode.removeChild(e.viewNode),this.pageBreakType=a};return o.loopWithFrame(m=>{for(var v;e;){e.formattingContext;let b=new on().find(e.formattingContext);do{if(!e.viewNode)break;if(e.inline&&e.viewNode.nodeType!=1){if(je(e.viewNode,e.whitespace))break;if(!e.after){d()?g():this.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!0,a)?(e=(this.stopAtOverflow&&h||e).modify(),e.overflow=!0):(e=e.modify(),e.breakBefore=a),m.breakLoop();return}}if(!e.after){if(e.floatSide&&(this.breakAtTheEdgeBeforeFloat=Sr(a)?a:null),b&&b.startNonInlineElementNode(e))break;if(e.clearSide&&this.applyClearance(e)&&t&&this.breakPositions.length===0&&this.saveEdgeBreakPosition(e.copy(),a,!1),!e.inline&&!e.repeatOnBreak&&(h?Wa(h):this.breakPositions[this.breakPositions.length-1]instanceof po)&&this.saveEdgeBreakPosition(e.copy(),a,!1),!this.isBFC(e.formattingContext)||ui.isInstanceOfRepetitiveElementsOwnerFormattingContext(e.formattingContext)||this.isFloatNodeContext(e)||e.flexContainer||!e.nodeShadow&&!e.sourceNode.firstElementChild&&je(e.sourceNode.firstChild,e.whitespace)){l.push(e.copy()),a=Je(a,e.breakBefore),d()?g():(this.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!0,a)||!this.layoutConstraint.allowLayout(e))&&(e=(this.stopAtOverflow&&h||e).modify(),e.overflow=!0),m.breakLoop();return}}if(e.viewNode.nodeType!=1)break;let S=e.viewNode.style;if(e.after){e.floatSide&&(a=a??this.breakAtTheEdgeBeforeFloat,this.breakAtTheEdgeBeforeFloat=null);let L=e.sourceNode;if(L.localName==="svg"||L.localName==="math"||L.getAttribute("data-math-typeset")==="true"){p=!1,h=e.copy(),c.push(h),a=Je(null,e.breakAfter),this.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!this.stopAtOverflow,a);break}if(e.inline||b&&b.afterNonInlineElementNode(e,this.stopAtOverflow))break;if(p){if(d()){g(),m.breakLoop();return}l=[],t=!1,s=!1,a=null}p=!1,h=e.copy(),c.push(h),a=Je(a,e.breakAfter),S&&!(this.zeroIndent(S.paddingBottom)&&this.zeroIndent(S.borderBottomWidth))&&(c=[h])}else{if(l.push(e.copy()),a=Je(a,e.breakBefore),(e.pageType!=((v=e.parent)==null?void 0:v.pageType)||!it(a))&&!this.layoutConstraint.allowLayout(e)&&(this.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!this.stopAtOverflow,a),e=e.modify(),e.overflow=!0,this.stopAtOverflow)){m.breakLoop();return}let L=e.viewNode.localName;if(li[L]){d()?g():this.checkOverflowAndSaveEdgeAndBreakPosition(h,null,!0,a)&&(e=(this.stopAtOverflow&&h||e).modify(),e.overflow=!0),m.breakLoop();return}S&&!(this.zeroIndent(S.paddingTop)&&this.zeroIndent(S.borderTopWidth))&&(s=!1,c=[]),p=!0}}while(!1);let w=this.nextInTree(e,s);if(w.isPending()){w.then(S=>{e=S,m.continueLoop()});return}else e=w.get()}this.checkOverflowAndSaveEdgeAndBreakPosition(h,c,!this.stopAtOverflow,a)?h&&this.stopAtOverflow&&(e=h.modify(),e.overflow=!0):it(a)&&(this.pageBreakType=a),m.breakLoop()}).then(()=>{h&&(this.lastAfterPosition=h.toNodePosition()),o.finish(e)}),o.result()}skipTailEdges(e){let t=e.copy(),i=_("skipEdges"),n=null,r=!1;return i.loopWithFrame(o=>{for(;e;){do{if(!e.viewNode)break;if(e.inline&&e.viewNode.nodeType!=1){if(je(e.viewNode,e.whitespace))break;if(!e.after){it(n)&&(this.pageBreakType=n),o.breakLoop();return}}if(!e.after&&(this.isFloatNodeContext(e)||e.flexContainer)){n=Je(n,e.breakBefore),it(n)&&(this.pageBreakType=n),o.breakLoop();return}if(e.viewNode.nodeType!=1)break;let a=e.viewNode.style;if(e.after){if(r){if(it(n)){this.pageBreakType=n,o.breakLoop();return}n=null}r=!1,n=Je(n,e.breakAfter)}else{n=Je(n,e.breakBefore);let h=e.viewNode.localName;if(li[h]){it(n)&&(this.pageBreakType=n),o.breakLoop();return}if(a&&!(this.zeroIndent(a.paddingTop)&&this.zeroIndent(a.borderTopWidth))){o.breakLoop();return}}r=!0}while(!1);let s=this.layoutContext.nextInTree(e);if(s.isPending()){s.then(a=>{e=a,o.continueLoop()});return}else e=s.get()}t=null,o.breakLoop()}).then(()=>{i.finish(t)}),i.result()}layoutFloatOrFootnote(e){return zi(e.floatReference)||e.floatSide==="footnote"?this.layoutPageFloat(e):this.layoutFloat(e)}layoutNext(e,t,i){let n=_("layoutNext");return this.skipEdges(e,t,i||null).then(r=>{if(e=r,!e||this.pageBreakType||this.stopByOverflow(e))n.finish(e);else{let o=e.formattingContext;new on().find(o).layout(e,this,t).thenFinish(n)}}),n.result()}clearOverflownViewNodes(e,t){if(e)for(let i=e.parent;e;e=i,i=i?i.parent:null){let n=(i||e).formattingContext;new on().find(n).clearOverflownViewNodes(this,i,e,t),t=!1}}initGeom(){let e=this.element.ownerDocument.createElement("div");e.style.position="absolute",e.style.top=`${this.paddingTop}px`,e.style.right=`${this.paddingRight}px`,e.style.bottom=`${this.paddingBottom}px`,e.style.left=`${this.paddingLeft}px`,this.element.appendChild(e);let t=this.clientLayout.getElementClientRect(e);this.element.removeChild(e);let i=this.originX+this.left+this.getInsetLeft(),n=this.originY+this.top+this.getInsetTop();this.box=new ht(i,n,i+this.width,n+this.height),this.startEdge=t?this.vertical?this.rtl?t.bottom:t.top:this.rtl?t.right:t.left:0,this.endEdge=t?this.vertical?this.rtl?t.top:t.bottom:this.rtl?t.left:t.right:0,this.beforeEdge=t?this.vertical?t.right:t.top:0,this.afterEdge=t?this.vertical?t.left:t.bottom:0,this.leftFloatEdge=this.beforeEdge,this.rightFloatEdge=this.beforeEdge,this.bottommostFloatTop=this.beforeEdge,this.footnoteEdge=this.afterEdge,this.bands=dp(this.box,[this.getInnerShape()],this.getExclusions(),8,this.snapHeight,this.vertical),this.createFloats()}init(){this.chunkPositions=[],T(this.element,"width",`${this.width}px`),T(this.element,"height",`${this.height}px`),this.initGeom(),this.computedBlockSize=0,this.overflown=!1,this.pageBreakType=null,this.lastAfterPosition=null}saveEdgeBreakPosition(e,t,i){e.formattingContext;let n=e.copy(),r=new on().find(e.formattingContext),o=this.calculateClonedPaddingBorder(n),s=r.createEdgeBreakPosition(n,t,i,this.computedBlockSize+o);this.breakPositions.push(s)}saveBoxBreakPosition(e){let t=e[0].breakPenalty;if(t){let n=e[0];for(;n.parent&&n.inline;)n=n.parent;t=n.breakPenalty}let i=new po(e,t);this.breakPositions.push(i)}updateMaxReachedAfterEdge(e){if(!isNaN(e)){let t=this.getBoxDir()*(e-this.beforeEdge);this.computedBlockSize=Math.max(t,this.computedBlockSize)}}layout(e,t,i){if(this.chunkPositions.push(e),e.primary.after&&(this.lastAfterPosition=e.primary),this.stopAtOverflow&&this.overflown)return P(e);if(this.isFullWithPageFloats())return e.primary.after&&e.primary.steps.length===1?P(null):P(e);let n=_("layout");return this.openAllViews(e.primary).then(r=>{let o=null;if(r.viewNode)o=r.copy();else{let a=h=>{h.nodeContext.viewNode&&(o=h.nodeContext,this.layoutContext.removeEventListener("nextInTree",a))};this.layoutContext.addEventListener("nextInTree",a)}let s=new vm(t,i);s.layout(r,this).then(a=>{this.doFinishBreak(a,s.context.overflownNodeContext,o,s.initialComputedBlockSize).then(h=>{let l=null;this.pseudoParent?l=P(null):l=this.doFinishBreakOfFragmentLayoutConstraints(h),l.then(()=>{if(this.pageFloatLayoutContext.isInvalidated()){n.finish(null);return}if(!h)n.finish(null);else{this.overflown=!0;let c=new Qt(h.toNodePosition());n.finish(c)}})})})}),n.result()}isFullWithPageFloats(){return this.pageFloatLayoutContext.isColumnFullWithPageFloats(this)}getMaxBlockSizeOfPageFloats(){return this.pageFloatLayoutContext.getMaxBlockSizeOfPageFloats()}doFinishBreakOfFragmentLayoutConstraints(e){let t=_("doFinishBreakOfFragmentLayoutConstraints"),i=[].concat(this.fragmentLayoutConstraints);i.sort((r,o)=>r.getPriorityOfFinishBreak()-o.getPriorityOfFinishBreak());let n=0;return t.loop(()=>n<i.length?i[n++].finishBreak(e,this).thenReturn(!0):P(!1)).then(()=>{t.finish(!0)}),t.result()}doLayout(e,t,i){let n=_("doLayout"),r=null;return this.breakPositions=[],this.nodeContextOverflowingDueToRepetitiveElements=null,n.loopWithFrame(o=>{for(;e;){let s=!0;if(this.layoutNext(e,t,i||null).then(a=>{if(t=!1,i=null,this.nodeContextOverflowingDueToRepetitiveElements&&this.stopAtOverflow?(this.pageBreakType=null,e=this.nodeContextOverflowingDueToRepetitiveElements,e.overflow=!0):e=a,this.pageFloatLayoutContext.isInvalidated())o.breakLoop();else if(this.pageBreakType)o.breakLoop();else if(e&&this.stopByOverflow(e)){r=e;let h=this.findAcceptableBreakPosition();e=h.nodeContext,h.breakPosition&&h.breakPosition.breakPositionChosen(this),o.breakLoop()}else s?s=!1:o.continueLoop()}),s){s=!1;return}}this.computedBlockSize+=this.getOffsetByRepetitiveElements(),o.breakLoop()}).then(()=>{n.finish({nodeContext:e,overflownNodeContext:r})}),n.result()}redoLayout(){let e=this.chunkPositions,t=this.element.lastChild;for(;t!=this.last;){let s=t.previousSibling;this.element===t.parentNode&&this.layoutContext.isPseudoelement(t)||this.element.removeChild(t),t=s}this.killFloats(),this.init();let i=_("redoLayout"),n=0,r=null,o=!0;return i.loopWithFrame(s=>{if(n<e.length){let a=e[n++];this.layout(a,o).then(h=>{o=!1,h?(r=h,s.breakLoop()):s.continueLoop()});return}s.breakLoop()}).then(()=>{i.finish(r)}),i.result()}saveDistanceToBlockEndFloats(){let e=this.pageFloatLayoutContext.getBlockStartEdgeOfBlockEndFloats();e>0&&isFinite(e)&&(this.blockDistanceToBlockEndFloats=this.getBoxDir()*(e-this.beforeEdge-this.computedBlockSize))}collectElementsOffset(){let e=[];for(let t=this;t;t=t.pseudoParent)t.fragmentLayoutConstraints.forEach(i=>{if(ui.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(i)){let n=i.getRepetitiveElements();e.push(n)}if(Cr.isInstanceOfAfterIfContinuesLayoutConstraint(i)){let n=i.getRepetitiveElements();e.push(n)}Kt.isInstanceOfTableRowLayoutConstraint(i)&&i.getElementsOffsetsForTableCell(this).forEach(n=>{e.push(n)})});return e}},_s=class{constructor(e,t,i){u(this,"startNodeContexts",[]),u(this,"column"),this.column=Object.create(e),this.column.element=t,this.column.layoutContext=e.layoutContext.clone(),this.column.stopAtOverflow=!1,this.column.flowRootFormattingContext=i.formattingContext,this.column.pseudoParent=e;let n=this.column.calculateClonedPaddingBorder(i);this.column.footnoteEdge=this.column.footnoteEdge-n;let r=this;this.column.openAllViews=function(o){return Ir.prototype.openAllViews.call(this,o).thenAsync(s=>(r.startNodeContexts.push(s.copy()),P(s)))}}layout(e,t){return this.column.layout(e,t)}findAcceptableBreakPosition(e){let t=this.column.findAcceptableBreakPosition();if(e){let i=this.startNodeContexts[0].copy(),n=new Vr(i,null,i.overflow,0);if(n.findAcceptableBreak(this.column,0),!t.nodeContext)return{breakPosition:n,nodeContext:i}}return t}finishBreak(e,t,i){return this.column.finishBreak(e,t,i)}doFinishBreakOfFragmentLayoutConstraints(e){this.column.doFinishBreakOfFragmentLayoutConstraints(e)}isStartNodeContext(e){let t=this.startNodeContexts[0];return t.viewNode===e.viewNode&&t.after===e.after&&t.offsetInNode===e.offsetInNode}isLastAfterNodeContext(e){return Zt(e.toNodePosition(),this.column.lastAfterPosition)}getColumnElement(){return this.column.element}getColumn(){return this.column}},Fr=class{breakTextNode(e,t,i,n,r,o){if(t.after)t.offsetInNode=e.length;else{let s=i-t.boxOffset,a=e.data;a.charCodeAt(s)==173?s=this.breakAfterSoftHyphen(e,a,s,t):s=this.breakAfterOtherCharacter(e,a,s,t),s>0&&(t=this.updateNodeContext(t,s,e))}return t}breakAfterSoftHyphen(e,t,i,n){let r=new RegExp("[\\u0620\\u0626\\u0628\\u062A-\\u062E\\u0633-\\u0647\\u0649\\u064A\\u066E\\u066F\\u0678-\\u0687\\u069A-\\u06BF\\u06C1\\u06C2\\u06CC\\u06CE\\u06D0\\u06D1\\u06FA-\\u06FC\\u06FF\\u0712-\\u0714\\u071A-\\u071D\\u071F-\\u0727\\u0729\\u072B\\u072D\\u072E\\u074E-\\u0758\\u075C-\\u076A\\u076D-\\u0770\\u0772\\u0775-\\u0777\\u077A-\\u077F\\u07CA-\\u07EA\\u07FA\\u0841-\\u0845\\u0848\\u084A-\\u0853\\u0855\\u0860\\u0862-\\u0865\\u0868\\u0883-\\u0886\\u0889-\\u088D\\u08A0-\\u08A9\\u08AF\\u08B0\\u08B3-\\u08B8\\u08BA-\\u08C8\\u1807\\u180A\\u1820-\\u1878\\u1887-\\u18A8\\u18AA\\u200D\\uA840-\\uA871\\u{10AC0}-\\u{10AC4}\\u{10AD3}-\\u{10AD6}\\u{10AD8}-\\u{10ADC}\\u{10ADE}-\\u{10AE0}\\u{10AEB}-\\u{10AEE}\\u{10B80}\\u{10B82}\\u{10B86}-\\u{10B88}\\u{10B8A}\\u{10B8B}\\u{10B8D}\\u{10B90}\\u{10BAD}\\u{10BAE}\\u{10D01}-\\u{10D21}\\u{10D23}\\u{10EC3}\\u{10EC4}\\u{10F30}-\\u{10F32}\\u{10F34}-\\u{10F44}\\u{10F51}-\\u{10F53}\\u{10F70}-\\u{10F73}\\u{10F76}-\\u{10F81}\\u{10FB0}\\u{10FB2}\\u{10FB3}\\u{10FB8}\\u{10FBB}\\u{10FBC}\\u{10FBE}\\u{10FBF}\\u{10FC1}\\u{10FC4}\\u{10FCA}\\u{1E900}-\\u{1E943}]\\p{Mn}*$","u").test(t.slice(0,i))?"\u200D":"";if(e.replaceData(i,t.length-i,n.breakWord?"":r+al(n)),r){let o=n.preprocessedTextContent[0][1];n.preprocessedTextContent[0][1]=o.slice(0,i+1)+r+o.slice(i+1)}return i+1}breakAfterOtherCharacter(e,t,i,n){let r=t.charAt(i);i++;let o=t.charAt(i);return e.replaceData(i,t.length-i,!n.breakWord&&fa(r)&&fa(o)?al(n):""),i}updateNodeContext(e,t,i){return e=e.modify(),e.offsetInNode+=t,e.breakBefore=null,e}};u(Fr,"instance");Fr.instance=new Fr;function al(e){return e.hyphenateCharacter||e.parent&&e.parent.hyphenateCharacter||"-"}var vm=class extends Is{constructor(e,t){super(),this.leadingEdge=e,u(this,"breakAfter"),u(this,"initialPageBreakType",null),u(this,"initialComputedBlockSize",0),u(this,"initialOverflown",!1),u(this,"context",{overflownNodeContext:null}),this.breakAfter=t||null}resolveLayoutMode(e){return new xm(this.leadingEdge,this.breakAfter,this.context)}prepareLayout(e,t){t.fragmentLayoutConstraints=[],t.pseudoParent||ng()}clearNodes(e){super.clearNodes(e);let t=e;for(;t;){let i=t.viewNode;i&&pu(i.parentNode,i),t=t.parent}}saveState(e,t){super.saveState(e,t),this.initialPageBreakType=t.pageBreakType,this.initialComputedBlockSize=t.computedBlockSize,this.initialOverflown=t.overflown}restoreState(e,t){super.restoreState(e,t),t.pageBreakType=this.initialPageBreakType,t.computedBlockSize=this.initialComputedBlockSize,t.overflown=this.initialOverflown}},xm=class{constructor(e,t,i){this.leadingEdge=e,this.breakAfter=t,this.context=i}doLayout(e,t){let i=_("DefaultLayoutMode.doLayout");return mm(e,t).then(()=>{t.doLayout(e,this.leadingEdge,this.breakAfter).then(n=>{this.context.overflownNodeContext=n.overflownNodeContext,i.finish(n.nodeContext)})}),i.result()}accept(e,t){return t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||t.fragmentLayoutConstraints.length<=0?!0:t.fragmentLayoutConstraints.every(i=>i.allowLayout(e,this.context.overflownNodeContext,t))}postLayout(e,t,i,n){return n||(n=!i.fragmentLayoutConstraints.some(r=>r.nextCandidate(e))),i.fragmentLayoutConstraints.forEach(r=>{r.postLayout(n,e,t,i)}),n}},ym=class extends Ir{constructor(e,t,i,n,r,o,s){super(t,i,n,r,o),this.floatSide=e,this.parentContainer=s,u(this,"rootViewNodes",[]),u(this,"floatMargins",[]),u(this,"adjustContentRelativeSize",!0)}openAllViews(e){return super.openAllViews(e).thenAsync(t=>(t&&this.fixFloatSizeAndPosition(t),P(t)))}convertPercentageSizesToPx(e){let t=this.parentContainer.getPaddingRect(),i=t.x2-t.x1,n=t.y2-t.y1;function r(o,s){o.forEach(a=>{let h=Ai(e,a);if(h&&h.charAt(h.length-1)==="%"){let l=parseFloat(h),c=s*l/100;T(e,a,`${c}px`)}})}r(["width","max-width","min-width"],i),r(["height","max-height","min-height"],n),r(["margin-top","margin-right","margin-bottom","margin-left","padding-top","padding-right","padding-bottom","padding-left"],this.vertical?n:i),["margin-top","margin-right","margin-bottom","margin-left"].forEach(o=>{Ai(e,o)==="auto"&&T(e,o,"0")})}fixFloatSizeAndPosition(e){for(;e.parent;)e=e.parent;e.viewNode.nodeType;let t=e.viewNode;if(this.rootViewNodes.push(t),this.adjustContentRelativeSize&&this.convertPercentageSizesToPx(t),this.floatMargins.push(this.getComputedMargin(t)),this.adjustContentRelativeSize){let i=this.floatSide;if(this.parentContainer.vertical){if(i==="block-end"||i==="left"){let n=Ai(t,"height");n!==""&&n!=="auto"&&T(t,"margin-top","auto")}}else if(i==="block-end"||i==="bottom"){let n=Ai(t,"width");n!==""&&n!=="auto"&&T(t,"margin-left","auto")}}}getContentInlineSize(){return Math.max.apply(null,this.rootViewNodes.map((e,t)=>{let i=this.clientLayout.getElementClientRect(e),n=this.floatMargins[t];return this.vertical?n.top+i.height+n.bottom:n.left+i.width+n.right}))}},mi=class{constructor(e,t){this.parent=e,this.rootSourceNode=t,u(this,"formattingContextType","RepetitiveElementsOwner"),u(this,"isRoot",!1),u(this,"repetitiveElements",null)}getName(){return"Repetitive elements owner formatting context (RepetitiveElementsOwnerFormattingContext)"}isFirstTime(e,t){return t}getParent(){return this.parent}getRepetitiveElements(){return this.repetitiveElements}getRootViewNode(e){let t=this.getRootNodeContext(e);return t?t.viewNode:null}getRootNodeContext(e){do if(!e.belongsTo(this)&&e.sourceNode===this.rootSourceNode)return e;while(e=e.parent);return null}initializeRepetitiveElements(e){this.repetitiveElements||zo.some(t=>t.root===this.rootSourceNode?(this.repetitiveElements=t.elements,!0):!1)||(this.repetitiveElements=new Sm(e,this.rootSourceNode),zo.push({root:this.rootSourceNode,elements:this.repetitiveElements}))}saveState(){}restoreState(e){}},Sm=class{constructor(e,t){this.vertical=e,this.ownerSourceNode=t,u(this,"headerSourceNode",null),u(this,"footerSourceNode",null),u(this,"headerViewNode",null),u(this,"footerViewNode",null),u(this,"headerNodePosition",null),u(this,"footerNodePosition",null),u(this,"headerHeight",0),u(this,"footerHeight",0),u(this,"isSkipHeader",!1),u(this,"isSkipFooter",!1),u(this,"enableSkippingFooter",!0),u(this,"enableSkippingHeader",!0),u(this,"doneInitialLayout",!1),u(this,"firstContentSourceNode",null),u(this,"lastContentSourceNode",null),u(this,"affectedNodeCache",[]),u(this,"afterLastContentNodeCache",[]),u(this,"allowInsert",!1),u(this,"allowInsertRepeatitiveElements")}setHeaderNodeContext(e){this.headerNodePosition||(this.headerNodePosition=Er(e,0),this.headerSourceNode=e.sourceNode,this.headerViewNode=e.viewNode)}setFooterNodeContext(e){this.footerNodePosition||(this.footerNodePosition=Er(e,0),this.footerSourceNode=e.sourceNode,this.footerViewNode=e.viewNode)}updateHeight(e){this.headerViewNode&&(this.headerHeight=_o(this.headerViewNode,e,this.vertical),this.headerViewNode=null),this.footerViewNode&&(this.footerHeight=_o(this.footerViewNode,e,this.vertical),this.footerViewNode=null)}prepareLayoutFragment(){this.isSkipHeader=this.isSkipFooter=!1,this.enableSkippingFooter=!0,this.enableSkippingHeader=!0}appendHeaderToFragment(e,t,i){return!this.headerNodePosition||this.isSkipHeader?P(!0):this.appendElementToFragment(this.headerNodePosition,e,t,i)}appendFooterToFragment(e,t,i){return!this.footerNodePosition||this.isSkipFooter?P(!0):this.appendElementToFragment(this.footerNodePosition,e,t,i)}appendElementToFragment(e,t,i,n){let r=t.viewNode.ownerDocument,o=t.viewNode,s=r.createElement("div");o.appendChild(s);let a=new _s(n,s,t),h=a.getColumn().pageBreakType;return a.getColumn().pageBreakType=null,this.allowInsertRepeatitiveElements=!0,a.layout(new Qt(e),!0).thenAsync(()=>(this.allowInsertRepeatitiveElements=!1,o.removeChild(s),this.moveChildren(s,o,i),a.getColumn().pageBreakType=h,P(!0)))}moveChildren(e,t,i){if(t)for(;e.firstChild;){let n=e.firstChild;e.removeChild(n),n.setAttribute(Wi,"1"),i?t.insertBefore(n,i):t.appendChild(n)}}calculateOffset(e){let t=0;return e&&!this.affectTo(e)||((!this.isSkipFooter||e&&this.isAfterLastContent(e))&&(t+=this.footerHeight),this.isSkipHeader||(t+=this.headerHeight)),t}calculateMinimumOffset(e){let t=0;return e&&!this.affectTo(e)||(e&&this.isAfterLastContent(e)&&(t+=this.footerHeight),this.enableSkippingHeader||(t+=this.headerHeight)),t}isAfterLastContent(e){return this.findResultFromCache(e,this.afterLastContentNodeCache,t=>this.isAfterNodeContextOf(this.lastContentSourceNode,e,!1))}affectTo(e){return this.findResultFromCache(e,this.affectedNodeCache,t=>this.isAfterNodeContextOf(this.ownerSourceNode,e,!0))}findResultFromCache(e,t,i){let n=t.filter(r=>r.nodeContext.sourceNode===e.sourceNode&&r.nodeContext.after===e.after);if(n.length>0)return n[0].result;{let r=i(e);return t.push({nodeContext:e,result:r}),r}}isAfterNodeContextOf(e,t,i){let n=[];for(let r=e;r;r=r.parentNode){if(t.sourceNode===r)return t.after;n.push(r)}for(let r=t.sourceNode;r;r=r.parentNode){let o=n.indexOf(r);if(o>=0)return i?o===0:!1;for(let s=r;s;s=s.previousElementSibling)if(n.includes(s))return!0}return t.after}isFirstContentNode(e){return e&&this.firstContentSourceNode===e.sourceNode}isEnableToUpdateState(){return!!(!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition||!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition)}updateState(){!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition?this.isSkipFooter=!0:!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition&&(this.isSkipHeader=!0)}preventSkippingHeader(){this.isSkipHeader=!1,this.enableSkippingHeader=!1}preventSkippingFooter(){this.isSkipFooter=!1,this.enableSkippingFooter=!1}isHeaderRegistered(){return!!this.headerNodePosition}isFooterRegistered(){return!!this.footerNodePosition}isHeaderSourceNode(e){return this.headerSourceNode===e}isFooterSourceNode(e){return this.footerSourceNode===e}},Wu=class{constructor(e){this.formattingContext=e}accept(e,t){return!!e}postLayout(e,t,i,n){let r=this.formattingContext.getRepetitiveElements();return r&&(i.clientLayout,r.doneInitialLayout||(r.updateHeight(i),r.doneInitialLayout=!0)),n}},Gu=class{constructor(e){this.formattingContext=e}accept(e,t){return!0}postLayout(e,t,i,n){return n}},Cm=class extends Wu{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}accept(e,t){return!1}},Em=class extends Gu{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return!e.belongsTo(this.formattingContext)&&!e.after&&t.fragmentLayoutConstraints.unshift(new Ms(e)),this.processor.doLayout(e,t)}},Ms=class ju{constructor(t){u(this,"flagmentLayoutConstraintType","RepetitiveElementsOwner"),u(this,"nodeContext");let i=Rt(t.formattingContext);this.nodeContext=i.getRootNodeContext(t)}allowLayout(t,i,n){let r=this.getRepetitiveElements();return!r||Ri(this.nodeContext.viewNode)||!r.isEnableToUpdateState()?!0:!(i&&!t||t&&t.overflow)}nextCandidate(t){let i=this.getRepetitiveElements();return i&&i.isEnableToUpdateState()?(i.updateState(),!0):!1}postLayout(t,i,n,r){let o=this.getRepetitiveElements();o&&t&&r.stopAtOverflow&&(i==null||o.isAfterLastContent(i))&&o.preventSkippingFooter()}finishBreak(t,i){let n=Rt(this.nodeContext.formattingContext),r=this.getRepetitiveElements();if(!r)return P(!0);let o=this.nodeContext;return Im(n,o,i).thenAsync(()=>Fm(n,o,i).thenAsync(()=>(r.prepareLayoutFragment(),P(!0))))}getRepetitiveElements(){return Rt(this.nodeContext.formattingContext).getRepetitiveElements()}equalsTo(t){return t instanceof ju?Rt(this.nodeContext.formattingContext)===Rt(t.nodeContext.formattingContext):!1}getPriorityOfFinishBreak(){return 10}},km=class extends Is{constructor(e,t){super(),this.formattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.formattingContext.getRepetitiveElements();return!e.belongsTo(this.formattingContext)&&!t.doneInitialLayout?new Cm(this.formattingContext,this.processor):(!e.belongsTo(this.formattingContext)&&!e.after&&t&&t.preventSkippingHeader(),new Em(this.formattingContext,this.processor))}},Pm=class extends bn{constructor(e,t){super(),this.formattingContext=e,this.column=t}startNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext,n=t.getRepetitiveElements();if(i.parent&&t.rootSourceNode===i.parent.sourceNode){switch(i.repeatOnBreak){case"header":if(n.isHeaderRegistered())i.repeatOnBreak="none";else return n.setHeaderNodeContext(i),P(!0);break;case"footer":if(n.isFooterRegistered())i.repeatOnBreak="none";else return n.setFooterNodeContext(i),P(!0);break}n.firstContentSourceNode||(n.firstContentSourceNode=i.sourceNode)}return bn.prototype.startNonInlineElementNode.call(this,e)}afterNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext;return i.sourceNode===t.rootSourceNode&&(t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0),i.repeatOnBreak==="header"||i.repeatOnBreak==="footer"?P(!0):bn.prototype.afterNonInlineElementNode.call(this,e)}},Nm=class extends Oi{layout(e,t,i){if(t.isFloatNodeContext(e))return t.layoutFloatOrFootnote(e);let n=Rt(e.formattingContext);return n.getRootViewNode(e)?(i&&Xu(e.parent,t),e.belongsTo(n)?Oi.prototype.layout.call(this,e,t,i):new km(n,this).layout(e,t)):t.buildDeepElementView(e)}startNonInlineElementNode(e){let t=Am(e).getRepetitiveElements();return t&&!t.allowInsertRepeatitiveElements&&(t.isHeaderSourceNode(e.sourceNode)||t.isFooterSourceNode(e.sourceNode))&&e.viewNode.parentNode.removeChild(e.viewNode),!1}doInitialLayout(e,t){let i=Rt(e.formattingContext),n=_("BlockLayoutProcessor.doInitialLayout");return this.layoutEntireBlock(e,t).thenFinish(n),n.result()}layoutEntireBlock(e,t){let i=Rt(e.formattingContext),n=new Pm(i,t);return new Mo(n,t.layoutContext).iterate(e)}doLayout(e,t){let i=Rt(e.formattingContext),n=_("doLayout"),r=t.layoutContext.nextInTree(e,!1);return $u(r,t).then(o=>{let s=o;n.loopWithFrame(a=>{for(;s;){let h=!0;if(t.layoutNext(s,!1).then(l=>{s=l,t.pageFloatLayoutContext.isInvalidated()||t.pageBreakType||s&&t.stopByOverflow(s)||s&&s.after&&s.sourceNode==i.rootSourceNode?a.breakLoop():h?h=!1:a.continueLoop()}),h){h=!1;return}}a.breakLoop()}).then(()=>{n.finish(s)})}),n.result()}finishBreak(e,t,i,n){return Oi.prototype.finishBreak.call(this,e,t,i,n)}clearOverflownViewNodes(e,t,i,n){Oi.prototype.clearOverflownViewNodes(e,t,i,n)}};function Tm(e,t){for(let i=e;i;i=i.parent){let n=i.formattingContext;n&&n instanceof mi&&!i.belongsTo(n)&&t(n,i)}}function Xu(e,t){e&&Tm(e.after?e.parent:e,(i,n)=>{Kt.isInstanceOfTableFormattingContext(i)||t.fragmentLayoutConstraints.push(new Ms(n))})}function Im(e,t,i){let n=e.getRepetitiveElements();if(n){let r=e.getRootNodeContext(t);if(r.viewNode){let o=r.viewNode.firstChild;return n.appendHeaderToFragment(r,o,i)}}return P(!0)}function Fm(e,t,i){let n=e.getRepetitiveElements();if(n&&!n.isSkipFooter){let r=e.getRootNodeContext(t);if(r.viewNode)return n.appendFooterToFragment(r,null,i)}return P(!0)}function Am(e){let t=e.formattingContext;return!t||!(t instanceof mi)?null:t}function Rt(e){return e instanceof mi,e}var Rm=new Nm;mt("RESOLVE_LAYOUT_PROCESSOR",e=>e instanceof mi&&!Kt.isInstanceOfTableFormattingContext(e)?Rm:null);var qu=class{constructor(e,t){this.rowIndex=e,this.sourceNode=t,u(this,"cells",[])}addCell(e){this.cells.push(e)}getMinimumHeight(){return Math.min.apply(null,this.cells.map(e=>e.height))}},Lm=class{constructor(e,t,i){this.rowIndex=e,this.columnIndex=t,u(this,"viewElement"),u(this,"colSpan"),u(this,"rowSpan"),u(this,"height",0),u(this,"anchorSlot",null),this.viewElement=i,this.colSpan=i.colSpan||1,this.rowSpan=i.rowSpan||1}setHeight(e){this.height=e}setAnchorSlot(e){this.anchorSlot=e}},Om=class{constructor(e,t,i){this.rowIndex=e,this.columnIndex=t,this.cell=i}},Bm=class{constructor(e,t,i){this.column=e,this.cellNodeContext=i,u(this,"pseudoColumn"),u(this,"empty",!1),this.pseudoColumn=new _s(e,t,i)}findAcceptableBreakPosition(){let e=this.cellNodeContext.viewNode,{verticalAlign:t,alignContent:i}=e.style;t!=="top"&&t!=="baseline"&&T(e,"vertical-align","top"),i&&i!=="normal"&&T(e,"align-content","normal");let n=this.pseudoColumn.findAcceptableBreakPosition(!0);return T(e,"vertical-align",t),i&&i!=="normal"&&T(e,"align-content",i),n}},_m=class{constructor(e,t){this.viewNode=e,this.side=t}},Mm=class extends Vr{constructor(e,t,i,n){super(e,t,i,n),u(this,"formattingContext"),u(this,"acceptableCellBreakPositions",null),u(this,"rowIndex",null),this.formattingContext=e.formattingContext}findAcceptableBreak(e,t){let i=super.findAcceptableBreak(e,t);return t<this.getMinBreakPenalty()?null:this.getAcceptableCellBreakPositions().every(n=>!!n.nodeContext)?i:null}getMinBreakPenalty(){let e=super.getMinBreakPenalty();return this.getAcceptableCellBreakPositions().forEach(t=>{e+=t.breakPosition.getMinBreakPenalty()}),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){let e=this.formattingContext,t=this.getCellFragments();this.acceptableCellBreakPositions=t.map(i=>i.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getRowIndex(){return this.rowIndex!=null?this.rowIndex:this.rowIndex=this.formattingContext.findRowIndexBySourceNode(this.position.sourceNode)}getCellFragments(){return this.formattingContext.getRowSpanningCellsOverflowingTheRow(this.getRowIndex()).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},zm=class extends Ps{constructor(e,t,i){super(),this.rowIndex=e,this.beforeNodeContext=t,this.formattingContext=i,u(this,"acceptableCellBreakPositions",null)}findAcceptableBreak(e,t){if(t<this.getMinBreakPenalty())return null;let i=this.getCellFragments(),n=this.getAcceptableCellBreakPositions(),r=n.every(o=>!!o.nodeContext)&&n.some((o,s)=>{let a=i[s].pseudoColumn,h=o.nodeContext;return!a.isStartNodeContext(h)&&!a.isLastAfterNodeContext(h)});return this.beforeNodeContext.overflow=n.some(o=>o.nodeContext&&o.nodeContext.overflow),r?this.beforeNodeContext:null}getMinBreakPenalty(){let e=this.formattingContext,t=e.getRowByIndex(this.rowIndex),i=0;return e.isFreelyFragmentableRow(t)||(i+=10),this.getAcceptableCellBreakPositions().forEach(n=>{i+=n.breakPosition.getMinBreakPenalty()}),i}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(t=>t.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getCellFragments(){return this.formattingContext.getCellsFallingOnRow(this.rowIndex).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},Hi=class extends mi{constructor(e,t){super(e,t),this.tableSourceNode=t,u(this,"formattingContextType","Table"),u(this,"vertical",!1),u(this,"columnCount",-1),u(this,"tableWidth",0),u(this,"captions",[]),u(this,"colGroups",null),u(this,"colWidths",null),u(this,"inlineBorderSpacing",0),u(this,"rows",[]),u(this,"slots",[]),u(this,"cellFragments",[]),u(this,"lastRowViewNode",null),u(this,"cellBreakPositions",[]),u(this,"repetitiveElements",null)}getName(){return"Table formatting context (Table.TableFormattingContext)"}isFirstTime(e,t){if(!t)return t;switch(e.display){case"table-row":return this.cellBreakPositions.length===0;case"table-cell":return!this.cellBreakPositions.some(i=>i.cellNodePosition.steps[0].node===e.sourceNode);default:return t}}getParent(){return this.parent}finishFragment(){this.cellFragments=[]}addRow(e,t){this.rows[e]=t}getRowSlots(e){let t=this.slots[e];return t||(t=this.slots[e]=[]),t}addCell(e,t){let i=this.rows[e];i||(this.addRow(e,new qu(e,null)),i=this.rows[e]),i.addCell(t);let n=e+t.rowSpan,r=this.getRowSlots(e),o=0;for(;r[o];)o++;for(;e<n;e++){r=this.getRowSlots(e);for(let s=o;s<o+t.colSpan;s++){let a=r[s]=new Om(e,s,t);t.anchorSlot||t.setAnchorSlot(a)}}}getRowByIndex(e){return this.rows[e]}findRowIndexBySourceNode(e){return this.rows.findIndex(t=>e===t.sourceNode)}addCellFragment(e,t,i){let n=this.cellFragments[e];n||(n=this.cellFragments[e]=[]),n[t]=i}getCellsFallingOnRow(e){return this.getRowSlots(e).reduce((t,i)=>i.cell!==t[t.length-1]?t.concat(i.cell):t,[])}getRowSpanningCellsOverflowingTheRow(e){return this.getCellsFallingOnRow(e).filter(t=>t.rowIndex+t.rowSpan-1>e)}getCellFragmentOfCell(e){return this.cellFragments[e.rowIndex]&&this.cellFragments[e.rowIndex][e.columnIndex]}isFreelyFragmentableRow(e){return e.getMinimumHeight()>this.tableWidth/2}getColumnCount(){return this.columnCount<0&&(this.columnCount=Math.max.apply(null,this.rows.map(e=>e.cells.reduce((t,i)=>t+i.colSpan,0)))),this.columnCount}updateCellSizes(e){this.rows.forEach(t=>{t.cells.forEach(i=>{let n=e.getElementClientRect(i.viewElement);i.viewElement=null,i.setHeight(this.vertical?n.width:n.height)})})}findCellFromColumn(e){if(!e)return null;let t=null,i=0,n=0;e:for(i=0;i<this.cellFragments.length;i++)if(this.cellFragments[i]){for(n=0;n<this.cellFragments[i].length;n++)if(this.cellFragments[i][n]&&e===this.cellFragments[i][n].pseudoColumn.getColumn()){t=this.rows[i].cells[n];break e}}if(!t)return null;for(;i<this.slots.length;i++)for(;n<this.slots[i].length;n++){let r=this.slots[i][n];if(r.cell===t)return{rowIndex:r.rowIndex,columnIndex:r.columnIndex}}return null}collectElementsOffsetOfUpperCells(e){let t=[];return this.slots.reduce((i,n,r)=>{if(r>=e.rowIndex)return i;let o=n[e.columnIndex]&&this.getCellFragmentOfCell(n[e.columnIndex].cell);return!o||t.includes(o)||(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),i),t.push(o)),i},[])}collectElementsOffsetOfHighestColumn(){let e=[];return this.rows.forEach(t=>{t.cells.forEach((i,n)=>{e[n]||(e[n]={collected:[],elements:[]});let r=e[n],o=this.getCellFragmentOfCell(i);!o||r.collected.includes(o)||(this.collectElementsOffsetFromColumn(o.pseudoColumn.getColumn(),r.elements),r.collected.push(o))})}),[new Dm(e.map(t=>t.elements))]}collectElementsOffsetFromColumn(e,t){e.fragmentLayoutConstraints.forEach(i=>{if(ui.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(i)){let n=i.getRepetitiveElements();t.push(n)}Kt.isInstanceOfTableRowLayoutConstraint(i)&&i.getElementsOffsetsForTableCell(null).forEach(n=>{t.push(n)})})}saveState(){return[].concat(this.cellBreakPositions)}restoreState(e){this.cellBreakPositions=e}},Dm=class{constructor(e){this.repeatitiveElementsInColumns=e}calculateOffset(e){return this.calculateMaxOffsetOfColumn(e,t=>t.current)}calculateMinimumOffset(e){return this.calculateMaxOffsetOfColumn(e,t=>t.minimum)}calculateMaxOffsetOfColumn(e,t){let i=0;return this.repeatitiveElementsInColumns.forEach(n=>{let r=Di(e,n);i=Math.max(i,t(r))}),i}};function ft(e){return e instanceof Hi,e}function Vm(e){return e==="table-row-group"||e==="table-header-group"||e==="table-footer-group"}function Hm(e){return e==="table"||e==="inline-table"}function ll(e){return Vm(e)||Hm(e)}function Yu(e,t,i){let n=e.nodeContext,r=n.display,o=n.parent?n.parent.display:null,s=!1;if(o==="inline-table"&&!(n.formattingContext instanceof Hi)){for(let a=n.parent;a;a=a.parent)if(a.formattingContext instanceof Hi){s=a.formattingContext===t;break}}return s||r==="table-row"&&!ll(o)||r==="table-cell"&&o!=="table-row"&&!ll(o)||n.formattingContext instanceof Hi&&n.formattingContext!==t?i.buildDeepElementView(n).thenAsync(a=>(e.nodeContext=a,P(!0))):null}var Um=class extends bn{constructor(e,t){super(),this.formattingContext=e,this.column=t,u(this,"rowIndex",-1),u(this,"columnIndex",0),u(this,"inRow",!1),u(this,"checkPoints",[]),u(this,"inHeaderOrFooter",!1)}startNonInlineElementNode(e){let t=this.formattingContext,i=Yu(e,t,this.column);if(i)return i;this.postLayoutBlockContents(e);let n=e.nodeContext,r=n.display,o=t.getRepetitiveElements();switch(r){case"table":t.inlineBorderSpacing=n.inlineBorderSpacing;break;case"table-caption":{let s=new _m(n.viewNode,n.captionSide);t.captions.push(s);break}case"table-header-group":return o.isHeaderRegistered()||(this.inHeaderOrFooter=!0,o.setHeaderNodeContext(n)),P(!0);case"table-footer-group":return o.isFooterRegistered()||(this.inHeaderOrFooter=!0,o.setFooterNodeContext(n)),P(!0);case"table-row":this.inHeaderOrFooter||(this.inRow=!0,this.rowIndex++,n.sourceNode,this.columnIndex=0,t.addRow(this.rowIndex,new qu(this.rowIndex,n.sourceNode)),o.firstContentSourceNode||(o.firstContentSourceNode=n.sourceNode));break}return super.startNonInlineElementNode(e)}afterNonInlineElementNode(e){let t=this.formattingContext,i=e.nodeContext,n=i.display,r=this.column.clientLayout;if(this.postLayoutBlockContents(e),i.sourceNode===t.tableSourceNode){let o=r.getElementComputedStyle(t.getRootViewNode(i));t.tableWidth=parseFloat(o[t.vertical?"height":"width"]),t.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0}else switch(n){case"table-header-group":case"table-footer-group":if(this.inHeaderOrFooter)return this.inHeaderOrFooter=!1,P(!0);break;case"table-row":this.inHeaderOrFooter||(t.lastRowViewNode=i.viewNode,this.inRow=!1);break;case"table-cell":if(!this.inHeaderOrFooter){this.inRow||(this.rowIndex++,this.columnIndex=0,this.inRow=!0);let o=i.viewNode;t.addCell(this.rowIndex,new Lm(this.rowIndex,this.columnIndex,o)),this.columnIndex++}break}return super.afterNonInlineElementNode(e)}startNonElementNode(e){this.registerCheckPoint(e)}afterNonElementNode(e){this.registerCheckPoint(e)}startInlineElementNode(e){this.registerCheckPoint(e)}afterInlineElementNode(e){this.registerCheckPoint(e)}registerCheckPoint(e){let t=e.nodeContext;t&&t.viewNode&&!Li(t)&&this.checkPoints.push(t.clone())}postLayoutBlockContents(e){this.checkPoints.length>0&&this.column.postLayoutBlock(e.nodeContext,this.checkPoints),this.checkPoints=[]}},Ku=class Zu extends bn{constructor(t,i){super(!0),this.formattingContext=t,this.column=i,u(this,"inRow",!1),u(this,"currentRowIndex",-1),u(this,"currentColumnIndex",0),u(this,"originalStopAtOverflow"),u(this,"inHeader"),u(this,"inFooter"),this.originalStopAtOverflow=i.stopAtOverflow,i.stopAtOverflow=!1}resetColumn(){this.column.stopAtOverflow=this.originalStopAtOverflow}getColSpanningCellWidth(t){let i=this.formattingContext.colWidths,n=0;for(let r=0;r<t.colSpan;r++)n+=i[t.anchorSlot.columnIndex+r];return n+=this.formattingContext.inlineBorderSpacing*(t.colSpan-1),n}layoutCell(t,i,n){let r=t.rowIndex,o=t.columnIndex,s=t.colSpan,a=i.viewNode,h=i.verticalAlign;s>1&&(T(a,"box-sizing","border-box"),T(a,this.formattingContext.vertical?"height":"width",`${this.getColSpanningCellWidth(t)}px`));let l=a.ownerDocument.createElement("div");a.appendChild(l);let c=new Bm(this.column,l,i);return this.formattingContext.addCellFragment(r,o,c),n.primary.steps.length===1&&n.primary.after&&(c.empty=!0),c.pseudoColumn.layout(n,!0).thenReturn(!0)}hasBrokenCellAtSlot(t){let i=this.formattingContext.cellBreakPositions[0];return i?i.cell.anchorSlot.columnIndex===t:!1}extractRowSpanningCellBreakPositions(){let t=this.formattingContext.cellBreakPositions;if(t.length===0)return[];let i=[],n=0;do{let r=t[n],o=r.cell.rowIndex;if(o<this.currentRowIndex){let s=i[o];s||(s=i[o]=[]),s.push(r),t.splice(n,1)}else n++}while(n<t.length);return i}layoutRowSpanningCellsFromPreviousFragment(t){let i=this.formattingContext,n=this.extractRowSpanningCellBreakPositions(),r=n.reduce(p=>p+1,0);if(r===0)return P(!0);let o=this.column.layoutContext,s=t.nodeContext;s.viewNode.parentNode.removeChild(s.viewNode);let a=_("layoutRowSpanningCellsFromPreviousFragment"),h=P(!0),l=0,c=[];return n.forEach(p=>{h=h.thenAsync(()=>{let d=kr(p[0].cellNodePosition.steps[1],s.parent);return o.setCurrent(d,!1).thenAsync(()=>{let f=P(!0),g=0;function m(v){for(;g<v;){if(!c.includes(g)){let b=d.viewNode.ownerDocument.createElement("td");T(b,"padding","0"),d.viewNode.appendChild(b)}g++}}return p.forEach(v=>{f=f.thenAsync(()=>{let b=v.cell;m(b.anchorSlot.columnIndex);let w=v.cellNodePosition,S=kr(w.steps[0],d);return S.offsetInNode=w.offsetInNode,S.after=w.after,S.fragmentIndex=w.steps[0].fragmentIndex+1,o.setCurrent(S,!1).thenAsync(()=>{let L=v.breakChunkPosition;for(let B=0;B<b.colSpan;B++)c.push(g+B);return g+=b.colSpan,this.layoutCell(b,S,L).thenAsync(()=>(S.viewNode.rowSpan=b.rowIndex+b.rowSpan-this.currentRowIndex+r-l,P(!0)))})})}),f.thenAsync(()=>(m(i.getColumnCount()),l++,P(!0)))})})}),h.then(()=>{o.setCurrent(s,!0,t.atUnforcedBreak).then(()=>{a.finish(!0)})}),a.result()}startTableRow(t){if(this.inHeader||this.inFooter)return P(!0);let i=t.nodeContext,n=this.formattingContext;return this.currentRowIndex<0?(i.sourceNode,this.currentRowIndex=n.findRowIndexBySourceNode(i.sourceNode)):this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0,this.layoutRowSpanningCellsFromPreviousFragment(t).thenAsync(()=>(this.registerCellFragmentIndex(),this.column.checkOverflowAndSaveEdgeAndBreakPosition(t.lastAfterNodeContext,null,!0,t.breakAtTheEdge)&&n.getRowSpanningCellsOverflowingTheRow(this.currentRowIndex-1).length===0&&(this.resetColumn(),i.overflow=!0,t.break=!0),P(!0)))}registerCellFragmentIndex(){this.formattingContext.getRowByIndex(this.currentRowIndex).cells.forEach(t=>{let i=this.formattingContext.cellBreakPositions[t.columnIndex];if(i&&i.cell.anchorSlot.columnIndex==t.anchorSlot.columnIndex){let n=i.cellNodePosition.steps[0],r=this.column.layoutContext.xmldoc.getElementOffset(n.node);dm(r,n.fragmentIndex+1,1)}})}startTableCell(t){if(this.inHeader||this.inFooter)return P(!0);let i=t.nodeContext;this.inRow||(this.currentRowIndex<0?this.currentRowIndex=0:this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0);let n=this.formattingContext.getRowByIndex(this.currentRowIndex).cells[this.currentColumnIndex];if(!n)return t.break=!0,P(!0);let r=i.copy().modify();r.after=!0,t.nodeContext=r;let o=_("startTableCell"),s;if(this.hasBrokenCellAtSlot(n.anchorSlot.columnIndex)){let a=this.formattingContext.cellBreakPositions.shift();i.fragmentIndex=a.cellNodePosition.steps[0].fragmentIndex+1,s=P(a.breakChunkPosition)}else s=this.column.nextInTree(i,t.atUnforcedBreak).thenAsync(a=>{a.viewNode&&i.viewNode.removeChild(a.viewNode);let h=Er(a,0);return P(new Qt(h))});return s.then(a=>{this.layoutCell(n,i,a).then(()=>{this.afterNonInlineElementNode(t),this.currentColumnIndex++,o.finish(!0)})}),o.result()}startNonInlineBox(t){let i=Yu(t,ft(this.formattingContext),this.column);if(i)return i;let n=t.nodeContext,r=this.formattingContext.getRepetitiveElements(),o=n.display;return o==="table-header-group"&&r&&r.isHeaderSourceNode(n.sourceNode)?(this.inHeader=!0,P(!0)):o==="table-footer-group"&&r&&r.isFooterSourceNode(n.sourceNode)?(this.inFooter=!0,P(!0)):o==="table-row"?this.startTableRow(t):o==="table-cell"?this.startTableCell(t):P(!0)}endNonInlineBox(t){let i=t.nodeContext;if(i.display==="table-row"&&(this.inRow=!1,!this.inHeader&&!this.inFooter)){let n=i.copy().modify();n.after=!1;let r=new zm(this.currentRowIndex,n,this.formattingContext);this.column.breakPositions.push(r)}return P(!0)}afterNonInlineElementNode(t){let i=t.nodeContext,n=this.formattingContext.getRepetitiveElements(),r=i.display;if(r==="table-header-group"?n&&!n.allowInsertRepeatitiveElements&&n.isHeaderSourceNode(i.sourceNode)?(this.inHeader=!1,i.viewNode.parentNode.removeChild(i.viewNode)):T(i.viewNode,"display","table-row-group"):r==="table-footer-group"&&(n&&!n.allowInsertRepeatitiveElements&&n.isFooterSourceNode(i.sourceNode)?(this.inFooter=!1,i.viewNode.parentNode.removeChild(i.viewNode)):T(i.viewNode,"display","table-row-group")),r&&Zu.ignoreList[r])i.viewNode.parentNode.removeChild(i.viewNode);else if(i.sourceNode===this.formattingContext.tableSourceNode)i.overflow=this.column.checkOverflowAndSaveEdge(i,null),this.resetColumn(),t.break=!0;else return super.afterNonInlineElementNode(t);return P(!0)}};u(Ku,"ignoreList",{"table-caption":!0,"table-column-group":!0,"table-column":!0});var $m=Ku,Fn=[];function Wm(e){let t=Fn.findIndex(n=>n.root===e),i=Fn[t];return i?i.tableLayoutOption:null}function Gm(e){let t=Fn.findIndex(i=>i.root===e);t>=0&&Fn.splice(t,1)}var Qu=class{layoutEntireTable(e,t){let i=ft(e.formattingContext),n=new Um(i,t);return new Mo(n,t.layoutContext).iterate(e)}getColumnWidths(e,t,i,n){let r=e.ownerDocument,o=r.createElement("tr"),s=[];for(let h=0;h<t;h++){let l=r.createElement("td");o.appendChild(l),s.push(l)}e.parentNode.insertBefore(o,e.nextSibling);let a=s.map(h=>{let l=n.getElementClientRect(h),c=i?l.height:l.width;return Math.ceil(c)});return e.parentNode.removeChild(o),a}getColGroupElements(e){let t=[],i=e.firstElementChild;for(;i;)i.localName==="colgroup"&&t.push(i),i=i.nextElementSibling;return t}normalizeAndGetColElements(e){let t=[];return e.forEach(i=>{let n=i.span;i.removeAttribute("span");let r=i.firstElementChild;for(;r;){if(r.localName==="col"){let o=r.span;for(r.removeAttribute("span"),n-=o;o-- >1;){let s=r.cloneNode(!0);i.insertBefore(s,r),t.push(s)}t.push(r)}r=r.nextElementSibling}for(;n-- >0;)r=i.ownerDocument.createElement("col"),i.appendChild(r),t.push(r)}),t}addMissingColElements(e,t,i,n){if(e.length<i){let r=n.ownerDocument.createElement("colgroup");t.push(r);for(let o=e.length;o<i;o++){let s=n.ownerDocument.createElement("col");r.appendChild(s),e.push(s)}}}normalizeColGroups(e,t,i){let n=e.vertical,r=e.lastRowViewNode;if(!r)return;e.lastRowViewNode=null;let o=r.ownerDocument.createDocumentFragment(),s=e.getColumnCount();if(!(s>0)){e.colGroups=o;return}let a=e.colWidths=this.getColumnWidths(r,s,n,i.clientLayout),h=this.getColGroupElements(t),l=this.normalizeAndGetColElements(h);this.addMissingColElements(l,h,s,t),l.forEach((c,p)=>{T(c,n?"height":"width",`${a[p]}px`)}),h.forEach(c=>{o.appendChild(c.cloneNode(!0))}),e.colGroups=o}doInitialLayout(e,t){let i=ft(e.formattingContext);i.vertical=e.vertical,i.initializeRepetitiveElements(e.vertical),e.sourceNode;let n=Wm(e.sourceNode);Gm(e.sourceNode);let r=_("TableLayoutProcessor.doInitialLayout"),o=e.copy();return this.layoutEntireTable(e,t).then(s=>{let a=s.viewNode,h=t.clientLayout.getElementClientRect(a),l=t.vertical?h.left:h.bottom;if(l+=(t.vertical?-1:1)*Di(e,t.collectElementsOffset()).current,!t.isOverflown(l)&&(!n||!n.calculateBreakPositionsInside)){t.breakPositions.push(new Ym(o)),r.finish(s);return}this.normalizeColGroups(i,a,t),i.updateCellSizes(t.clientLayout),r.finish(null)}),r.result()}addCaptions(e,t,i){let n=e.captions;n.forEach((r,o)=>{r&&(t.insertBefore(r.viewNode,i),r.side==="top"&&(n[o]=null))})}addColGroups(e,t,i){e.colGroups&&this.getColGroupElements(t).length===0&&t.insertBefore(e.colGroups.cloneNode(!0),i)}removeColGroups(e,t){if(e.colGroups&&t){let i=this.getColGroupElements(t);i&&i.forEach(n=>{t.removeChild(n)})}}doLayout(e,t){let i=ft(e.formattingContext),n=i.getRootViewNode(e),r=n.firstChild;this.addCaptions(i,n,r),this.addColGroups(i,n,r);let o=new $m(i,t),s=new Mo(o,t.layoutContext),a=_("TableFormattingContext.doLayout");return s.iterate(e).thenFinish(a),a.result()}layout(e,t,i){let n=ft(e.formattingContext);return n.getRootViewNode(e)?(i&&Xu(e.parent,t),new Xm(n,this).layout(e,t)):t.buildDeepElementView(e)}createEdgeBreakPosition(e,t,i,n){return new Mm(e,t,i,n)}startNonInlineElementNode(e){return!1}afterNonInlineElementNode(e,t){return!1}finishBreak(e,t,i,n){let r=ft(t.formattingContext);if(t.display==="table-row"){t.sourceNode;let o=r.findRowIndexBySourceNode(t.sourceNode);r.cellBreakPositions=[];let s;if(t.after?s=r.getRowSpanningCellsOverflowingTheRow(o):s=r.getCellsFallingOnRow(o),s.length){let a=_("TableLayoutProcessor.finishBreak"),h=0;return a.loopWithFrame(l=>{if(h===s.length){l.breakLoop();return}let c=s[h++],p=r.getCellFragmentOfCell(c),d=p.findAcceptableBreakPosition().nodeContext,f=p.cellNodeContext,g=f.toNodePosition(),m=new Qt(d.toNodePosition());r.cellBreakPositions.push({cellNodePosition:g,breakChunkPosition:m,cell:c});let v=f.viewNode;p.column.layoutContext.processFragmentedBlockEdge(p.cellNodeContext),o<c.rowIndex+c.rowSpan-1&&(v.rowSpan=o-c.rowIndex+1),p.empty?l.continueLoop():p.pseudoColumn.finishBreak(d,!1,!0).then(()=>{jm(p,r,d),l.continueLoop()})}).then(()=>{e.clearOverflownViewNodes(t,!1),e.layoutContext.processFragmentedBlockEdge(t),r.finishFragment(),a.finish(!0)}),a.result()}}return r.finishFragment(),Ts.finishBreak(e,t,i,n)}clearOverflownViewNodes(e,t,i,n){Oi.prototype.clearOverflownViewNodes(e,t,i,n)}};function jm(e,t,i){let n=t.getRepetitiveElements();if(!n)return;let r=t.vertical,o=e.column,s=e.pseudoColumn.getColumnElement(),a=e.cellNodeContext.viewNode,h=o.clientLayout.getElementClientRect(a),l=o.getComputedPaddingBorder(a);if(r){let c=h.right-o.footnoteEdge-n.calculateOffset(i)-l.right;T(s,"max-width",`${c}px`)}else{let c=o.footnoteEdge-n.calculateOffset(i)-h.top-l.top;T(s,"max-height",`${c}px`)}T(s,"overflow","hidden")}var Xm=class extends Is{constructor(e,t){super(),this.tableFormattingContext=e,this.processor=t}resolveLayoutMode(e){let t=this.tableFormattingContext.getRepetitiveElements();return!t||!t.doneInitialLayout?new qm(this.tableFormattingContext,this.processor):(e.sourceNode===this.tableFormattingContext.tableSourceNode&&!e.after&&t&&t.preventSkippingHeader(),new Zm(this.tableFormattingContext,this.processor))}clearNodes(e){super.clearNodes(e);let t=this.tableFormattingContext.getRootViewNode(e);this.processor.removeColGroups(this.tableFormattingContext,t)}restoreState(e,t){super.restoreState(e,t),this.tableFormattingContext.finishFragment()}},qm=class extends Wu{constructor(e,t){super(e),this.processor=t}doLayout(e,t){return this.processor.doInitialLayout(e,t)}},Ym=class extends Vr{constructor(e){super(e,null,e.overflow,0)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error("EdgeBreakPosition.prototype.updateEdge not called");return(this.overflows?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}breakPositionChosen(e){e.fragmentLayoutConstraints.push(new Km(this.position.sourceNode))}},Km=class Ju{constructor(t){this.tableRootNode=t,u(this,"flagmentLayoutConstraintType","EntireTable")}allowLayout(t,i,n){return t.overflow,!1}nextCandidate(t){return!0}postLayout(t,i,n,r){i.sourceNode,Fn.push({root:i.sourceNode,tableLayoutOption:{calculateBreakPositionsInside:!0}})}finishBreak(t,i){return P(!0)}equalsTo(t){return t instanceof Ju&&t.tableRootNode===this.tableRootNode}getPriorityOfFinishBreak(){return 0}},Zm=class extends Gu{constructor(e,t){super(e),this.processor=t}doLayout(e,t){let i=this.formattingContext.getRepetitiveElements();if(i&&!i.isAfterLastContent(e)){let n=new Qm(e);t.fragmentLayoutConstraints.some(r=>n.equalsTo(r))||t.fragmentLayoutConstraints.unshift(n)}return this.processor.doLayout(e,t)}},Qm=class ec extends Ms{constructor(t){super(t),u(this,"flagmentLayoutConstraintType","TableRow"),u(this,"cellFragmentLayoutConstraints",[])}allowLayout(t,i,n){let r=this.getRepetitiveElements();return!r||n.pseudoParent||Ri(this.nodeContext.viewNode)||!r.isEnableToUpdateState()?!0:!(i&&!t||t&&t.overflow)}nextCandidate(t){let i=ft(this.nodeContext.formattingContext);return this.collectCellFragmentLayoutConstraints(t,i).some(n=>n.constraints.some(r=>r.nextCandidate(t)))?!0:super.nextCandidate(t)}postLayout(t,i,n,r){let o=ft(this.nodeContext.formattingContext);if(this.cellFragmentLayoutConstraints=this.collectCellFragmentLayoutConstraints(i,o),this.cellFragmentLayoutConstraints.forEach(s=>{s.constraints.forEach(a=>{a.postLayout(t,s.breakPosition,n,r)})}),!t){let s=o.getRootViewNode(this.nodeContext);new Qu().removeColGroups(o,s),this.removeDummyRowNodes(n)}super.postLayout(t,i,n,r)}finishBreak(t,i){let n=ft(this.nodeContext.formattingContext),r=_("finishBreak"),o=this.cellFragmentLayoutConstraints.reduce((a,h)=>a.concat(h.constraints.map(l=>({constraint:l,breakPosition:h.breakPosition}))),[]),s=0;return r.loop(()=>{if(s<o.length){let a=o[s++];return a.constraint.finishBreak(a.breakPosition,i).thenReturn(!0)}else return P(!1)}).then(()=>{r.finish(!0)}),r.result().thenAsync(()=>super.finishBreak(t,i))}removeDummyRowNodes(t){if(!(!t||t.display!=="table-row"||!t.viewNode))for(;t.viewNode.previousElementSibling;){let i=t.viewNode.previousElementSibling;i.parentNode&&i.parentNode.removeChild(i)}}collectCellFragmentLayoutConstraints(t,i){return this.getCellFragemnts(t,i).map(n=>({constraints:n.fragment.pseudoColumn.getColumn().fragmentLayoutConstraints,breakPosition:n.breakPosition}))}getCellFragemnts(t,i){let n=Number.MAX_VALUE;t&&t.display==="table-row"&&(t.sourceNode,n=i.findRowIndexBySourceNode(t.sourceNode)+1),n=Math.min(i.cellFragments.length,n);let r=[];for(let o=0;o<n;o++)i.cellFragments[o]&&i.cellFragments[o].forEach(s=>{s&&r.push({fragment:s,breakPosition:s.findAcceptableBreakPosition().nodeContext})});return r}getElementsOffsetsForTableCell(t){let i=ft(this.nodeContext.formattingContext),n=i.findCellFromColumn(t);return n?i.collectElementsOffsetOfUpperCells(n):i.collectElementsOffsetOfHighestColumn()}equalsTo(t){return t instanceof ec?ft(this.nodeContext.formattingContext)===ft(t.nodeContext.formattingContext):!1}},Jm=new Qu;function ew(e,t,i,n,r,o){if(!t)return null;if(i===x.table){let s=e.parent;return new Hi(s?s.formattingContext:null,e.sourceNode)}return null}function tw(e){return e instanceof Hi?Jm:null}mt("RESOLVE_FORMATTING_CONTEXT",ew);mt("RESOLVE_LAYOUT_PROCESSOR",tw);function hl(e){return e.reduce((t,i)=>t+i,0)/e.length}function iw(e){let t=hl(e);return hl(e.map(i=>{let n=i-t;return n*n}))}var nw=class{constructor(e,t){this.layoutResult=e,this.penalty=t}};function An(e){return e.vertical?e.width:e.height}function Rn(e,t){e.vertical?e.width=t:e.height=t}var tc=class{constructor(e,t,i){this.layoutContainer=e,this.columnGenerator=t,this.regionPageFloatLayoutContext=i,u(this,"originalContainerBlockSize"),this.originalContainerBlockSize=An(e)}balanceColumns(e){let t=_("ColumnBalancer#balanceColumns");this.preBalance(e),this.savePageFloatLayoutContexts(e),this.layoutContainer.clear();let i=[this.createTrialResult(e)];return t.loopWithFrame(n=>{if(!this.hasNextCandidate(i)){n.breakLoop();return}this.updateCondition(i),this.columnGenerator().then(r=>{if(this.savePageFloatLayoutContexts(r),this.layoutContainer.clear(),!r){n.breakLoop();return}i.push(this.createTrialResult(r)),n.continueLoop()})}).then(()=>{let n=i.reduce((r,o)=>o.penalty<r.penalty?o:r,i[0]);this.restoreContents(n.layoutResult),this.postBalance(),t.finish(n.layoutResult)}),t.result()}createTrialResult(e){let t=this.calculatePenalty(e);return new nw(e,t)}preBalance(e){}postBalance(){Rn(this.layoutContainer,this.originalContainerBlockSize)}savePageFloatLayoutContexts(e){let t=this.regionPageFloatLayoutContext.detachChildren();e&&(e.columnPageFloatLayoutContexts=t)}restoreContents(e){let t=this.layoutContainer.element;e.columns.forEach(i=>{t.appendChild(i.element)}),e.columnPageFloatLayoutContexts,this.regionPageFloatLayoutContext.attachChildren(e.columnPageFloatLayoutContexts)}},Qo=1;function ic(e){let t=e[e.length-1];if(t.penalty===0)return!1;let i=e[e.length-2];if(i&&t.penalty>=i.penalty)return!1;let n=t.layoutResult.columns,r=Math.max.apply(null,n.map(s=>s.computedBlockSize)),o=Math.max.apply(null,n.map(s=>s.getMaxBlockSizeOfPageFloats()));return r>o+Qo}function nc(e,t){let i=e[e.length-1].layoutResult.columns,n=Math.max.apply(null,i.map(r=>isNaN(r.blockDistanceToBlockEndFloats)?r.computedBlockSize:r.computedBlockSize-r.blockDistanceToBlockEndFloats+Qo))-Qo;n<An(t)?Rn(t,n):Rn(t,An(t)-1)}var rw=class extends tc{constructor(e,t,i,n){super(i,e,t),this.columnCount=n,u(this,"originalPosition",null),u(this,"foundUpperBound",!1)}preBalance(e){let t=e.columns.reduce((i,n)=>i+n.computedBlockSize,0);Rn(this.layoutContainer,t/this.columnCount),this.originalPosition=e.position}checkPosition(e){return this.originalPosition?this.originalPosition.isSamePosition(e):e===null}calculatePenalty(e){if(!this.checkPosition(e.position))return 1/0;let t=e.columns;return ul(t)?1/0:Math.max.apply(null,t.map(i=>i.computedBlockSize))}hasNextCandidate(e){if(e.length===1)return!0;if(this.foundUpperBound)return ic(e);{let t=e[e.length-1];return this.checkPosition(t.layoutResult.position)&&!ul(t.layoutResult.columns)?(this.foundUpperBound=!0,!0):An(this.layoutContainer)<this.originalContainerBlockSize}}updateCondition(e){if(this.foundUpperBound)nc(e,this.layoutContainer);else{let t=Math.min(this.originalContainerBlockSize,An(this.layoutContainer)+this.originalContainerBlockSize*.1);Rn(this.layoutContainer,t)}}};function ul(e){if(e.length<=1)return!1;let t=e[e.length-1].computedBlockSize;return e.slice(0,e.length-1).every(i=>t>i.computedBlockSize)}var ow=class extends tc{constructor(e,t,i){super(i,e,t)}calculatePenalty(e){if(e.columns.every(i=>i.computedBlockSize===0))return 1/0;let t=e.columns.filter(i=>!i.pageBreakType).map(i=>i.computedBlockSize);return iw(t)}hasNextCandidate(e){return ic(e)}updateCondition(e){nc(e,this.layoutContainer)}};function sw(e,t,i,n,r,o,s){if(t===x.auto)return null;{let a=s.positions.length===0,h=o[o.length-1],l=!!(h&&h.pageBreakType);return a||l?new rw(i,n,r,e):t===x.balance_all?new ow(i,n,r):(x.balance,null)}}var fo=class{constructor(e,t,i){u(this,"endStuckFixed"),u(this,"endFixed"),u(this,"endSlipped"),this.endStuckFixed=e,this.endFixed=t,this.endSlipped=i}},aw=class{constructor(){u(this,"map",[])}getMaxFixed(){return this.map.length==0?0:this.map[this.map.length-1].endFixed}getMaxSlipped(){return this.map.length==0?0:this.map[this.map.length-1].endSlipped}addStuckRange(e){if(this.map.length==0)this.map.push(new fo(e,e,e));else{let t=this.map[this.map.length-1],i=t.endSlipped+e-t.endFixed;t.endFixed==t.endStuckFixed?(t.endFixed=e,t.endStuckFixed=e,t.endSlipped=i):this.map.push(new fo(e,e,i))}}addSlippedRange(e){this.map.length==0?this.map.push(new fo(e,0,0)):this.map[this.map.length-1].endFixed=e}slippedByFixed(e){let t=Yt(this.map.length,n=>e<=this.map[n].endFixed),i=this.map[t];return i.endSlipped-Math.max(0,i.endStuckFixed-e)}fixedBySlipped(e){let t=Yt(this.map.length,n=>e<=this.map[n].endSlipped),i=this.map[t];return i.endStuckFixed-(i.endSlipped-e)}},lw=class Jo{constructor(t,i,n,r,o,s,a,h){if(this.context=t,this.style=i,this.offset=n,this.isRoot=r,this.flowChunk=o,this.atBlockStart=s,this.atFlowStart=a,this.isParentBoxDisplayed=h,u(this,"flowName"),u(this,"isBlockValue",null),u(this,"hasBoxValue",null),u(this,"styleValues",{}),u(this,"beforeBox",null),u(this,"afterBox",null),u(this,"breakBefore",null),this.flowName=o.flowName,this.hasBox()){let l=i._pseudos;if(l&&l.before){let c=new Jo(t,l.before,n,!1,o,this.isBlock(),a,!0),p=c.styleValue("content");Jt(p)&&(this.beforeBox=c,this.breakBefore=c.breakBefore)}}this.breakBefore=Je(this.getBreakValue("before"),this.breakBefore),this.atFlowStart&&it(this.breakBefore)&&(o.breakBefore=Je(o.breakBefore,this.breakBefore))}buildAfterPseudoElementBox(t,i,n){if(this.hasBox()){let r=this.style._pseudos;if(r&&r.after){let o=new Jo(this.context,r.after,t,!1,this.flowChunk,i,n,!0),s=o.styleValue("content");Jt(s)&&(this.afterBox=o)}}}styleValue(t,i){if(!(t in this.styleValues)){let n=this.style[t];this.styleValues[t]=n?n.evaluate(this.context,t):i||null}return this.styleValues[t]}displayValue(){return this.styleValue("display",x.inline)}isBlock(){if(this.isBlockValue===null){let t=this.displayValue(),i=this.styleValue("position"),n=this.styleValue("float");this.isBlockValue=cu(t,i,n,this.isRoot)}return this.isBlockValue}hasBox(){return this.hasBoxValue===null&&(this.hasBoxValue=this.isParentBoxDisplayed&&this.displayValue()!==x.none),this.hasBoxValue}getBreakValue(t){let i=null;if(this.isBlock()){let n=this.styleValue(`break-${t}`);n&&(i=n.toString())}return i}},hw=class{constructor(e){this.context=e,u(this,"stack",[]),u(this,"atBlockStart",!0),u(this,"atFlowStart",!0),u(this,"atStartStack",[])}empty(){return this.stack.length===0}lastBox(){return this.stack[this.stack.length-1]}lastFlowName(){let e=this.lastBox();return e?e.flowChunk.flowName:null}isCurrentBoxDisplayed(){return this.stack.every(e=>e.displayValue()!==x.none)}push(e,t,i,n){let r=this.lastBox();n&&r&&n.flowName!==r.flowName&&this.atStartStack.push({atBlockStart:this.atBlockStart,atFlowStart:this.atFlowStart});let o=n||r.flowChunk,s=this.atFlowStart||!!n,a=this.isCurrentBoxDisplayed(),h=new lw(this.context,e,t,i,o,s||this.atBlockStart,s,a);return this.stack.push(h),this.atBlockStart=h.hasBox()?!h.beforeBox&&h.isBlock():this.atBlockStart,this.atFlowStart=h.hasBox()?!h.beforeBox&&s:this.atFlowStart,h}encounteredTextNode(e){let t=this.lastBox();if((e.nodeType===Node.TEXT_NODE||e.nodeType===Node.CDATA_SECTION_NODE)&&(this.atBlockStart||this.atFlowStart)&&t.hasBox()){let i=t.styleValue("white-space",x.normal).toString(),n=Jh(i);n&&!je(e,n)&&(this.atBlockStart=!1,this.atFlowStart=!1)}}pop(e){let t=this.stack.pop();if(t.buildAfterPseudoElementBox(e,this.atBlockStart,this.atFlowStart),this.atFlowStart&&t.afterBox){let n=t.afterBox.getBreakValue("before");t.flowChunk.breakBefore=Je(t.flowChunk.breakBefore,n)}let i=this.lastBox();if(i)if(i.flowName===t.flowName)t.hasBox()&&(this.atBlockStart=this.atFlowStart=!1);else{let n=this.atStartStack.pop();this.atBlockStart=n.atBlockStart,this.atFlowStart=n.atFlowStart}return t}nearestBlockStartOffset(e){if(!e.atBlockStart)return e.offset;let t=this.stack.length-1,i=this.stack[t];for(i===e&&(t--,i=this.stack[t]);t>=0;){if(i.flowName!==e.flowName)return e.offset;if(!i.atBlockStart||i.isRoot)return i.offset;e=i,i=this.stack[--t]}throw new Error("No block start offset found!")}},cl=class{constructor(e,t,i,n,r,o,s,a){this.xmldoc=e,this.scope=i,this.context=n,this.primaryFlows=r,this.validatorSet=o,this.counterListener=s,u(this,"root"),u(this,"cascadeHolder"),u(this,"last"),u(this,"rootStyle",{}),u(this,"styleMap",{}),u(this,"flows",{}),u(this,"flowChunks",[]),u(this,"flowListener",null),u(this,"flowToReach",null),u(this,"idToReach",null),u(this,"cascade"),u(this,"offsetMap"),u(this,"primary",!0),u(this,"primaryStack",[]),u(this,"rootBackgroundAssigned",!1),u(this,"rootLayoutAssigned",!1),u(this,"lastOffset"),u(this,"breakBeforeValues",{}),u(this,"boxStack"),u(this,"bodyReached",!0),this.root=e.root,this.cascadeHolder=t,this.last=this.root,this.cascade=t.createInstance(n,s,a,e.lang),this.offsetMap=new aw;let h=e.getElementOffset(this.root);this.lastOffset=h,this.boxStack=new hw(n),this.offsetMap.addStuckRange(h);let l=this.getAttrStyle(this.root);switch(this.cascade.pushElement(this,this.root,l,h),this.postprocessTopStyle(l,!1),this.root.namespaceURI){case"http://www.w3.org/1999/xhtml":this.bodyReached=!1;break}this.primaryStack.push(!0),this.styleMap={},this.styleMap[`e${h}`]=l,this.lastOffset++,this.replayFlowElementsFromOffset(-1)}hasProp(e,t,i){let n=e[i];return n&&n.evaluate(this.context)!==t[i]}transferPropsToRoot(e,t){for(let i in t){let n=e[i];if(n)this.rootStyle[i]=n,delete e[i];else{let r=t[i];r&&(this.rootStyle[i]=new J(r,Dh))}}}postprocessTopStyle(e,t){var i;if(t)for(let n of["writing-mode","direction"])e[n]&&!(t&&this.rootStyle[n])&&(this.rootStyle[n]=e[n]);else for(let n in e)vn(n)&&(this.rootStyle[n]=e[n]);if(!this.rootBackgroundAssigned){let n=this.hasProp(e,this.validatorSet.backgroundProps,"background-color")?e["background-color"].evaluate(this.context):null,r=this.hasProp(e,this.validatorSet.backgroundProps,"background-image")?e["background-image"].evaluate(this.context):null;(n&&!te(n)||r&&!te(r))&&(this.transferPropsToRoot(e,this.validatorSet.backgroundProps),this.rootBackgroundAssigned=!0)}if(!this.rootLayoutAssigned){for(let n=0;n<dl.length;n++)if(this.hasProp(e,this.validatorSet.layoutProps,dl[n])){this.transferPropsToRoot(e,this.validatorSet.layoutProps),this.rootLayoutAssigned=!0;break}}if(!t){let n=e["font-size"],r=!0;if(n&&!te(n.value)){let a=n.evaluate(this.context);if(a instanceof A){let h=a.num;switch(a.unit){case"em":case"rem":h*=this.context.initialFontSize;break;case"ex":h*=this.context.initialFontSize*xe.ex/xe.em;break;case"%":h*=this.context.initialFontSize/100;break;case"lh":case"rlh":h*=this.context.initialFontSize*xe.lh/xe.em;break;default:{let l=xe[a.unit];l&&(h*=l),r=!1}}this.context.rootFontSize=h,this.context.isRelativeRootFontSize=r}}let o=(i=this.context.rootFontSize)!=null?i:this.context.initialFontSize,s=e["line-height"];if(s&&!te(s.value)){let a=s.evaluate(this.context);if(a instanceof wi)this.context.rootLineHeight=a.num*o;else if(a instanceof A){let h=a.num;switch(a.unit){case"em":case"rem":h*=o;break;case"ex":h*=o*xe.ex/xe.em;break;case"%":h*=o/100;break;case"lh":case"rlh":h*=this.context.initialFontSize*xe.lh/xe.em;break;default:{let l=xe[a.unit];l&&(h*=l)}}this.context.rootLineHeight=h}}else this.context.rootLineHeight=this.context.fontSize()*xe.lh/xe.em}}getTopContainerStyle(){let e=0;for(;!this.bodyReached&&(e+=5e3,this.styleUntil(e,0)!=Number.POSITIVE_INFINITY););return this.rootStyle}getAttrStyle(e){if(e.style instanceof CSSStyleDeclaration){let t=e.getAttribute("style");if(t)return rm(this.scope,this.validatorSet,this.xmldoc.url,t)}return{}}getReachedOffset(){return this.lastOffset}replayFlowElementsFromOffset(e){if(e>=this.lastOffset)return;let t=this.context,i=this.xmldoc.getElementOffset(this.root);if(e<i){let o=this.getStyle(this.root,!1),s=Ge(o,"flow-into"),a=s?s.evaluate(t,"flow-into").toString():"body",h=this.encounteredFlowElement(a,o,this.root,i);this.boxStack.empty()&&this.boxStack.push(o,i,!0,h)}let n=this.xmldoc.getNodeByOffset(e),r=this.xmldoc.getNodeOffset(n,0,!1);if(!(r>=this.lastOffset))for(;;){if(n.nodeType!=1)r+=n.textContent.length;else{let s=n,a=this.getStyle(s,!1),h=a["flow-into"];if(h){let l=h.evaluate(t,"flow-into").toString();this.encounteredFlowElement(l,a,s,r)}r++}if(r>=this.lastOffset)break;let o=n.firstChild;if(o==null){for(;o=n.nextSibling,!o;)if(n=n.parentNode,n===this.root)return}n=o}}resetFlowChunkStream(e){this.flowListener=e;for(let t=0;t<this.flowChunks.length;t++)this.flowListener.encounteredFlowChunk(this.flowChunks[t],this.flows[this.flowChunks[t].flowName])}styleUntilFlowIsReached(e){this.flowToReach=e;let t=0;for(;!(this.flowToReach==null||(t+=5e3,this.styleUntil(t,0)==Number.POSITIVE_INFINITY)););}styleUntilIdIsReached(e){if(!e)return;this.idToReach=e;let t=0;for(;!(!this.idToReach||(t+=5e3,this.styleUntil(t,0)===Number.POSITIVE_INFINITY)););this.idToReach=null}encounteredFlowElement(e,t,i,n){let r=0,o=Number.POSITIVE_INFINITY,s=!1,a=!1,h=!1,l=t["flow-options"];if(l){let m=bp(l.evaluate(this.context,"flow-options"));s=!!m.exclusive,a=!!m.static,h=!!m.last}let c=t["flow-linger"];c&&(o=La(c.evaluate(this.context,"flow-linger"),Number.POSITIVE_INFINITY));let p=t["flow-priority"];p&&(r=La(p.evaluate(this.context,"flow-priority"),0));let d=this.breakBeforeValues[n]||null,f=this.flows[e];if(!f){let m=this.boxStack.lastFlowName();f=this.flows[e]=new Of(e,m)}let g=new Bf(e,i,n,r,o,s,a,h,d);return this.flowChunks.push(g),this.flowToReach==e&&(this.flowToReach=null),this.flowListener&&this.flowListener.encounteredFlowChunk(g,f),g}registerForcedBreakOffset(e,t,i){if(it(e)){let r=this.flows[i].forcedBreakOffsets;(r.length===0||r[r.length-1]<t)&&r.push(t)}let n=this.breakBeforeValues[t];this.breakBeforeValues[t]=Je(n,e)}styleUntil(e,t){let i=-1,n;if(e<=this.lastOffset&&(n=this.offsetMap.slippedByFixed(e),i=n+t,i<this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(i);if(this.last==null)return Number.POSITIVE_INFINITY;let r=this.context;for(;;){let o=this.last.firstChild;if(o==null)for(;;){if(this.last.nodeType==1){this.cascade.popElement(this.last),this.primary=this.primaryStack.pop();let s=this.boxStack.pop(this.lastOffset),a=null;if(s.afterBox){let h=s.afterBox.getBreakValue("before");this.registerForcedBreakOffset(h,s.afterBox.atBlockStart?this.boxStack.nearestBlockStartOffset(s):s.afterBox.offset,s.flowName),a=s.afterBox.getBreakValue("after")}a=Je(a,s.getBreakValue("after")),this.registerForcedBreakOffset(a,this.lastOffset,s.flowName)}if(o=this.last.nextSibling,o)break;if(this.last=this.last.parentNode,this.last===this.root)return this.last=null,e<this.lastOffset&&(i<0&&(n=this.offsetMap.slippedByFixed(e),i=n+t),i<=this.offsetMap.getMaxSlipped())?this.offsetMap.fixedBySlipped(i):Number.POSITIVE_INFINITY}if(this.last=o,this.last.nodeType!=1)this.lastOffset+=this.last.textContent.length,this.boxStack.encounteredTextNode(this.last),this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset);else{let s=this.last,a=this.getAttrStyle(s);this.primaryStack.push(this.primary),this.cascade.pushElement(this,s,a,this.lastOffset);let h=s.getAttribute("id")||s.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");h&&h===this.idToReach&&(this.idToReach=null),!this.bodyReached&&s.localName=="body"&&s.parentNode==this.root&&(this.postprocessTopStyle(a,!0),this.bodyReached=!0);let l,c=a["flow-into"];if(c){let d=c.evaluate(r,"flow-into").toString(),f=this.encounteredFlowElement(d,a,s,this.lastOffset);this.primary=!!this.primaryFlows[d],l=this.boxStack.push(a,this.lastOffset,s===this.root,f)}else l=this.boxStack.push(a,this.lastOffset,s===this.root),s===this.xmldoc.body&&(l.breakBefore=Je(l.flowChunk.breakBefore,l.breakBefore));let p=this.boxStack.nearestBlockStartOffset(l);if(p===0){let d=a.page,f=d&&!te(d.value)&&d.value.toString();f&&f.toLowerCase()!=="auto"&&(this.cascade.firstPageType=f)}if(this.registerForcedBreakOffset(l.breakBefore,p,l.flowName),l.beforeBox){let d=l.beforeBox.getBreakValue("after");this.registerForcedBreakOffset(d,l.beforeBox.atBlockStart?p:l.offset,l.flowName)}if(this.primary&&l.displayValue()===x.none&&(this.primary=!1),this.styleMap[`e${this.lastOffset}`]=a,this.lastOffset++,this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset),this.bodyReached&&p===0)continue;if(e<this.lastOffset&&(i<0&&(n=this.offsetMap.slippedByFixed(e),i=n+t),i<=this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(i)}}}getStyle(e,t){let i=this.xmldoc.getElementOffset(e),n=`e${i}`;return t&&(i=this.xmldoc.getNodeOffset(e,0,!0)),this.lastOffset<=i&&this.styleUntil(i,0),this.styleMap[n]}processContent(e,t,i){}},dl=["column-count","column-width","column-fill"],_i=class{constructor(e){this.validator=e,u(this,"success",null),u(this,"failure",null),u(this,"code",0)}isSpecial(){return this.code!=0}markAsStartGroup(){this.code=-1}isStartGroup(){return this.code==-1}markAsEndGroup(){this.code=-2}isEndGroup(){return this.code==-2}markAsStartAlternate(e){this.code=2*e+1}isStartAlternate(){return this.code>0&&this.code%2!=0}markAsEndAlternate(e){this.code=2*e+2}isEndAlternate(){return this.code>0&&this.code%2==0}getAlternate(){return Math.floor((this.code-1)/2)}},si=class{constructor(e,t){this.where=e,this.success=t,u(this,"what",-1)}},an=class rc{constructor(){u(this,"nodes",[]),u(this,"connections",[]),u(this,"match",[]),u(this,"nomatch",[]),u(this,"error",[]),u(this,"emptyHead",!0)}connect(t,i){for(let n=0;n<t.length;n++)this.connections[t[n]].what=i;t.splice(0,t.length)}clone(){let t=new rc;for(let i=0;i<this.nodes.length;i++){let n=this.nodes[i],r=new _i(n.validator);r.code=n.code,t.nodes.push(r)}for(let i=0;i<this.connections.length;i++){let n=this.connections[i],r=new si(n.where,n.success);r.what=n.what,t.connections.push(r)}return t.match.push(...this.match),t.nomatch.push(...this.nomatch),t.error.push(...this.error),t}addSpecialToArr(t,i,n){let r=this.nodes.length,o=new _i(pl);n>=0?i?o.markAsStartAlternate(n):o.markAsEndAlternate(n):i?o.markAsStartGroup():o.markAsEndGroup(),this.nodes.push(o),this.connect(t,r);let s=new si(r,!0),a=new si(r,!1);t.push(this.connections.length),this.connections.push(a),t.push(this.connections.length),this.connections.push(s)}endSpecialGroup(){let t=[this.match,this.nomatch,this.error];for(let i=0;i<t.length;i++)this.addSpecialToArr(t[i],!1,-1)}startSpecialGroup(){if(this.nodes.length)throw new Error("invalid call");this.addSpecialToArr(this.match,!0,-1)}endClause(t){this.addSpecialToArr(this.match,!1,t)}startClause(t){if(this.nodes.length)throw new Error("invalid call");let i=new _i(pl);i.markAsStartAlternate(t),this.nodes.push(i);let n=new si(0,!0),r=new si(0,!1);this.nomatch.push(this.connections.length),this.connections.push(r),this.match.push(this.connections.length),this.connections.push(n)}addPrimitive(t){let i=this.nodes.length;this.nodes.push(new _i(t));let n=new si(i,!0),r=new si(i,!1);this.connect(this.match,i),this.emptyHead?(this.nomatch.push(this.connections.length),this.emptyHead=!1):this.error.push(this.connections.length),this.connections.push(r),this.match.push(this.connections.length),this.connections.push(n)}isSimple(){return this.nodes.length==1&&!this.nodes[0].isSpecial()}isPrimitive(){return this.isSimple()&&this.nodes[0].validator instanceof Re}addGroup(t,i){if(t.nodes.length==0)return;let n=this.nodes.length;if(i==4&&n==1&&t.isPrimitive()&&this.isPrimitive()){this.nodes[0].validator=this.nodes[0].validator.combine(t.nodes[0].validator);return}for(let o=0;o<t.nodes.length;o++)this.nodes.push(t.nodes[o]);i==4?(this.emptyHead=!0,this.connect(this.nomatch,n)):this.connect(this.match,n);let r=this.connections.length;for(let o=0;o<t.connections.length;o++){let s=t.connections[o];s.where+=n,s.what>=0&&(s.what+=n),this.connections.push(s)}for(let o=0;o<t.match.length;o++)this.match.push(t.match[o]+r);if(i==3&&this.connect(this.match,n),i==2||i==3)for(let o=0;o<t.nomatch.length;o++)this.match.push(t.nomatch[o]+r);else if(this.emptyHead){for(let o=0;o<t.nomatch.length;o++)this.nomatch.push(t.nomatch[o]+r);this.emptyHead=t.emptyHead}else for(let o=0;o<t.nomatch.length;o++)this.error.push(t.nomatch[o]+r);for(let o=0;o<t.error.length;o++)this.error.push(t.error[o]+r);t.nodes=null,t.connections=null}finish(t,i){let n=this.nodes.length;this.nodes.push(t),this.nodes.push(i),this.connect(this.match,n),this.connect(this.nomatch,n+1),this.connect(this.error,n+1);for(let r of this.connections)r.success?this.nodes[r.where].success=this.nodes[r.what]:this.nodes[r.where].failure=this.nodes[r.what];for(let r=0;r<n;r++)if(this.nodes[r].failure==null||this.nodes[r].success==null)throw new Error("Invalid validator state");return this.nodes[0]}},uw=1,oc=2,sc=4,ai=8,fr=16,es=32,gr=64,ac=128,dn=256,pn=512,ts=1024,lc=2048,hc=4096,uc=8192,cc=class extends Dt{constructor(){super()}validateForShorthand(e,t){let i=e[t].visit(this);return i?[i]:null}},Re=class dc extends cc{constructor(t,i,n){super(),this.allowed=t,this.idents=i,this.units=n}visitEmpty(t){return this.allowed&uw?t:null}visitSlash(t){return this.allowed&lc?t:null}visitStr(t){return this.allowed&oc?t:null}visitIdent(t){return this.idents[t.name.toLowerCase()]||(this.allowed&sc||this.allowed&gr&&CSS.supports("color",t.name)?t:null)}visitNumeric(t){return t.num==0&&!(this.allowed&pn)?t.unit=="%"&&this.allowed&ts?t:null:t.num<0&&!(this.allowed&dn)?null:this.units[t.unit]?t:null}visitNum(t){return t.num==0?this.allowed&pn?t:null:t.num<=0&&!(this.allowed&dn)?null:this.allowed&fr?t:null}visitInt(t){return t.num==0?this.allowed&pn?t:null:t.num<=0&&!(this.allowed&dn)?null:this.allowed&(es|fr)?t:this.idents[`${t.num}`]||null}visitHexColor(t){return this.allowed&gr&&/^([0-9A-F]{3,4}|([0-9A-F]{2}){3,4})$/i.test(t.hex)?t:null}visitURL(t){return this.allowed&ac?t:null}visitURange(t){return this.allowed&hc?t:null}visitSpaceList(t){return null}visitCommaList(t){return null}visitFunc(t){return this.allowed&gr&&CSS.supports("color",t.toString())||this.allowed&uc&&CSS.supports("background-image",t.toString())||t.name==="calc"&&this.allowed&(ai|fr|es|dn|pn|ts)?t:null}visitExpr(t){return this.allowed&2046?t:null}combine(t){let i={},n={};for(let r in this.idents)i[r]=this.idents[r];for(let r in t.idents)i[r]=t.idents[r];for(let r in this.units)n[r]=this.units[r];for(let r in t.units)n[r]=t.units[r];return new dc(this.allowed|t.allowed,i,n)}},se={},pl=new Re(0,se,se),zs=class extends cc{constructor(e){super(),u(this,"successTerminal"),u(this,"failureTerminal"),u(this,"first"),this.successTerminal=new _i(null),this.failureTerminal=new _i(null),this.first=e.finish(this.successTerminal,this.failureTerminal)}validateList(e,t,i){let n=t?[]:e,r=this.first,o=i,s=null,a=null;for(;r!==this.successTerminal&&r!==this.failureTerminal;){if(o>=e.length){r=r.failure;continue}let h=e[o],l=h;if(r.isSpecial()){let c=!0;r.isStartGroup()?(s?s.push(a):s=[a],a=[]):r.isEndGroup()?s.length>0?a=s.pop():a=null:r.isEndAlternate()?a[r.getAlternate()]="taken":c=a[r.getAlternate()]==null,r=c?r.success:r.failure}else{if(o==0&&!t&&r.validator instanceof Sn&&this instanceof Sn){if(l=new Ie(e).visit(r.validator),l){o=e.length,r=r.success;continue}}else if(o==0&&!t&&r.validator instanceof Ds&&this instanceof Sn){if(l=new et(e).visit(r.validator),l){o=e.length,r=r.success;continue}}else l=h.visit(r.validator);if(!l){r=r.failure;continue}if(l!==h&&e===n){n=[];for(let c=0;c<o;c++)n[c]=e[c]}e!==n&&(n[o-i]=l),o++,r=r.success}}return r===this.successTerminal&&(t?n.length>0:o==e.length)?n:null}validateSingle(e){let t=null,i=this.first;for(;i!==this.successTerminal&&i!==this.failureTerminal;){if(!e){i=i.failure;continue}if(i.isSpecial()){i=i.success;continue}if(t=e.visit(i.validator),!t){i=i.failure;continue}e=null,i=i.success}return i===this.successTerminal?t:null}visitEmpty(e){return this.validateSingle(e)}visitSlash(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitURange(e){return this.validateSingle(e)}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return null}},Sn=class extends zs{constructor(e){super(e)}visitSpaceList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new Ie(t):null}visitCommaList(e){let t=this.first,i=!1;for(;t;){if(t.validator instanceof Ds){i=!0;break}t=t.failure}if(i){let n=this.validateList(e.values,!1,0);return n===e.values?e:n?new et(n):null}return null}validateForShorthand(e,t){return this.validateList(e,!0,t)}},Ds=class extends zs{constructor(e){super(e)}visitSpaceList(e){return this.validateSingle(e)}visitCommaList(e){let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new et(t):null}validateForShorthand(e,t){let i=this.first,n;for(;i!==this.failureTerminal;){if(n=i.validator.validateForShorthand(e,t),n)return n;i=i.failure}return null}},cw=class extends zs{constructor(e,t){super(t),this.name=e}validateSingle(e){return null}visitFunc(e){if(e.name.toLowerCase()!=this.name)return null;let t=this.validateList(e.values,!1,0);return t===e.values?e:t?new qi(e.name,t):null}},pc=class{tryParse(e,t,i){return t}success(e,t){}},fc=class extends pc{constructor(e,t){super(),this.name=t,u(this,"validator"),this.validator=e.validators[this.name]}tryParse(e,t,i){if(i.values[this.name])return t;let n=this.validator.validateForShorthand(e,t);if(n){let r=n.length,o=r>1?new Ie(n):n[0];return this.success(o,i),t+r}return t}success(e,t){t.values[this.name]=e}},dw=class extends fc{constructor(e,t){super(e,t[0]),this.names=t}success(e,t){for(let i=0;i<this.names.length;i++)t.values[this.names[i]]=e}},pw=class extends pc{constructor(e,t){super(),this.nodes=e,this.slash=t}tryParse(e,t,i){let n=t;if(this.slash)if(e[t]==Br){if(++t==e.length)return n}else return n;let r=this.nodes[0].tryParse(e,t,i);if(r==t)return n;t=r;for(let o=1;o<this.nodes.length&&t<e.length&&(r=this.nodes[o].tryParse(e,t,i),r!=t);o++)t=r;return t}},Vs=class extends Dt{constructor(){super(...arguments),u(this,"syntax",null),u(this,"propList",null),u(this,"error",!1),u(this,"values",{}),u(this,"validatorSet",null)}setOwner(e){this.validatorSet=e}syntaxNodeForProperty(e){return new fc(this.validatorSet,e)}clone(){let e=new this.constructor;return e.syntax=this.syntax,e.propList=this.propList,e.validatorSet=this.validatorSet,e}init(e,t){this.syntax=e,this.propList=t}finish(e,t){var i,n;if(!this.error){for(let r of this.propList)t.simpleProperty(r,(n=(i=this.values[r])!=null?i:this.validatorSet.defaultValues[r])!=null?n:x.initial,e);return!0}return!1}propagateDefaultingValue(e,t,i){for(let n of this.propList)i.simpleProperty(n,e,t)}validateList(e){return this.error=!0,0}validateSingle(e){return this.validateList([e]),null}visitEmpty(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitSpaceList(e){return this.validateList(e.values),null}visitCommaList(e){return this.error=!0,null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return this.validateSingle(e)}},Ji=class extends Vs{constructor(){super()}validateList(e){let t=0,i=0;for(;t<e.length;){let n=this.syntax[i].tryParse(e,t,this);if(n>t){t=n,i=0;continue}if(++i==this.syntax.length){this.error=!0;break}}return t}},gc=class extends Vs{constructor(){super()}validateList(e){if(e.length>this.syntax.length||e.length==0)return this.error=!0,0;for(let t=0;t<this.syntax.length;t++){let i=t;for(;i>=e.length;)i=i==1?0:i-2;if(this.syntax[t].tryParse(e,i,this)!=i+1)return this.error=!0,0}return e.length}createSyntaxNode(){return new dw(this.validatorSet,this.propList)}},fw=class extends Vs{constructor(){super()}validateList(e){let t=e.length;for(let i=0;i<e.length;i++)if(e[i]===Br){t=i;break}if(t>this.syntax.length||e.length==0)return this.error=!0,0;for(let i=0;i<this.syntax.length;i++){let n=i;for(;n>=t;)n=n==1?0:n-2;let r;if(t+1<e.length)for(r=t+i+1;r>=e.length;)r=r-(r==t+2?1:2);else r=n;let o=[e[n],e[r]];if(this.syntax[i].tryParse(o,0,this)!=2)return this.error=!0,0}return e.length}},gw=class extends Ji{constructor(){super()}mergeIn(e,t){var i,n;for(let r of this.propList){let o=(n=(i=t[r])!=null?i:this.validatorSet.defaultValues[r])!=null?n:x.initial,s=e[r];s||(s=[],e[r]=s),s.push(o)}}visitCommaList(e){let t={};for(let i=0;i<e.values.length;i++)if(this.values={},e.values[i]instanceof et?this.error=!0:(e.values[i].visit(this),this.mergeIn(t,this.values),this.values["background-color"]&&i!=e.values.length-1&&(this.error=!0)),this.error)return null;this.values={};for(let i in t)i=="background-color"?this.values[i]=t[i].pop():this.values[i]=new et(t[i]);return null}},mw=class extends Ji{constructor(){super()}init(e,t){super.init(e,t),this.propList.push("font-family","line-height","font-size","font-stretch","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian")}validateList(e){let t=super.validateList(e),i=this.values["font-variant_css2"];i&&(delete this.values["font-variant_css2"],this.values["font-variant-caps"]=i);let n=this.values["font-stretch_css3"];if(n&&(delete this.values["font-stretch_css3"],this.values["font-stretch"]=n),t+2>e.length)return this.error=!0,t;this.error=!1;let r=this.validatorSet.validators;if(!e[t].visit(r["font-size"]))return this.error=!0,t;if(this.values["font-size"]=e[t++],e[t]===Br){if(t++,t+2>e.length)return this.error=!0,t;if(!e[t].visit(r["line-height"]))return this.error=!0,t;this.values["line-height"]=e[t++]}let o=t==e.length-1?e[t]:new Ie(e.slice(t,e.length));return o.visit(r["font-family"])?(this.values["font-family"]=o,e.length):(this.error=!0,t)}visitCommaList(e){if(e.values[0].visit(this),this.error)return null;let t=[this.values["font-family"]];for(let n=1;n<e.values.length;n++)t.push(e.values[n]);let i=new et(t);return i.visit(this.validatorSet.validators["font-family"])?this.values["font-family"]=i:this.error=!0,null}visitIdent(e){let t=this.validatorSet.systemFonts[e.name];if(t)for(let i in t)this.values[i]=t[i];else this.error=!0;return null}},ww=class extends Ji{validateList(e){if(e.length===1&&e[0]instanceof yt)switch(e[0].name.toLowerCase()){case"normal":e=[this.validatorSet.defaultValues["text-autospace"],this.validatorSet.defaultValues["text-spacing-trim"]];break;case"auto":e=[x.auto,x.auto];break;case"none":e=[z("no-autospace"),z("space-all")];break}return super.validateList(e)}},bw=["unicode-bidi","direction","margin-block-start","margin-block-end","margin-inline-start","margin-inline-end","padding-block-start","padding-block-end","padding-inline-start","padding-inline-end","border-block-start-color","border-block-end-color","border-inline-start-color","border-inline-end-color","border-block-start-style","border-block-end-style","border-inline-start-style","border-inline-end-style","border-block-start-width","border-block-end-width","border-inline-start-width","border-inline-end-width","block-start","block-end","inline-start","inline-end","block-size","inline-size","max-block-size","max-inline-size","min-block-size","min-inline-size","behavior","bleed","conflicting-partitions","crop-offset","enabled","flow-consume","flow-from","flow-into","flow-linger","flow-options","flow-priority","font-display","font-size-adjust","font-stretch_css3","font-variant_css2","glyph-orientation-vertical","marks","min-page-height","min-page-width","repeat-on-break","required","required-partitions","ruby-align","shape-inside","snap-height","snap-width","template","text-decoration-skip","text-justify","text-zoom","unicode-range","utilization","wrap-flow"],vw=class extends Ji{constructor(){super()}init(e,t){super.init(e,t);for(let i in this.validatorSet.validators)bw.includes(i)||this.propList.push(i)}validateList(e){return this.error=!0,0}},fl={SIMPLE:Ji,INSETS:gc,INSETS_SLASH:fw,COMMA:gw,FONT:mw,TEXT_SPACING:ww,ALL:vw},xw=class{constructor(){u(this,"validators",{}),u(this,"prefixes",{}),u(this,"defaultValues",{}),u(this,"namedValidators",{}),u(this,"systemFonts",{}),u(this,"shorthands",{}),u(this,"layoutProps",{}),u(this,"backgroundProps",{})}addReplacement(e,t){let i;if(t.type==3)i=new A(t.num,t.text);else if(t.type==7)i=new bh(t.text);else if(t.type==1)i=z(t.text);else throw new Error("unexpected replacement");if(e.isPrimitive()){let n=e.nodes[0].validator.idents;for(let r in n)n[r]=i;return e}throw new Error("unexpected replacement")}newGroup(e,t){let i=new an;if(e=="||"){for(let r=0;r<t.length;r++){let o=new an;o.startClause(r),o.addGroup(t[r],1),o.endClause(r),i.addGroup(o,r==0?1:4)}let n=new an;return n.startSpecialGroup(),n.addGroup(i,3),n.endSpecialGroup(),n}else{let n;switch(e){case" ":n=1;break;case"|":case"||":n=4;break;default:throw new Error("unexpected op")}for(let r=0;r<t.length;r++)i.addGroup(t[r],r==0?1:n);return i}}addCounts(e,t,i){let n=new an;for(let r=0;r<t;r++)n.addGroup(e.clone(),1);if(i==Number.POSITIVE_INFINITY)n.addGroup(e,3);else for(let r=t;r<i;r++)n.addGroup(e.clone(),2);return n}primitive(e){let t=new an;return t.addPrimitive(e),t}newFunc(e,t){let i;switch(e){case"COMMA":i=new Ds(t);break;case"SPACE":i=new Sn(t);break;default:i=new cw(e.toLowerCase(),t);break}return this.primitive(i)}initBuiltInValidators(){this.namedValidators.COLOR=this.primitive(new Re(gr,se,se)),this.namedValidators.IMAGE_FUNCTION=this.primitive(new Re(uc,se,se)),this.namedValidators.POS_INT=this.primitive(new Re(es,se,se)),this.namedValidators.POS_NUM=this.primitive(new Re(fr,se,se)),this.namedValidators.POS_PERCENTAGE=this.primitive(new Re(ai,se,{"%":X})),this.namedValidators.NEGATIVE=this.primitive(new Re(dn,se,se)),this.namedValidators.ZERO=this.primitive(new Re(pn,se,se)),this.namedValidators.ZERO_PERCENTAGE=this.primitive(new Re(ts,se,se)),this.namedValidators.POS_LENGTH=this.primitive(new Re(ai,se,{em:X,ex:X,ch:X,rem:X,lh:X,rlh:X,vw:X,vh:X,vi:X,vb:X,vmin:X,vmax:X,pvw:X,pvh:X,pvi:X,pvb:X,pvmin:X,pvmax:X,cm:X,mm:X,in:X,px:X,pt:X,pc:X,q:X})),this.namedValidators.POS_ANGLE=this.primitive(new Re(ai,se,{deg:X,grad:X,rad:X,turn:X})),this.namedValidators.POS_TIME=this.primitive(new Re(ai,se,{s:X,ms:X})),this.namedValidators.FREQUENCY=this.primitive(new Re(ai,se,{Hz:X,kHz:X})),this.namedValidators.RESOLUTION=this.primitive(new Re(ai,se,{dpi:X,dpcm:X,dppx:X})),this.namedValidators.URI=this.primitive(new Re(ac,se,se)),this.namedValidators.URANGE=this.primitive(new Re(hc,se,se)),this.namedValidators.IDENT=this.primitive(new Re(sc,se,se)),this.namedValidators.STRING=this.primitive(new Re(oc,se,se)),this.namedValidators.SLASH=this.primitive(new Re(lc,se,se));let e={"font-family":z("sans-serif")};this.systemFonts.caption=e,this.systemFonts.icon=e,this.systemFonts.menu=e,this.systemFonts["message-box"]=e,this.systemFonts["small-caption"]=e,this.systemFonts["status-bar"]=e}isBuiltIn(e){return!!e.match(/^[A-Z_0-9]+$/)}readNameAndPrefixes(e,t){let i=e.token();if(i.type==0)return null;let n={"":!0};if(i.type==14){do{if(e.consume(),i=e.token(),i.type!=1)throw new Error("Prefix name expected");n[i.text]=!0,e.consume(),i=e.token()}while(i.type==16);if(i.type!=15)throw new Error("']' expected");e.consume(),i=e.token()}if(i.type!=1)throw new Error("Property name expected");if(t==2?i.text=="SHORTHANDS":i.text=="DEFAULTS")return e.consume(),null;let r=i.text;if(e.consume(),t!=2){if(e.token().type!=39)throw new Error("'=' expected");this.isBuiltIn(r)||(this.prefixes[r]=n)}else if(e.token().type!=18)throw new Error("':' expected");return r}parseValidators(e){for(;;){let t=this.readNameAndPrefixes(e,1);if(!t)return;let i=[],n=[],r="",o,s=!0,a=()=>{if(i.length==0)throw new Error("No values");return i.length==1?i[0]:this.newGroup(r,i)},h=c=>{if(s)throw new Error(`'${c}': unexpected`);if(r&&r!=c)throw new Error(`mixed operators: '${c}' and '${r}'`);r=c,s=!0},l=null;for(;!l;){e.consume();let c=e.token();switch(c.type){case 1:if(s||h(" "),this.isBuiltIn(c.text)){let p=this.namedValidators[c.text];if(!p)throw new Error(`'${c.text}' unexpected`);i.push(p.clone())}else{let p={};p[c.text.toLowerCase()]=z(c.text),i.push(this.primitive(new Re(0,p,se)))}s=!1;break;case 5:{let p={};p[`${c.num}`]=new gi(c.num),i.push(this.primitive(new Re(0,p,se))),s=!1;break}case 34:h("|");break;case 25:h("||");break;case 14:s||h(" "),n.push({vals:i,op:r,b:"["}),r="",i=[],s=!0;break;case 6:s||h(" "),n.push({vals:i,op:r,b:"(",fn:c.text}),r="",i=[],s=!0;break;case 15:{o=a();let p=n.pop();if(p.b!="[")throw new Error("']' unexpected");i=p.vals,i.push(o),r=p.op,s=!1;break}case 11:{o=a();let p=n.pop();if(p.b!="(")throw new Error("')' unexpected");i=p.vals,i.push(this.newFunc(p.fn,o)),r=p.op,s=!1;break}case 18:if(s)throw new Error("':' unexpected");e.consume(),i.push(this.addReplacement(i.pop(),e.token()));break;case 22:if(s)throw new Error("'?' unexpected");i.push(this.addCounts(i.pop(),0,1));break;case 36:if(s)throw new Error("'*' unexpected");i.push(this.addCounts(i.pop(),0,Number.POSITIVE_INFINITY));break;case 23:if(s)throw new Error("'+' unexpected");i.push(this.addCounts(i.pop(),1,Number.POSITIVE_INFINITY));break;case 12:{if(e.consume(),c=e.token(),c.type!=5)throw new Error("<int> expected");let p=c.num,d=p;if(e.consume(),c=e.token(),c.type==16){if(e.consume(),c=e.token(),c.type!=5)throw new Error("<int> expected");d=c.num,e.consume(),c=e.token()}if(c.type!=13)throw new Error("'}' expected");i.push(this.addCounts(i.pop(),p,d));break}case 17:if(l=a(),n.length>0)throw new Error(`unclosed '${n.pop().b}'`);break;default:throw new Error("unexpected token")}}e.consume(),this.isBuiltIn(t)?this.namedValidators[t]=l:l.isSimple()?this.validators[t]=l.nodes[0].validator:this.validators[t]=new Sn(l)}}parseDefaults(e){for(;;){let t=this.readNameAndPrefixes(e,2);if(!t)return;let i=[];for(;;){e.consume();let n=e.token();if(n.type==17){e.consume();break}switch(n.type){case 1:i.push(z(n.text));break;case 4:i.push(new wi(n.num));break;case 5:i.push(new gi(n.num));break;case 3:i.push(new A(n.num,n.text));break;default:throw new Error("unexpected token")}}this.defaultValues[t]=i.length>1?new Ie(i):i[0]}}parseShorthands(e){for(;;){let t=this.readNameAndPrefixes(e,3);if(!t)return;let i=e.nthToken(1),n;i.type==1&&fl[i.text]?(n=new fl[i.text],e.consume()):n=new Ji,n.setOwner(this);let r=!1,o=[],s=!1,a=[],h=[];for(;!r;)switch(e.consume(),i=e.token(),i.type){case 1:if(this.validators[i.text])o.push(n.syntaxNodeForProperty(i.text)),i.text.includes("_")||h.push(i.text);else if(this.shorthands[i.text]instanceof gc){let l=this.shorthands[i.text];o.push(l.createSyntaxNode()),h.push(...l.propList)}else throw new Error(`'${i.text}' is neither a simple property nor an inset shorthand`);break;case 19:if(o.length>0||s)throw new Error("unexpected slash");s=!0;break;case 14:a.push({slash:s,syntax:o}),o=[],s=!1;break;case 15:{let l=new pw(o,s),c=a.pop();o=c.syntax,s=c.slash,o.push(l);break}case 17:r=!0,e.consume();break;default:throw new Error("unexpected token")}n.init(o,h),this.shorthands[t]=n}}parse(e){let t=new St(e,null);this.parseValidators(t),this.parseDefaults(t),this.parseShorthands(t),this.backgroundProps=this.makePropSet(["background"]),this.layoutProps=this.makePropSet(["margin","border","padding","columns","column-gap","column-rule","column-fill"])}makePropSet(e){var t;let i={};for(let n of e){let r=this.shorthands[n],o=r?r.propList:[n];for(let s of o)i[s]=(t=this.defaultValues[s])!=null?t:x.initial}return i}validatePropertyAndHandleShorthand(e,t,i,n){if(_t(e)||n.ruleType==="font-face"||Sw(t)){n.simpleProperty(e,t,i);return}let r="",o=e;e=e.toLowerCase();let s=e.match(/^-([a-z]+)-([-a-z0-9]+)$/);s&&(r=s[1],e=s[2]);let a=this.prefixes[e];if(!a||!a[r]){CSS.supports(e,t.toString())?n.simpleProperty(o,t,i):n.unknownProperty(o,t);return}let h=this.validators[e];if(h){let l=te(t)||t.isExpr()?t:t.visit(h);l?n.simpleProperty(e,l,i):!r&&CSS.supports(e,t.toString())?n.simpleProperty(e,t,i):n.invalidPropertyValue(o,t)}else{let l=this.shorthands[e].clone();te(t)?l.propagateDefaultingValue(t,i,n):(t.visit(l),l.finish(i,n)||n.invalidPropertyValue(o,t))}}};function mc(){let e=new xw;return e.initBuiltInValidators(),e.parse(Rh),e}var yw=class extends Dt{constructor(){super(...arguments),u(this,"varFound",!1)}visitFunc(e){return e.name==="var"?this.varFound=!0:this.varFound||this.visitValues(e.values),null}};function Sw(e){let t=new yw;return e.visit(t),t.varFound}var Ln={"font-style":x.auto,"font-stretch":x.auto,"font-weight":x.auto,"unicode-range":sp},wb=`OTTO${new Date().valueOf()}`;function Cw(e){let t=new Bt;for(let i in Ln)t.append(" "),t.append(e[i].toString());return t.toString()}function Ew(e){for(let t in Ln)e[t]||(e[t]=Ln[t])}function kw(e,t){let i={};for(let n in e)i[n]=Ge(e,n).evaluate(t,n);return Ew(i),i}var wc=class{constructor(e){this.properties=e,u(this,"fontTraitKey"),u(this,"src"),u(this,"blobURLs",[]),u(this,"blobs",[]),u(this,"family"),this.fontTraitKey=Cw(this.properties),this.src=this.properties.src?this.properties.src.toString():null;let t=this.properties["font-family"];this.family=t?t.stringValue():null}traitsEqual(e){return this.fontTraitKey==e.fontTraitKey}makeAtRule(e,t){let i=new Bt;i.append(`@font-face {
  font-family: `),i.append(this.family),i.append(`;
  `);for(let n in Ln)i.append(n),i.append(": "),this.properties[n].appendTo(i,!0),i.append(`;
  `);if(t){i.append('src: url("');let n=of(t);i.append(n),this.blobURLs.push(n),this.blobs.push(t),i.append('")')}else i.append("src: "),i.append(e);return i.append(`;
}
`),i.toString()}},Pw=class{constructor(e){this.deobfuscator=e,u(this,"familyMap",{})}registerFamily(e,t){let i=e.family,n=this.familyMap[i],r=t.family;if(n){if(n!=r)throw new Error(`E_FONT_FAMILY_INCONSISTENT ${e.family}`)}else this.familyMap[i]=r}filterFontFamily(e){if(e instanceof et){let t=e.values,i=[];for(let n of t){let r=this.familyMap[n.stringValue()];r&&i.push(z(r)),i.push(n)}return new et(i)}else{let t=this.familyMap[e.stringValue()];return t?new et([z(t),e]):e}}},Nw=class{constructor(e,t,i){this.head=e,this.body=t,u(this,"srcURLMap",{}),u(this,"familyPrefix"),u(this,"familyCounter",0),this.familyPrefix=i||"Fnt_"}getViewFontFamily(e,t){let i=e.family,n=t.familyMap[i];return n||(n=this.familyPrefix+ ++this.familyCounter,t.familyMap[i]=n,n)}initFont(e,t,i){let n=_("initFont"),r=e.src,o={};for(let l in Ln)o[l]=e.properties[l];let s=this.getViewFontFamily(e,i);o["font-family"]=z(s);let a=new wc(o),h=this.head.ownerDocument.createElement("style");return h.textContent=a.makeAtRule(r,t),this.head.appendChild(h),U.debug("Load font:",r),n.finish(a),n.result()}loadFont(e,t){let i=e.src,n=e.family+";"+i,r=this.srcURLMap[n];return r?r.piggyback(o=>{let s=o;s.traitsEqual(e)?(t.registerFamily(e,s),U.debug("Found already-loaded font:",i)):U.warn("E_FONT_FACE_INCOMPATIBLE",e.src)}):(r=new Dn(()=>{let o=_("loadFont"),s=i.replace(/^url\("([^"]+)"\).*$/,"$1"),a=t.deobfuscator?t.deobfuscator(s):null;return a?Dr(s,"blob").then(h=>{if(!h.responseBlob){o.finish(null);return}a(h.responseBlob).then(l=>{this.initFont(e,l,t).thenFinish(o)})}):this.initFont(e,null,t).thenFinish(o),o.result()},`loadFont ${i}`),this.srcURLMap[n]=r,r.start()),r}findOrLoadFonts(e,t){let i=[];for(let n of e){if(!n.src||!n.family){U.warn("E_FONT_FACE_INVALID");continue}i.push(this.loadFont(n,t))}return zr(i).thenAsync(()=>this.waitFontLoading())}waitFontLoading(){let e=this.head.ownerDocument.fonts,t=0;if(e.forEach(n=>{n.status==="unloaded"&&(t++,n.load().catch(r=>{}))}),t===0)return P(!0);let i=_("waitFontLoading");return i.loop(()=>i.sleep(20).thenAsync(()=>e.status==="loading"?P(!0):P(!1))).thenFinish(i),i.result()}},Tw=1,jr=class{constructor(e,t,i,n,r){this.name=t,this.pseudoName=i,this.classes=n,this.parent=r,u(this,"specified",{}),u(this,"children",[]),u(this,"pageMaster",null),u(this,"index",0),u(this,"key"),u(this,"_scope"),this._scope=e,this.key=`p${Tw++}`,r&&(this.index=r.children.length,r.children.push(this))}get scope(){return this._scope}createInstance(e){throw new Error("E_UNEXPECTED_CALL")}clone(e){throw new Error("E_UNEXPECTED_CALL")}copySpecified(e){let t=this.specified,i=e.specified;for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(i[n]=t[n])}cloneChildren(e){for(let t=0;t<this.children.length;t++)this.children[t].clone({parent:e})}},Iw=class extends jr{constructor(e){super(e,null,null,[],null),this.specified.width=new J(Yi,0),this.specified.height=new J(Ki,0)}},gl=class extends xo{constructor(e,t){super(e,n),this.pageMaster=t;let i=this;function n(r,o){let s=r.match(/^([^.]+)\.([^.]+)$/);if(s){let a=i.pageMaster.keyMap[s[1]];if(a){let h=this.lookupInstance(a);if(h)return o?h.resolveFunc(s[2]):h.resolveName(s[2])}}return null}}},bc=class vc extends jr{constructor(t,i,n,r,o,s,a){super(t,i,n,r,o),this.condition=s,this.specificity=a,u(this,"keyMap",{}),t instanceof gl||(this._scope=new gl(t,this)),this.pageMaster=this,this.specified.width=new J(Yi,0),this.specified.height=new J(Ki,0),this.specified["wrap-flow"]=new J(x.auto,0),this.specified.position=new J(x.relative,0),this.specified.overflow=new J(x.visible,0)}createInstance(t){return new Us(t,this)}clone(t){let i=new vc(this.scope,this.name,t.pseudoName||this.pseudoName,this.classes,this.parent,this.condition,this.specificity);return this.copySpecified(i),this.cloneChildren(i),i}resetScope(){this.scope.pageMaster=this}},xc=class yc extends jr{constructor(t,i,n,r,o){super(t,i,n,r,o),this.pageMaster=o.pageMaster,i&&(this.pageMaster.keyMap[i]=this.key),this.specified["wrap-flow"]=new J(x.auto,0)}createInstance(t){return new Lw(t,this)}clone(t){let i=new yc(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(i),this.cloneChildren(i),i}},Xr=class Sc extends jr{constructor(t,i,n,r,o){super(t,i,n,r,o),this.pageMaster=o.pageMaster,i&&(this.pageMaster.keyMap[i]=this.key)}createInstance(t){return new On(t,this)}clone(t){let i=new Sc(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(i),this.cloneChildren(i),i}};function Fw(e,t,i){return!t||te(t)?new ze(e,i):t.toExpr(e,e.zero)}function pe(e,t,i){return!t||t===x.auto||te(t)?null:t.toExpr(e,i)}function Aw(e,t,i){return!t||t===x.normal||te(t)?null:t.toExpr(e,i)}function at(e,t,i){return!t||t===x.auto||te(t)?e.zero:t.toExpr(e,i)}function ml(e,t,i){return!t||te(t)?e.zero:t===x.auto?null:t.toExpr(e,i)}function Nt(e,t,i,n){return!t||i===x.none||te(t)?e.zero:t.toExpr(e,n)}function Cc(e,t,i){return!t||te(t)?i:t===x._true?e._true:t===x._false?e._false:t.toExpr(e,e.zero)}var qr=class{constructor(e,t){this.parentInstance=e,this.pageBox=t,u(this,"cascaded",{}),u(this,"style",{}),u(this,"autoWidth",null),u(this,"autoHeight",null),u(this,"children",[]),u(this,"isAutoWidth",!1),u(this,"isAutoHeight",!1),u(this,"isTopDependentOnAutoHeight",!1),u(this,"isRightDependentOnAutoWidth",!1),u(this,"calculatedWidth",0),u(this,"calculatedHeight",0),u(this,"pageMasterInstance",null),u(this,"namedValues",{}),u(this,"namedFuncs",{}),u(this,"vertical",!1),u(this,"rtl",!1),u(this,"suppressEmptyBoxGeneration",!1),e&&e.children.push(this)}reset(){this.calculatedWidth=0,this.calculatedHeight=0}addNamedValues(e,t){let i=this.resolveName(e),n=this.resolveName(t);if(!i||!n)throw new Error("E_INTERNAL");return Y(this.pageBox.scope,i,n)}resolveName(e){let t=this.namedValues[e];if(t)return t;let i=this.style[e];switch(i&&(t=i.toExpr(this.pageBox.scope,this.pageBox.scope.zero)),e){case"margin-left-edge":t=this.resolveName("left");break;case"margin-top-edge":t=this.resolveName("top");break;case"margin-right-edge":t=this.addNamedValues("border-right-edge","margin-right");break;case"margin-bottom-edge":t=this.addNamedValues("border-bottom-edge","margin-bottom");break;case"border-left-edge":t=this.addNamedValues("margin-left-edge","margin-left");break;case"border-top-edge":t=this.addNamedValues("margin-top-edge","margin-top");break;case"border-right-edge":t=this.addNamedValues("padding-right-edge","border-right-width");break;case"border-bottom-edge":t=this.addNamedValues("padding-bottom-edge","border-bottom-width");break;case"padding-left-edge":t=this.addNamedValues("border-left-edge","border-left-width");break;case"padding-top-edge":t=this.addNamedValues("border-top-edge","border-top-width");break;case"padding-right-edge":t=this.addNamedValues("right-edge","padding-right");break;case"padding-bottom-edge":t=this.addNamedValues("bottom-edge","padding-bottom");break;case"left-edge":t=this.addNamedValues("padding-left-edge","padding-left");break;case"top-edge":t=this.addNamedValues("padding-top-edge","padding-top");break;case"right-edge":t=this.addNamedValues("left-edge","width");break;case"bottom-edge":t=this.addNamedValues("top-edge","height");break}if(!t){let n;if(e=="extent")n=this.vertical?"width":"height";else if(e=="measure")n=this.vertical?"height":"width";else{let r=this.vertical?bu:vu;n=e;for(let o in r)n=n.replace(o,r[o])}n!=e&&(t=this.resolveName(n))}return t&&(this.namedValues[e]=t),t}resolveFunc(e){let t=this.namedFuncs[e];if(t)return t;switch(e){case"columns":{let i=this.pageBox.scope,n=new ph(i,0),r=this.resolveName("column-count"),o=this.resolveName("column-width"),s=this.resolveName("column-gap");t=ue(i,cr(i,new gn(i,"min",[n,r]),Y(i,o,s)),s);break}}return t&&(this.namedFuncs[e]=t),t}initEnabled(){let e=this.pageBox.scope,t=this.style,i=Cc(e,t.enabled,e._true),n=pe(e,t.page,e.zero);if(n){let s=new $e(e,"page-number");i=gt(e,i,new gs(e,n,s))}let r=pe(e,t["min-page-width"],e.zero);r&&(i=gt(e,i,new So(e,new $e(e,"page-width"),r)));let o=pe(e,t["min-page-height"],e.zero);o&&(i=gt(e,i,new So(e,new $e(e,"page-height"),o))),i=this.boxSpecificEnabled(i),t.enabled=new $(i)}boxSpecificEnabled(e){return e}initHorizontal(){let e=this.pageBox.scope,t=this.style,i=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,n=pe(e,t.left,i),r=pe(e,t["margin-left"],i),o=Nt(e,t["border-left-width"],t["border-left-style"],i),s=at(e,t["padding-left"],i),a=pe(e,t.width,i),h=pe(e,t["max-width"],i),l=at(e,t["padding-right"],i),c=Nt(e,t["border-right-width"],t["border-right-style"],i),p=pe(e,t["margin-right"],i),d=pe(e,t.right,i),f=Y(e,o,s),g=Y(e,o,l);if(n&&d&&a){let b=ue(e,i,Y(e,a,Y(e,Y(e,n,f),g)));r?p?d=ue(e,b,p):p=ue(e,b,Y(e,d,r)):(b=ue(e,b,d),p?r=ue(e,b,p):(r=cr(e,b,new ze(e,.5)),p=r))}else{r||(r=e.zero),p||(p=e.zero),!n&&!d&&!a&&(n=e.zero),!n&&!a?(a=this.autoWidth,this.isAutoWidth=!0):!n&&!d?n=e.zero:!a&&!d&&(a=this.autoWidth,this.isAutoWidth=!0);let b=ue(e,i,Y(e,Y(e,r,f),Y(e,p,g)));this.isAutoWidth&&(h||(h=ue(e,b,n||d)),!this.vertical&&(pe(e,t["column-width"],null)||pe(e,t["column-count"],null))&&(a=h,this.isAutoWidth=!1)),n?a?d||(d=ue(e,b,Y(e,n,a))):a=ue(e,b,Y(e,n,d)):n=ue(e,b,Y(e,d,a))}let m=t["snap-width"]||(this.parentInstance?this.parentInstance.style["snap-width"]:null),v=at(e,m,i);t.left=new $(n),t["margin-left"]=new $(r),t["border-left-width"]=new $(o),t["padding-left"]=new $(s),t.width=new $(a),t["max-width"]=new $(h||a),t["padding-right"]=new $(l),t["border-right-width"]=new $(c),t["margin-right"]=new $(p),t.right=new $(d),t["snap-width"]=new $(v)}initVertical(){let e=this.pageBox.scope,t=this.style,i=this.parentInstance?this.parentInstance.style.width.toExpr(e,null):null,n=this.parentInstance?this.parentInstance.style.height.toExpr(e,null):null,r=pe(e,t.top,n),o=pe(e,t["margin-top"],i),s=Nt(e,t["border-top-width"],t["border-top-style"],i),a=at(e,t["padding-top"],i),h=pe(e,t.height,n),l=pe(e,t["max-height"],n),c=at(e,t["padding-bottom"],i),p=Nt(e,t["border-bottom-width"],t["border-bottom-style"],i),d=pe(e,t["margin-bottom"],i),f=pe(e,t.bottom,n),g=Y(e,s,a),m=Y(e,p,c);if(r&&f&&h){let w=ue(e,n,Y(e,h,Y(e,Y(e,r,g),m)));o?d?f=ue(e,w,o):d=ue(e,w,Y(e,f,o)):(w=ue(e,w,f),d?o=ue(e,w,d):(o=cr(e,w,new ze(e,.5)),d=o))}else{o||(o=e.zero),d||(d=e.zero),!r&&!f&&!h&&(r=e.zero),!r&&!h?(h=this.autoHeight,this.isAutoHeight=!0):!r&&!f?r=e.zero:!h&&!f&&(h=this.autoHeight,this.isAutoHeight=!0);let w=ue(e,n,Y(e,Y(e,o,g),Y(e,d,m)));this.isAutoHeight&&(l||(l=ue(e,w,r||f)),this.vertical&&(pe(e,t["column-width"],null)||pe(e,t["column-count"],null))&&(h=l,this.isAutoHeight=!1)),r?h?f||(f=ue(e,w,Y(e,r,h))):h=ue(e,w,Y(e,f,r)):r=ue(e,w,Y(e,f,h))}let v=t["snap-height"]||(this.parentInstance?this.parentInstance.style["snap-height"]:null),b=at(e,v,i);t.top=new $(r),t["margin-top"]=new $(o),t["border-top-width"]=new $(s),t["padding-top"]=new $(a),t.height=new $(h),t["max-height"]=new $(l||h),t["padding-bottom"]=new $(c),t["border-bottom-width"]=new $(p),t["margin-bottom"]=new $(d),t.bottom=new $(f),t["snap-height"]=new $(b)}initColumns(){let e=this.pageBox.scope,t=this.style,i=pe(e,t[this.vertical?"height":"width"],null),n=pe(e,t["column-width"],i),r=pe(e,t["column-count"],null),o=Aw(e,t["column-gap"],null);o||(o=new fi(e,1,"em")),n&&!r&&(r=new gn(e,"floor",[Co(e,Y(e,i,o),Y(e,n,o))]),r=new gn(e,"max",[e.one,r])),r||(r=e.one),n=ue(e,Co(e,Y(e,i,o),r),o),t["column-width"]=new $(n),t["column-count"]=new $(r),t["column-gap"]=new $(o)}depends(e,t,i){return this.style[e].toExpr(this.pageBox.scope,null).depend(t,i)}init(e){e.registerInstance(this.pageBox.key,this);let t=this.pageBox.scope,i=this.style,n=this.parentInstance?this.parentInstance.getActiveRegions(e):null,r=Mu(this.cascaded,e,n,!1,null);this.vertical=Bu(r,e,this.parentInstance?this.parentInstance.vertical:!1),this.rtl=_u(r,e,this.parentInstance?this.parentInstance.rtl:!1),Du(r,i,this.vertical,this.rtl,(o,s)=>s.value),this.autoWidth=new We(t,()=>this.calculatedWidth,"autoWidth"),this.autoHeight=new We(t,()=>this.calculatedHeight,"autoHeight"),this.initHorizontal(),this.initVertical(),this.initColumns(),this.initEnabled()}getProp(e,t){var i,n;let r=this.style[t];return!r&&vn(t)&&(t==="font-size"&&e.isRelativeRootFontSize&&e.rootFontSize?r=new A(e.rootFontSize,"px"):r=(n=((i=e.styler)==null?void 0:i.rootStyle)[t])==null?void 0:n.value),r&&(r=Tr(e,r,t)),r}getPropAsNumber(e,t){var i,n;let r=this.style[t];if(r){let o=/\b(height|top|bottom)\b/.test(t)?(i=e.pageAreaHeight)!=null?i:e.pageHeight():(n=e.pageAreaWidth)!=null?n:e.pageWidth();r=Tr(e,r,t,o)}return Ze(r,e)}getSpecial(e,t){let i=Su(this.cascaded,t);if(i){let n=[];for(let r=0;r<i.length;r++){let o=i[r].evaluate(e,"");o&&o!==X&&n.push(o)}if(n.length)return n}return null}getActiveRegions(e){let t=this.getSpecial(e,"region-id");if(t){let i=[];for(let n=0;n<t.length;n++)i[n]=t[n].toString();return i}return null}propagateProperty(e,t,i,n){this.propagatePropertyToElement(e,t.element,i,n)}propagatePropertyToElement(e,t,i,n){let r=this.getProp(e,i);r&&(r.isNumeric()&&th(r.unit)&&(r=xh(r,e)),i==="font-family"&&(r=n.filterFontFamily(r)),(i.startsWith("background")||i==="z-index")&&t.parentElement.hasAttribute("data-vivliostyle-bleed-box")&&(t=t.parentElement),T(t,i,r.toString()))}propagateDelayedProperty(e,t,i,n){let r=this.getProp(e,i);r&&n.push(new Cs(t.element,i,r))}assignLeftPosition(e,t){let i=this.getPropAsNumber(e,"left"),n=this.getPropAsNumber(e,"margin-left"),r=this.getPropAsNumber(e,"padding-left"),o=this.getPropAsNumber(e,"border-left-width"),s=this.getPropAsNumber(e,"width");t.setHorizontalPosition(i,s),T(t.element,"margin-left",`${n}px`),T(t.element,"padding-left",`${r}px`),T(t.element,"border-left-width",`${o}px`),t.marginLeft=n,t.borderLeft=o,t.paddingLeft=r}assignRightPosition(e,t){let i=this.getPropAsNumber(e,"right"),n=this.getPropAsNumber(e,"snap-height"),r=this.getPropAsNumber(e,"margin-right"),o=this.getPropAsNumber(e,"padding-right"),s=this.getPropAsNumber(e,"border-right-width");if(T(t.element,"margin-right",`${r}px`),T(t.element,"padding-right",`${o}px`),T(t.element,"border-right-width",`${s}px`),t.marginRight=r,t.borderRight=s,this.vertical&&n>0){let a=i+t.getInsetRight(),h=a-Math.floor(a/n)*n;h>0&&(t.snapOffsetX=n-h,o+=t.snapOffsetX)}t.paddingRight=o,t.snapWidth=n}assignTopPosition(e,t){let i=this.getPropAsNumber(e,"snap-height"),n=this.getPropAsNumber(e,"top"),r=this.getPropAsNumber(e,"margin-top"),o=this.getPropAsNumber(e,"padding-top"),s=this.getPropAsNumber(e,"border-top-width");if(t.top=n,t.marginTop=r,t.borderTop=s,t.snapHeight=i,!this.vertical&&i>0){let a=n+t.getInsetTop(),h=a-Math.floor(a/i)*i;h>0&&(t.snapOffsetY=i-h,o+=t.snapOffsetY)}t.paddingTop=o,T(t.element,"top",`${n}px`),T(t.element,"margin-top",`${r}px`),T(t.element,"padding-top",`${o}px`),T(t.element,"border-top-width",`${s}px`)}assignBottomPosition(e,t){let i=this.getPropAsNumber(e,"margin-bottom"),n=this.getPropAsNumber(e,"padding-bottom"),r=this.getPropAsNumber(e,"border-bottom-width"),o=this.getPropAsNumber(e,"height")-t.snapOffsetY;T(t.element,"height",`${o}px`),T(t.element,"margin-bottom",`${i}px`),T(t.element,"padding-bottom",`${n}px`),T(t.element,"border-bottom-width",`${r}px`),t.height=o-t.snapOffsetY,t.marginBottom=i,t.borderBottom=r,t.paddingBottom=n}assignBeforePosition(e,t){this.vertical?this.assignRightPosition(e,t):this.assignTopPosition(e,t)}assignAfterPosition(e,t){this.vertical?this.assignLeftPosition(e,t):this.assignBottomPosition(e,t)}assignStartEndPosition(e,t){this.vertical?(this.assignTopPosition(e,t),this.assignBottomPosition(e,t)):(this.assignRightPosition(e,t),this.assignLeftPosition(e,t))}sizeWithMaxHeight(e,t){T(t.element,"border-top-width","0px");let i=this.getPropAsNumber(e,"max-height");this.isTopDependentOnAutoHeight?t.setVerticalPosition(0,i):(this.assignTopPosition(e,t),i-=t.snapOffsetY,t.height=i,T(t.element,"height",`${i}px`))}sizeWithMaxWidth(e,t){T(t.element,"border-left-width","0px");let i=this.getPropAsNumber(e,"max-width");if(this.isRightDependentOnAutoWidth)t.setHorizontalPosition(0,i);else{this.assignRightPosition(e,t),i-=t.snapOffsetX,t.width=i;let n=this.getPropAsNumber(e,"right");T(t.element,"right",`${n}px`),T(t.element,"width",`${i}px`)}}prepareContainer(e,t,i,n,r){(!this.parentInstance||this.vertical!=this.parentInstance.vertical)&&T(t.element,"writing-mode",this.vertical?"vertical-rl":"horizontal-tb"),(!this.parentInstance||this.rtl!=this.parentInstance.rtl)&&T(t.element,"direction",this.rtl?"rtl":"ltr"),(this.vertical?this.isAutoWidth:this.isAutoHeight)?this.vertical?this.sizeWithMaxWidth(e,t):this.sizeWithMaxHeight(e,t):(this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),(this.vertical?this.isAutoHeight:this.isAutoWidth)?this.vertical?this.sizeWithMaxHeight(e,t):this.sizeWithMaxWidth(e,t):this.assignStartEndPosition(e,t);for(let o=0;o<wl.length;o++)this.propagateProperty(e,t,wl[o],n)}transferContentProps(e,t,i,n){for(let r=0;r<vl.length;r++)this.propagateProperty(e,t,vl[r],n)}transferSingleUriContentProps(e,t,i){let n=()=>{var o,s;let a=(s=(o=this.cascaded.width)!=null?o:this.cascaded[this.vertical?"block-size":"inline-size"])==null?void 0:s.value;return!!a&&a!==x.auto&&!te(a)},r=()=>{var o,s;let a=(s=(o=this.cascaded.height)!=null?o:this.cascaded[this.vertical?"inline-size":"block-size"])==null?void 0:s.value;return!!a&&a!==x.auto&&!te(a)};for(let o=0;o<xl.length;o++){let s=xl[o];s==="width"&&!n()||s==="height"&&!r()||this.propagatePropertyToElement(e,t,s,i)}}finishContainer(e,t,i,n,r,o,s){this.vertical?this.calculatedWidth=t.computedBlockSize+t.snapOffsetX:this.calculatedHeight=t.computedBlockSize+t.snapOffsetY;let a=(this.vertical||!n)&&this.isAutoHeight,h=(!this.vertical||!n)&&this.isAutoWidth,l=null;if((h||a)&&(h&&T(t.element,"width","auto"),a&&T(t.element,"height","auto"),l=o.getElementClientRect(n?n.element:t.element),h&&(this.calculatedWidth=Math.ceil(l.right-l.left-t.paddingLeft-t.borderLeft-t.paddingRight-t.borderRight),this.vertical&&(this.calculatedWidth+=t.snapOffsetX)),a&&(this.calculatedHeight=l.bottom-l.top-t.paddingTop-t.borderTop-t.paddingBottom-t.borderBottom,this.vertical||(this.calculatedHeight+=t.snapOffsetY))),(this.vertical?this.isAutoHeight:this.isAutoWidth)&&this.assignStartEndPosition(e,t),(this.vertical?this.isAutoWidth:this.isAutoHeight)&&((this.vertical?this.isRightDependentOnAutoWidth:this.isTopDependentOnAutoHeight)&&this.assignBeforePosition(e,t),this.assignAfterPosition(e,t)),r>1){let c=this.getPropAsNumber(e,"column-rule-width"),p=this.getProp(e,"column-rule-style"),d=this.getProp(e,"column-rule-color");if(c>0&&p&&p!=x.none&&d!=x.transparent){let f=this.getPropAsNumber(e,"column-gap"),g=this.vertical?t.height:t.width,m=this.vertical?"border-top":"border-left";for(let v=1;v<r;v++){let b=this.vertical?(g+f)*v/r-f/2+t.paddingTop-c/2:(g+f)*v/r-f/2+t.paddingLeft-c/2,w=this.vertical?t.width+t.paddingLeft+t.paddingRight:t.height+t.paddingTop+t.paddingBottom,S=t.element.ownerDocument.createElement("div");T(S,"position","absolute"),T(S,this.vertical?"left":"top","0px"),T(S,this.vertical?"top":"left",`${b}px`),T(S,this.vertical?"height":"width","0px"),T(S,this.vertical?"width":"height",`${w}px`),T(S,m,`${c}px ${p.toString()}${d?` ${d.toString()}`:""}`),t.element.insertBefore(S,t.element.firstChild)}}}for(let c=0;c<bl.length;c++)this.propagateProperty(e,t,bl[c],s);for(let c=0;c<yl.length;c++)this.propagateDelayedProperty(e,t,yl[c],i.delayedItems)}applyCascadeAndInit(e,t){let i=this.cascaded,n=this.pageBox.specified;for(let o in n)this.pageBox.pseudoName=="vivliostyle-page-rule-master"&&(o==="writing-mode"||o==="direction")||Vi(o)&&ci(i,o,Ge(n,o));if(this.pageBox.pseudoName==Hs)for(let o in t)(o.match(/^background-/)||o=="writing-mode")&&(i[o]=t[o]);if(this.pageBox.pseudoName=="layout-host")for(let o in t)!o.match(/^background-/)&&o!="writing-mode"&&(i[o]=t[o]);e.pushRule(this.pageBox.classes,null,i);let r=i.content;r&&(i.content=r.filterValue(new qo(e,null,e.counterResolver))),this.init(e.context);for(let o of this.pageBox.children)o.createInstance(this).applyCascadeAndInit(e,t);e.popRule()}resolveAutoSizing(e){this.isAutoWidth&&(this.isRightDependentOnAutoWidth=this.depends("right",this.autoWidth,e)||this.depends("margin-right",this.autoWidth,e)||this.depends("border-right-width",this.autoWidth,e)||this.depends("padding-right",this.autoWidth,e)),this.isAutoHeight&&(this.isTopDependentOnAutoHeight=this.depends("top",this.autoHeight,e)||this.depends("margin-top",this.autoHeight,e)||this.depends("border-top-width",this.autoHeight,e)||this.depends("padding-top",this.autoHeight,e));for(let t of this.children)t.resolveAutoSizing(e)}},wl=["border-left-style","border-right-style","border-top-style","border-bottom-style","border-left-color","border-right-color","border-top-color","border-bottom-color","outline-style","outline-color","outline-width","overflow","visibility"],bl=["border-top-left-radius","border-top-right-radius","border-bottom-right-radius","border-bottom-left-radius","border-image-source","border-image-slice","border-image-width","border-image-outset","border-image-repeat","background-attachment","background-color","background-image","background-repeat","background-position","background-clip","background-origin","background-size","opacity","z-index","background-blend-mode","isolation","mix-blend-mode","filter"],vl=["color","font-family","font-size","font-style","font-weight","line-height","letter-spacing","text-align","text-decoration","text-indent","text-transform","white-space","word-spacing","font-feature-settings","font-kerning","font-size-adjust","font-variant-ligatures","font-variant-caps","font-variant-numeric","font-variant-east-asian","font-stretch","text-combine-upright","text-decoration-color","text-decoration-line","text-decoration-skip","text-decoration-style","text-decoration-thickness","text-emphasis","text-emphasis-color","text-emphasis-position","text-emphasis-style","text-fill-color","text-orientation","text-shadow","text-stroke-color","text-stroke-width","text-underline-position"],xl=["width","height","image-resolution","object-fit","object-position"],yl=["transform","transform-origin"],Hs="background-host",Rw=class extends qr{constructor(e){super(null,e)}applyCascadeAndInit(e,t){super.applyCascadeAndInit(e,t),this.children.sort((i,n)=>n.pageBox.specificity-i.pageBox.specificity||i.pageBox.index-n.pageBox.index)}},Us=class extends qr{constructor(e,t){super(e,t),this.pageMasterInstance=this}boxSpecificEnabled(e){let t=this.pageBox.pageMaster;return t.condition&&(e=gt(t.scope,e,t.condition)),e}adjustPageLayout(e,t,i){}},Lw=class extends qr{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}},On=class extends qr{constructor(e,t){super(e,t),this.pageMasterInstance=e.pageMasterInstance}processPartitionList(e,t,i){let n=null;if(t instanceof yt&&(n=[t]),t instanceof et&&(n=t.values),n){let r=this.pageBox.scope;for(let o=0;o<n.length;o++)if(n[o]instanceof yt){let s=vo(n[o].name,"enabled"),a=new $e(r,s);i&&(a=new qt(r,a)),e=gt(r,e,a)}}return e}boxSpecificEnabled(e){let t=this.pageBox.scope,i=this.style,n=Cc(t,i.required,t._false)!==t._false;if(n||this.isAutoHeight){let r=Fw(t,i["flow-from"],"body"),o=new gn(t,"has-content",[r]);e=gt(t,e,o)}if(e=this.processPartitionList(e,i["required-partitions"],!1),e=this.processPartitionList(e,i["conflicting-partitions"],!0),n){let r=this.pageMasterInstance.style.enabled,o=r?r.toExpr(t,null):t._true;o=gt(t,o,e),this.pageMasterInstance.style.enabled=new $(o)}return e}prepareContainer(e,t,i,n,r){i.pageAreaElement||T(t.element,"overflow","hidden"),super.prepareContainer(e,t,i,n,r)}},$s=class extends Vn{constructor(e,t,i,n){super(e,t,!1),this.target=i,this.validatorSet=n}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}simpleProperty(e,t,i){this.target.specified[e]=new J(t,i?Vh:Hh)}},Ec=class extends $s{constructor(e,t,i,n){super(e,t,i,n)}},Ow=class kc extends $s{constructor(t,i,n,r){super(t,i,n,r),n.specified.width=new J(ka,0),n.specified.height=new J(ka,0)}startPartitionRule(t,i,n){let r=new Xr(this.scope,t,i,n,this.target),o=new Ec(this.scope,this.owner,r,this.validatorSet);this.owner.pushHandler(o)}startPartitionGroupRule(t,i,n){let r=new xc(this.scope,t,i,n,this.target),o=new kc(this.scope,this.owner,r,this.validatorSet);this.owner.pushHandler(o)}},Bw=class extends $s{constructor(e,t,i,n){super(e,t,i,n)}startPartitionRule(e,t,i){let n=new Xr(this.scope,e,t,i,this.target),r=new Ec(this.scope,this.owner,n,this.validatorSet);this.owner.pushHandler(r)}startPartitionGroupRule(e,t,i){let n=new xc(this.scope,e,t,i,this.target),r=new Ow(this.scope,this.owner,n,this.validatorSet);this.owner.pushHandler(r)}};function Pc(e){var t,i;let n=(t=e["writing-mode"])==null?void 0:t.value,r=(i=e.direction)==null?void 0:i.value;return n===x.vertical_lr||n!==x.vertical_rl&&r!==x.rtl?"ltr":"rtl"}var _w={a10:{width:new A(26,"mm"),height:new A(37,"mm")},a9:{width:new A(37,"mm"),height:new A(52,"mm")},a8:{width:new A(52,"mm"),height:new A(74,"mm")},a7:{width:new A(74,"mm"),height:new A(105,"mm")},a6:{width:new A(105,"mm"),height:new A(148,"mm")},a5:{width:new A(148,"mm"),height:new A(210,"mm")},a4:{width:new A(210,"mm"),height:new A(297,"mm")},a3:{width:new A(297,"mm"),height:new A(420,"mm")},a2:{width:new A(420,"mm"),height:new A(594,"mm")},a1:{width:new A(594,"mm"),height:new A(841,"mm")},a0:{width:new A(841,"mm"),height:new A(1189,"mm")},b10:{width:new A(31,"mm"),height:new A(44,"mm")},b9:{width:new A(44,"mm"),height:new A(62,"mm")},b8:{width:new A(62,"mm"),height:new A(88,"mm")},b7:{width:new A(88,"mm"),height:new A(125,"mm")},b6:{width:new A(125,"mm"),height:new A(176,"mm")},b5:{width:new A(176,"mm"),height:new A(250,"mm")},b4:{width:new A(250,"mm"),height:new A(353,"mm")},b3:{width:new A(353,"mm"),height:new A(500,"mm")},b2:{width:new A(500,"mm"),height:new A(707,"mm")},b1:{width:new A(707,"mm"),height:new A(1e3,"mm")},b0:{width:new A(1e3,"mm"),height:new A(1414,"mm")},c10:{width:new A(28,"mm"),height:new A(40,"mm")},c9:{width:new A(40,"mm"),height:new A(57,"mm")},c8:{width:new A(57,"mm"),height:new A(81,"mm")},c7:{width:new A(81,"mm"),height:new A(114,"mm")},c6:{width:new A(114,"mm"),height:new A(162,"mm")},c5:{width:new A(162,"mm"),height:new A(229,"mm")},c4:{width:new A(229,"mm"),height:new A(324,"mm")},c3:{width:new A(324,"mm"),height:new A(458,"mm")},c2:{width:new A(458,"mm"),height:new A(648,"mm")},c1:{width:new A(648,"mm"),height:new A(917,"mm")},c0:{width:new A(917,"mm"),height:new A(1297,"mm")},"jis-b10":{width:new A(32,"mm"),height:new A(45,"mm")},"jis-b9":{width:new A(45,"mm"),height:new A(64,"mm")},"jis-b8":{width:new A(64,"mm"),height:new A(91,"mm")},"jis-b7":{width:new A(91,"mm"),height:new A(128,"mm")},"jis-b6":{width:new A(128,"mm"),height:new A(182,"mm")},"jis-b5":{width:new A(182,"mm"),height:new A(257,"mm")},"jis-b4":{width:new A(257,"mm"),height:new A(364,"mm")},"jis-b3":{width:new A(364,"mm"),height:new A(515,"mm")},"jis-b2":{width:new A(515,"mm"),height:new A(728,"mm")},"jis-b1":{width:new A(728,"mm"),height:new A(1030,"mm")},"jis-b0":{width:new A(1030,"mm"),height:new A(1456,"mm")},letter:{width:new A(8.5,"in"),height:new A(11,"in")},legal:{width:new A(8.5,"in"),height:new A(14,"in")},ledger:{width:new A(11,"in"),height:new A(17,"in")}},Mw=new A(.24,"pt"),bb=new A(3,"mm"),zw=new A(10,"mm"),Dw=new A(13,"mm");function Ar(e){let t={width:Yi,height:Ki,bleed:ce,bleedOffset:ce,cropOffset:ce},i=e.size;if(!(!i||i.value===x.auto)){let l=i.value,c,p;if(l.isSpaceList()?(c=l.values[0],p=l.values[1]):(c=l,p=null),c.isNumeric())t.width=c,t.height=p||c;else{let d=c.name&&_w[c.name.toLowerCase()];d&&(p&&p===x.landscape?(t.width=d.height,t.height=d.width):(t.width=d.width,t.height=d.height))}}let n=e.marks,r=e.bleed,o=n&&!te(n.value)?n.value:x.none,s=r&&!te(r.value)?r.value:x.auto;if(s===x.auto){if(o!==x.none){let l=!1;o.isSpaceList()?l=o.values.some(c=>c===x.crop):l=o===x.crop,l&&(t.bleed=new A(6,"pt"))}}else s.isNumeric()&&(t.bleed=s);let a=e["crop-offset"],h=a&&!te(a.value)?a.value:x.auto;return h===x.auto?o!==x.none&&(t.bleedOffset=Dw):h.isNumeric()&&(t.cropOffset=h),t}function Sl(e,t){let i={},n=Math.max(0,e.bleed.num)*t.queryUnitSize(e.bleed.unit,!1),r=!e.cropOffset.num&&e.bleedOffset.num?e.bleedOffset.num*t.queryUnitSize(e.bleedOffset.unit,!1):Math.max(0,e.cropOffset.num*t.queryUnitSize(e.cropOffset.unit,!1)-n),o=n+r,s=e.width;s===Yi?t.pref.defaultPaperSize?i.pageWidth=t.pref.defaultPaperSize.width*t.queryUnitSize("px",!1):i.pageWidth=(t.pref.spreadView?Math.floor(t.viewportWidth/2)-t.pref.pageBorder:t.viewportWidth)-o*2:i.pageWidth=s.num*t.queryUnitSize(s.unit,!1);let a=e.height;return a===Ki?t.pref.defaultPaperSize?i.pageHeight=t.pref.defaultPaperSize.height*t.queryUnitSize("px",!1):i.pageHeight=t.viewportHeight-o*2:i.pageHeight=a.num*t.queryUnitSize(a.unit,!1),i.bleed=n,i.bleedOffset=r,i.cropOffset=o,i}function Nc(e,t,i){let n=e.createElementNS("http://www.w3.org/2000/svg","svg");return n.setAttribute("width",t),n.setAttribute("height",i),n.style.position="absolute",n}function Cn(e,t,i){i=i||"polyline";let n=e.createElementNS("http://www.w3.org/2000/svg",i);return n.setAttribute("stroke","#010101"),n.setAttribute("stroke-width",t),n.setAttribute("fill","none"),n}var is=(e=>(e.TOP_LEFT="top left",e.TOP_RIGHT="top right",e.BOTTOM_LEFT="bottom left",e.BOTTOM_RIGHT="bottom right",e))(is||{});function Vw(e,t,i,n,r,o){let s=n;s<=r+2*xe.mm&&(s=r+n/2);let a=Math.max(n,s),h=r+a+i/2,l=Nc(e,h,h),c=[[0,r+n],[n,r+n],[n,r+n-s]],p=c.map(g=>[g[1],g[0]]);(t==="top right"||t==="bottom right")&&(c=c.map(g=>[r+a-g[0],g[1]]),p=p.map(g=>[r+a-g[0],g[1]])),(t==="bottom left"||t==="bottom right")&&(c=c.map(g=>[g[0],r+a-g[1]]),p=p.map(g=>[g[0],r+a-g[1]]));let d=Cn(e,i);d.setAttribute("points",c.map(g=>g.join(",")).join(" ")),l.appendChild(d);let f=Cn(e,i);return f.setAttribute("points",p.map(g=>g.join(",")).join(" ")),l.appendChild(f),t.split(" ").forEach(g=>{l.style[g]=`${o}px`}),l}var Bn=(e=>(e.TOP="top",e.BOTTOM="bottom",e.LEFT="left",e.RIGHT="right",e))(Bn||{});function Hw(e,t,i,n,r){let o=n*2,s,a;t==="top"||t==="bottom"?(s=o,a=n):(s=n,a=o);let h=Nc(e,s,a),l=Cn(e,i);l.setAttribute("points",`0,${a/2} ${s},${a/2}`),h.appendChild(l);let c=Cn(e,i);c.setAttribute("points",`${s/2},0 ${s/2},${a}`),h.appendChild(c);let p=Cn(e,i,"circle");p.setAttribute("cx",s/2),p.setAttribute("cy",a/2),p.setAttribute("r",n/4),h.appendChild(p);let d;switch(t){case"top":d="bottom";break;case"bottom":d="top";break;case"left":d="right";break;case"right":d="left";break}return Object.keys(Bn).forEach(f=>{let g=Bn[f];g===t?h.style[g]=`${r}px`:g!==d&&(h.style[g]="0",h.style[`margin-${g}`]="auto")}),h}function Uw(e,t,i,n){let r=!1,o=!1,s=e.marks;if(s){let f=s.value;f instanceof Ie?f.values.forEach(g=>{g===x.crop?r=!0:g===x.cross&&(o=!0)}):f===x.crop?r=!0:f===x.cross&&(o=!0)}let a=t.bleed;if(!r&&!o)return;let h=i.container,l=h.ownerDocument,c=Ze(Mw,n),p=Math.max(0,t.bleedOffset-Ze(zw,n)),d=t.bleedOffset-p;r&&Object.keys(is).forEach(f=>{let g=is[f],m=Vw(l,g,c,d,a,p);h.appendChild(m)}),o&&Object.keys(Bn).forEach(f=>{let g=Bn[f],m=Hw(l,g,c,d,p);h.appendChild(m)})}var ns=(()=>{let e=["left","right","top","bottom","before","after","start","end","block-start","block-end","inline-start","inline-end"],t={width:!0,height:!0,"block-size":!0,"inline-size":!0,margin:!0,padding:!0,border:!0,outline:!0,"outline-width":!0,"outline-style":!0,"outline-color":!0};return e.forEach(i=>{t[`margin-${i}`]=!0,t[`padding-${i}`]=!0,t[`border-${i}-width`]=!0,t[`border-${i}-style`]=!0,t[`border-${i}-color`]=!0}),t})(),Ws={"top-left-corner":{order:1,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"top-left":{order:2,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"top-center":{order:3,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"top-right":{order:4,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"top-right-corner":{order:5,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"right-top":{order:6,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"start"},"right-middle":{order:7,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"center"},"right-bottom":{order:8,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:"end"},"bottom-right-corner":{order:9,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},"bottom-right":{order:10,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"end"},"bottom-center":{order:11,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"center"},"bottom-left":{order:12,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:"start"},"bottom-left-corner":{order:13,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},"left-bottom":{order:14,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"end"},"left-middle":{order:15,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"center"},"left-top":{order:16,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:"start"}},$w=(()=>{let e=Ws;return Object.keys(e).sort((t,i)=>e[t].order-e[i].order)})(),Gs="vivliostyle-page-rule-master",_n="_marginBoxes",Ww=class extends bc{constructor(e,t,i){super(e,null,Gs,[],t,null,0),u(this,"bodyPartitionKey"),u(this,"pageMarginBoxes",{});let n=Ar(i),r=new Gw(this.scope,this,i,n);this.bodyPartitionKey=r.key,this.createPageMarginBoxes(i),this.applySpecified(i,n)}createPageMarginBoxes(e){let t=e[_n];t&&$w.forEach(i=>{t[i]&&(this.pageMarginBoxes[i]=new jw(this.scope,this,i,e))})}applySpecified(e,t){this.specified.position=new J(x.relative,0),this.specified.width=new J(t.width,0),this.specified.height=new J(t.height,0);for(let i in e)!ns[i]&&i!=="background-clip"&&(this.specified[i]=e[i])}createInstance(e){return new mr(e,this)}},Gw=class extends Xr{constructor(e,t,i,n){super(e,null,null,[],t),this.pageSize=n,this.specified["z-index"]=new J(new gi(0),0),this.applySpecified(i)}applySpecified(e){this.specified["flow-from"]=new J(z("body"),0),this.specified.position=new J(x.absolute,0),this.specified.overflow=new J(x.visible,0);for(let t in ns)ns.hasOwnProperty(t)&&(this.specified[t]=e[t])}createInstance(e){return new Ic(e,this)}},jw=class extends Xr{constructor(e,t,i,n){super(e,null,null,[],t),this.marginBoxName=i,this.applySpecified(n)}applySpecified(e){let t=e[_n][this.marginBoxName];for(let i in e){let n=e[i],r=t[i];(wu[i]||r&&r.value===x.inherit)&&(this.specified[i]=n)}for(let i in t)if(Object.prototype.hasOwnProperty.call(t,i)){let n=t[i];n&&n.value!==X&&n.value!==x.inherit&&n.value!==x.unset&&n.value!==x.revert&&(this.specified[i]=n)}}createInstance(e){return new qw(e,this)}},mr=class extends Us{constructor(e,t){super(e,t),u(this,"pageAreaDimension",null),u(this,"pageMarginBoxInstances",{})}applyCascadeAndInit(e,t){let i=this.cascaded;for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n))switch(n){case"writing-mode":case"direction":i[n]=t[n]}super.applyCascadeAndInit(e,t)}initHorizontal(){let e=this.style;e.left=ce,e["margin-left"]=ce,e["border-left-width"]=ce,e["padding-left"]=ce,e["padding-right"]=ce,e["border-right-width"]=ce,e["margin-right"]=ce,e.right=ce}initVertical(){let e=this.style;e.top=ce,e["margin-top"]=ce,e["border-top-width"]=ce,e["padding-top"]=ce,e["padding-bottom"]=ce,e["border-bottom-width"]=ce,e["margin-bottom"]=ce,e.bottom=ce}setPageAreaDimension(e){this.pageAreaDimension=e;let t=this.style;t.width=new $(e.borderBoxWidth),t.height=new $(e.borderBoxHeight),t["padding-left"]=new $(e.marginLeft),t["padding-right"]=new $(e.marginRight),t["padding-top"]=new $(e.marginTop),t["padding-bottom"]=new $(e.marginBottom)}adjustPageLayout(e,t,i){let n=t.marginBoxes,r={start:this.pageAreaDimension.marginLeft,end:this.pageAreaDimension.marginRight,extent:this.pageAreaDimension.borderBoxWidth},o={start:this.pageAreaDimension.marginTop,end:this.pageAreaDimension.marginBottom,extent:this.pageAreaDimension.borderBoxHeight};this.sizeMarginBoxesAlongVariableDimension(n.top,!0,r,e,i),this.sizeMarginBoxesAlongVariableDimension(n.bottom,!0,r,e,i),this.sizeMarginBoxesAlongVariableDimension(n.left,!1,o,e,i),this.sizeMarginBoxesAlongVariableDimension(n.right,!1,o,e,i)}sizeMarginBoxesAlongVariableDimension(e,t,i,n,r){let o="start",s="center",a="end",h=this.pageBox.scope,l={},c={},p={};for(let S in e){let L=Ws[S];if(L){let B=e[S],D=this.pageMarginBoxInstances[S],W=new Tc(B,D.style,t,h,r);l[L.positionAlongVariableDimension]=B,c[L.positionAlongVariableDimension]=D,p[L.positionAlongVariableDimension]=W}}let d={start:i.start.evaluate(n),end:i.end.evaluate(n),extent:i.extent.evaluate(n)},f=this.getSizesOfMarginBoxesAlongVariableDimension(p,d.extent),g=!1,m={};Object.keys(l).forEach(S=>{let L=S,B=pe(h,c[L].style[t?"max-width":"max-height"],i.extent);if(B){let D=B.evaluate(n);if(f[L]>D){let W=p[L]=new Cl(l[L],c[L].style,t,h,r,D);m[L]=W.getOuterSize(),g=!0}}}),g&&(f=this.getSizesOfMarginBoxesAlongVariableDimension(p,d.extent),g=!1,[o,s,a].forEach(S=>{f[S]=m[S]||f[S]}));let v={};Object.keys(l).forEach(S=>{let L=S,B=pe(h,c[L].style[t?"min-width":"min-height"],i.extent);if(B){let D=B.evaluate(n);if(f[L]<D){let W=p[L]=new Cl(l[L],c[L].style,t,h,r,D);v[L]=W.getOuterSize(),g=!0}}}),g&&(f=this.getSizesOfMarginBoxesAlongVariableDimension(p,d.extent),[o,s,a].forEach(S=>{f[S]=v[S]||f[S]}));let b=d.start+d.extent,w=d.start+(d.start+d.extent);[o,s,a].forEach(S=>{let L=f[S];if(L){let B=l[S],D=0;switch(S){case o:D=t?B.left:B.top;break;case s:D=(w-L)/2;break;case a:D=b-L;break}t?B.setHorizontalPosition(D,L-B.getInsetLeft()-B.getInsetRight()):B.setVerticalPosition(D,L-B.getInsetTop()-B.getInsetBottom())}})}getSizesOfMarginBoxesAlongVariableDimension(e,t){let i=e.start,n=e.center,r=e.end,o={};if(n){let s=[i,r].filter(p=>p),a=s.length?new Xw(s):null,h=this.distributeAutoMarginBoxSizes(n,a,t);h.xSize&&(o.center=h.xSize);let l=h.xSize||n.getOuterSize(),c=(t-l)/2;i&&i.hasAutoSize()&&(o.start=c),r&&r.hasAutoSize()&&(o.end=c)}else{let s=this.distributeAutoMarginBoxSizes(i,r,t);s.xSize&&(o.start=s.xSize),s.ySize&&(o.end=s.ySize)}return o}distributeAutoMarginBoxSizes(e,t,i){let n={xSize:null,ySize:null};if(e&&t)if(e.hasAutoSize()&&t.hasAutoSize()){let r=e.getOuterMaxContentSize(),o=t.getOuterMaxContentSize();if(r>0&&o>0){let s=r+o;if(s<i)n.xSize=i*r/s;else{let a=e.getOuterMinContentSize(),h=t.getOuterMinContentSize(),l=a+h;l<i?n.xSize=a+(i-l)*(r-a)/(s-l):l>0&&(n.xSize=i*a/l)}n.xSize>0&&(n.ySize=i-n.xSize)}else r>0?n.xSize=i:o>0&&(n.ySize=i)}else e.hasAutoSize()?n.xSize=Math.max(i-t.getOuterSize(),0):t.hasAutoSize()&&(n.ySize=Math.max(i-e.getOuterSize(),0));else e?e.hasAutoSize()&&(n.xSize=i):t&&t.hasAutoSize()&&(n.ySize=i);return n}prepareContainer(e,t,i,n,r){super.prepareContainer(e,t,i,n,r),t.element.setAttribute("data-vivliostyle-page-box",!0)}},Tc=class{constructor(e,t,i,n,r){this.container=e,this.isHorizontal=i,this.clientLayout=r,u(this,"hasAutoSize_"),u(this,"size",null);let o=t[i?"width":"height"];this.hasAutoSize_=!o||o===x.auto||te(o)}hasAutoSize(){return this.hasAutoSize_}getSize(){if(!this.size){let e=this.isHorizontal?["max-content width","min-content width"]:["max-content height","min-content height"];this.size=Ss(this.clientLayout,this.container.element,e)}return this.size}getOuterMaxContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["max-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["max-content height"]+this.container.getInsetBottom()}getOuterMinContentSize(){let e=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+e["min-content width"]+this.container.getInsetRight():this.container.getInsetTop()+e["min-content height"]+this.container.getInsetBottom()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.container.width+this.container.getInsetRight():this.container.getInsetTop()+this.container.height+this.container.getInsetBottom()}},Xw=class{constructor(e){this.params=e}hasAutoSize(){return this.params.some(e=>e.hasAutoSize())}getOuterMaxContentSize(){let e=this.params.map(t=>t.getOuterMaxContentSize());return Math.max.apply(null,e)*e.length}getOuterMinContentSize(){let e=this.params.map(t=>t.getOuterMinContentSize());return Math.max.apply(null,e)*e.length}getOuterSize(){let e=this.params.map(t=>t.getOuterSize());return Math.max.apply(null,e)*e.length}},Cl=class extends Tc{constructor(e,t,i,n,r,o){super(e,t,i,n,r),u(this,"fixedSize"),this.fixedSize=o}hasAutoSize(){return!1}getOuterMaxContentSize(){return this.getOuterSize()}getOuterMinContentSize(){return this.getOuterSize()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.fixedSize+this.container.getInsetRight():this.container.getInsetTop()+this.fixedSize+this.container.getInsetBottom()}},Ic=class extends On{constructor(e,t){super(e,t),u(this,"borderBoxWidth",null),u(this,"borderBoxHeight",null),u(this,"marginTop",null),u(this,"marginRight",null),u(this,"marginBottom",null),u(this,"marginLeft",null)}applyCascadeAndInit(e,t){let i=this.cascaded;for(let n in t)Object.prototype.hasOwnProperty.call(t,n)&&(n.match(/^column.*$/)||n.match(/^background-/))&&(i[n]=t[n]);super.applyCascadeAndInit(e,t),this.parentInstance.setPageAreaDimension({borderBoxWidth:this.borderBoxWidth,borderBoxHeight:this.borderBoxHeight,marginTop:this.marginTop,marginRight:this.marginRight,marginBottom:this.marginBottom,marginLeft:this.marginLeft})}initHorizontal(){let e=this.resolvePageBoxDimensions({start:"left",end:"right",extent:"width"});this.borderBoxWidth=e.borderBoxExtent,this.marginLeft=e.marginStart,this.marginRight=e.marginEnd}initVertical(){let e=this.resolvePageBoxDimensions({start:"top",end:"bottom",extent:"height"});this.borderBoxHeight=e.borderBoxExtent,this.marginTop=e.marginStart,this.marginBottom=e.marginEnd}resolvePageBoxDimensions(e){let t=this.style,i=this.pageBox.pageSize,n=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,a=i[s].toExpr(n,null),h=pe(n,t[s],a),l=pe(n,t[`margin-${r}`],a),c=pe(n,t[`margin-${o}`],a),p=at(n,t[`padding-${r}`],a),d=at(n,t[`padding-${o}`],a),f=Nt(n,t[`border-${r}-width`],t[`border-${r}-style`],a),g=Nt(n,t[`border-${o}-width`],t[`border-${o}-style`],a),m=ue(n,a,Y(n,Y(n,f,p),Y(n,g,d)));return h?(m=ue(n,m,h),!l&&!c?(l=cr(n,m,new ze(n,.5)),c=l):l?c=ue(n,m,l):l=ue(n,m,c)):(l||(l=n.zero),c||(c=n.zero),h=ue(n,m,Y(n,l,c))),i.width!==Yi||i.height!==Ki||this.hasBorderOrOutline()||l instanceof fi&&l.num<0||c instanceof fi&&c.num<0?(t[r]=new $(l),t[o]=new $(c),t[`margin-${r}`]=ce,t[`margin-${o}`]=ce,t[`border-${r}-width`]=new $(f),t[`border-${o}-width`]=new $(g)):(t[r]=ce,t[o]=ce,t[`margin-${r}`]=ce,t[`margin-${o}`]=ce,t[`border-${r}-width`]=new $(l),t[`border-${o}-width`]=new $(c),t[`border-${r}-style`]=x.solid,t[`border-${o}-style`]=x.solid,t[`border-${r}-color`]=x.transparent,t[`border-${o}-color`]=x.transparent,t["background-clip"]=x.padding_box),t[`padding-${r}`]=new $(p),t[`padding-${o}`]=new $(d),t[s]=new $(h),t[`max-${s}`]=new $(h),{borderBoxExtent:ue(n,a,Y(n,l,c)),marginStart:l,marginEnd:c}}hasBorderOrOutline(){let e=t=>{var i;let n=(i=Ge(this.cascaded,t))==null?void 0:i.value;return!!n&&n!==x.none};return e("border-top-style")||e("border-bottom-style")||e("border-left-style")||e("border-right-style")||e("border-block-start-style")||e("border-block-end-style")||e("border-inline-start-style")||e("border-inline-end-style")||e("outline-style")}prepareContainer(e,t,i,n,r){i.pageAreaElement=t.element,super.prepareContainer(e,t,i,n,r),e.pageAreaWidth=parseFloat(i.pageAreaElement.style.width),e.pageAreaHeight=parseFloat(i.pageAreaElement.style.height)}},qw=class extends On{constructor(e,t){super(e,t),u(this,"boxInfo"),u(this,"suppressEmptyBoxGeneration",!0);let i=t.marginBoxName;this.boxInfo=Ws[i];let n=e;n.pageMarginBoxInstances[i]=this}prepareContainer(e,t,i,n,r){this.applyVerticalAlign(e,t.element),super.prepareContainer(e,t,i,n,r)}applyVerticalAlign(e,t){T(t,"display","flex"),T(t,"flex-flow",this.vertical?this.rtl?"row-reverse":"row":"column");let i=this.getProp(e,"vertical-align"),n=null;i===z("middle")?n="center":i===z("top")?n="flex-start":i===z("bottom")&&(n="flex-end"),n&&T(t,"justify-content",n);let r=this.getProp(e,"content");if(this.vertical||r instanceof bt||r instanceof $&&r.expr instanceof We&&r.expr.str.startsWith("running-element-")){let o="center";(this.boxInfo.isInTopRow||this.boxInfo.isInBottomRow)&&(this.boxInfo.isInLeftColumn||this.boxInfo.positionAlongVariableDimension==="end"?o=this.vertical||this.rtl?"start":"end":(this.boxInfo.isInRightColumn||this.boxInfo.positionAlongVariableDimension==="start")&&(o=this.vertical||this.rtl?"end":"start")),T(t,"align-items",o)}}positionAlongVariableDimension(e,t){let i=this.style,n=this.pageBox.scope,r=e.start,o=e.end,s=e.extent,a=r==="left",h=a?t.borderBoxWidth:t.borderBoxHeight,l=pe(n,i[s],h),c=a?t.marginLeft:t.marginTop;if(this.boxInfo.positionAlongVariableDimension==="start")i[r]=new $(c);else if(l){let p=at(n,i[`margin-${r}`],h),d=at(n,i[`margin-${o}`],h),f=at(n,i[`padding-${r}`],h),g=at(n,i[`padding-${o}`],h),m=Nt(n,i[`border-${r}-width`],i[`border-${r}-style`],h),v=Nt(n,i[`border-${o}-width`],i[`border-${o}-style`],h),b=Y(n,l,Y(n,Y(n,f,g),Y(n,Y(n,m,v),Y(n,p,d))));switch(this.boxInfo.positionAlongVariableDimension){case"center":i[r]=new $(Y(n,c,Co(n,ue(n,h,b),new ze(n,2))));break;case"end":i[r]=new $(ue(n,Y(n,c,h),b));break}}}positionAndSizeAlongFixedDimension(e,t){let i=this.style,n=this.pageBox.scope,r=e.inside,o=e.outside,s=e.extent,a=t[`margin${o.charAt(0).toUpperCase()}${o.substring(1)}`],h=ml(n,i[`margin-${r}`],a),l=ml(n,i[`margin-${o}`],a),c=at(n,i[`padding-${r}`],a),p=at(n,i[`padding-${o}`],a),d=Nt(n,i[`border-${r}-width`],i[`border-${r}-style`],a),f=Nt(n,i[`border-${o}-width`],i[`border-${o}-style`],a),g=pe(n,i[s],a),m=null;function v(b){if(m)return m;m={extent:g?g.evaluate(b):null,marginInside:h?h.evaluate(b):null,marginOutside:l?l.evaluate(b):null};let w=a.evaluate(b),S=0;return[d,c,p,f].forEach(L=>{L&&(S+=L.evaluate(b))}),(m.marginInside===null||m.marginOutside===null)&&S+m.extent+m.marginInside+m.marginOutside>w&&(m.marginInside===null&&(m.marginInside=0),m.marginOutside===null&&(m.marginOutside=0)),m.extent!==null&&m.marginInside!==null&&m.marginOutside!==null&&(m.marginOutside=null),m.extent===null&&m.marginInside!==null&&m.marginOutside!==null?m.extent=w-S-m.marginInside-m.marginOutside:m.extent!==null&&m.marginInside===null&&m.marginOutside!==null?m.marginInside=w-S-m.extent-m.marginOutside:m.extent!==null&&m.marginInside!==null&&m.marginOutside===null?m.marginOutside=w-S-m.extent-m.marginInside:m.extent===null?(m.marginInside=m.marginOutside=0,m.extent=w-S):m.marginInside=m.marginOutside=(w-S-m.extent)/2,m}i[s]=new $(new We(n,function(){let b=v(this).extent;return b===null?0:b},s)),i[`margin-${r}`]=new $(new We(n,function(){let b=v(this).marginInside;return b===null?0:b},`margin-${r}`)),i[`margin-${o}`]=new $(new We(n,function(){let b=v(this).marginOutside;return b===null?0:b},`margin-${o}`)),r==="left"?i.left=new $(Y(n,t.marginLeft,t.borderBoxWidth)):r==="top"&&(i.top=new $(Y(n,t.marginTop,t.borderBoxHeight)))}initHorizontal(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInLeftColumn?this.positionAndSizeAlongFixedDimension({inside:"right",outside:"left",extent:"width"},e):this.boxInfo.isInRightColumn?this.positionAndSizeAlongFixedDimension({inside:"left",outside:"right",extent:"width"},e):this.positionAlongVariableDimension({start:"left",end:"right",extent:"width"},e)}initVertical(){let e=this.parentInstance.pageAreaDimension;this.boxInfo.isInTopRow?this.positionAndSizeAlongFixedDimension({inside:"bottom",outside:"top",extent:"height"},e):this.boxInfo.isInBottomRow?this.positionAndSizeAlongFixedDimension({inside:"top",outside:"bottom",extent:"height"},e):this.positionAlongVariableDimension({start:"top",end:"bottom",extent:"height"},e)}finishContainer(e,t,i,n,r,o,s){super.finishContainer(e,t,i,n,r,o,s);let a=i.marginBoxes,h=this.pageBox.marginBoxName,l=this.boxInfo;!l.isInLeftColumn&&!l.isInRightColumn?l.isInTopRow?a.top[h]=t:l.isInBottomRow&&(a.bottom[h]=t):!l.isInTopRow&&!l.isInBottomRow&&(l.isInLeftColumn?a.left[h]=t:l.isInRightColumn&&(a.right[h]=t))}},Yw=class{constructor(e,t,i,n,r){this.cascadeInstance=e,this.pageScope=t,this.rootPageBoxInstance=i,this.context=n,this.docElementStyle=r,u(this,"pageMasterCache",{}),this.definePageProgression()}definePageProgression(){let e=this.pageScope,t=this.context,i=t.isVersoFirstPage,n=new $e(e,"page-number"),r=new gs(e,new hh(e,n,new ze(e,2)),i?e.one:e.zero);e.defineName("recto-page",new qt(e,r)),e.defineName("verso-page",r),(t.pageProgression||Pc(this.docElementStyle))==="ltr"?(e.defineName("left-page",r),e.defineName("right-page",new qt(e,r))):(e.defineName("left-page",new qt(e,r)),e.defineName("right-page",r))}getCascadedPageStyle(e){let t={};return this.cascadeInstance.pushRule([],e,t),this.cascadeInstance.popRule(),t}getPageRulePageMaster(e,t){let i=e.pageBox;if(Object.keys(t).length===0)return i.resetScope(),e;let n=this.makeCacheKey(t,i),r=this.pageMasterCache[n];return r||(i.pseudoName===Hs?r=this.generatePageRuleMaster(t):r=this.generateCascadedPageMaster(t,i),this.pageMasterCache[n]=r),r.pageBox.resetScope(),r}makeCacheKey(e,t){let i=this.makeCascadeValueObjectKey(e);return`${t.key}^${i}`}makeCascadeValueObjectKey(e){let t=[];for(let i in e)if(Object.prototype.hasOwnProperty.call(e,i)){let n=e[i],r;n instanceof J?r=`${n.value}`:r=this.makeCascadeValueObjectKey(n),t.push(i+r+(n.priority||""))}return t.sort().join("^")}generatePageRuleMaster(e){let t=new Ww(this.pageScope,this.rootPageBoxInstance.pageBox,e).createInstance(this.rootPageBoxInstance);return t.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),t.resolveAutoSizing(this.context),t}generateCascadedPageMaster(e,t){let i=t.clone({pseudoName:Gs}),n=i.specified,r=e.size;if(r&&!te(r.value)){let s=Ar(e),a=r.priority;zt(n,"width",new J(s.width,a),this.context),zt(n,"height",new J(s.height,a),this.context)}["counter-reset","counter-increment"].forEach(s=>{n[s]&&(e[s]=n[s])});let o=i.createInstance(this.rootPageBoxInstance);return o.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),o.resolveAutoSizing(this.context),o}},Kw=class extends be{constructor(e){super(),this.pageType=e}apply(e){e.currentPageType===this.pageType&&this.chained.apply(e)}getPriority(){return 3}makePrimary(e){return this.chained&&e.insertInTable(e.pagetypes,this.pageType,this.chained),!0}},Zw=class extends be{constructor(e){super(),this.scope=e}apply(e){new $e(this.scope,"page-number").evaluate(e.context)===1&&this.chained.apply(e)}getPriority(){return 2}},Qw=class extends be{constructor(e){super(),this.scope=e}apply(e){new $e(this.scope,"blank-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}},Jw=class extends be{constructor(e){super(),this.scope=e}apply(e){new $e(this.scope,"left-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},e0=class extends be{constructor(e){super(),this.scope=e}apply(e){new $e(this.scope,"right-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},t0=class extends be{constructor(e){super(),this.scope=e}apply(e){new $e(this.scope,"recto-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},i0=class extends be{constructor(e){super(),this.scope=e}apply(e){new $e(this.scope,"verso-page").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},n0=class extends Un{constructor(e,t,i){super(t,i),this.scope=e,this.a=t,this.b=i}apply(e){let t=e.context,i=t.layoutPositionAtPageStart.page;t.blankPageAtStart&&i--,i&&this.matchANPlusB(i)&&this.chained.apply(e)}getPriority(){return 2}},r0=class extends As{constructor(e,t){super(e,t,null,null,null)}apply(e){o0(e.context,e.currentStyle,this.style,this.specificity,e)}};function o0(e,t,i,n,r){Nr(e,t,i,n,null,null,null);let o=i[_n];if(o){let s=$r(t,_n);for(let a in o)if(o.hasOwnProperty(a)){let h=s[a];h||(h={},s[a]=h),Nr(e,h,o[a],n,null,null,null)}}}var s0=class extends Tn{constructor(e,t,i,n,r){super(e,t,i?.condition,i,null,n,!1),this.pageProps=r,u(this,"currentPageSelectors",[]),u(this,"currentNamedPageSelector",""),u(this,"currentPseudoPageClassSelectors",[])}startPageRule(){this.startSelectorRule()}tagSelector(e,t){this.currentNamedPageSelector=t,t&&(this.chain.push(new Kw(t)),this.specificity+=65536)}pseudoclassSelector(e,t){if(e=e.toLowerCase(),t)switch(e){case"nth":{let[i,n]=t;this.currentPseudoPageClassSelectors.push(`:${e}(${i}n${n<0?n:"+"+n})`),this.chain.push(new n0(this.scope,i,n)),this.specificity+=256}break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}(${t.join("")})`);break}else switch(this.currentPseudoPageClassSelectors.push(`:${e}`),e){case"first":this.chain.push(new Zw(this.scope)),this.specificity+=256;break;case"blank":this.chain.push(new Qw(this.scope)),this.specificity+=256;break;case"left":this.chain.push(new Jw(this.scope)),this.specificity+=1;break;case"right":this.chain.push(new e0(this.scope)),this.specificity+=1;break;case"recto":this.chain.push(new t0(this.scope)),this.specificity+=1;break;case"verso":this.chain.push(new i0(this.scope)),this.specificity+=1;break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}`);break}}finishSelector(){let e;!this.currentNamedPageSelector&&!this.currentPseudoPageClassSelectors.length?e=null:e=[this.currentNamedPageSelector].concat(this.currentPseudoPageClassSelectors.sort()),this.currentPageSelectors.push({selectors:e,specificity:this.specificity}),this.currentNamedPageSelector="",this.currentPseudoPageClassSelectors=[]}nextSelector(){this.finishSelector(),super.nextSelector()}startRuleBody(){this.finishSelector(),super.startRuleBody()}simpleProperty(e,t,i){if((e==="bleed"||e==="marks")&&!this.currentPageSelectors.some(o=>o.selectors===null))return;super.simpleProperty(e,t,i);let n=Ge(this.elementStyle,e),r=this.pageProps;if(e==="bleed"||e==="marks")r[""]||(r[""]={}),Object.keys(r).forEach(o=>{ci(r[o],e,n)});else if(e==="size"){let o=r[""];this.currentPageSelectors.forEach(s=>{let a=new J(n.value,n.priority+s.specificity),h=s.selectors?s.selectors.join(""):"",l=r[h];l?zt(l,e,a):(l=r[h]={},ci(l,e,a),o&&["bleed","marks"].forEach(c=>{o[c]&&ci(l,c,o[c])}))})}}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.pagetypes,"*",e)}makeApplyRuleAction(e){return new r0(this.elementStyle,e)}startPageMarginBoxRule(e){let t=$r(this.elementStyle,_n),i=t[e];i||(i={},t[e]=i);let n=new a0(this.scope,this.owner,this.validatorSet,i);this.owner.pushHandler(n)}},a0=class extends Vn{constructor(e,t,i,n){super(e,t,!1),this.validatorSet=i,this.boxStyle=n}property(e,t,i){this.validatorSet.validatePropertyAndHandleShorthand(e,t,i,this)}invalidPropertyValue(e,t){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${t.toString()}`)}unknownProperty(e,t){this.report(`E_INVALID_PROPERTY ${e}: ${t.toString()}`)}simpleProperty(e,t,i){let n=i?this.getImportantSpecificity():this.getBaseSpecificity(),r=new J(t,n);ci(this.boxStyle,e,r)}},Tt=!0;function l0(e){Tt=e}var di=[];function El(e,t){return e===t||(e.src||t.src?e.src===t.src:e.textContent===t.textContent)}function Fc(e){let t=Array.from(e.querySelectorAll("body > :not(script):not(link):not(style) ~ script"));return Array.from(e.querySelectorAll("head > script, body > script")).filter(i=>!t.includes(i))}function js(e,t,i){var n,r;if(!Tt||!(i!=null&&i.inHead)&&!(i!=null&&i.atEnd)&&Fc(e.ownerDocument).includes(e))return P(!1);let o=e.textContent,s=e.src,a=e.type==="module",h=(a||s)&&e.async,l=a&&!h||s&&e.defer,c=!(i!=null&&i.atEnd)&&(i?.forceDefer||l||h);if(Ac(t)||(t.onload=null),c)return di.some(d=>El(d,e))||di.push(e),P(!0);if(s.includes("/mathjax")){let d=t.document.head.querySelector("script[src*='MathJax.js']:not([data-vivliostyle-scripting])");if(d){if(s.includes("/mathjax@3"))t.document.head.removeChild(d),(r=(n=t.MathJax)==null?void 0:n.version)!=null&&r.startsWith("2.")&&delete t.MathJax;else if(s.includes("/MathJax.js"))return P(!0)}}for(let d of t.document.head.getElementsByTagName("script"))d.hasAttribute("data-vivliostyle-scripting")&&El(d,e)&&t.document.head.removeChild(d);let p=t.document.createElement("script");p.textContent=o,s&&(p.src=s),p.async=h,p.defer=l,p.setAttribute("data-vivliostyle-scripting","true");for(let d of e.attributes)["src","async","defer"].includes(d.name)||p.setAttribute(d.name,d.value);if(U.debug("script:",s),s){let d=Ni(p);return t.document.head.appendChild(p),zr([d])}else return t.document.head.appendChild(p),P(!0)}function h0(e,t){var i;let n={},r=s=>{var a;let h=(a=s["font-family"])==null?void 0:a.value;if(h)if(h.values)for(let c of h.values)n[c.stringValue()]=!0;else n[h.stringValue()]=!0;let l=s._marginBoxes;if(l)for(let c of Object.values(l))r(c)},o=s=>{if(s instanceof As)r(s.style);else if(s instanceof Qi||Array.isArray(s))for(let a of Object.values(s))o(a)};for(let s of Object.values(t.cascade.code))for(let a of Object.values(s??{}))o(a);for(let s of e.querySelectorAll("[style]"))(i=s.style)!=null&&i.fontFamily&&(n[s.style.fontFamily]=!0);return Object.keys(n).join(",")}function u0(e,t,i){var n;let r=(n=t.document.querySelector("[data-vivliostyle-textcontent]"))!=null?n:t.document.createElement("div");return r.style.position="fixed",r.style.fontSize="0",r.setAttribute("data-vivliostyle-textcontent","true"),r.setAttribute("aria-hidden","true"),r.style.fontFamily=h0(e,i),r.textContent=e.documentElement.textContent,t.document.body.appendChild(r),r}function c0(e,t,i){if(!Tt)return P(!1);let n=Fc(e);if(n.length===0)return P(!1);let r=n.some(c=>!(c.async||c.defer||c.type==="module")),o=r?u0(e,t,i):null,s=t.document.fonts,a=t.$,h=!1,l=_("loadScripts");return l.loop(()=>{if(n.length===0)return r?l.sleep(20).thenAsync(()=>{var p,d;return s.status==="loading"||t.document.documentElement.classList.contains("wf-loading")||(p=t.FontJSON)!=null&&p.Font&&(d=t.ret)!=null&&d.readyState&&t.ret.readyState<4?P(!0):P(!1)}):P(!1);let c=n.shift();return js(c,t,{inHead:!0,forceDefer:h}).thenAsync(()=>(!h&&t.$!==a&&(di.push(c),h=!0),n.length===0&&r&&(U.debug("dispatchEvent: DOMContentLoaded (document)"),t.document.dispatchEvent(new Event("DOMContentLoaded"))),P(!0)))}).then(()=>{o&&o.remove(),l.finish(!0)}),l.result()}function d0(e){if(!Tt)return P(!1);let t=_("loadScripts");return t.loop(()=>di.length===0?P(!1):js(di.shift(),e,{atEnd:!0}).thenReturn(di.length>0)).then(()=>{U.debug("dispatchEvent: DOMContentLoaded (window)"),e.dispatchEvent(new Event("DOMContentLoaded")),U.debug("dispatchEvent: load (window)"),e.dispatchEvent(new Event("load")),t.finish(!0)}),t.result()}function Ac(e){return Tt?di.length>0||!!e.document.head.querySelector("script[data-vivliostyle-scripting]"):!1}var p0=(e,t,i)=>e.replace(/[uU][rR][lL]\(\s*"((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"\r\n])+)"/gm,(n,r)=>`url("${i.transformURL(r,t)}"`).replace(/[uU][rR][lL]\(\s*'((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^'\r\n])+)'/gm,(n,r)=>`url('${i.transformURL(r,t)}'`).replace(/[uU][rR][lL]\(\s*((\\([^0-9a-fA-F]+|[0-9a-fA-F]+\s*)|[^"'\r\n\)\s])+)/gm,(n,r)=>`url(${i.transformURL(r,t)}`),f0={};function g0(e){e.addEventListener("load",()=>{e.contentWindow.navigator.epubReadingSystem={name:"adapt",version:"0.1",layoutStyle:"paginated",hasFeature:function(t,i){switch(t){case"mouse-events":return!0}return!1}}},!1)}var Rc=class rs extends cs{constructor(t,i,n,r,o,s,a,h,l,c,p,d,f){super(),this.flowName=t,this.context=i,this.viewport=n,this.styler=r,this.regionIds=o,this.xmldoc=s,this.docFaces=a,this.footnoteStyle=h,this.stylerProducer=l,this.page=c,this.customRenderer=p,this.fallbackMap=d,this.documentURLTransformer=f,u(this,"document"),u(this,"exprContentListener"),u(this,"nodeContext",null),u(this,"viewRoot",null),u(this,"isFootnote",!1),u(this,"sourceNode",null),u(this,"offsetInNode",0),u(this,"viewNode",null),this.document=n.document,this.exprContentListener=r.counterListener.getExprContentListener()}clone(){return new rs(this.flowName,this.context,this.viewport,this.styler,this.regionIds,this.xmldoc,this.docFaces,this.footnoteStyle,this.stylerProducer,this.page,this.customRenderer,this.fallbackMap,this.documentURLTransformer)}createPseudoelementShadow(t,i,n,r,o,s,a,h){let l=this.getPseudoMap(n,this.regionIds,this.isFootnote,this.nodeContext,s);if(!l)return h;let c=[],p=pr.createElementNS("http://www.pyroxy.com/ns/shadow","root"),d=p;for(let g of cm){let m;if(g){if(!l[g]||g=="footnote-marker"&&!(i&&this.isFootnote))continue;if(g.match(/^first-/)){let v=r.display;if(!v||v===x.inline)continue;let b=t.firstElementChild;if(b&&je(b.previousSibling)){let w=o.getStyle(b,!1);if(w){let S=Ge(w,"display");if(S!=null&&S.value&&S.value!==x.inline)continue}}}if(g==="before"||g==="after"){let v=l[g].content;if(!v||!Jt(v.value))continue}c.push(g),m=pr.createElementNS("http://www.w3.org/1999/xhtml","span"),Zo(m,g)}else m=pr.createElementNS("http://www.pyroxy.com/ns/shadow","content");d.appendChild(m),g.match(/^first-/)&&(d=m)}if(!c.length)return h;let f=new sl(t,n,o,s,this.exprContentListener);return new Lo(t,p,null,a,h,dt.ROOTLESS,f)}getPseudoMap(t,i,n,r,o){let s=vt(t,"_pseudos");if(!s)return null;let a={};for(let h in s){let l=a[h]={};yn(l,s[h],o),Ko(l,o,s[h]),zu(s[h],i,n,(c,p)=>{yn(l,p,o),Ou(p,d=>{yn(l,d,o)})})}return a}createRefShadow(t,i,n,r,o){let s=_("createRefShadow");return this.xmldoc.store.load(t).then(a=>{let h=a;if(h){let l=h.getElement(t);if(l){let c=this.stylerProducer.getStylerForDoc(h);o=new Lo(n,l,h,r,o,i,c)}}s.finish(o)}),s.result()}createShadows(t,i,n,r,o,s,a){let h=_("createShadows"),l=null,c=r.template,p;if(c instanceof bt||c===x.footnote){let d=c instanceof bt?c.url:Te("user-agent.xml#footnote",pi);p=this.createRefShadow(d,dt.ROOTLESS,t,a,l)}else p=P(l);return p.then(d=>{let f=null;if(t.namespaceURI=="http://www.pyroxy.com/ns/shadow"&&t.localName=="include"){let m=t.getAttribute("href"),v=null;m?v=a?a.xmldoc:this.xmldoc:a&&(a.owner.namespaceURI=="http://www.w3.org/1999/xhtml"?m=a.owner.getAttribute("href"):m=a.owner.getAttributeNS("http://www.w3.org/1999/xlink","href"),v=a.parentShadow?a.parentShadow.xmldoc:this.xmldoc),m&&(m=Te(m,v.url),f=this.createRefShadow(m,dt.ROOTED,t,a,d))}f==null&&(f=P(d));let g=null;f.then(m=>{if(r.display===x.table_cell){let v=Te("user-agent.xml#table-cell",pi);g=this.createRefShadow(v,dt.ROOTLESS,t,a,m)}else g=P(m);g.then(v=>{v=this.createPseudoelementShadow(t,i,n,r,o,s,a,v),h.finish(v)})})}),h.result()}setViewRoot(t,i){this.viewRoot=t,this.isFootnote=i}computeStyle(t,i,n,r){var o;let s=this.context,a=Mu(n,s,this.regionIds,this.isFootnote,this.nodeContext),h=!((o=this.nodeContext)!=null&&o.parent);h&&(!a["writing-mode"]&&this.styler.rootStyle["writing-mode"]&&(a["writing-mode"]=this.styler.rootStyle["writing-mode"]),!a.direction&&this.styler.rootStyle.direction&&(a.direction=this.styler.rootStyle.direction));let l=t;t=Bu(a,s,t);let c=!h&&t!==l;if(i=_u(a,s,i),Du(a,r,t,i,(m,v)=>{let b;c&&(t?/^(min-|max-)?(height|inline-size)$/.test(m)&&(b=s.pageAreaHeight):/^(min-|max-)?(width|inline-size)$/.test(m)&&(b=s.pageAreaWidth));let w=v.evaluate(s,m,b,t);return m=="font-family"&&(w=this.docFaces.filterFontFamily(w)),w}),c){let m=r[t?"height":"width"];(!m||m===x.auto)&&(r[t?"height":"width"]=x.max_content)}if($a(r.position))return r.position=x.fixed,r.visibility=x.hidden,t;let p=r.position,d=r.float,f=r.display||(this.sourceNode.namespaceURI==="http://www.w3.org/1999/xhtml"?x.inline:void 0),g=uu(f,p,d,this.sourceNode===this.xmldoc.root);return["display","position","float"].forEach(m=>{g[m]&&(r[m]=g[m])}),t}inheritFromSourceParent(t){let i=this.nodeContext.sourceNode,n=[],r=null,o=this.nodeContext.shadowContext,s=-1;for(;i&&i.nodeType==1;){let p=o&&o.root==i;if(!p||o.type==dt.ROOTLESS){let d=(o?o.styler:this.styler).getStyle(i,!1);n.push(d),r=r||wo(i)}p?(i=o.owner,o=o.parentShadow):(i=i.parentNode,s++)}let a=s===0,h=this.context.queryUnitSize("em",a),l={"font-size":new J(new A(h,"px"),0)},c=new gg(l,this.context);for(let p=n.length-1;p>=0;--p){let d=n[p],f=[];for(let v in d)vn(v)&&f.push(v);f.sort(Na);let g,m;for(let v of f){c.setPropName(v);let b=Ge(d,v),w=b;te(b.value)||(v==="font-size"&&p===n.length-1&&this.context.isRelativeRootFontSize&&this.context.rootFontSize?w=new J(new A(this.context.rootFontSize,"px"),b.priority):v==="line-height"&&p===n.length-1&&this.context.rootLineHeight&&b.value instanceof A&&(b.value.unit==="lh"||b.value.unit==="rlh")?w=new J(new A(this.context.rootLineHeight,"px"),b.priority):p===0&&b.value instanceof A&&b.value.unit==="lh"?w=new J(new A(b.value.num*this.getLineHeightUnitSize(v,g,m),"px"),b.priority):_t(v)||(w=b.filterValue(c)),v==="font-size"?g=w.value:v==="line-height"&&(m=w.value),l[v]=w)}}for(let p in t)vn(p)||(l[p]=t[p]);return{lang:r,elementStyle:l}}resolveURL(t){return t=Te(t,this.xmldoc.url),this.fallbackMap[t]||t}inheritLangAttribute(){this.nodeContext.lang=wo(this.nodeContext.sourceNode)||this.nodeContext.parent&&this.nodeContext.parent.lang||this.nodeContext.lang}transferPolyfilledInheritedProps(t){let i=ag().filter(n=>t[n]);if(i.length){let n=this.nodeContext.inheritedProps;if(this.nodeContext.parent){n=this.nodeContext.inheritedProps={};for(let r in this.nodeContext.parent.inheritedProps)n[r]=this.nodeContext.parent.inheritedProps[r]}i.forEach(r=>{let o=t[r];if(o){if(te(o))o===x.initial&&(n[r]=void 0);else if(o instanceof gi)n[r]=o.num;else if(o instanceof yt)n[r]=o.name;else if(o instanceof A){let s=o;switch(s.unit){case"dpi":case"dpcm":case"dppx":n[r]=s.num*xe[s.unit];break;default:n[r]=o}}else n[r]=o;["widows","orphans"].includes(r)||delete t[r]}})}}resolveFormattingContext(t,i,n,r,o,s){let a=xt("RESOLVE_FORMATTING_CONTEXT");for(let h=0;h<a.length;h++){let l=a[h](t,i,n,r,o,s);if(l){t.formattingContext=l;return}}}createElementView(t,i){var n,r,o,s;let a=!0,h=_("createElementView"),l=this.sourceNode,c=this.nodeContext.shadowContext?this.nodeContext.shadowContext.styler:this.styler,p=c.getStyle(l,!1);if(!this.nodeContext.shadowContext){let L=this.xmldoc.getElementOffset(l);Hr.registerFragmentIndex(L,this.nodeContext.fragmentIndex,0)}let d={};if(!this.nodeContext.parent){let L=this.inheritFromSourceParent(p);p=L.elementStyle,this.nodeContext.lang=L.lang}let f=p.position,g=p.float,m=p["float-reference"],v=g&&!te(g.value)&&g.value!==x.none&&m&&!te(m.value)?$f(m.value.toString()):null;if(this.nodeContext.parent&&($a(f?.value)||v&&zi(v))){let L=this.inheritFromSourceParent(p);p=L.elementStyle,this.nodeContext.lang=L.lang}this.nodeContext.vertical=this.computeStyle(this.nodeContext.vertical,this.nodeContext.direction==="rtl",p,d),v&&zi(v)&&d.display===x.block&&(d.display=x.flow_root),c.processContent(l,d,(r=this.nodeContext.viewNode)!=null?r:(n=this.nodeContext.parent)==null?void 0:n.viewNode),this.transferPolyfilledInheritedProps(d),this.inheritLangAttribute(),d.direction&&(this.nodeContext.direction=d.direction.toString());let b=d["flow-into"];if(b&&b.toString()!=this.flowName)return h.finish(!1),h.result();if(Tt&&l.localName==="script"&&l.namespaceURI==="http://www.w3.org/1999/xhtml")return js(l,this.viewport.window).thenFinish(h),h.result();let w=d.display;if(te(w)&&(w===x.initial||w===x.unset?w=x.inline:w===x.inherit?w=((o=this.nodeContext.parent)==null?void 0:o.display)&&z((s=this.nodeContext.parent)==null?void 0:s.display):w=null),w===x.none)return h.finish(!1),h.result();let S=this.nodeContext.parent==null;return this.nodeContext.flexContainer=w===x.flex,this.createShadows(l,S,p,d,c,this.context,this.nodeContext.shadowContext).then(L=>{var B,D;this.nodeContext.nodeShadow=L;let W=d.position,q=d.float,ye=d.clear,Xe=this.nodeContext.vertical?x.vertical_rl:x.horizontal_tb,ge=this.nodeContext.parent?this.nodeContext.parent.vertical?x.vertical_rl:x.horizontal_tb:Xe,me=Zf(l);this.nodeContext.establishesBFC=Qf(w,W,q,d.overflow,Xe,ge,me),this.nodeContext.containingBlockForAbsolute=Jf(W),this.nodeContext.isInsideBFC()&&q!==x.footnote&&!(v&&zi(v))&&(q=null,ye=null);let y=q===x.left||q===x.right||q===x.top||q===x.bottom||q===x.inline_start||q===x.inline_end||q===x.block_start||q===x.block_end||q===x.snap_block||q===x.footnote;q&&(delete d.float,q===x.footnote&&(this.isFootnote?(y=!1,d.display=x.block):d.display=x.inline)),ye&&(ye===x.inherit&&this.nodeContext.parent&&this.nodeContext.parent.clearSide&&(ye=z(this.nodeContext.parent.clearSide)),(ye===x.left||ye===x.right||ye===x.top||ye===x.bottom||ye===x.both||ye===x.all||ye===x.same)&&(delete d.clear,d.display&&d.display!=x.inline&&(this.nodeContext.clearSide=ye.toString())));let I=w===x.list_item&&d["ua-list-item-count"],C=d["break-inside"];(y||C&&!te(C)&&C!==x.auto)&&this.nodeContext.breakPenalty++,w&&w!==x.inline&&hi(w)&&this.nodeContext.breakPenalty++,this.nodeContext.inline=!y&&!w||hi(w)||du(w),this.nodeContext.display=w?w.toString():"inline",this.nodeContext.floatSide=y?q.toString():null,this.nodeContext.floatReference=v||Be.INLINE;let E=d["float-min-wrap-block"];this.nodeContext.floatMinWrapBlock=E&&!te(E)?E:null;let O=this.isInsideNonRootMultiColumn(),R=d["column-span"];if(this.nodeContext.columnSpan=!O&&R&&!te(R)?R:null,!this.nodeContext.inline){let V=d["break-after"];V&&!te(V)&&!(O&&V===x.column)&&(this.nodeContext.breakAfter=V.toString(),Fo[this.nodeContext.breakAfter]&&delete d["break-after"]);let ie=d["break-before"];ie&&!te(ie)&&!(O&&ie===x.column)&&(this.nodeContext.fragmentIndex===1&&(this.nodeContext.breakBefore=ie.toString()),Fo[this.nodeContext.breakBefore]&&delete d["break-before"]);let ne=d.page,de=ne&&!te(ne)&&ne.toString();!de&&!this.nodeContext.parent&&(this.nodeContext.shadowContext||w===x.table_header_group||w===x.table_footer_group)&&(de=this.styler.cascade.currentPageType),!de||de.toLowerCase()==="auto"?de=this.nodeContext.pageType:this.nodeContext.pageType=de,this.styler.cascade.currentPageType!==de&&!(!de&&d.position===x.fixed)&&(this.nodeContext.fragmentIndex===1&&!Nn(this.nodeContext.breakBefore)&&(this.nodeContext.breakBefore="page"),de!==this.styler.cascade.previousPageType&&(this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.styler.cascade.currentPageType=de)}this.nodeContext.verticalAlign=d["vertical-align"]&&d["vertical-align"].toString()||"baseline",this.nodeContext.captionSide=d["caption-side"]&&d["caption-side"].toString()||"top";let M=d["border-collapse"];if(!M||M===z("separate")){let V=d["border-spacing"],ie,ne;V&&(V instanceof Ie?(ie=V.values[0],ne=V.values[1]):ie=ne=V,ie.isNumeric()&&(this.nodeContext.inlineBorderSpacing=Ze(ie,this.context)),ne.isNumeric()&&(this.nodeContext.blockBorderSpacing=Ze(ne,this.context)))}let H=d["footnote-policy"];this.nodeContext.footnotePolicy=H&&!te(H)?H:null;let j=d["x-first-pseudo"];if(j){let V=this.nodeContext.parent?this.nodeContext.parent.firstPseudo:null;this.nodeContext.firstPseudo=new Df(V,j.num)}this.nodeContext.inline||this.processAfterIfcontinues(l,p,c,this.context);let K=d["white-space"];if(K){let V=Jh(K.toString());V!==null&&(this.nodeContext.whitespace=V)}let Q=d["hyphenate-character"];Q&&Q instanceof _e&&(this.nodeContext.hyphenateCharacter=Q.str);let Z=d["word-break"],ve=d["line-break"],re=d["overflow-wrap"];(Z===x.break_all||ve===x.anywhere||re===x.break_word||re===x.anywhere)&&(this.nodeContext.breakWord=!0),this.resolveFormattingContext(this.nodeContext,t,w,W,q,S),this.nodeContext.parent&&this.nodeContext.parent.formattingContext&&(t=this.nodeContext.parent.formattingContext.isFirstTime(this.nodeContext,t)),this.nodeContext.inline||(this.nodeContext.repeatOnBreak=this.processRepeatOnBreak(d),this.findAndProcessRepeatingElements(l,c));let ae=!1,Ce=null,Se=[],ee=l.namespaceURI,G=l.localName;if(ee=="http://www.w3.org/1999/xhtml"?(G=="html"||G=="body"||G=="script"||G=="link"||G=="meta"?G="div":G=="vide_"?G="video":G=="audi_"?G="audio":G=="object"&&(ae=!!this.customRenderer),l.getAttribute(Bs)&&(D=(B=p.content)==null?void 0:B.value)!=null&&D.url&&(G="img")):ee=="http://www.idpf.org/2007/ops"?(G="span",ee="http://www.w3.org/1999/xhtml"):ee=="http://www.pyroxy.com/ns/shadow"?(ee="http://www.w3.org/1999/xhtml",G=this.nodeContext.inline?"span":"div"):ae=!!this.customRenderer,I)t?G="li":(G="div",w=x.block,d.display=w);else if(G=="body"||G=="li")G="div";else if(G=="q")G="span";else if(G=="a"){let V=d["hyperlink-processing"];V&&V.toString()!="normal"&&(G="span")}d.behavior&&d.behavior.toString()!="none"&&this.customRenderer&&(ae=!0),l.dataset&&l.getAttribute("data-math-typeset")==="true"&&(ae=!0);let le;if(ae){let V=this.nodeContext.parent?this.nodeContext.parent.viewNode:null;le=this.customRenderer(l,V,d)}else le=P(null);le.then(V=>{if(V)ae&&(a=V.getAttribute("data-adapt-process-children")=="true");else if(d.display===x.none){h.finish(!1);return}else V=this.createElement(ee,G);G=="a"&&V.addEventListener("click",this.page.hrefHandler,!1),Ce&&(this.applyPseudoelementStyle(this.nodeContext,"inner",Ce),V.appendChild(Ce)),V.localName=="iframe"&&V.namespaceURI=="http://www.w3.org/1999/xhtml"&&g0(V);let ie=this.nodeContext.inheritedProps["image-resolution"],ne=[],de=d.width,tt=d.height,id=l.getAttribute("width"),nd=l.getAttribute("height"),Kr=de===x.auto||!de&&!id,Zr=tt===x.auto||!tt&&!nd,qs=l.attributes,rd=qs.length,$n=null,Ys=null;for(let ut=0;ut<rd;ut++){let Ct=qs[ut],rt=Ct.namespaceURI,oe=Ct.localName,Fe=Ct.nodeValue;if(rt){if(rt=="http://www.w3.org/2000/xmlns/")continue;rt=="http://www.w3.org/1999/xlink"&&oe=="href"&&(Fe=this.documentURLTransformer.transformURL(this.resolveURL(Fe),this.xmldoc.url))}else{if(!Tt&&oe.match(/^on/)||oe=="style")continue;if((oe=="id"||oe=="name")&&t){let Ve=this.documentURLTransformer.transformFragment(Fe,this.xmldoc.url);if(Tt&&!(V.namespaceURI==="http://www.w3.org/2000/svg"&&V.localName!=="svg")&&!V.ownerDocument.getElementById(Fe)){V.setAttribute(oe,Fe),V.setAttribute("data-vivliostyle-id",Ve);let ei=V.ownerDocument.createElement("a");ei.setAttribute(oe,Ve),ei.setAttribute(Wi,"1"),ei.style.position="absolute",V.appendChild(ei)}else V.setAttribute(oe,Ve);this.page.registerElementWithId(V,Ve);continue}if(oe=="src"||oe=="href"||oe=="poster")Fe=this.resolveURL(Fe),oe==="href"&&(Fe=this.documentURLTransformer.transformURL(Fe,this.xmldoc.url));else if(oe=="srcset")Fe=Fe.split(",").map(Ve=>this.resolveURL(Ve.trim())).join(",");else if(oe==="data"&&ae&&G==="object"&&V.hasAttribute("data"))continue;if(oe==="poster"&&G==="video"&&ee==="http://www.w3.org/1999/xhtml"&&Kr&&Zr){let Ve=new Image,ei=Ni(Ve,Fe);Se.push(ei),ne.push({image:Ve,element:V,fetcher:ei})}}if(ee=="http://www.w3.org/2000/svg"&&/^[A-Z\-]+$/.test(oe)&&(oe=oe.toLowerCase()),this.isSVGUrlAttribute(oe)&&(Fe=p0(Fe,this.xmldoc.url,this.documentURLTransformer)),rt){let Ve=f0[rt];Ve&&(oe=`${Ve}:${oe}`)}if(oe=="src"&&!rt&&(G=="img"||G=="input")&&ee=="http://www.w3.org/1999/xhtml")$n=Fe;else if(oe=="alt"&&!rt&&G=="img"&&ee=="http://www.w3.org/1999/xhtml")Ys=Fe;else if(oe=="href"&&G=="image"&&ee=="http://www.w3.org/2000/svg"&&rt=="http://www.w3.org/1999/xlink")this.page.fetchers.push(Ni(V,Fe));else if(rt)V.setAttributeNS(rt,oe,Fe);else try{V.setAttribute(oe,Fe)}catch(Ve){U.warn(Ve)}}if($n){let ut=G==="input"?new Image:V,Ct=Ni(ut,$n,Ys);ut!==V&&(V.src=$n);let rt=()=>{var oe,Fe;if(d.position===x.fixed)return!0;for(let Ve=(oe=this.nodeContext.parent)==null?void 0:oe.viewNode;Ve&&Ve!==this.viewRoot;Ve=Ve.parentElement)if(((Fe=Ve.style)==null?void 0:Fe.position)==="fixed")return!0;return!1};!Kr&&!Zr&&!(()=>{let oe=this.nodeContext.vertical?de:tt;return oe instanceof A&&oe.unit==="%"})()&&!rt()?this.page.fetchers.push(Ct):(Kr&&Zr&&ie&&ie!==1&&ne.push({image:ut,element:V,fetcher:Ct}),Se.push(Ct))}delete d.content;let Qr=d["list-style-image"];if(Qr&&Qr instanceof bt){let ut=Qr.url;Se.push(Ni(new Image,ut))}if(this.preprocessElementStyle(d),this.applyComputedStyles(V,d),this.nodeContext.inline)t||(lt(V,"inline-start"),ln(V)&&lt(V,"clone"));else if(!t)lt(V,"block-start"),ln(V)&&(lt(V,"clone"),ho(V,"block-start"));else if(!Es(d.position)){let ut=d["margin-break"],Ct=this.getBreakTypeAt(this.nodeContext),rt=Ct!==null,oe=Ct==="auto";(ut===x.discard&&rt||ut!==x.keep&&oe&&!this.nodeContext.floatSide)&&ho(V,"block-start")}I&&V.setAttribute("value",d["ua-list-item-count"].stringValue()),this.viewNode=V,Se.length?zr(Se).then(()=>{ie>0&&this.modifyElemDimensionWithImageResolution(ne,ie,d,this.nodeContext.vertical),h.finish(a)}):h.timeSlice().then(()=>{h.finish(a)})})}),h.result()}isInsideNonRootMultiColumn(){var t;for(let i=(t=this.nodeContext.parent)==null?void 0:t.viewNode;i;i=i.parentNode){let n=i.nodeType===1?i.style:null;if(!n)break;if(!isNaN(parseFloat(n.columnCount))||!isNaN(parseFloat(n.columnWidth)))return!0;if(n.position==="absolute")break}return!1}getBreakTypeAt(t){var i,n,r,o,s;for(let h=t;h&&!h.after;h=h.parent){if(it(h.breakBefore))return h.breakBefore;if(h.fragmentIndex===1&&!h.parent)return h.sourceNode===h.sourceNode.ownerDocument.documentElement?"page":null;if((i=h.parent)!=null&&i.floatSide)return null;let l=(n=h.parent)==null?void 0:n.viewNode;if(l){let c=this.viewport.window.getComputedStyle(l),p=parseFloat(c.paddingBlockStart),d=parseFloat(c.borderBlockStartWidth);if(p||d)return null;let f=l?.firstChild;for(;f&&(je(f,h.parent.whitespace)||!h.floatSide&&fu(f));)f=f.nextSibling;if(f&&f!==h.viewNode)return null}}let a=(s=(o=(r=this.context)==null?void 0:r.currentLayoutPosition)==null?void 0:o.flowPositions[this.flowName])==null?void 0:s.startBreakType;return it(a)?a:"auto"}processAfterIfcontinues(t,i,n,r){let o=this.getPseudoMap(i,this.regionIds,this.isFootnote,this.nodeContext,r);if(o&&o["after-if-continues"]&&o["after-if-continues"].content){let s=new sl(t,i,n,r,this.exprContentListener);this.nodeContext.afterIfContinues=new pm(t,s)}}isSVGUrlAttribute(t){return rs.SVG_URL_ATTRIBUTES.includes(t.toLowerCase())}modifyElemDimensionWithImageResolution(t,i,n,r){t.forEach(o=>{if(o.fetcher.get().get()==="load"){let s=o.image,a=s.width/i,h=s.height/i,l=o.element;if(a>0&&h>0){if(n["box-sizing"]===x.border_box&&(n["border-left-style"]!==x.none&&(a+=Ze(n["border-left-width"],this.context)),n["border-right-style"]!==x.none&&(a+=Ze(n["border-right-width"],this.context)),n["border-top-style"]!==x.none&&(h+=Ze(n["border-top-width"],this.context)),n["border-bottom-style"]!==x.none&&(h+=Ze(n["border-bottom-width"],this.context))),i>1){let c=n["max-width"]||x.none,p=n["max-height"]||x.none;if(c===x.none&&p===x.none)T(l,"max-width",`${a}px`);else if(c!==x.none&&p===x.none)T(l,"width",`${a}px`);else if(c===x.none&&p!==x.none)T(l,"height",`${h}px`);else{c.isNumeric(),p.isNumeric();let d=c,f=p;d.unit!=="%"?T(l,"max-width",`${Math.min(a,Ze(d,this.context))}px`):f.unit!=="%"?T(l,"max-height",`${Math.min(h,Ze(f,this.context))}px`):r?T(l,"height",`${h}px`):T(l,"width",`${a}px`)}}else if(i<1){let c=n["min-width"]||ce,p=n["min-height"]||ce;c.isNumeric(),c.isNumeric();let d=c,f=p;d.num===0&&f.num===0?T(l,"min-width",`${a}px`):d.num!==0&&f.num===0?T(l,"width",`${a}px`):d.num===0&&f.num!==0?T(l,"height",`${h}px`):d.unit!=="%"?T(l,"min-width",`${Math.max(a,Ze(d,this.context))}px`):f.unit!=="%"?T(l,"min-height",`${Math.max(h,Ze(f,this.context))}px`):r?T(l,"height",`${h}px`):T(l,"width",`${a}px`)}}}})}preprocessElementStyle(t){xt("PREPROCESS_ELEMENT_STYLE").forEach(i=>{i(this.nodeContext,t)})}findAndProcessRepeatingElements(t,i){for(let n=t.firstChild;n;n=n.nextSibling){if(n.nodeType!==1)continue;let r={},o=i.getStyle(n,!1);if(this.computeStyle(this.nodeContext.vertical,this.nodeContext.direction==="rtl",o,r),!this.processRepeatOnBreak(r))continue;if(this.nodeContext.formattingContext instanceof mi&&!this.nodeContext.belongsTo(this.nodeContext.formattingContext))return;let s=this.nodeContext.parent,a=s&&s.formattingContext;this.nodeContext.formattingContext=new mi(a,this.nodeContext.sourceNode),this.nodeContext.formattingContext.initializeRepetitiveElements(this.nodeContext.vertical);return}}processRepeatOnBreak(t){let i=t["repeat-on-break"];return i!==x.none&&((i===x.auto||te(i))&&(t.display===x.table_header_group?i=x.header:t.display===x.table_footer_group?i=x.footer:i=x.none),i&&i!==x.none)?i.toString():null}createTextNodeView(){let t=_("createTextNodeView");return this.preprocessTextContent().then(()=>{let i=this.offsetInNode||0,n=Da(this.nodeContext.preprocessedTextContent).substr(i);this.viewNode=document.createTextNode(n),t.finish(!0)}),t.result()}preprocessTextContent(){if(this.nodeContext.preprocessedTextContent!=null)return P(!0);let t,i=t=this.sourceNode.textContent,n=_("preprocessTextContent"),r=xt("PREPROCESS_TEXT_CONTENT"),o=0;return n.loop(()=>o>=r.length?P(!1):r[o++](this.nodeContext,i).thenAsync(s=>(i=s,P(!0)))).then(()=>{this.nodeContext.preprocessedTextContent=Nf(t,i),n.finish(!0)}),n.result()}createNodeView(t,i){let n=_("createNodeView"),r,o=!0;return this.sourceNode.nodeType==1?r=this.createElementView(t,i):this.sourceNode.nodeType==8?(this.viewNode=null,r=P(!0)):r=this.createTextNodeView(),r.then(s=>{var a;if(o=s,this.nodeContext.viewNode=this.viewNode,this.viewNode){let h=(p,d)=>p?.nodeType===1&&Bi(p)===d,l=this.nodeContext.parent,c=l?h(this.viewNode,"after")&&h(l.viewNode,"first-letter")&&(a=l.viewNode)!=null&&a.hasChildNodes()?l.parent.viewNode:l.viewNode:this.viewRoot;c&&(this.nodeContext.inline&&!(this.viewNode.nodeType===3&&je(this.viewNode))&&!c.hasChildNodes()&&Yh(c).includes("block-start")&&lt(c,"text-start"),c.appendChild(this.viewNode))}n.finish(o)}),n.result()}setCurrent(t,i,n){return this.nodeContext=t,t?(this.sourceNode=t.sourceNode,this.offsetInNode=t.offsetInNode):(this.sourceNode=null,this.offsetInNode=-1),this.viewNode=null,this.nodeContext?this.createNodeView(i,!!n):P(!0)}processShadowContent(t){if(t.shadowContext==null||t.sourceNode.localName!="content"||t.sourceNode.namespaceURI!="http://www.pyroxy.com/ns/shadow")return t;let i=t.boxOffset,n=t.shadowContext,r=t.parent,o,s,a=n.subShadow||n.parentShadow;n.subShadow?(o=n.root,s=n.type,s==dt.ROOTLESS&&(o=o.firstChild)):(o=n.owner.firstChild,s=dt.ROOTLESS);let h=t.sourceNode.nextSibling;if(h?(t.sourceNode=h,t.resetView()):t.shadowSibling?t=t.shadowSibling:o?t=null:(t=t.parent.modify(),t.after=!0),o){let l=new un(o,r,i);return l.shadowContext=a,l.shadowType=s,l.shadowSibling=t,l}return t.boxOffset=i,t}nextPositionInTree(t){let i=t.boxOffset+1;if(t.after){if(!t.parent)return null;if(t.shadowType!=dt.ROOTED){let n=t.sourceNode.nextSibling;if(n)return t=t.modify(),t.boxOffset=i,t.sourceNode=n,t.resetView(),this.processShadowContent(t)}return t.shadowSibling?(t=t.shadowSibling.modify(),t.boxOffset=i,t):(t=t.parent.modify(),t.boxOffset=i,t.after=!0,t)}else{if(t.nodeShadow){let r=t.nodeShadow.root;if(t.nodeShadow.type==dt.ROOTLESS&&(r=r.firstChild),r){let o=new un(r,t,i);return o.shadowContext=t.nodeShadow,o.shadowType=t.nodeShadow.type,this.processShadowContent(o)}}let n=t.sourceNode.firstChild;if(n)return this.processShadowContent(new un(n,t,i));if(t.sourceNode.nodeType!=1){let r=Da(t.preprocessedTextContent);i+=r.length-1-t.offsetInNode}return t=t.modify(),t.boxOffset=i,t.after=!0,t}}isTransclusion(t,i,n){let r=Ge(i,"hyperlink-processing");if(!r)return!1;let o=r.evaluate(this.context,"hyperlink-processing");return o?o.toString()==n:!1}nextInTree(t,i){let n=this.nextPositionInTree(t);if(!n||n.after)return P(n);let r=_("nextInTree");return this.setCurrent(n,!0,i).then(o=>{(!n.viewNode||!o)&&(n=n.modify(),n.after=!0,n.viewNode||(n.inline=!0)),this.dispatchEvent({type:"nextInTree",nodeContext:n}),r.finish(n)}),r.result()}addImageFetchers(t){if(t instanceof et){let i=t.values;for(let n=0;n<i.length;n++)this.addImageFetchers(i[n])}else if(t instanceof bt){let i=t.url;this.page.fetchers.push(Ni(new Image,i))}}applyComputedStyles(t,i){var n,r,o;let s=i["background-image"];s&&this.addImageFetchers(s);let a=i.position===x.relative,h=((n=this.nodeContext)==null?void 0:n.parent)===null&&((r=this.sourceNode)==null?void 0:r.parentElement)===null&&!!((o=this.viewRoot)!=null&&o.parentElement),l=Object.keys(i);l.sort(Na);let c,p;for(let d of l){if(w0[d])continue;let f=i[d];if(!(!f||f===X&&!_t(d))){if(f=f.visit(new Sp(this.xmldoc.url,this.documentURLTransformer)),f instanceof A&&th(f.unit)&&(f.unit==="lh"?f=new A(f.num*this.getLineHeightUnitSize(d,c,p),"px"):f=xh(f,this.context)),d==="font-size"?c=f:d==="line-height"&&(p=f),Ff[d]||a&&Af[d]){this.page.delayedItems.push(new Cs(t,d,f));continue}h&&this.page.pageAreaElement&&vn(d)?T(this.page.pageAreaElement.parentElement,d,f.toString()):T(t,d,f.toString())}}}getLineHeightUnitSize(t,i,n){var r,o,s,a;let h=xe.lh/xe.em,l=((o=(r=this.nodeContext.parent)==null?void 0:r.viewNode)==null?void 0:o.nodeType)===1?this.viewport.window.getComputedStyle(this.nodeContext.parent.viewNode):null,c=l?parseFloat(l.fontSize):this.context.fontSize(),p=l?l.lineHeight==="normal"?c*h:parseFloat(l.lineHeight):this.context.rootLineHeight;if(t==="line-height"||t==="font-size")return p;let d=null;if(n){if(n instanceof wi||n instanceof A&&(n.unit==="em"||n.unit==="%"))d=n instanceof A&&n.unit==="%"?n.num/100:n.num;else if(n instanceof A)return n.num*this.context.queryUnitSize(n.unit,!1)}else for(let f=(s=this.nodeContext.parent)==null?void 0:s.viewNode;;f=f.parentNode){if(!f||f.nodeType!==1){d=h;break}let g=(a=f?.style)==null?void 0:a.lineHeight;if(g){/^[0-9.]+$/.test(g)&&(d=parseFloat(g)),g==="normal"&&(d=h);break}}return d!==null?i instanceof A?d*ku(i,c,this.context).num:d*c:p}applyPseudoelementStyle(t,i,n){if(t.after)return;let r=this.sourceNode,o=(t.shadowContext?t.shadowContext.styler:this.styler).getStyle(r,!1),s=vt(o,"_pseudos");if(!s||(o=s[i],!o))return;let a={};t.vertical=this.computeStyle(t.vertical,t.direction==="rtl",o,a);let h=a.content;Jt(h)&&(h.visit(new Pr(n,this.context,h,this.exprContentListener)),delete a.content),this.applyComputedStyles(n,a)}peelOff(t,i){let n=_("peelOff"),r=t.firstPseudo,o=t.offsetInNode,s=t.after;if(i>0){let p=t.viewNode.textContent;t.viewNode.textContent=p.substr(0,i),o+=i}else if(!s&&t.viewNode&&o==0){let p=t.viewNode.parentNode;p&&p.removeChild(t.viewNode)}let a=t.boxOffset+i,h=[];for(;t.firstPseudo===r;)h.push(t),t=t.parent;let l=h.pop(),c=l.shadowSibling;return n.loop(()=>{for(;h.length>0;){l=h.pop(),t=new un(l.sourceNode,t,a),h.length==0&&(t.offsetInNode=o,t.after=s),t.shadowType=l.shadowType,t.shadowContext=l.shadowContext,t.nodeShadow=l.nodeShadow,t.shadowSibling=l.shadowSibling?l.shadowSibling:c,c=null;let p=this.setCurrent(t,!1);if(p.isPending())return p}return P(!1)}).then(()=>{n.finish(t)}),n.result()}createElement(t,i){return t=="http://www.w3.org/1999/xhtml"?this.document.createElement(i):this.document.createElementNS(t,i)}applyFootnoteStyle(t,i,n){let r={},o=vt(this.footnoteStyle,"_pseudos");if(t=this.computeStyle(t,i,this.footnoteStyle,r),o&&o.before){let s={},a=this.createElement("http://www.w3.org/1999/xhtml","span");Zo(a,"before"),n.appendChild(a),this.computeStyle(t,i,o.before,s),delete s.content,this.applyComputedStyles(a,s)}return delete r.content,this.applyComputedStyles(n,r),t}processFragmentedBlockEdge(t){var i,n,r;let o=!t.inline&&t.after?t.parent:t,s=!1;if(t.inline&&t.after&&!t.shadowContext&&((i=t.sourceNode.nextSibling)==null?void 0:i.nodeType)===1){let h=t.sourceNode.nextSibling,l=(n=Ge(this.styler.getStyle(h,!1),"display"))==null?void 0:n.value.toString();s=l&&!hi(l)||h.getAttribute("data-math-typeset")==="true"&&/^\s*(\$\$|\\\[)/.test(h.textContent)}let a=0;for(let h=o;h;h=h.parent){if(((r=h.viewNode)==null?void 0:r.nodeType)!==1)continue;let l=h.viewNode;if(l.style)if(h.inline){if(lt(l,"inline-end"),ln(l)){let c=h.vertical?l.offsetWidth:l.offsetHeight;lt(l,"clone"),(h.vertical?l.offsetWidth:l.offsetHeight)>c&&this.fixClonedBoxDecorationOverflow(l)}}else{if(lt(l,"block-end"),!a++&&h!==o){let{textAlign:c}=this.viewport.window.getComputedStyle(l);if(c==="justify"&&!s){let p=this.createChildAnonymousBlockIfNeeded(l);p?p!==l?Kh(p,["block-start","text-start","block-end","text-end","justify"]):(lt(l,"text-end"),lt(l,"justify")):lt(l,"text-end")}else lt(l,"text-end")}ln(l)&&(lt(l,"clone"),ho(l,"block-end"))}}}fixClonedBoxDecorationOverflow(t){let i=this.viewport.window.getComputedStyle(t),n=parseFloat(i.paddingInlineEnd),r=parseFloat(i.borderInlineEndWidth),o=-(n+r);isNaN(o)||(t.style.marginInlineEnd=`${o}px`)}createChildAnonymousBlockIfNeeded(t){let i=o=>{let{display:s,position:a,float:h}=this.viewport.window.getComputedStyle(o);if(o.localName==="ruby"||li[o.localName])return!1;if(o.localName==="br")return!0;if((s==="inline"||s==="contents")&&o.hasChildNodes()){let l=o.lastElementChild;if(l&&(!l.nextSibling||l.nextSibling===o.lastChild&&je(l.nextSibling))){let c=i(l);if(c||c===null)return c}for(let c=l?.previousElementSibling;c;c=c.previousElementSibling){let p=i(c);if(p||p===null)return null}return!1}if(s==="none"||a==="absolute"||a==="fixed"||h&&h!=="none"||o.hasAttribute(Wi)){let l=o.previousElementSibling;return l&&(l.nextSibling===o||l.nextSibling===o.previousSibling&&je(l.nextSibling))?i(l):!1}return!(!s||hi(s))},n=null;for(let o=t.lastElementChild;o;o=o.previousElementSibling){let s=i(o);if(s){n=o;break}if(s===null)return null}if(!n)return t;if(n===t.lastElementChild&&(!n.nextSibling||n.nextSibling===t.lastChild&&je(n.nextSibling)))return null;let r=t.ownerDocument.createElement("span");r.className="viv-anonymous-block";for(let o=n.nextSibling,s=null;o;o=s)s=o.nextSibling,r.appendChild(o);return t.appendChild(r),r}convertLengthToPx(t,i,n){let r=t.num,o=t.unit;if(Wd(o)){let s=i;for(;s&&s.nodeType!==1;)s=s.parentNode;let a=parseFloat(n.getElementComputedStyle(s)["font-size"]);return this.context,Fs(t,a,this.context).num}else{let s=this.context.queryUnitSize(o,!1);return s?r*s:t}}isSameNodePositionStep(t,i){if(t.shadowContext){if(!i.shadowContext)return!1;let n=t.node.nodeType===1?t.node:t.node.parentElement,r=i.node.nodeType===1?i.node:i.node.parentElement;return t.shadowContext.owner===i.shadowContext.owner&&Bi(n)===Bi(r)}else return t.node===i.node}isSameNodePosition(t,i){return t.offsetInNode===i.offsetInNode&&t.after==i.after&&t.steps.length===i.steps.length&&t.steps.every((n,r)=>{let o=i.steps[r];return this.isSameNodePositionStep(n,o)})}isPseudoelement(t){return!!Bi(t)}};u(Rc,"SVG_URL_ATTRIBUTES",["color-profile","clip-path","cursor","filter","marker","marker-start","marker-end","marker-mid","fill","stroke","mask"]);var m0=Rc,w0={"float-min-wrap-block":!0,"float-reference":!0,"flow-into":!0,"flow-linger":!0,"flow-options":!0,"flow-priority":!0,"footnote-policy":!0,"margin-break":!0,page:!0},wr=null,b0=class{constructor(e){u(this,"layoutBox"),u(this,"window"),u(this,"scaleRatio"),this.layoutBox=e.layoutBox,this.window=e.window,this.scaleRatio=e.scaleRatio}scaleRect(e){return wr?{left:e.left*this.scaleRatio,top:e.top*this.scaleRatio,right:e.right*this.scaleRatio,bottom:e.bottom*this.scaleRatio,width:e.width*this.scaleRatio,height:e.height*this.scaleRatio}:e}subtractOffsets(e,t){let i=t.left,n=t.top;return{left:e.left-i,top:e.top-n,right:e.right-i,bottom:e.bottom-n,width:e.width,height:e.height}}getRangeClientRects(e){let t=e.getClientRects(),i=this.layoutBox.getBoundingClientRect();return Array.from(t).map(n=>this.scaleRect(this.subtractOffsets(n,i)))}getElementClientRect(e){let t=e.getBoundingClientRect();if(t.left===0&&t.top===0&&t.right===0&&t.bottom===0)return t;let i=this.layoutBox.getBoundingClientRect();return this.scaleRect(this.subtractOffsets(t,i))}getElementComputedStyle(e){return this.window.getComputedStyle(e,null)}adjustLengthValue(e){let t=64*(this.scaleRatio||1);return Math.floor(e*t)/t}},Rr=class{constructor(e,t,i,n,r,o){this.window=e,this.fontSize=t,this.pixelRatio=i,u(this,"document"),u(this,"root"),u(this,"outerZoomBox"),u(this,"contentContainer"),u(this,"layoutBox"),u(this,"width"),u(this,"height"),u(this,"scaleRatio",1),this.document=e.document,this.root=n||this.document.body;let s=this.root.firstElementChild;s||(s=this.document.createElement("div"),s.setAttribute("data-vivliostyle-outer-zoom-box","true"),this.root.appendChild(s));let a=s.firstElementChild;a||(a=this.document.createElement("div"),a.setAttribute("data-vivliostyle-spread-container","true"),s.appendChild(a)),i>0&&CSS.supports("zoom","8")&&(T(this.root,"--viv-outputPixelRatio",`${i}`),T(this.root,"--viv-devicePixelRatio",`${e.devicePixelRatio}`),this.scaleRatio=i/e.devicePixelRatio,wr===null&&(wr=!("currentCSSZoom"in a)),wr&&T(this.root,"--viv-scaleRectRatio",`${this.scaleRatio}`));let h=s.nextElementSibling;h||(h=this.document.createElement("div"),h.setAttribute("data-vivliostyle-layout-box","true"),this.root.appendChild(h)),this.outerZoomBox=s,this.contentContainer=a,this.layoutBox=h,this.width=r||parseFloat(e.getComputedStyle(this.root).width)||this.root.offsetWidth||e.innerWidth,this.height=o||parseFloat(e.getComputedStyle(this.root).height)||this.root.offsetHeight||e.innerHeight;let l={width:794,height:1056},c=!e.outerWidth&&!e.outerHeight||/Headless/.test(navigator.userAgent)||navigator.webdriver&&e.innerWidth===800&&e.innerHeight===600;(!this.width||!r&&c)&&(this.width=l.width),(!this.height||!o&&c)&&(this.height=l.height)}resetZoom(){T(this.outerZoomBox,"width",""),T(this.outerZoomBox,"height",""),T(this.contentContainer,"width",""),T(this.contentContainer,"height",""),T(this.contentContainer,"transform","")}zoom(e,t,i){T(this.root,"--viv-outputScale",`${i}`),T(this.outerZoomBox,"width",`${e*i}px`),T(this.outerZoomBox,"height",`${t*i}px`),T(this.contentContainer,"width",`${e}px`),T(this.contentContainer,"height",`${t}px`)}clear(){let e=this.root;for(;e.lastChild;)e.removeChild(e.lastChild)}},Lc=class{constructor(e,t,i){this.store=e,this.url=t,this.document=i,u(this,"lang",null),u(this,"totalOffset",-1),u(this,"root"),u(this,"body"),u(this,"head"),u(this,"last"),u(this,"lastOffset",1),u(this,"idMap"),this.root=i.documentElement;let n=null,r=null;if(this.root.namespaceURI=="http://www.w3.org/1999/xhtml"){for(let o=this.root.firstChild;o;o=o.nextSibling){if(o.nodeType!=1)continue;let s=o;if(s.namespaceURI=="http://www.w3.org/1999/xhtml")switch(s.localName){case"head":r=s;break;case"body":n=s;break}}this.lang=this.root.getAttribute("lang")}this.body=n,this.head=r,this.last=this.root,this.last.setAttribute(At,"0")}doc(){return new Bc([this.document])}getElementOffset(e){let t=e.getAttribute(At);if(t)return parseInt(t,10);let i=this.lastOffset,n=this.last;for(;n!=e;){let r=n.firstChild;if(!r){for(;r=n.nextSibling,!r;)if(n=n.parentNode,n==null)throw new Error("Internal error")}n=r,r.nodeType==1?(r.setAttribute(At,i.toString()),++i):i+=r.textContent.length}return this.lastOffset=i,this.last=e,i-1}getNodeOffset(e,t,i){let n=0,r=e,o=null;if(r.nodeType==1){if(!i)return this.getElementOffset(r)}else{if(n=t,o=r.previousSibling,!o)return r=r.parentNode,n+=1,this.getElementOffset(r)+n;r=o}for(;;){for(;r.lastChild;)r=r.lastChild;if(r.nodeType==1)break;if(n+=r.textContent.length,o=r.previousSibling,!o){r=r.parentNode;break}r=o}return n+=1,this.getElementOffset(r)+n}getTotalOffset(){return this.totalOffset<0&&(this.totalOffset=this.getNodeOffset(this.root,0,!0)),this.totalOffset}getNodeByOffset(e){let t,i=this.root;for(;;){if(t=this.getElementOffset(i),t>=e)return i;let a=i.children;if(!a)break;let h=Yt(a.length,l=>{let c=a[l];return this.getElementOffset(c)>e});if(h==0)break;i=a[h-1]}let n=t+1,r=i,o=r.firstChild||r.nextSibling,s=null;for(;;){if(o){if(o.nodeType==1||(r=o,s=r,n+=o.textContent.length,n>e&&!/^\s*$/.test(o.textContent)))break}else if(r=r.parentNode,!r)break;o=r.nextSibling}return o&&s&&/^\s*$/.test(s.textContent)&&(s=o),s||i}buildIdMap(e){let t=e.getAttribute("id");t&&!this.idMap[t]&&(this.idMap[t]=e);let i=e.getAttributeNS("http://www.w3.org/XML/1998/namespace","id");i&&!this.idMap[i]&&(this.idMap[i]=e);for(let n=e.firstElementChild;n;n=n.nextElementSibling)this.buildIdMap(n)}getElement(e){let t=e.match(/([^#]*)#(.+)$/);if(!t||t[1]&&t[1]!=this.url)return null;let i=t[2],n=this.document.getElementById(i);return!n&&this.document.getElementsByName&&(n=this.document.getElementsByName(i)[0]),n||(this.idMap||(this.idMap={},this.buildIdMap(this.document.documentElement)),n=this.idMap[i]),n}},os=(e=>(e.TEXT_HTML="text/html",e.TEXT_XML="text/xml",e.APPLICATION_XML="application/xml",e.APPLICATION_XHTML_XML="application/xhtml+xml",e.IMAGE_SVG_XML="image/svg+xml",e))(os||{});function hr(e,t,i){let n=i||new DOMParser,r;try{r=n.parseFromString(e,t)}catch{}if(r){let o=r.documentElement,s="parsererror";if(o.localName===s)return null;for(let a=o.firstElementChild;a;a=a.nextElementSibling)if(a.localName===s)return null}else return null;return r}function v0(e){let t=e.contentType;if(t){let n=Object.keys(os);for(let r=0;r<n.length;r++)if(os[n[r]]===t)return t;if(t.match(/\+xml$/))return"application/xml"}let i=e.url.match(/\.([^./]+)$/);if(i)switch(i[1]){case"html":case"htm":return"text/html";case"xhtml":case"xht":return"application/xhtml+xml";case"svg":case"svgz":return"image/svg+xml";case"opf":case"xml":return"application/xml"}return null}function Oc(e,t){let i=e.responseXML;if(!i){let r=new DOMParser,o=e.responseText;if(o){let s=v0(e);if(i=hr(o,s||"application/xml",r),i&&!s){let a=i.documentElement;a.localName.toLowerCase()==="html"&&!a.namespaceURI?i=hr(o,"text/html",r):a.localName.toLowerCase()==="svg"&&i.contentType!=="image/svg+xml"&&(i=hr(o,"image/svg+xml",r))}i||(i=hr(o,"text/html",r))}}let n=i?new Lc(t,e.url,i):null;return P(n)}function x0(){return new vs(Oc,"document")}var y0=class ss{constructor(t){this.fn=t}check(t){return this.fn(t)}withAttribute(t,i){return new ss(n=>this.check(n)&&n.nodeType==1&&n.getAttribute(t)==i)}withChild(t,i){return new ss(n=>{if(!this.check(n))return!1;let r=new Bc([n]);return r=r.child(t),i&&(r=r.predicate(i)),r.size()>0})}},kl=new y0(e=>!0),Bc=class as{constructor(t){this.nodes=t}asArray(){return this.nodes}size(){return this.nodes.length}predicate(t){let i=[];for(let n of this.nodes)t.check(n)&&i.push(n);return new as(i)}forEachNode(t){let i=[],n=r=>{i.push(r)};for(let r=0;r<this.nodes.length;r++)t(this.nodes[r],n);return new as(i)}forEach(t){let i=[];for(let n=0;n<this.nodes.length;n++)i.push(t(this.nodes[n]));return i}forEachNonNull(t){let i=[];for(let n=0;n<this.nodes.length;n++){let r=t(this.nodes[n]);r!=null&&i.push(r)}return i}child(t){return this.forEachNode((i,n)=>{for(let r=i.firstChild;r;r=r.nextSibling)r.nodeType==1&&r.localName==t&&n(r)})}childElements(){return this.forEachNode((t,i)=>{for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==1&&i(n)})}attribute(t){return this.forEachNonNull(i=>i.nodeType==1?i.getAttribute(t):null)}textContent(){return this.forEach(t=>t.textContent)}},S0=new Dn(()=>{let e=_("uaStylesheetBase"),t=mc(),i=Te("user-agent-base.css",pi),n=new Tn(null,null,null,null,null,t,!0);return n.startStylesheet("UA"),Zg(n.cascade),ys(Bh,n,i,null,null).thenFinish(e),e.result()},"uaStylesheetBaseFetcher");function C0(){return S0.get()}var E0=class{constructor(e,t,i,n,r,o,s,a,h,l){this.store=e,this.rootScope=t,this.pageScope=i,this.cascade=n,this.rootBox=r,this.fontFaces=o,this.footnoteProps=s,this.flowProps=a,this.viewportProps=h,this.pageProps=l,u(this,"fontDeobfuscator"),u(this,"validatorSet"),this.fontDeobfuscator=e.fontDeobfuscator,this.validatorSet=e.validatorSet,this.pageScope.defineBuiltIn("has-content",function(c){c=c;let p=this,d=p.currentLayoutPosition,f=d.firstFlowChunkOfFlow(c);return p.matchPageSide(d.startSideOfFlow(c))&&d.hasContent(c,p.lookupOffset)&&!!f&&!p.flowChunkIsAfterParentFlowForcedBreak(f)}),this.pageScope.defineName("page-number",new We(this.pageScope,function(){let c=this;return c.pageNumberOffset+c.currentLayoutPosition.page},"page-number")),this.pageScope.defineName("blank-page",new We(this.pageScope,function(){let c=this.currentLayoutPosition;return c?.isBlankPage},"blank-page"))}sizeViewport(e,t,i,n){if(this.viewportProps.length){let r=new yo(this.rootScope,e,t,i),o=fg(r,this.viewportProps),s=o.width,a=o.height,h=o["text-zoom"],l=1;if(s&&a||h){let c=xe.em;if((h?h.evaluate(r,"text-zoom"):null)===x.scale&&(l=c/i,i=c,e*=l,t*=l),s&&a){let p=Ze(s.evaluate(r,"width"),r),d=Ze(a.evaluate(r,"height"),r);if(p>0&&d>0)return{width:n&&n.spreadView?(p+n.pageBorder)*2:p,height:d,fontSize:i}}}}return{width:e,height:t,fontSize:i}}},_c=class extends yo{constructor(e,t,i,n,r,o,s,a,h,l,c,p,d){super(e.rootScope,n.width,n.height,n.fontSize),this.style=e,this.xmldoc=t,this.viewport=n,this.clientLayout=r,this.fontMapper=o,this.customRenderer=s,this.fallbackMap=a,this.pageNumberOffset=h,this.documentURLTransformer=l,this.counterStore=c,u(this,"lang"),u(this,"primaryFlows",{body:!0}),u(this,"rootPageBoxInstance",null),u(this,"styler",null),u(this,"stylerMap",null),u(this,"currentLayoutPosition",null),u(this,"layoutPositionAtPageStart",null),u(this,"lookupOffset",0),u(this,"faces"),u(this,"pageBoxInstances",{}),u(this,"pageManager",null),u(this,"rootPageFloatLayoutContext"),u(this,"pageBreaks",{}),u(this,"pageProgression",null),u(this,"isVersoFirstPage",!1),u(this,"blankPageAtStart",!1),u(this,"pageSheetSize",{}),u(this,"pageSheetHeight",0),u(this,"pageSheetWidth",0),this.lang=t.lang||i,this.faces=new Pw(this.style.fontDeobfuscator),this.rootPageFloatLayoutContext=new cn(null,null,null,null,null,null,null),this.pageProgression=p||null,this.isVersoFirstPage=!!d;for(let f in e.flowProps){let g=e.flowProps[f],m=Ge(g,"flow-consume");m&&(m.evaluate(this,"flow-consume")==x.all?this.primaryFlows[f]=!0:delete this.primaryFlows[f])}}init(){let e=_("StyleInstance.init"),t=this.counterStore.createCounterListener(this.xmldoc.url),i=this.counterStore.createCounterResolver(this.xmldoc.url,this.style.rootScope,this.style.pageScope);this.styler=new cl(this.xmldoc,this.style.cascade,this.style.rootScope,this,this.primaryFlows,this.style.validatorSet,t,i),i.setStyler(this.styler),this.styler.resetFlowChunkStream(this),this.stylerMap={},this.stylerMap[this.xmldoc.url]=this.styler;let n=this.styler.getTopContainerStyle();this.pageProgression||(this.pageProgression=Pc(n)),this.matchStartPageSide(this.styler.breakBeforeValues[0])||(this.pageNumberOffset===0?this.isVersoFirstPage=!0:this.blankPageAtStart=!0);let r=this.style.rootBox;this.rootPageBoxInstance=new Rw(r);let o=this.style.cascade.createInstance(this,t,i,this.lang);this.styler.cascade.currentPageType=this.styler.cascade.firstPageType,this.rootPageBoxInstance.applyCascadeAndInit(o,n),this.rootPageBoxInstance.resolveAutoSizing(this),this.pageManager=new Yw(o,this.style.pageScope,this.rootPageBoxInstance,this,n);let s=[];for(let h of this.style.fontFaces){if(h.condition&&!h.condition.evaluate(this))continue;let l=kw(h.properties,this),c=new wc(l);s.push(c)}this.fontMapper.findOrLoadFonts(s,this.faces).then(()=>{c0(this.xmldoc.document,this.viewport.window,this.styler).thenFinish(e)});let a=this.style.pageProps;return a[""]||(a[""]={}),Object.keys(a).forEach(h=>{let l=a[h];this.styler.cascade.applyVarFilter([l],this.styler,null),this.styler.cascade.applyCalcFilter(l,this.styler.context);let c=Sl(Ar(l),this);this.pageSheetSize[h]={width:c.pageWidth+c.cropOffset*2,height:c.pageHeight+c.cropOffset*2}}),e.result()}matchStartPageSide(e){let t=this.pageNumberOffset%2==(this.isVersoFirstPage?1:0),i=this.pageProgression=="ltr";switch(e){case"left":return t!==i;case"right":return t===i;case"recto":return t;case"verso":return!t;default:return!0}}getStylerForDoc(e){let t=this.stylerMap[e.url];if(!t){let i=this.style.store.getStyleForDoc(e),n=new yo(i.rootScope,this.pageWidth(),this.pageHeight(),this.initialFontSize),r=this.counterStore.createCounterListener(e.url),o=this.counterStore.createCounterResolver(e.url,i.rootScope,i.pageScope);t=new cl(e,i.cascade,i.rootScope,n,this.primaryFlows,i.validatorSet,r,o),this.stylerMap[e.url]=t}return t}registerInstance(e,t){this.pageBoxInstances[e]=t}lookupInstance(e){return this.pageBoxInstances[e]}encounteredFlowChunk(e,t){let i=this.currentLayoutPosition;if(i){i.flows[e.flowName]?t=i.flows[e.flowName]:i.flows[e.flowName]=t;let n=i.flowPositions[e.flowName];n||(n=new Hf,i.flowPositions[e.flowName]=n);let r=zf(e.element),o=new Qt(r),s=new Vf(o,e);n.positions.push(s)}}evalSupportsTest(e,t,i){if(i)return e==="selector"?this.evalSupportsSelector(t):!1;if(!e)return!1;let n=!0;class r{unknownProperty(h,l){n=!1}invalidPropertyValue(h,l){n=!1}simpleProperty(h,l,c){}}let o=new r,s=Zi(this.style.rootScope,new St(t,null),"");return s?(this.xmldoc.store.validatorSet.validatePropertyAndHandleShorthand(e,s,!1,o),n):!1}evalSupportsSelector(e){let t=new Mc(null),i=new St(e+"{}",t);return new Hn(Ne,i,t,"").runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!1)?!t.cascadeParserHandler.invalid:!1}getConsumedOffset(e){let t=Number.POSITIVE_INFINITY;for(let i=0;i<e.positions.length;i++){let n=e.positions[i].chunkPosition.primary,r=n.steps[0].node,o=n.offsetInNode,s=n.after,a=0;for(;r.ownerDocument!=this.xmldoc.document;)a++,r=n.steps[a].node,s=!1,o=0;let h=this.xmldoc.getNodeOffset(r,o,s);h<t&&(t=h)}return t}getPosition(e,t){if(!e)return 0;let i=Number.POSITIVE_INFINITY;for(let n in this.primaryFlows){let r=e.flowPositions[n];if(!t&&(!r||r.positions.length==0)&&this.currentLayoutPosition&&(this.styler.styleUntilFlowIsReached(n),r=this.currentLayoutPosition.flowPositions[n],e!=this.currentLayoutPosition&&r&&(r=r.clone(),e.flowPositions[n]=r)),r){let o=this.getConsumedOffset(r);o<i&&(i=o)}}return i}dumpLocation(e){U.debug("Location - page",this.currentLayoutPosition.page),U.debug("  current:",e),U.debug("  lookup:",this.lookupOffset);for(let t in this.currentLayoutPosition.flowPositions){let i=this.currentLayoutPosition.flowPositions[t];for(let n of i.positions)U.debug("  Chunk",`${t}:`,n.flowChunk.startOffset)}}matchPageSide(e){switch(e){case"left":case"right":case"recto":case"verso":return new $e(this.style.pageScope,`${e}-page`).evaluate(this);default:return!0}}updateStartSide(e){for(let t in e.flowPositions){let i=e.flowPositions[t];if(i&&i.positions.length>0){let n=i.positions[0].flowChunk;if(this.getConsumedOffset(i)===n.startOffset){let r=i.positions[0].flowChunk.breakBefore,o=i.startBreakType;i.startBreakType=za(Je(o,r))}}}}selectPageMaster(e){let t=this.currentLayoutPosition,i=this.getPosition(t);if(i==Number.POSITIVE_INFINITY)return null;let n=this.rootPageBoxInstance.children,r;for(let o=0;o<n.length;o++){if(r=n[o],r.pageBox.pseudoName===Gs)continue;let s=1;r.pageBox.pseudoName===Hs&&!(this.actualPageWidth&&this.actualPageHeight)&&(s=1/0);let a=r.getProp(this,"utilization");a&&a.isNum()&&(s=a.num);let h=this.queryUnitSize("em",!1),l=this.pageWidth()*this.pageHeight(),c=Math.ceil(s*l/(h*h));this.lookupOffset=this.styler.styleUntil(i,c),this.updateStartSide(t),this.layoutPositionAtPageStart=t.clone(),this.initLingering(),this.clearScope(this.style.pageScope);let p=r.getProp(this,"enabled");if(!p||p===x._true){if(t.page===1&&this.blankPageAtStart){r.style={};let d=e.size;e={},d&&(e.size=d)}return this.pageManager.getPageRulePageMaster(r,e)}}throw new Error("No enabled page masters")}flowChunkIsAfterParentFlowForcedBreak(e){let t=this.layoutPositionAtPageStart.flows,i=t[e.flowName].parentFlowName;if(i){let n=e.startOffset,r=t[i].forcedBreakOffsets;if(!r.length||n<r[0])return!1;let o=Yt(r.length,l=>r[l]>n)-1,s=r[o],a=this.layoutPositionAtPageStart.flowPositions[i],h=this.getConsumedOffset(a);return s<h?!1:h<s?!0:!this.matchPageSide(a.startBreakType)}return!1}setFormattingContextToColumn(e,t){let i=this.currentLayoutPosition.flows[t];i.formattingContext||(i.formattingContext=new Ns(null)),e.flowRootFormattingContext=i.formattingContext}layoutDeferredPageFloats(e){let t=e.pageFloatLayoutContext,i=t.getDeferredPageFloatContinuations(),n=a=>{if(a.floatReference!==Be.PAGE)return!1;let h=this.layoutPositionAtPageStart.flowPositions.body,l=h&&this.getConsumedOffset(h),c=this.xmldoc.getNodeOffset(a.nodePosition.steps[0].node,0,!1);return c!=null&&l!=null&&c>l},r=_("layoutDeferredPageFloats"),o=!1,s=0;return r.loopWithFrame(a=>{if(s===i.length){a.breakLoop();return}let h=i[s++],l=h.float;if(n(l)){a.breakLoop();return}let c=new Gi().findByFloat(l),p=c.findPageFloatFragment(l,t);if(p&&p.hasFloat(l)){a.continueLoop();return}else if(t.isForbidden(l)||t.hasPrecedingFloatsDeferredToNext(l)){t.deferPageFloat(h),a.breakLoop();return}e.layoutPageFloatInner(h,c,null,p).then(d=>{if(!d){a.breakLoop();return}let f=t.parent.isInvalidated();if(f){a.breakLoop();return}else t.isInvalidated()&&!f&&(o=!0,t.validate());a.continueLoop()})}).then(()=>{o&&t.invalidate(),r.finish(!0)}),r.result()}getLastAfterPositionIfDeferredFloatsExists(e,t){if(e.pageFloatLayoutContext.getPageFloatContinuationsDeferredToNext().length>0)if(e.lastAfterPosition){let i;return t?(i=t.clone(),i.primary=e.lastAfterPosition):i=new Qt(e.lastAfterPosition),i}else return null;else return null}layoutColumn(e,t){let i=this.currentLayoutPosition.flowPositions[t];if(!i||!this.matchPageSide(i.startBreakType))return P(!0);this.setFormattingContextToColumn(e,t),e.init(),this.primaryFlows[t]&&e.bands.length>0&&(e.forceNonfitting=!1);let n=_("layoutColumn");return this.layoutDeferredPageFloats(e).then(()=>{if(e.pageFloatLayoutContext.isInvalidated()){n.finish(!0);return}let r=[],o=[],s=!0;n.loopWithFrame(a=>{if(e.pageFloatLayoutContext.hasContinuingFloatFragmentsInFlow(t)){a.breakLoop();return}for(;i.positions.length-o.length>0;){let h=0;for(;o.includes(h);)h++;let l=i.positions[h];if(l.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(l.flowChunk))break;for(let d=h+1;d<i.positions.length;d++){if(o.includes(d))continue;let f=i.positions[d];if(f.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(f.flowChunk))break;f.flowChunk.isBetter(l.flowChunk)&&(l=f,h=d)}let c=l.flowChunk,p=!0;if(e.layout(l.chunkPosition,s,i.breakAfter).then(d=>{if(e.pageFloatLayoutContext.isInvalidated()){a.breakLoop();return}if(s=!1,l.flowChunk.repeated&&(d===null||c.exclusive)&&r.push(h),c.exclusive){o.push(h),a.breakLoop();return}else{let f=!!d||!!e.pageBreakType,g=this.getLastAfterPositionIfDeferredFloatsExists(e,d);if(e.pageBreakType&&g?(l.chunkPosition=g,i.breakAfter=e.pageBreakType,e.pageBreakType=null):(o.push(h),(d||g)&&(l.chunkPosition=d||g,r.push(h)),i.startBreakType=za(e.pageBreakType)),f){a.breakLoop();return}}e.forceNonfitting=!1,p?p=!1:a.continueLoop()}),p){p=!1;return}}a.breakLoop()}).then(()=>{if(!e.pageFloatLayoutContext.isInvalidated()){i.positions=i.positions.filter((h,l)=>r.includes(l)||!o.includes(l)),i.breakAfter==="column"&&(i.breakAfter=null),e.saveDistanceToBlockEndFloats();let a=e.pageFloatLayoutContext.getMaxReachedAfterEdge();e.updateMaxReachedAfterEdge(a)}n.finish(!0)})}),n.result()}createLayoutConstraint(e){let t=this.currentLayoutPosition.page-1,i=this.counterStore.createLayoutConstraint(t);return new bm([i].concat(e.getLayoutConstraints()))}createAndLayoutColumn(e,t,i,n,r,o,s,a,h,l,c,p,d,f){let g=e.vertical?e.isAutoWidth&&e.isRightDependentOnAutoWidth:e.isAutoHeight&&e.isTopDependentOnAutoHeight,m=r.element,v=new cn(a,Be.COLUMN,null,s,null,null,null),b=this.currentLayoutPosition.clone(),w=_("createAndLayoutColumn"),S;return w.loopWithFrame(L=>{let B=this.createLayoutConstraint(v);if(h>1){let D=this.viewport.document.createElement("div");if(T(D,"position","absolute"),m.appendChild(D),S=new Ir(D,d,this.clientLayout,B,v),S.forceNonfitting=f,S.vertical=r.vertical,S.rtl=r.rtl,S.snapHeight=r.snapHeight,S.snapWidth=r.snapWidth,r.vertical){let W=(r.rtl?h-o-1:o)*(c+l)+r.paddingTop,q=parseFloat(m.style.width);S.setHorizontalPosition(r.paddingLeft+q-r.width,r.width),S.setVerticalPosition(W,c)}else{let W=(r.rtl?h-o-1:o)*(c+l)+r.paddingLeft;S.setVerticalPosition(r.paddingTop,r.height),S.setHorizontalPosition(W,c)}S.originX=t,S.originY=i}else S=new Ir(m,d,this.clientLayout,B,v),S.copyFrom(r);S.exclusions=g?[]:n.concat(),S.innerShape=p,v.setContainer(S),S.width>=0?this.layoutColumn(S,s).then(()=>{v.isInvalidated()||v.finish(),S.pageFloatLayoutContext.isInvalidated()&&!a.isInvalidated()?(S.pageFloatLayoutContext.validate(),this.currentLayoutPosition=b.clone(),S.element!==m&&m.removeChild(S.element),L.continueLoop()):L.breakLoop()}):(v.finish(),L.breakLoop())}).then(()=>{w.finish(S)}),w.result()}setPagePageFloatLayoutContextContainer(e,t,i){(t instanceof Ic||t instanceof Us&&!(t instanceof mr))&&e.setContainer(i)}getRegionPageFloatLayoutContext(e,t,i,n){t instanceof On;let r=t.getProp(this,"writing-mode")||null,o=t.getProp(this,"direction")||null;return new cn(e,Be.REGION,i,n,null,r,o)}layoutFlowColumnsWithBalancing(e,t,i,n,r,o,s,a,h){let l=this.currentLayoutPosition.clone(),c=this.getRegionPageFloatLayoutContext(o,t,s,a),p=!0,d=()=>(this.currentLayoutPosition=l.clone(),this.layoutFlowColumns(e,t,i,n,r,o,c,s,a,h,p).thenAsync(f=>P(f?{columns:f,position:this.currentLayoutPosition}:null)));return d().thenAsync(f=>{if(!f)return P(null);if(h<=1)return P(f.columns);let g=t.getProp(this,"column-fill")||x.balance,m=this.currentLayoutPosition.flowPositions[a],v=sw(h,g,d,c,s,f.columns,m);return v?(p=!1,o.lock(),c.lock(),v.balanceColumns(f).thenAsync(b=>(o.unlock(),o.validate(),c.unlock(),this.currentLayoutPosition=b.position,P(b.columns)))):P(f.columns)})}layoutFlowColumns(e,t,i,n,r,o,s,a,h,l,c){let p=_("layoutFlowColumns"),d=this.currentLayoutPosition.clone(),f=t.getPropAsNumber(this,"column-gap"),g=l>1?t.getPropAsNumber(this,"column-width"):a.width,m=t.getActiveRegions(this),v=t.getProp(this,"shape-inside"),b=kh(v,0,0,a.width,a.height,this),w=new m0(h,this,this.viewport,this.styler,m,this.xmldoc,this.faces,this.style.footnoteProps,this,e,this.customRenderer,this.fallbackMap,this.documentURLTransformer),S=0,L=null,B=[];return p.loopWithFrame(D=>{this.createAndLayoutColumn(t,i,n,r,a,S++,h,s,l,f,g,b,w,c).then(W=>{if(o.isInvalidated()){B=null,D.breakLoop();return}if((W.pageBreakType&&W.pageBreakType!=="column"||S===l)&&!s.isInvalidated()&&s.finish(),s.isInvalidated()){S=0,this.currentLayoutPosition=d.clone(),s.validate(),s.isLocked()?(B=null,D.breakLoop()):D.continueLoop();return}L=W,B[S-1]=L,L.pageBreakType&&L.pageBreakType!="column"&&(S=l,L.pageBreakType!="region"&&(this.pageBreaks[h]=!0)),S<l?D.continueLoop():D.breakLoop()})}).then(()=>{p.finish(B)}),p.result()}layoutContainer(e,t,i,n,r,o,s){t.reset();let a=t.getProp(this,"enabled");if(a&&a!==x._true)return P(!0);let h=_("layoutContainer"),l=t.getProp(this,"wrap-flow")===x.auto,c=t.getProp(this,"flow-from"),p=this.viewport.document.createElement("div"),d=t.getProp(this,"position");T(p,"position",d?d.name:"absolute");let f=t instanceof mr;t instanceof On?i.appendChild(p):i.insertBefore(p,i.firstChild);let g=new su(p);g.vertical=t.vertical,g.rtl=t.rtl,g.exclusions=o,t.prepareContainer(this,g,e,this.faces,this.clientLayout),t instanceof mr&&(g.width<=0||g.height<=0)&&U.warn("Negative or zero page area size"),g.originX=n,g.originY=r,n+=g.left+g.marginLeft+g.borderLeft,r+=g.top+g.marginTop+g.borderTop,this.setPagePageFloatLayoutContextContainer(s,t,g);let m,v=!1;if(!c||!c.isIdent()){let b=t.getProp(this,"content");if(b instanceof $&&b.expr instanceof We&&b.expr.str.startsWith("running-element-"))b.visit(new Pr(p,this,b,this.counterStore.getExprContentListener()));else if(b&&Jt(b)){let w="span";b.url&&(w="img");let S=this.viewport.document.createElement(w);b.visit(new Pr(S,this,b,this.counterStore.getExprContentListener())),p.appendChild(S),w=="img"&&t.transferSingleUriContentProps(this,S,this.faces),t.transferContentProps(this,g,e,this.faces),w=="span"&&um(S,t.getProp(this,"text-autospace"),t.getProp(this,"text-spacing-trim"),t.getProp(this,"hanging-punctuation"),this.lang,t.vertical)}else t.suppressEmptyBoxGeneration&&(i.removeChild(p),v=!0);v||t.finishContainer(this,g,e,null,1,this.clientLayout,this.faces),m=P(!0)}else if(this.pageBreaks[c.toString()])s.isInvalidated()||t.finishContainer(this,g,e,null,1,this.clientLayout,this.faces),m=P(!0);else{let b=_("layoutContainer.inner"),w=c.toString(),S=t.getPropAsNumber(this,"column-count");this.layoutFlowColumnsWithBalancing(e,t,n,r,o,s,g,w,S).then(L=>{if(!s.isInvalidated()){let B=L[0];B.element===p&&(g=B),g.computedBlockSize=Math.max.apply(null,L.map(W=>W.computedBlockSize)),t.finishContainer(this,g,e,B,S,this.clientLayout,this.faces);let D=this.currentLayoutPosition.flowPositions[w];D&&D.breakAfter==="region"&&(D.breakAfter=null)}b.finish(!0)}),m=b.result()}return m.then(()=>{if(s.isInvalidated()){h.finish(!0);return}if(!t.isAutoHeight||Math.floor(g.computedBlockSize)>0){if(!v&&!l){let w=t.getProp(this,"shape-outside"),S=g.getOuterShape(w,this);o.push(S)}}else if(t.children.length==0){i.removeChild(p),h.finish(!0);return}let b=f?0:t.children.length-1;h.loop(()=>{for(;b>=0&&b<t.children.length;){let w=t.children[f?b++:b--],S=this.layoutContainer(e,w,p,n,r,o,s);if(S.isPending())return S.thenAsync(()=>P(!s.isInvalidated()));if(s.isInvalidated())break}return P(!1)}).then(()=>{h.finish(!0)})}),h.result()}processLinger(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let i=this.currentLayoutPosition.flowPositions[t];for(let n=i.positions.length-1;n>=0;n--){let r=i.positions[n];r.flowChunk.startPage>=0&&r.flowChunk.startPage+r.flowChunk.linger-1<=e&&i.positions.splice(n,1)}}}initLingering(){let e=this.currentLayoutPosition.page;for(let t in this.currentLayoutPosition.flowPositions){let i=this.currentLayoutPosition.flowPositions[t];for(let n=i.positions.length-1;n>=0;n--){let r=i.positions[n];r.flowChunk.startPage<0&&r.flowChunk.startOffset<this.lookupOffset&&(r.flowChunk.startPage=e)}}}noMorePrimaryFlows(e){for(let t in this.primaryFlows){let i=e.flowPositions[t];if(i&&i.positions.length>0)return!1}return!0}layoutNextPage(e,t){var i;let n=e.container===e.bleedBox;this.pageBreaks={},t?(this.currentLayoutPosition=t.clone(),this.styler.replayFlowElementsFromOffset(t.highestSeenOffset)):(this.currentLayoutPosition=new Uf,this.styler.replayFlowElementsFromOffset(-1)),this.lang&&e.bleedBox.setAttribute("lang",this.lang),t=this.currentLayoutPosition;let r=1e4;if(t.page>r)throw new Error(`Too many pages generated (over ${r} pages)`);t.page++;let o=t.startSideOfFlow("body");t.isBlankPage=Nn(o)&&this.matchPageSide(o),e.isBlankPage=t.isBlankPage,e.pageType==null&&(e.pageType=(i=e.isBlankPage?this.styler.cascade.previousPageType:this.styler.cascade.currentPageType)!=null?i:"",this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.clearScope(this.style.pageScope),this.layoutPositionAtPageStart=t.clone();let s=n?{}:this.pageManager.getCascadedPageStyle(e.pageType);this.styler.cascade.applyVarFilter([s],this.styler,null),this.styler.cascade.applyCalcFilter(s,this.styler.context);let a=this.selectPageMaster(s);if(!a)return P(null);let h=0;if(!n){e.setAutoPageWidth(a.pageBox.specified.width.value===Yi),e.setAutoPageHeight(a.pageBox.specified.height.value===Ki),this.counterStore.setCurrentPage(e),this.counterStore.updatePageCounters(s,this);let f=Sl(Ar(s),this);this.setPageSizeAndBleed(f,e),Uw(s,f,e,this),h=f.bleedOffset+f.bleed}let l=!n&&a.getProp(this,"writing-mode")||x.horizontal_tb;this.pageVertical=l!=x.horizontal_tb;let c=a.getProp(this,"direction")||x.ltr,p=new cn(this.rootPageFloatLayoutContext,Be.PAGE,null,null,null,l,c),d=_("layoutNextPage");return d.loopWithFrame(f=>{this.layoutContainer(e,a,e.bleedBox,h,h,[],p).then(()=>{p.isInvalidated()||p.finish(),p.isInvalidated()?(this.currentLayoutPosition=this.layoutPositionAtPageStart.clone(),p.validate(),f.continueLoop()):f.breakLoop()})}).then(()=>{if(a.adjustPageLayout(this,e,this.clientLayout),!n){let g=new $e(a.pageBox.scope,"left-page");e.side=g.evaluate(this)?"left":"right",this.processLinger(),t=this.currentLayoutPosition,Object.keys(t.flowPositions).forEach(m=>{let v=t.flowPositions[m],b=v.breakAfter;b&&(b==="page"||!this.matchPageSide(b))&&(v.breakAfter=null)})}this.currentLayoutPosition=this.layoutPositionAtPageStart=null,t.highestSeenOffset=this.styler.getReachedOffset();let f=this.style.store.getTriggersForDoc(this.xmldoc);e.finish(f,this.clientLayout),this.noMorePrimaryFlows(t)&&(t=null),d.finish(t)}),d.result()}setPageSizeAndBleed(e,t){this.actualPageWidth=e.pageWidth,this.actualPageHeight=e.pageHeight,this.pageSheetWidth=e.pageWidth+e.cropOffset*2,this.pageSheetHeight=e.pageHeight+e.cropOffset*2,t.container.style.width=`${this.pageSheetWidth}px`,t.container.style.height=`${this.pageSheetHeight}px`,t.bleedBox.style.left=`${e.bleedOffset}px`,t.bleedBox.style.right=`${e.bleedOffset}px`,t.bleedBox.style.top=`${e.bleedOffset}px`,t.bleedBox.style.bottom=`${e.bleedOffset}px`,t.bleedBox.style.padding=`${e.bleed}px`}},k0=class ls extends Tn{constructor(t,i,n,r){super(t.rootScope,t,i,n,r,t.validatorSet,!n),this.masterHandler=t,u(this,"insideRegion",!1)}startPageTemplateRule(){}startPageMasterRule(t,i,n){let r=new bc(this.masterHandler.pageScope,t,i,n,this.masterHandler.rootBox,this.condition,this.owner.getBaseSpecificity());this.masterHandler.pushHandler(new Bw(r.scope,this.masterHandler,r,this.validatorSet))}startWhenRule(t){let i=t.expr;this.condition!=null&&(i=gt(this.scope,this.condition,i)),this.masterHandler.pushHandler(new ls(this.masterHandler,i,this,this.regionId))}startDefineRule(){this.masterHandler.pushHandler(new im(this.scope,this.owner))}startFontFaceRule(){let t={};this.masterHandler.fontFaces.push({properties:t,condition:this.condition}),this.masterHandler.pushHandler(new lr(this.scope,this.owner,null,t,this.masterHandler.validatorSet,"font-face"))}startFlowRule(t){let i=this.masterHandler.flowProps[t];i||(i={},this.masterHandler.flowProps[t]=i),this.masterHandler.pushHandler(new lr(this.scope,this.owner,null,i,this.masterHandler.validatorSet))}startViewportRule(){let t={};this.masterHandler.viewportProps.push(t),this.masterHandler.pushHandler(new lr(this.scope,this.owner,this.condition,t,this.masterHandler.validatorSet))}startFootnoteRule(t){let i=this.masterHandler.footnoteProps;if(t){let n=$r(i,"_pseudos");i=n[t],i||(i={},n[t]=i)}this.masterHandler.pushHandler(new lr(this.scope,this.owner,null,i,this.masterHandler.validatorSet))}startRegionRule(){this.insideRegion=!0,this.startSelectorRule()}startPageRule(){let t=new s0(this.masterHandler.pageScope,this.masterHandler,this,this.validatorSet,this.masterHandler.pageProps);this.masterHandler.pushHandler(t),t.startPageRule()}startRuleBody(){if(Tn.prototype.startRuleBody.call(this),this.insideRegion){this.insideRegion=!1;let t=`R${this.masterHandler.regionCount++}`;this.special("region-id",z(t)),this.endRule();let i=new ls(this.masterHandler,this.condition,this,t);this.masterHandler.pushHandler(i),i.startRuleBody()}}},Mc=class extends cf{constructor(e){super(),this.validatorSet=e,u(this,"rootScope"),u(this,"pageScope"),u(this,"rootBox"),u(this,"cascadeParserHandler"),u(this,"regionCount",0),u(this,"fontFaces",[]),u(this,"footnoteProps",{}),u(this,"flowProps",{}),u(this,"viewportProps",[]),u(this,"pageProps",{}),this.rootScope=new xo(null),this.pageScope=new xo(this.rootScope),this.rootBox=new Iw(this.rootScope),this.cascadeParserHandler=new k0(this,null,null,null),this.slave=this.cascadeParserHandler}};function P0(e,t){return t.parseOPSResource(e)}var N0=class extends vs{constructor(e){super(P0,"document"),this.fontDeobfuscator=e,u(this,"styleByKey",{}),u(this,"styleFetcherByKey",{}),u(this,"styleByDocURL",{}),u(this,"triggersByDocURL",{}),u(this,"validatorSet",null),u(this,"styleSheets",[]),u(this,"triggerSingleDocumentPreprocessing",!1)}init(e,t){this.setStyleSheets(e,t);let i=_("OPSDocStore.init");return this.validatorSet=mc(),C0().then(()=>{this.triggerSingleDocumentPreprocessing=!0,i.finish(!0)}),i.result()}getStyleForDoc(e){return this.styleByDocURL[e.url]}getTriggersForDoc(e){return this.triggersByDocURL[e.url]}setStyleSheets(e,t){this.clearStyleSheets(),e&&e.forEach(this.addAuthorStyleSheet,this),t&&t.forEach(this.addUserStyleSheet,this)}clearStyleSheets(){this.styleSheets.splice(0)}addAuthorStyleSheet(e){let t=e.url;t&&(t=Te(Pn(t),Ui)),this.styleSheets.push({url:t,text:e.text,flavor:"Author",classes:null,media:null})}addUserStyleSheet(e){let t=e.url;t&&(t=Te(Pn(t),Ui)),this.styleSheets.push({url:t,text:e.text,flavor:"User",classes:null,media:null})}parseOPSResource(e){let t=_("OPSDocStore.load"),i=e.url,n=i.endsWith("?viv-toc-box");return Oc(e,this).then(r=>{var o;if(!r){t.finish(null);return}if(this.triggerSingleDocumentPreprocessing){let d=xt("PREPROCESS_SINGLE_DOCUMENT");for(let f=0;f<d.length;f++)try{d[f](r.document)}catch(g){U.warn("Error during single document preprocessing:",g)}}let s=[],a=r.document.getElementsByTagNameNS("http://www.idpf.org/2007/ops","trigger");for(let d=0;d<a.length;d++){let f=a[d],g=f.getAttributeNS("http://www.w3.org/2001/xml-events","observer"),m=f.getAttributeNS("http://www.w3.org/2001/xml-events","event"),v=f.getAttribute("action"),b=f.getAttribute("ref");g&&m&&v&&b&&s.push({observer:g,event:m,action:v,ref:b})}this.triggersByDocURL[i]=s;let h=[];if(h.push({url:Te("user-agent-page.css",pi),text:Oh,flavor:"UA",classes:null,media:null}),n)h.push({url:Te("user-agent-toc.css",pi),text:_h,flavor:"UA",classes:null,media:null});else{let d=r.document.querySelectorAll("style, link, meta");for(let f of d){let g=f.namespaceURI,m=f.localName;if(g=="http://www.w3.org/1999/xhtml")if(m=="style"){let v=f.getAttribute("class"),b=f.getAttribute("media"),w=f.getAttribute("title");h.push({url:i,text:f.textContent,flavor:"Author",classes:w?v:null,media:b})}else if(m=="link"){let v=f.getAttribute("href"),b=(o=f.getAttribute("rel"))==null?void 0:o.split(/\s+/),w=f.getAttribute("class"),S=f.getAttribute("media");if(v&&b!=null&&b.includes("stylesheet")&&(!b.includes("alternate")||w)){let L=Te(v,i),B=f.getAttribute("title");h.push({url:L,text:null,classes:B?w:null,media:S,flavor:"Author"})}}else m=="meta"&&f.getAttribute("name")=="viewport"&&h.push({url:i,text:this.processViewportMeta(f),flavor:"Author",classes:null,media:null})}for(let f=0;f<this.styleSheets.length;f++)h.push(this.styleSheets[f])}let l="";for(let d=0;d<h.length;d++)l+=h[d].url,l+="^",h[d].text&&(l+=h[d].text),l+="^";let c=this.styleByKey[l];if(c){this.styleByDocURL[i]=c,t.finish(r);return}let p=this.styleFetcherByKey[l];p||(p=new Dn(()=>{let d=_("fetchStylesheet"),f=0,g=new Mc(this.validatorSet);return d.loop(()=>{if(f<h.length){let m=h[f++];return g.startStylesheet(m.flavor),m.text!==null?ys(m.text,g,m.url,m.classes,m.media).thenReturn(!0):$h(m.url,g,m.classes,m.media)}return P(!1)}).then(()=>{let m=g.cascadeParserHandler.finish();c=new E0(this,g.rootScope,g.pageScope,m,g.rootBox,g.fontFaces,g.footnoteProps,g.flowProps,g.viewportProps,g.pageProps),this.styleByKey[l]=c,delete this.styleFetcherByKey[l],d.finish(c)}),d.result()},`FetchStylesheet ${i}`),this.styleFetcherByKey[l]=p,p.start()),p.get().then(d=>{this.styleByDocURL[i]=d,t.finish(r)})}),t.result()}processViewportMeta(e){return""}},En="\u25B8",Pl="\u25BE",T0="\u25B9";function Xs(e){let t=Array.from(e.querySelectorAll("nav[*|type],nav[epub\\:type]"));if(t.length>0||(t=Array.from(e.querySelectorAll("[role=doc-toc]")),t.length>0))return t;let i="nav,.toc,#toc,#table-of-contents,#contents,[role=directory]";for(let n of e.querySelectorAll(i)){if(t.find(o=>o.contains(n)))continue;let r=n;/^h[1-6]$/.test(r.localName)&&(r.previousElementSibling?r=r.nextElementSibling:r=r.parentElement),r&&r.querySelector("li a[href]")&&t.push(r)}return t}function I0(e){let t=Xs(e),i=[];for(let n of t)for(let r of n.querySelectorAll("li a[href]"))i.push(r);return i}var F0=class{constructor(e,t,i,n,r,o,s,a,h,l){this.store=e,this.url=t,this.lang=i,this.clientLayout=n,this.fontMapper=r,this.rendererFactory=s,this.fallbackMap=a,this.documentURLTransformer=h,this.counterStore=l,u(this,"pref"),u(this,"page",null),u(this,"instance",null),this.pref=Zl(o),this.pref.spreadView=!1}setAutoHeight(e,t){if(t--!=0){for(let i=e.firstChild;i;i=i.nextSibling)if(i.nodeType==1){let n=i;Ai(n,"height","auto")!="auto"&&(T(n,"height","auto"),this.setAutoHeight(n,t)),Ai(n,"position","static")=="absolute"&&(T(n,"position","relative"),this.setAutoHeight(n,t))}}}makeCustomRenderer(e){let t=this.rendererFactory.makeCustomRenderer(e);return(i,n,r)=>{let o=r.behavior;if(o)switch(o.toString()){case"toc-node-anchor":r.color=x.inherit,r["text-decoration"]=x.none;break;case"toc-node":r.display=x.block,r.margin=ce,r.padding=ce,r["padding-inline-start"]=new A(1.25,"em");break;case"toc-node-first-child":r.display=x.inline_block,r.margin=new A(.2,"em"),r["vertical-align"]=x.top,r.color=x.inherit,r["text-decoration"]=x.none;break;case"toc-container":r.padding=ce;break}if(!o||o.toString()!="toc-node"&&o.toString()!="toc-container")return t(i,n,r);let s=i.firstChild;s&&s.nodeType!==1&&je(s)&&i.replaceChild(i.ownerDocument.createComment(s.textContent),s);let a=n.getAttribute("data-adapt-class");if(a=="toc-node"){let l=n.firstChild;l.textContent!=En&&(l.textContent=En,T(l,"cursor","pointer"),l.addEventListener("click",A0,!1),l.setAttribute("role","button"),l.setAttribute("aria-expanded","false"),n.setAttribute("aria-expanded","false"),n.style.height!=="0px"&&(l.tabIndex=0))}let h=n.ownerDocument.createElement("div");if(h.setAttribute("data-adapt-process-children","true"),o.toString()=="toc-node"){let l=n.ownerDocument.createElement("div");if(l.textContent=T0,T(l,"margin","0.2em 0 0 -1em"),T(l,"margin-inline-start","-1em"),T(l,"margin-inline-end","0"),T(l,"display","inline-block"),T(l,"width","1em"),T(l,"text-align","center"),T(l,"vertical-align","top"),T(l,"cursor","default"),T(l,"font-family","Menlo,sans-serif"),h.appendChild(l),T(h,"overflow","hidden"),h.setAttribute("data-adapt-class","toc-node"),h.setAttribute("role","treeitem"),a=="toc-node"||a=="toc-container"){T(h,"height","0px");let c=i.firstElementChild;c&&c.localName==="a"&&(c.tabIndex=-1)}else n.setAttribute("role","tree")}else a=="toc-node"&&(h.setAttribute("data-adapt-class","toc-container"),h.setAttribute("role","group"),h.setAttribute("aria-hidden","true"));return P(h)}}showTOC(e,t,i,n,r){if(this.page)return P(this.page);let o=_("showTOC"),s=new Qh(e,e);this.page=s;let a=Lt(this.url)+"?viv-toc-box";return this.store.load(a).then(h=>{for(let f of Xs(h.document))f.setAttribute("data-vivliostyle-role","doc-toc");let l=this.store.getStyleForDoc(h),c=l.sizeViewport(i,1e5,r);t=new Rr(t.window,c.fontSize,0,t.root,c.width,c.height);let p=this.makeCustomRenderer(h),d=new _c(l,h,this.lang,t,this.clientLayout,this.fontMapper,p,this.fallbackMap,0,this.documentURLTransformer,this.counterStore);this.instance=d,d.pref=this.pref,d.init().then(()=>{d.layoutNextPage(s,null).then(()=>{this.setAutoHeight(e,2),o.finish(s)})})}),o.result()}hideTOC(){this.page&&(this.page.container.style.visibility="hidden",this.page.container.setAttribute("aria-hidden","true"))}isTOCVisible(){return!!this.page&&this.page.container.style.visibility==="visible"}getTOC(){if(!this.page)return[];function e(n){if(!n)return[];let r=n.querySelectorAll(":scope > [role=treeitem] > a[href]");return Array.from(r).map(t)}function t(n){let r=new URL(n.href),[,o]=r.hash.match(/^#?(.*)$/),s=n.innerText,a=n.parentElement.querySelector("[role=group]"),h=e(a);return{id:o,title:s,children:h}}let i=this.page.container.querySelector("[role=tree]");return e(i)}};function A0(e){let t=e.target,i=t.textContent==En;t.textContent=i?Pl:En;let n=t.parentNode;t.setAttribute("aria-expanded",i?"true":"false"),n.setAttribute("aria-expanded",i?"true":"false");let r=n.firstChild;for(;r;){if(r.nodeType===1){let o=r,s=o.getAttribute("data-adapt-class");if(s==="toc-container"){if(o.setAttribute("aria-hidden",i?"false":"true"),o.firstChild){r=o.firstChild;continue}}else if(s==="toc-node"&&(o.style.height=i?"auto":"0px",o.children.length>=2&&(o.children[1].tabIndex=i?0:-1),o.children.length>=3&&(o.children[0].tabIndex=i?0:-1,!i))){let a=o.children[0];if(a.textContent==Pl){a.textContent=En,a.setAttribute("aria-expanded","false"),o.setAttribute("aria-expanded","false"),r=o.children[2];continue}}}for(;!r.nextSibling&&r.parentNode!==n;)r=r.parentNode;r=r.nextSibling}e.stopPropagation()}var Nl=class extends N0{constructor(){super(null),u(this,"plainXMLStore"),u(this,"jsonStore"),u(this,"opfByURL",{}),u(this,"primaryOPFByEPubURL",{}),u(this,"deobfuscators",{}),u(this,"documents",{}),this.fontDeobfuscator=this.makeDeobfuscatorFactory(),this.plainXMLStore=x0(),this.jsonStore=af()}makeDeobfuscatorFactory(){return e=>this.deobfuscators[e]}loadAsPlainXML(e,t,i){return this.plainXMLStore.load(e,t,i)}startLoadingAsPlainXML(e){this.plainXMLStore.fetch(e)}loadAsJSON(e,t,i){return this.jsonStore.load(e,t,i)}loadPubDoc(e){let t=_("loadPubDoc");return Dr(e,null,"HEAD").then(i=>{if(i.status>=400)this.loadEPUBDoc(e).then(n=>{if(n){t.finish(n);return}U.error(`Failed to fetch a source document from ${e} (${i.status}${i.statusText?" "+i.statusText:""})`),t.finish(null)});else if(!i.status&&!i.responseXML&&!i.responseText&&!i.responseBlob&&!i.contentType&&/\/[^/.]+(?:[#?]|$)/.test(e)&&(e=e.replace(/([#?]|$)/,"/$1")),i.contentType=="application/oebps-package+xml"||/\.opf(?:[#?]|$)/.test(e)){let[,n,r]=e.match(/^((?:.*\/)?)([^/]*)$/);this.loadOPF(n,r).thenFinish(t)}else i.contentType=="application/ld+json"||i.contentType=="application/webpub+json"||i.contentType=="application/audiobook+json"||i.contentType=="application/json"||/\.json(?:ld)?(?:[#?]|$)/.test(e)?this.loadAsJSON(e,!0).then(n=>{if(!n){this.reportLoadError(e),t.finish(null);return}let r=new br(this,e);r.initWithWebPubManifest(n,void 0,e).then(()=>{t.finish(r)})}):this.loadWebPub(e).then(n=>{if(n){t.finish(n);return}this.loadEPUBDoc(e).then(r=>{if(r){t.finish(r);return}U.error(`Failed to load ${e}.`),t.finish(null)})})}),t.result()}loadEPUBDoc(e){let t=_("loadEPUBDoc");e.endsWith("/")||(e=e+"/"),this.startLoadingAsPlainXML(e+"META-INF/encryption.xml");let i=e+"META-INF/container.xml";return this.loadAsPlainXML(i).then(n=>{if(n){let r=n.doc().child("container").child("rootfiles").child("rootfile").attribute("full-path");for(let o of r)if(o){this.loadOPF(e,o).thenFinish(t);return}}t.finish(null)}),t.result()}loadOPF(e,t){let i=e+t,n=this.opfByURL[i];if(n)return P(n);let r=_("loadOPF");return this.loadAsPlainXML(i,!0,`Failed to fetch EPUB OPF ${i}`).then(o=>{o?this.loadAsPlainXML(`${e}META-INF/encryption.xml`).then(s=>{n=new br(this,e),n.initWithXMLDoc(o,s).then(()=>{this.opfByURL[i]=n,this.primaryOPFByEPubURL[e]=n,r.finish(n)})}):this.reportLoadError(i)}),r.result()}loadWebPub(e){let t=_("loadWebPub");return this.load(e).then(i=>{if(!i)this.reportLoadError(e);else if(i.document.querySelector("a[href='META-INF/'],a[href$='/META-INF/']"))t.finish(null);else{let n=i.document,r=new br(this,e),o=n.querySelector("link[rel='publication'],link[rel='manifest'][type='application/webpub+json']");if(o){let s=o.getAttribute("href");if(/^#/.test(s)){let a=us(n.getElementById(s.substr(1)).textContent);r.initWithWebPubManifest(a,n).then(()=>{t.finish(r)})}else{let a=Te(o.getAttribute("href"),e);this.loadAsJSON(a,!0,`Failed to fetch Publication Manifest ${a}`).then(h=>{r.initWithWebPubManifest(h,n,a).then(()=>{t.finish(r)})})}}else r.initWithWebPubManifest({},n).then(()=>{r.toc&&r.toc.src===i.url&&Xs(n).length===0&&(r.toc=null),t.finish(r)})}}),t.result()}addDocument(e,t){let i=_("EPUBDocStore.load"),n=Lt(e);return(this.documents[n]=this.parseOPSResource({status:200,statusText:"",url:n,contentType:t.contentType,responseText:null,responseXML:t,responseBlob:null})).thenFinish(i),i.result()}reportLoadError(e){let t=n=>n.replace(/([^:/?#]|^)[/?#].*/,"$1"),i=()=>{let n=t(e);return!(n===t(Ui)||Object.keys(this.resources).find(r=>this.resources[r]&&t(r)===n)||/\.(xhtml|xht|xml|opf)$/i.test(e))};e.startsWith("data:")?U.error(`Failed to load ${e}. Invalid data.`):e.startsWith("http:")&&Ui.startsWith("https:")?U.error(`Failed to load ${e}. Mixed Content ("http:" content on "https:" context) is not allowed.`):i()?U.error(`Failed to load ${e}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`):U.error(`Failed to load ${e}. The target resource is invalid.`)}load(e){let t=Lt(e),i=this.documents[t];if(i)return i.isPending()?i:P(i.get());{let n=_("EPUBDocStore.load");return i=super.load(t,!0,`Failed to fetch a source document from ${t}`),i.then(r=>{r?n.finish(r):this.reportLoadError(t)}),n.result()}}processViewportMeta(e){let t=e.getAttribute("content");if(!t)return"";let i={},n;for(;(n=t.match(/^,?\s*([-A-Za-z_.][-A-Za-z_0-9.]*)\s*=\s*([-+A-Za-z_0-9.]*)\s*/))!=null;)t=t.substr(n[0].length),i[n[1]]=n[2];let r=i.width-0,o=i.height-0;if(r&&o){let s=!!Object.values(this.primaryOPFByEPubURL).find(a=>a.prePaginated);return`@-epubx-viewport{width:${r}px;height:${o}px;}`+(s?`@page{size:${r}px ${o}px;margin:0;}`:"@page{margin:0;}")}return""}},Tl=class{constructor(){u(this,"id",null),u(this,"src",""),u(this,"mediaType",null),u(this,"title",null),u(this,"itemRefElement",null),u(this,"spineIndex",-1),u(this,"compressedSize",0),u(this,"compressed",null),u(this,"epage",0),u(this,"epageCount",0),u(this,"startPage",null),u(this,"skipPagesBefore",null),u(this,"itemProperties"),this.itemProperties=Id}initWithElement(e,t){this.id=e.getAttribute("id"),this.src=Te(e.getAttribute("href"),t),this.mediaType=e.getAttribute("media-type");let i=e.getAttribute("properties");i&&(this.itemProperties=_d(i.split(/\s+/)))}initWithParam(e){this.spineIndex=e.index,this.id=`item${e.index+1}`,this.src=e.url,this.startPage=e.startPage,this.skipPagesBefore=e.skipPagesBefore}};function R0(e){return e.id}function L0(e){return t=>{let i=_("deobfuscator");return O0("SHA-1",e).then(n=>{let r=t.slice(0,1040),o=t.slice(1040,t.size);rf(r).then(s=>{let a=new DataView(s);for(let h=0;h<a.byteLength;h++){let l=a.getUint8(h);l^=n[h%20],a.setUint8(h,l)}i.finish(zh([a,o]))})}),i.result()}}function O0(e,t){let i=_("makeDigest"),n=i.suspend();return window.crypto.subtle.digest(e,new TextEncoder().encode(t)).then(r=>{n.schedule(new Uint8Array(r))}),i.result()}var jt={dcterms:"http://purl.org/dc/terms/",marc:"http://id.loc.gov/vocabulary/",media:"http://www.idpf.org/epub/vocab/overlays/#",rendition:"http://www.idpf.org/vocab/rendition/#",onix:"http://www.editeur.org/ONIX/book/codelists/current.html#",xsd:"http://www.w3.org/2001/XMLSchema#",opf:"http://www.idpf.org/2007/opf"},fn="http://idpf.org/epub/vocab/package/meta/#",Le={language:`${jt.dcterms}language`,title:`${jt.dcterms}title`,creator:`${jt.dcterms}creator`,layout:`${jt.rendition}layout`,titleType:`${fn}title-type`,displaySeq:`${fn}display-seq`,alternateScript:`${fn}alternate-script`,role:`${fn}role`};function B0(e,t){let i={};return(n,r)=>{var o,s,a,h,l,c;let p,d,f=n.r||i,g=r.r||i;if(e==Le.title&&(p=((o=f[Le.titleType])==null?void 0:o[0].v)=="main",d=((s=g[Le.titleType])==null?void 0:s[0].v)=="main",p!=d))return p?-1:1;let m=parseInt((a=f[Le.displaySeq])==null?void 0:a[0].v,10);isNaN(m)&&(m=Number.MAX_VALUE);let v=parseInt((h=g[Le.displaySeq])==null?void 0:h[0].v,10);return isNaN(v)&&(v=Number.MAX_VALUE),m!=v?m-v:e!=Le.language&&t&&(p=((l=f[Le.language]||f[Le.alternateScript])==null?void 0:l[0].v)==t,d=((c=g[Le.language]||g[Le.alternateScript])==null?void 0:c[0].v)==t,p!=d)?p?-1:1:n.o-r.o}}function _0(e,t){let i;if(!t)i=jt;else{i={};for(let d in jt)i[d]=jt[d];let p;for(;(p=t.match(/^\s*([A-Z_a-z\u007F-\uFFFF][-.A-Z_a-z0-9\u007F-\uFFFF]*):\s*(\S+)/))!=null;)t=t.substr(p[0].length),i[p[1]]=p[2]}let n=p=>{if(p){let d=p.match(/^\s*(([^:]*):)?(\S+)\s*$/);if(d){let f=d[2]?i[d[2]]:fn;if(f)return f+d[3]}}return null},r=1,o=e.childElements().forEachNonNull(p=>{if(p.localName=="meta"){let d=n(p.getAttribute("property"));if(d)return{name:d,value:p.textContent,id:p.getAttribute("id"),order:r++,refines:p.getAttribute("refines"),lang:null,scheme:n(p.getAttribute("scheme")),role:null}}else if(p.namespaceURI=="http://purl.org/dc/elements/1.1/")return{name:jt.dcterms+p.localName,order:r++,lang:p.getAttribute("xml:lang"),value:p.textContent,id:p.getAttribute("id"),refines:null,scheme:null,role:p.getAttribute("role")||p.getAttribute("opf:role")};return null}),s=to(o,p=>p.refines),a=p=>Md(p,(d,f)=>d.map(g=>{let m={v:g.value,o:g.order};g.scheme&&(m.s=g.scheme);let v=s[`#${g.id}`]||[];if(v.length||g.lang||g.role){g.lang&&v.push({name:Le.language,value:g.lang,lang:null,id:null,refines:g.id,scheme:null,order:g.order,role:null}),g.role&&v.push({name:Le.role,value:g.role,lang:null,id:null,refines:g.id,scheme:null,order:g.order,role:null});let b=to(v,w=>w.name);m.r=a(b)}return m})),h=a(to(o,p=>p.refines?null:p.name)),l=null;h[Le.language]&&(l=h[Le.language][0].v);let c=p=>{for(let d in p){let f=p[d];f.sort(B0(d,l));for(let g=0;g<f.length;g++){let m=f[g].r;m&&c(m)}}};return c(h),h}function M0(){let e=window.MathJax;return e?e.Hub:null}var Il={"application/xhtml+xml":!0,"image/jpeg":!0,"image/png":!0,"image/svg+xml":!0,"image/gif":!0,"audio/mp3":!0},go="viv-id-",br=class{constructor(e,t){this.store=e,this.pubURL=t,u(this,"opfXML",null),u(this,"encXML",null),u(this,"items",null),u(this,"spine",null),u(this,"itemMap",null),u(this,"itemMapByPath",null),u(this,"uid",null),u(this,"bindings",{}),u(this,"lang",null),u(this,"epageCount",0),u(this,"prePaginated",!1),u(this,"epageIsRenderedPage",!0),u(this,"epageCountCallback",null),u(this,"metadata",{}),u(this,"toc",null),u(this,"cover",null),u(this,"fallbackMap",{}),u(this,"pageProgression",null),u(this,"documentURLTransformer"),this.documentURLTransformer=this.createDocumentURLTransformer()}createDocumentURLTransformer(){let e=this;class t{transformFragment(n,r){let o=r+(n?`#${n}`:"");return go+jl(o,":")}transformURL(n,r){let o=n.match(/^([^#]*)#?(.*)$/);if(o){let s=o[1]||r,a=decodeURIComponent(o[2]);if(s&&e.spine.some(h=>h.src===s))return`#${this.transformFragment(a,s)}`}return n}restoreURL(n){n.charAt(0)==="#"&&(n=n.substring(1)),n.indexOf(go)===0&&(n=n.substring(go.length));let r=Bd(n,":").match(/^([^#]*)#?(.*)$/);return r?[r[1],r[2]]:[]}}return new t}getMetadata(){return this.metadata}getPathFromURL(e){if(e.startsWith("data:"))return e===this.pubURL?"":e;if(this.pubURL){let t=Te("",this.pubURL);return e===t||e+"/"===t?"":(t.charAt(t.length-1)!="/"&&(t+="/"),e.substr(0,t.length)==t?decodeURIComponent(e.substr(t.length)):null)}else return e}initWithXMLDoc(e,t){this.opfXML=e,this.encXML=t;let i=e.doc().child("package"),n=i.attribute("unique-identifier")[0];if(n){let h=e.getElement(`${e.url}#${n}`);h&&(this.uid=h.textContent.replace(/[ \n\r\t]/g,""))}let r={};this.items=i.child("manifest").child("item").asArray().map(h=>{let l=new Tl,c=h;l.initWithElement(c,e.url);let p=c.getAttribute("fallback");return p&&!Il[l.mediaType]&&(r[l.src]=p),!this.toc&&l.itemProperties.nav&&(this.toc=l),!this.cover&&l.itemProperties["cover-image"]&&(this.cover=l),l}),this.itemMap=ga(this.items,R0),this.itemMapByPath=ga(this.items,h=>this.getPathFromURL(h.src));for(let h in r){let l=h;for(;;){let c=this.itemMap[r[l]];if(!c)break;if(Il[c.mediaType]){this.fallbackMap[h]=c.src;break}l=c.src}}this.spine=i.child("spine").child("itemref").asArray().map((h,l)=>{let c=h,p=c.getAttribute("idref"),d=this.itemMap[p];return d&&(d.itemRefElement=c,d.spineIndex=l),d});let o=i.child("spine").attribute("page-progression-direction")[0];o&&(this.pageProgression=zl(o));let s=t?t.doc().child("encryption").child("EncryptedData").predicate(kl.withChild("EncryptionMethod",kl.withAttribute("Algorithm","http://www.idpf.org/2008/embedding"))).child("CipherData").child("CipherReference").attribute("URI"):[],a=i.child("bindings").child("mediaType").asArray();for(let h=0;h<a.length;h++){let l=a[h].getAttribute("handler"),c=a[h].getAttribute("media-type");c&&l&&this.itemMap[l]&&(this.bindings[c]=this.itemMap[l].src)}if(this.metadata=_0(i.child("metadata"),i.attribute("prefix")[0]),this.metadata[Le.language]&&(this.lang=this.metadata[Le.language][0].v),this.metadata[Le.layout]&&(this.prePaginated=this.metadata[Le.layout][0].v==="pre-paginated"),s.length>0&&this.uid){let h=L0(this.uid);for(let l=0;l<s.length;l++)this.store.deobfuscators[this.pubURL+s[l]]=h}return this.prePaginated&&this.assignAutoPages(),P(!0)}assignAutoPages(){let e=0;for(let t of this.spine){let i=this.prePaginated?1:Math.ceil(t.compressedSize/1024);t.epage=e,t.epageCount=i,e+=i}this.epageCount=e,this.epageCountCallback&&this.epageCountCallback(this.epageCount)}setEPageCountMode(e){this.epageIsRenderedPage=e||this.prePaginated}countEPages(e){if(this.epageCountCallback=e,this.epageIsRenderedPage)return this.prePaginated&&this.epageCount==0&&this.assignAutoPages(),P(!0);let t=0,i=0,n=_("countEPages");return n.loopWithFrame(r=>{if(i===this.spine.length){r.breakLoop();return}let o=this.spine[i++];o.epage=t,this.store.load(o.src).then(s=>{let a=1800,h=s.lang||this.lang;h&&h.match(/^(ja|ko|zh)/)&&(a/=3),o.epageCount=Math.ceil(s.getTotalOffset()/a),t+=o.epageCount,this.epageCount=t,this.epageCountCallback&&this.epageCountCallback(this.epageCount),r.continueLoop()})}).thenFinish(n),n.result()}initWithChapters(e,t){this.itemMap={},this.itemMapByPath={},this.items=[],this.spine=this.items;let i=this.opfXML=new Lc(null,"",new DOMParser().parseFromString("<spine></spine>","text/xml"));return e.forEach(n=>{let r=new Tl;r.initWithParam(n),r.id;let o=i.document.createElement("itemref");o.setAttribute("idref",r.id),i.root.appendChild(o),r.itemRefElement=o,this.itemMap[r.id]=r;let s=this.getPathFromURL(n.url);s==null&&(s=n.url),this.itemMapByPath[s]=r,this.items.push(r)}),t?this.store.addDocument(e[0].url,t):P(null)}initWithWebPubManifest(e,t,i){var n,r,o,s;e.readingProgression&&(this.pageProgression=e.readingProgression),this.metadata===void 0&&(this.metadata={});let a=e.name||((n=e.metadata)==null?void 0:n.title)||t?.title;a&&(this.metadata[Le.title]=(Array.isArray(a)?a:[a]).map(m=>{var v;return{v:(v=m.value)!=null?v:m}}));let h=e.author||e.creator||((r=e.metadata)==null?void 0:r.author)||Array.from((o=t?.querySelectorAll("meta[name='author'], meta[name='DC.Creator']"))!=null?o:[]).map(m=>m.content);h&&h.length!==0&&(this.metadata[Le.creator]=(Array.isArray(h)?h:[h]).map(m=>{var v;return{v:(v=m.name)!=null?v:m}}));let l=e.inLanguage||((s=e.metadata)==null?void 0:s.language)||t?.documentElement.lang||t?.documentElement.getAttribute("xml:lang");l&&(this.metadata[Le.language]=(Array.isArray(l)?l:[l]).map(m=>({v:m})));let c=this.getPathFromURL(this.pubURL);if(!e.readingOrder&&t&&c!==null){e.readingOrder=[encodeURI(c)];for(let m of I0(t)){let v=m.getAttribute("href");if(/^(https?:)?\/\//.test(v)||/\.(jpe?g|png|gif|pdf|svg|mml)([#?]|$)/.test(v))continue;let b=Lt(Te(v,this.pubURL)),w=this.getPathFromURL(b),S=w!==null?encodeURI(w):b;e.readingOrder.indexOf(S)==-1&&e.readingOrder.push(S)}}let p=[],d=0,f=-1;[e.readingOrder,e.resources].forEach(m=>{m instanceof Array&&m.forEach(v=>{let b=m===e.readingOrder,w=typeof v=="string"?v:v.url||v.href,S=typeof v=="string"?"":v.encodingFormat||v.href&&v.type||"";if(b||S==="text/html"||S==="application/xhtml+xml"||!S&&v.rel!=="stylesheet"&&/(^|\/)([^/]+\.(x?html|htm|xht)|[^/.]*)([#?]|$)/.test(w)){let L=i?i.replace(/\/[^/]+$/,"/"):this.pubURL,B={url:Te(Pn(w),L),index:d++,startPage:null,skipPagesBefore:null};v.rel==="contents"&&f===-1&&(f=B.index),p.push(B)}})});let g=_("initWithWebPubManifest");return this.initWithChapters(p).then(()=>{var m,v;f!==-1&&(this.toc=this.items[f]),this.toc||(this.toc=i?(m=this.items)==null?void 0:m[0]:this.itemMapByPath[c]);let b=(v=e.readingOrder)==null?void 0:v.length;b&&b<this.items.length&&this.items.splice(b),g.finish(!0)}),g.result()}getCFI(e,t){let i=this.spine[e],n=_("getCFI");return this.store.load(i.src).then(r=>{let o=r.getNodeByOffset(t),s=null;if(o){let a=r.getNodeOffset(o,0,!1),h=t-a,l=new ya;l.prependPathFromNode(o,h,!1,null),i.itemRefElement&&l.prependPathFromNode(i.itemRefElement,0,!1,null),s=l.toString()}n.finish(s)}),n.result()}resolveFragment(e){return $i("resolveFragment",t=>{if(!e){t.finish(null);return}let i=new ya;i.fromString(e);let n;if(this.opfXML){let r=i.navigate(this.opfXML.document);if(r.node.nodeType!=1||r.after||!r.ref){t.finish(null);return}let o=r.node,s=o.getAttribute("idref");if(o.localName!="itemref"||!s||!this.itemMap[s]){t.finish(null);return}n=this.itemMap[s],i=r.ref}else n=this.spine[0];this.store.load(n.src).then(r=>{let o=i.navigate(r.document),s=r.getNodeOffset(o.node,o.offset,o.after);t.finish({spineIndex:n.spineIndex,offsetInItem:s,pageIndex:-1})})},(t,i)=>{U.warn(i,"Cannot resolve fragment:",e),t.finish(null)})}resolveEPage(e){return $i("resolveEPage",t=>{if(e<=0){t.finish({spineIndex:0,offsetInItem:0,pageIndex:-1});return}if(this.epageIsRenderedPage){let r=this.spine.findIndex(a=>a.epage==0&&a.epageCount==0||a.epage<=e&&a.epage+a.epageCount>e);r==-1&&(r=this.spine.length-1);let o=this.spine[r];(!o||o.epageCount==0)&&(o=this.spine[--r]);let s=Math.floor(e-o.epage);t.finish({spineIndex:r,offsetInItem:-1,pageIndex:s});return}let i=Yt(this.spine.length,r=>{let o=this.spine[r];return o.epage+o.epageCount>e});i==this.spine.length&&i--;let n=this.spine[i];this.store.load(n.src).then(r=>{e-=n.epage,e>n.epageCount&&(e=n.epageCount);let o=0;if(e>0){let s=r.getTotalOffset();o=Math.round(s*e/n.epageCount),o==s&&o--}t.finish({spineIndex:i,offsetInItem:o,pageIndex:-1})})},(t,i)=>{U.warn(i,"Cannot resolve epage:",e),t.finish(null)})}getEPageFromPosition(e){let t=this.spine[e.spineIndex];if(this.epageIsRenderedPage){let n=t.epage+e.pageIndex;return P(n)}if(e.offsetInItem<=0)return P(t.epage);let i=_("getEPage");return this.store.load(t.src).then(n=>{let r=n.getTotalOffset(),o=Math.min(r,e.offsetInItem);i.finish(t.epage+o*t.epageCount/r)}),i.result()}},ur=(e,t)=>({page:e,position:{spineIndex:e.spineIndex,pageIndex:t,offsetInItem:e.offset}}),z0=class{constructor(e,t,i,n,r){this.opf=e,this.viewport=t,this.fontMapper=i,this.pageSheetSizeReporter=r,u(this,"spineItems",[]),u(this,"spineItemLoadingContinuations",[]),u(this,"pref"),u(this,"clientLayout"),u(this,"counterStore"),u(this,"tocAutohide",!1),u(this,"tocVisible",!1),u(this,"tocView"),this.pref=Zl(n),this.clientLayout=new b0(t),this.counterStore=new Pp(e.documentURLTransformer)}getPage(e){let t=this.spineItems[e.spineIndex];return t?t.pages[e.pageIndex]:null}getCurrentPageProgression(e){if(this.opf.pageProgression)return this.opf.pageProgression;{let t=this.spineItems[e?e.spineIndex:0];return t?t.instance.pageProgression:null}}finishPageContainer(e,t,i){t.container.style.display="none",t.container.style.visibility="visible",t.container.style.position="",t.container.style.top="",t.container.style.left="",t.container.setAttribute("data-vivliostyle-page-side",t.side);let n=e.pages[i];if(t.isFirstPage=e.item.spineIndex==0&&i==0,e.pages[i]=t,this.opf.epageIsRenderedPage){if(i==0&&e.item.spineIndex>0){let r=this.opf.spine[e.item.spineIndex-1];e.item.epage=r.epage+r.epageCount}e.item.epageCount=e.pages.length,this.opf.epageCount=this.opf.spine.reduce((r,o)=>r+o.epageCount,0),this.opf.epageCountCallback&&this.opf.epageCountCallback(this.opf.epageCount)}if(n)e.instance.viewport.contentContainer.replaceChild(t.container,n.container),n.dispatchEvent({type:"replaced",target:null,currentTarget:null,preventDefault:null,newPage:t});else{let r=null;if(i>0)r=e.pages[i-1].container.nextElementSibling;else for(let o=e.item.spineIndex+1;o<this.spineItems.length;o++){let s=this.spineItems[o];if(s&&s.pages[0]){r=s.pages[0].container;break}}e.instance.viewport.contentContainer.insertBefore(t.container,r)}this.pageSheetSizeReporter({width:e.instance.pageSheetWidth,height:e.instance.pageSheetHeight},e.instance.pageSheetSize,e.item.spineIndex,e.instance.pageNumberOffset+i)}renderSinglePage(e,t){let i=_("renderSinglePage"),n=e.pages[t?t.page:0],r=this.makePage(e,t);return n&&(r.pageType=n.pageType),e.instance.layoutNextPage(r,t).then(o=>{t=o;let s=t?t.page-1:e.layoutPositions.length-1;this.finishPageContainer(e,r,s),this.counterStore.finishPage(r.spineIndex,s);let a=null;if(t){let h=e.layoutPositions[t.page];e.layoutPositions[t.page]=t,h&&e.pages[t.page]&&(t.isSamePosition(h)||(a=this.renderSinglePage(e,t)))}a||(a=P(!0)),a.then(()=>{let h=this.counterStore.getUnresolvedRefsToPage(r),l=0;i.loopWithFrame(c=>{if(l++,l>h.length){c.breakLoop();return}let p=h[l-1];if(p.refs=p.refs.filter(d=>!d.isResolved()),p.refs.length===0){c.continueLoop();return}this.getPageViewItem(p.spineIndex).then(d=>{if(!d){c.continueLoop();return}let{currentPageType:f,previousPageType:g}=d.instance.styler.cascade,m=Object.entries(d.instance.scopes);this.counterStore.pushPageCounters(p.pageCounters),this.counterStore.pushReferencesToSolve(p.refs);let v=d.layoutPositions[p.pageIndex];this.renderSinglePage(d,v).then(b=>{d.instance.styler.cascade.currentPageType=f,d.instance.styler.cascade.previousPageType=g,d.instance.scopes=Object.fromEntries(m),this.counterStore.popPageCounters(),this.counterStore.popReferencesToSolve();let w=b.pageAndPosition.position;w.spineIndex===r.spineIndex&&w.pageIndex===s&&(r=b.pageAndPosition.page),c.continueLoop()})})}).then(()=>{r.container.parentElement||(r=e.pages[s]),r.isLastPage=!t&&e.item.spineIndex===this.opf.spine.length-1,r.isLastPage&&(this.viewport,this.counterStore.finishLastPage(this.viewport)),r.container.setAttribute("data-vivliostyle-page-index",s),r.container.setAttribute("data-vivliostyle-spine-index",r.spineIndex),i.finish({pageAndPosition:ur(r,s),nextLayoutPosition:t})})})}),i.result()}normalizeSeekPosition(e,t){let i=e.pageIndex,n=-1;if(i<0){n=e.offsetInItem;let r=Yt(t.layoutPositions.length,o=>t.instance.getPosition(t.layoutPositions[o],!0)>n);r===t.layoutPositions.length?t.complete?i=t.layoutPositions.length-1:i=Number.POSITIVE_INFINITY:i=r-1}else i===Number.POSITIVE_INFINITY&&e.offsetInItem!==-1&&(n=e.offsetInItem);return{spineIndex:e.spineIndex,pageIndex:i,offsetInItem:n}}findPage(e,t){let i=_("findPage");return this.getPageViewItem(e.spineIndex).then(n=>{if(!n){i.finish(null);return}let r=null,o;i.loopWithFrame(s=>{let a=this.normalizeSeekPosition(e,n);o=a.pageIndex,r=n.pages[o],r?s.breakLoop():n.complete?(o=n.layoutPositions.length-1,r=n.pages[o],s.breakLoop()):t?this.renderPage(a).then(h=>{h&&(r=h.page,o=h.position.pageIndex),s.breakLoop()}):i.sleep(100).then(()=>{s.continueLoop()})}).then(()=>{i.finish(ur(r,o))})}),i.result()}renderPage(e){let t=_("renderPage");return this.getPageViewItem(e.spineIndex).then(i=>{if(!i){t.finish(null);return}let n=this.normalizeSeekPosition(e,i),r=n.pageIndex,o=n.offsetInItem,s=i.pages[r];if(s){t.finish(ur(s,r));return}t.loopWithFrame(a=>{if(r<i.layoutPositions.length){a.breakLoop();return}if(i.complete){r=i.layoutPositions.length-1,a.breakLoop();return}let h=i.layoutPositions[i.layoutPositions.length-1];this.renderSinglePage(i,h).then(l=>{let c=l.pageAndPosition.page;if(h=l.nextLayoutPosition,h){if(o>=0&&i.instance.getPosition(h)>o){s=c,r=i.layoutPositions.length-2,a.breakLoop();return}a.continueLoop()}else s=c,r=l.pageAndPosition.position.pageIndex,i.complete=!0,a.breakLoop()})}).then(()=>{s=s||i.pages[r];let a=i.layoutPositions[r];if(s){t.finish(ur(s,r));return}this.renderSinglePage(i,a).then(h=>{h.nextLayoutPosition||(i.complete=!0),t.finish(h.pageAndPosition)})})}),t.result()}renderAllPages(){let e=_("renderAllPages");return this.renderPagesUpto({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},!1).then(t=>{e.loopWithFrame(i=>{this.spineItems.some(n=>n?.pages.some(r=>r?.fetchers.some(o=>!o.arrived)))?e.sleep(100).then(()=>{i.continueLoop()}):i.breakLoop()}).then(()=>{e.finish(t)})}),e.result()}renderPagesUpto(e,t){let i=_("renderPagesUpto");e||(e={spineIndex:0,pageIndex:0,offsetInItem:0});let n=e.spineIndex,r=e.pageIndex,o=0;t&&(o=n);let s;return i.loopWithFrame(a=>{let h={spineIndex:o,pageIndex:o===n?r:Number.POSITIVE_INFINITY,offsetInItem:o===n?e.offsetInItem:-1};this.renderPage(h).then(l=>{s=l,++o>n?a.breakLoop():a.continueLoop()})}).then(()=>{i.finish(s)}),i.result()}firstPage(e,t){return this.findPage({spineIndex:0,pageIndex:0,offsetInItem:-1},t)}lastPage(e,t){return this.findPage({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},t)}nextPage(e,t){let i=e.spineIndex,n=e.pageIndex,r=_("nextPage");return this.getPageViewItem(i).then(o=>{if(!o){r.finish(null);return}if(o.complete&&n==o.layoutPositions.length-1){if(i>=this.opf.spine.length-1){r.finish(null);return}i++,n=0;let s=this.spineItems[i],a=s&&s.pages[0],h=o.pages[o.pages.length-1];a&&h&&a.side==h.side&&(s.pages.forEach(l=>{l.container&&l.container.remove()}),this.spineItems[i]=null,this.spineItemLoadingContinuations[i]=null)}else n++;this.findPage({spineIndex:i,pageIndex:n,offsetInItem:-1},t).thenFinish(r)}),r.result()}previousPage(e,t){let i=e.spineIndex,n=e.pageIndex;if(n==0){if(i==0)return P(null);i--,n=Number.POSITIVE_INFINITY}else n--;return this.findPage({spineIndex:i,pageIndex:n,offsetInItem:-1},t)}isRectoPage(e,t){let i=e.side==="left",n=this.getCurrentPageProgression(t)==="ltr";return!i&&n||i&&!n}getSpread(e,t){let i=this.getPage(e);if(!i)return P({left:null,right:null});let n=_("getSpread"),r=i.side==="left",o;return this.isRectoPage(i,e)?o=this.previousPage(e,t):o=this.nextPage(e,t),o.then(s=>{let a=this.getPage(e),h=s&&s.page;h&&h.side===a.side&&(h=null),r?n.finish({left:a,right:h}):n.finish({left:h,right:a})}),n.result()}nextSpread(e,t){let i=this.getPage(e);if(!i)return P(null);let n=this.isRectoPage(i,e),r=this.nextPage(e,t);return n?r:r.thenAsync(o=>{if(o){if(o.page.side===i.side)return r;let s=this.nextPage(o.position,t);return s.thenAsync(a=>a?s:r)}else return P(null)})}previousSpread(e,t){let i=this.getPage(e);if(!i)return P(null);let n=this.isRectoPage(i,e),r=this.previousPage(e,t),o=i.container.previousElementSibling;return n?r.thenAsync(s=>s?s.page.side===i.side||s.page.container!==o?r:this.previousPage(s.position,t):P(null)):r}navigateToEPage(e,t,i){let n=_("navigateToEPage");return this.opf.resolveEPage(e).then(r=>{r?this.findPage(r,i).thenFinish(n):n.finish(null)}),n.result()}navigateToFragment(e,t,i){let n=_("navigateToCFI");return this.opf.resolveFragment(e).then(r=>{r?this.findPage(r,i).thenFinish(n):n.finish(null)}),n.result()}navigateTo(e,t,i){U.debug("Navigate to",e);let n=this.opf.getPathFromURL(Lt(e));if(!n){if(this.opf.opfXML&&e.match(/^#epubcfi\(/))n=this.opf.getPathFromURL(this.opf.opfXML.url);else if(e.charAt(0)==="#"){let s=this.opf.documentURLTransformer.restoreURL(e);this.opf.opfXML?(n=this.opf.getPathFromURL(s[0]),n==null&&(n=s[0])):n=s[0],e=s[0]+(s[1]?`#${s[1]}`:"")}if(n==null)return P(null)}let r=this.opf.itemMapByPath[n];if(!r){if(this.opf.opfXML&&n==this.opf.getPathFromURL(this.opf.opfXML.url)){let s=e.indexOf("#");if(s>=0)return this.navigateToFragment(e.substr(s+1),t,i)}return P(null)}let o=_("navigateTo");return this.getPageViewItem(r.spineIndex).then(s=>{if(!s){o.finish(null);return}let a=s.xmldoc.getElement(e);this.findPage({spineIndex:r.spineIndex,pageIndex:-1,offsetInItem:a?s.xmldoc.getElementOffset(a):0},i).thenFinish(o)}),o.result()}makePage(e,t){let i=e.instance.viewport,n=i.document.createElement("div");n.setAttribute("data-vivliostyle-page-container","true"),n.setAttribute("role","region"),n.style.position="absolute",n.style.top="0",n.style.left="0",kn||(n.style.visibility="hidden"),i.layoutBox.appendChild(n);let r=i.document.createElement("div");r.setAttribute("data-vivliostyle-bleed-box","true"),n.appendChild(r);let o=new Qh(n,r);if(o.spineIndex=e.item.spineIndex,o.position=t,o.offset=e.instance.getPosition(t),o.offset===0&&!(e.instance.blankPageAtStart&&e.pages.length===0)){let s=this.opf.documentURLTransformer.transformFragment("",e.item.src);r.setAttribute("id",s),o.registerElementWithId(r,s)}if(i!==this.viewport){let s=Ql(this.viewport.width,this.viewport.height,i.width,i.height),a=Zi(null,new St(s,null),"");o.delayedItems.push(new Cs(n,"transform",a))}return o}makeObjectView(e,t,i,n){let r=t.getAttribute("data"),o=null;if(r){r=Te(r,e.url);let s=t.getAttribute("media-type");if(!s){let a=this.opf.getPathFromURL(r);if(a){let h=this.opf.itemMapByPath[a];h&&(s=h.mediaType)}}if(s){let a=this.opf.bindings[s];if(a){o=this.viewport.document.createElement("iframe"),o.style.border="none";let h=pa(r),l=pa(s),c=new Bt;c.append(a),c.append("?src="),c.append(h),c.append("&type="),c.append(l);for(let f=t.firstChild;f;f=f.nextSibling)if(f.nodeType==1){let g=f;if(g.localName=="param"&&g.namespaceURI=="http://www.w3.org/1999/xhtml"){let m=g.getAttribute("name"),v=g.getAttribute("value");m&&v&&(c.append("&"),c.append(encodeURIComponent(m)),c.append("="),c.append(encodeURIComponent(v)))}}o.setAttribute("src",c.toString());let p=t.getAttribute("width");p&&o.setAttribute("width",p);let d=t.getAttribute("height");d&&o.setAttribute("height",d)}}}return o||(o=this.viewport.document.createElement("object"),r&&o.setAttribute("data",r),o.setAttribute("data-adapt-process-children","true")),P(o)}makeMathJaxView(e,t,i,n){let r=M0();if(r){let o=i.ownerDocument,s=o.createElement("span");i.appendChild(s);let a=o.importNode(t,!0);this.resolveURLsInMathML(a,e),s.appendChild(a);let h=r.queue;h.Push(["Typeset",r,s]);let l=_("makeMathJaxView"),c=l.suspend();return h.Push(()=>{c.schedule(s)}),l.result()}return P(null)}resolveURLsInMathML(e,t){if(e!=null){if(e.nodeType===1&&e.tagName==="mglyph"){let i=Array.from(e.attributes);for(let n of i){if(n.name!=="src")continue;let r=Te(n.nodeValue,t.url);n.namespaceURI?e.setAttributeNS(n.namespaceURI,n.name,r):e.setAttribute(n.name,r)}}e.firstChild&&this.resolveURLsInMathML(e.firstChild,t),e.nextSibling&&this.resolveURLsInMathML(e.nextSibling,t)}}makeCustomRenderer(e){return(t,i,n)=>t.localName=="object"&&t.namespaceURI=="http://www.w3.org/1999/xhtml"?this.makeObjectView(e,t,i,n):t.namespaceURI=="http://www.w3.org/1998/Math/MathML"?this.makeMathJaxView(e,t,i,n):t.dataset&&t.dataset.mathTypeset=="true"?this.makeMathJaxView(e,t,i,n):P(null)}getPageViewItem(e){if(e===-1||e>=this.opf.spine.length)return P(null);let t=this.spineItems[e];if(t)return P(t);let i=_("getPageViewItem"),n=this.spineItemLoadingContinuations[e];if(n){let s=i.suspend();return n.push(s),i.result()}else n=this.spineItemLoadingContinuations[e]=[];let r=this.opf.spine[e],o=this.opf.store;return o.load(r.src).then(s=>{var a;let h=r.itemRefElement.getAttribute("properties");h&&s.root.setAttribute("data-vivliostyle-epub-spine-properties",h),r.title=s.document.title;let l=o.getStyleForDoc(s),c=this.makeCustomRenderer(s),p=this.viewport,d=l.sizeViewport(p.width,p.height,p.fontSize,this.pref);(d.width!=p.width||d.height!=p.height||d.fontSize!=p.fontSize)&&(p=new Rr(p.window,d.fontSize,p.pixelRatio,p.root,d.width,d.height));let f=(a=this.spineItems[0])==null?void 0:a.instance.isVersoFirstPage,g=this.spineItems[e-1],m,v;if(r.startPage!==null)m=r.startPage-1,v=m;else{if(e>0&&(!g||!g.complete))m=r.epage||e,!this.opf.prePaginated&&m%2==(f?1:0)&&m++,v=m;else{m=g?g.instance.pageNumberOffset+g.pages.length:0;let S=this.counterStore.currentPageCounters.page;v=!S||!S.length?m:S[S.length-1]}r.skipPagesBefore!==null&&(m+=r.skipPagesBefore,v+=r.skipPagesBefore)}this.counterStore.forceSetPageCounter(v);let b=new _c(l,s,this.opf.lang,p,this.clientLayout,this.fontMapper,c,this.opf.fallbackMap,m,this.opf.documentURLTransformer,this.counterStore,this.opf.pageProgression,f);b.pref=this.pref;let w=this.opf.metadata&&this.opf.metadata[Le.title];b.pubTitle=w&&w[0]&&w[0].v||"",b.docTitle=r.title||"",b.init().then(()=>{!this.opf.pageProgression&&b.pageProgression&&(this.opf.pageProgression=b.pageProgression),t={item:r,xmldoc:s,instance:b,layoutPositions:[null],pages:[],complete:!1},this.spineItems[e]=t,i.finish(t),n.forEach(S=>{S.schedule(t)})})}),i.result()}removeRenderedPages(){let e=this.spineItems;for(let t of e)t&&t.pages.splice(0);this.viewport.clear()}hasAutoSizedPages(){let e=this.spineItems;for(let t of e)if(t){let i=t.pages;for(let n of i)if(n.isAutoPageWidth&&n.isAutoPageHeight)return!0}return!1}hasPages(){return this.spineItems.some(e=>e&&e.pages.length>0)}showTOC(e){let t=this.opf,i=t.toc;if(this.tocAutohide=e,!i)return P(null);if(this.tocVisible=!0,this.tocView&&this.tocView.page)return this.tocView.page.container.style.visibility="visible",this.tocView.page.container.setAttribute("aria-hidden","false"),P(this.tocView.page);let n=_("showTOC");this.tocView||(this.tocView=new F0(t.store,i.src,t.lang,this.clientLayout,this.fontMapper,this.pref,this,t.fallbackMap,t.documentURLTransformer,this.counterStore));let r=this.viewport,o=Math.min(344,Math.round(.67*r.width)-16),s=r.height-6,a=r.document.createElement("div");return r.root.appendChild(a),kn||(a.style.visibility="hidden"),a.style.width=`${o+16}px`,a.style.maxHeight=`${s}px`,a.setAttribute("data-vivliostyle-toc-box","true"),a.setAttribute("role","navigation"),this.tocView.showTOC(a,r,o,s,this.viewport.fontSize).then(h=>{a.style.visibility="visible",a.setAttribute("aria-hidden","false"),n.finish(h)}),n.result()}hideTOC(){this.tocVisible=!1,this.tocView&&this.tocView.hideTOC()}isTOCVisible(){return this.tocVisible&&!!this.tocView&&this.tocView.isTOCVisible()}},Fl="data-vivliostyle-viewer-status",D0="data-vivliostyle-spread-view",zc=(e=>(e.SINGLE_PAGE="singlePage",e.SPREAD="spread",e.AUTO_SPREAD="autoSpread",e))(zc||{}),V0=class{constructor(e,t,i,n){this.window=e,this.viewportElement=t,this.instanceId=i,this.callbackFn=n,u(this,"fontMapper"),u(this,"kick"),u(this,"sendCommand"),u(this,"resizeListener"),u(this,"hyperlinkListener"),u(this,"pageRuleStyleElement"),u(this,"pageSheetSizeAlreadySet",!1),u(this,"renderTask",null),u(this,"actions"),u(this,"readyState"),u(this,"packageURL"),u(this,"opf"),u(this,"touchActive"),u(this,"touchX"),u(this,"touchY"),u(this,"needResize"),u(this,"resized"),u(this,"needRefresh"),u(this,"viewportSize"),u(this,"currentPage"),u(this,"currentSpread"),u(this,"pagePosition"),u(this,"fontSize"),u(this,"zoom"),u(this,"fitToScreen"),u(this,"pageViewMode"),u(this,"waitForLoading"),u(this,"renderAllPages"),u(this,"pref"),u(this,"pageSizes"),u(this,"pixelRatio"),u(this,"pixelRatioLimit"),u(this,"viewport"),u(this,"opfView");let r=t.ownerDocument,o=(s,a)=>{let h=r.getElementById(s);return h||(h=r.createElement("style"),h.id=s,a&&(h.textContent=a),r.head.appendChild(h)),h};o("vivliostyle-viewport-screen-css",Fh),o("vivliostyle-viewport-css",Ah),o("vivliostyle-polyfill-css",Mh),t.setAttribute("data-vivliostyle-viewer-viewport",!0),kn&&t.setAttribute("data-vivliostyle-debug",!0),t.setAttribute(Fl,"loading"),this.fontMapper=new Nw(r.head,t),this.init(),this.kick=()=>{},this.sendCommand=()=>{},this.resizeListener=()=>{this.needResize=!0,this.resized=!0,this.kick()},this.pageReplacedListener=this.pageReplacedListener.bind(this),this.hyperlinkListener=s=>{},this.pageRuleStyleElement=o("vivliostyle-page-rules"),this.actions={loadPublication:this.loadPublication,loadXML:this.loadXML,configure:this.configure,moveTo:this.moveTo,toc:this.showTOC},this.addLogListeners()}init(){this.readyState="loading",this.packageURL=[],this.opf=null,this.touchActive=!1,this.touchX=0,this.touchY=0,this.needResize=!1,this.resized=!1,this.needRefresh=!1,this.viewportSize=null,this.currentPage=null,this.currentSpread=null,this.pagePosition=null,this.fontSize=16,this.zoom=1,this.fitToScreen=!1,this.pageViewMode="singlePage",this.waitForLoading=!1,this.renderAllPages=!0,this.pref=Kl(),this.pageSizes=[],this.pixelRatioLimit=/Chrome/.test(navigator.userAgent)?16:0,this.pixelRatio=Math.min(8,this.pixelRatioLimit)}addLogListeners(){let e=Hl;U.addListener(e.DEBUG,t=>{this.callback({t:"debug",content:t})}),U.addListener(e.INFO,t=>{this.callback({t:"info",content:t})}),U.addListener(e.WARN,t=>{this.callback({t:"warn",content:t})}),U.addListener(e.ERROR,t=>{this.callback({t:"error",content:t})})}callback(e){e.i=this.instanceId,this.callbackFn(e)}setReadyState(e){this.readyState!==e&&(this.readyState=e,this.viewportElement.setAttribute(Fl,e),this.callback({t:"readystatechange"}))}loadPublication(e){st.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,i=e.fragment,n=e.authorStyleSheet,r=e.userStyleSheet;this.viewport=null;let o=_("loadPublication");return this.configure(e).then(()=>{let s=new Nl;s.init(n,r).then(()=>{let a=Te(Pn(t),this.window.location.href);this.packageURL=[a],s.loadPubDoc(a).then(h=>{h?(this.opf=h,this.render(i).then(()=>{o.finish(!0)})):o.finish(!1)})})}),o.result()}loadXML(e){st.registerStartTiming("beforeRender"),this.setReadyState("loading");let t=e.url,i=e.document,n=e.fragment,r=e.authorStyleSheet,o=e.userStyleSheet;this.viewport=null;let s=_("loadXML");return this.configure(e).then(()=>{let a=new Nl;a.init(r,o).then(()=>{let h=t.map((l,c)=>({url:Te(Pn(l.url),this.window.location.href),index:c,startPage:l.startPage,skipPagesBefore:l.skipPagesBefore}));this.packageURL=h.map(l=>l.url),this.opf=new br(a,""),this.opf.initWithChapters(h,i).then(()=>{this.render(n).then(()=>{s.finish(!0)})})})}),s.result()}render(e){this.cancelRenderingTask();let t;return e?t=this.opf.resolveFragment(e).thenAsync(i=>(this.pagePosition=i,P(!0))):t=P(!0),t.thenAsync(()=>(st.registerEndTiming("beforeRender"),this.resize()))}resolveLength(e){let t=parseFloat(e),i=/[a-z]+$/,n;if(typeof e=="string"&&(n=e.match(i))){let r=n[0];if(r==="em"||r==="rem")return t*this.fontSize;if(r==="ex")return t*xe.ex*this.fontSize/xe.em;let o=xe[r];if(o)return t*o}return t}configure(e){if(typeof e.autoresize=="boolean"&&(e.autoresize?(this.viewportSize=null,this.window.addEventListener("resize",this.resizeListener,!1),this.needResize=!0):this.window.removeEventListener("resize",this.resizeListener,!1)),typeof e.fontSize=="number"){let t=e.fontSize;t>=5&&t<=72&&this.fontSize!=t&&(this.fontSize=t,this.needResize=!0)}if(typeof e.viewport=="object"&&e.viewport){let t=e.viewport,i={marginLeft:this.resolveLength(t["margin-left"])||0,marginRight:this.resolveLength(t["margin-right"])||0,marginTop:this.resolveLength(t["margin-top"])||0,marginBottom:this.resolveLength(t["margin-bottom"])||0,width:this.resolveLength(t.width)||0,height:this.resolveLength(t.height)||0};(i.width>=200||i.height>=200)&&(this.window.removeEventListener("resize",this.resizeListener,!1),this.viewportSize=i,this.needResize=!0)}if(typeof e.hyphenate=="boolean"&&(this.pref.hyphenate=e.hyphenate,this.needResize=!0),typeof e.horizontal=="boolean"&&(this.pref.horizontal=e.horizontal,this.needResize=!0),typeof e.nightMode=="boolean"&&(this.pref.nightMode=e.nightMode,this.needResize=!0),typeof e.lineHeight=="number"&&(this.pref.lineHeight=e.lineHeight,this.needResize=!0),typeof e.columnWidth=="number"&&(this.pref.columnWidth=e.columnWidth,this.needResize=!0),typeof e.fontFamily=="string"&&(this.pref.fontFamily=e.fontFamily,this.needResize=!0),typeof e.load=="boolean"&&(this.waitForLoading=e.load),typeof e.renderAllPages=="boolean"&&(this.renderAllPages=e.renderAllPages),typeof e.userAgentRootURL=="string"&&(ua(e.userAgentRootURL.replace(/resources\/?$/,"")),ca(e.userAgentRootURL)),typeof e.rootURL=="string"&&(ua(e.rootURL),ca(`${Ui}resources/`)),typeof e.pageViewMode=="string"&&e.pageViewMode!==this.pageViewMode&&(this.pageViewMode=e.pageViewMode,this.needResize=!0),typeof e.pageBorder=="number"&&e.pageBorder!==this.pref.pageBorder&&(this.viewport=null,this.pref.pageBorder=e.pageBorder,this.needResize=!0),typeof e.zoom=="number"&&e.zoom!==this.zoom&&(this.zoom=e.zoom,this.needRefresh=!0),typeof e.fitToScreen=="boolean"&&e.fitToScreen!==this.fitToScreen&&(this.fitToScreen=e.fitToScreen,this.needRefresh=!0),typeof e.defaultPaperSize=="object"&&typeof e.defaultPaperSize.width=="number"&&typeof e.defaultPaperSize.height=="number"&&(this.viewport=null,this.pref.defaultPaperSize=e.defaultPaperSize,this.needResize=!0),typeof e.allowScripts=="boolean"&&e.allowScripts!==Tt&&(l0(e.allowScripts),this.needResize=!0),typeof e.pixelRatio=="number"){let t=Math.min(e.pixelRatio,this.pixelRatioLimit);t!==this.pixelRatio&&(this.pixelRatio=t,this.needResize=!0)}return this.configurePlugins(e),P(!0)}configurePlugins(e){xt("CONFIGURATION").forEach(t=>{let i=t(e);this.needResize=i.needResize||this.needResize,this.needRefresh=i.needRefresh||this.needRefresh})}pageReplacedListener(e){let t=this.currentPage,i=this.currentSpread,n=e.target;i?(i.left===n||i.right===n)&&this.showCurrent(e.newPage):t===e.target&&this.showCurrent(e.newPage)}forCurrentPages(e){let t=[];this.currentPage&&t.push(this.currentPage),this.currentSpread&&(t.push(this.currentSpread.left),t.push(this.currentSpread.right)),t.forEach(i=>{i&&e(i)})}removePageListeners(){this.forCurrentPages(e=>{e.removeEventListener("hyperlink",this.hyperlinkListener,!1),e.removeEventListener("replaced",this.pageReplacedListener,!1)})}hidePages(){this.removePageListeners(),this.forCurrentPages(e=>{T(e.container,"display","none")}),this.currentPage=null,this.currentSpread=null}showSinglePage(e){e.addEventListener("hyperlink",this.hyperlinkListener,!1),e.addEventListener("replaced",this.pageReplacedListener,!1),T(e.container,"visibility","visible"),T(e.container,"display","block")}showPage(e){this.hidePages(),this.currentPage=e,e.container.style.marginLeft="",e.container.style.marginRight="",this.showSinglePage(e)}showSpread(e){if(this.hidePages(),this.currentSpread=e,e.left&&e.right){let t=parseFloat(e.left.container.style.width),i=parseFloat(e.right.container.style.width);t&&i&&t!==i&&(t<i?e.left.container.style.marginLeft=`${i-t}px`:e.right.container.style.marginRight=`${t-i}px`)}e.left&&(this.showSinglePage(e.left),e.right?e.left.container.removeAttribute("data-vivliostyle-unpaired-page"):e.left.container.setAttribute("data-vivliostyle-unpaired-page",!0)),e.right&&(this.showSinglePage(e.right),e.left?e.right.container.removeAttribute("data-vivliostyle-unpaired-page"):e.right.container.setAttribute("data-vivliostyle-unpaired-page",!0))}reportPosition(){let e=_("reportPosition");return this.pagePosition,this.opf.getCFI(this.pagePosition.spineIndex,this.pagePosition.offsetInItem).then(t=>{let i=this.currentPage;(this.waitForLoading&&i.fetchers.length>0?zr(i.fetchers):P(!0)).then(()=>{this.sendLocationNotification(i,t).thenFinish(e)})}),e.result()}createViewport(){let e=this.viewportElement;if(this.viewportSize){let t=this.viewportSize;return e.style.marginLeft=`${t.marginLeft}px`,e.style.marginRight=`${t.marginRight}px`,e.style.marginTop=`${t.marginTop}px`,e.style.marginBottom=`${t.marginBottom}px`,new Rr(this.window,this.fontSize,this.pixelRatio,e,t.width,t.height)}else return new Rr(this.window,this.fontSize,this.pixelRatio,e)}resolveSpreadView(e,t){switch(this.pageViewMode){case"singlePage":return!1;case"spread":return!0;case"autoSpread":default:return(e.width-this.pref.pageBorder)/e.height>=(t?t.width*2/t.height:1.45)&&(!!t||e.width>800)}}updateSpreadView(e){this.pref.spreadView=e,this.viewportElement.setAttribute(D0,e.toString())}sizeIsGood(){var e;let t=this.createViewport(),i=((e=this.opfView)==null?void 0:e.hasPages())&&!this.opfView.hasAutoSizedPages(),n=this.resolveSpreadView(t,this.resized&&i?this.pageSizes[0]:null);this.resized=!1;let r=this.pref.spreadView!==n;return this.updateSpreadView(n),this.pixelRatio&&this.opfView&&this.pixelRatio/this.window.devicePixelRatio!==this.opfView.clientLayout.scaleRatio||this.viewportSize||!this.viewport||this.viewport.fontSize!=this.fontSize?!1:!r&&t.width==this.viewport.width&&t.height==this.viewport.height||!r&&t.width==this.viewport.width&&t.height!=this.viewport.height&&/Android|iPhone|iPad|iPod/.test(navigator.userAgent)?!0:i?(this.viewport.width=t.width,this.viewport.height=t.height,this.needRefresh=!0,!0):!1}setPageSize(e,t,i,n){this.pageSizes[n]=e,this.setPageSizePageRules(t,i,n),n===0&&this.pageViewMode==="autoSpread"&&!this.opfView.hasAutoSizedPages()&&this.updateSpreadView(this.resolveSpreadView(this.viewport,e))}setPageSizePageRules(e,t,i){var n,r;if(this.pageRuleStyleElement&&(!this.pageSheetSizeAlreadySet||this.pageSizes[i].width!==((n=this.pageSizes[i-1])==null?void 0:n.width)||this.pageSizes[i].height!==((r=this.pageSizes[i-1])==null?void 0:r.height))){let s=function(g){let m=g*.75;return Math.ceil(m)};var o=s;let a=Math.max(...this.pageSizes.map(g=>g.width)),h=Math.max(...this.pageSizes.map(g=>g.height)),l=s(a),c=s(h),p=l*((this.pixelRatio||1)-1)+2,d=c*((this.pixelRatio||1)-1)+2,f=`@page {size: ${l}pt ${c}pt; margin: 0 ${-p}pt ${-d}pt 0;}`;this.pageRuleStyleElement.textContent=f,this.pageSheetSizeAlreadySet=!0}}removePageSizePageRules(){this.pageRuleStyleElement&&(this.pageRuleStyleElement.textContent="",this.pageSheetSizeAlreadySet=!1)}reset(){let e=!1,t=!1;this.opfView&&(e=this.opfView.tocVisible,t=this.opfView.tocAutohide,this.opfView.removeRenderedPages()),this.pageSizes=[],this.removePageSizePageRules(),this.viewport=this.createViewport(),this.viewport.resetZoom(),this.opfView=new z0(this.opf,this.viewport,this.fontMapper,this.pref,this.setPageSize.bind(this)),e&&this.sendCommand({a:"toc",v:"show",autohide:t})}showCurrent(e,t){return this.needRefresh=!1,this.removePageListeners(),this.pref.spreadView?this.opfView.getSpread(this.pagePosition,t).thenAsync(i=>(!i.left&&!i.right||(this.showSpread(i),this.setSpreadZoom(i),this.currentPage=e.side==="left"?i.left:i.right),P(null))):(this.showPage(e),this.setPageZoom(e),this.currentPage=e,P(null))}setPageZoom(e){let t=this.getAdjustedZoomFactor(e.dimensions);this.viewport.zoom(e.dimensions.width,e.dimensions.height,t)}setSpreadZoom(e){let t=this.getSpreadDimensions(e);this.viewport.zoom(t.width,t.height,this.getAdjustedZoomFactor(t))}getAdjustedZoomFactor(e){return this.fitToScreen?this.calculateZoomFactorToFitInsideViewPort(e):this.zoom}getSpreadDimensions(e){let t=0,i=0;return e.left&&(t+=e.left.dimensions.width,i=e.left.dimensions.height),e.right&&(t+=e.right.dimensions.width,i=Math.max(i,e.right.dimensions.height)),e.left&&e.right&&(t+=this.pref.pageBorder*2,t+=Math.abs(e.left.dimensions.width-e.right.dimensions.width)),{width:t,height:i}}queryZoomFactor(e){if(!this.currentPage)throw new Error("no page exists.");switch(e){case"fit inside viewport":{let t;return this.pref.spreadView?(this.currentSpread,t=this.getSpreadDimensions(this.currentSpread)):t=this.currentPage.dimensions,this.calculateZoomFactorToFitInsideViewPort(t)}default:throw new Error(`unknown zoom type: ${e}`)}}calculateZoomFactorToFitInsideViewPort(e){if(!this.viewport)return this.zoom;let t=this.viewport.width/e.width,i=this.viewport.height/e.height;return Math.min(t,i)}cancelRenderingTask(){this.renderTask&&this.renderTask.interrupt(new Al),this.renderTask=null}resize(){if(this.needResize=!1,this.needRefresh=!1,this.sizeIsGood())return P(!0);this.setReadyState("loading"),this.cancelRenderingTask();let e=To().getScheduler().run(()=>$i("resize",t=>{if(!this.opf){t.finish(!1);return}this.renderTask=e,st.registerStartTiming("render (resize)"),this.reset(),this.pagePosition&&(this.pagePosition.pageIndex==0&&this.pagePosition.offsetInItem==0||(this.pagePosition.pageIndex=-1)),this.opf.setEPageCountMode(this.renderAllPages),this.opfView.renderPagesUpto(this.pagePosition,!this.renderAllPages).then(i=>{if(!i){t.finish(!1);return}this.pagePosition=i.position,this.showCurrent(i.page,!0).then(()=>{this.setReadyState("interactive"),this.opf.countEPages(n=>{let r={t:"nav",epageCount:n,first:this.currentPage.isFirstPage,last:this.currentPage.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[this.pagePosition.spineIndex].title};(this.currentPage.isFirstPage||this.pagePosition.pageIndex==0&&this.opf.spine[this.pagePosition.spineIndex].epage)&&(r.epage=this.opf.spine[this.pagePosition.spineIndex].epage),this.callback(r)}).then(()=>{this.reportPosition().then(n=>{(this.renderAllPages?this.opfView.renderAllPages():P(null)).then(()=>{this.renderTask===e&&(this.renderTask=null),st.registerEndTiming("render (resize)"),Tt&&Ac(this.window)?d0(this.window).then(()=>{this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(n)}):(this.renderAllPages&&this.setReadyState("complete"),this.callback({t:"loaded"}),t.finish(n))})})})})})},(t,i)=>{if(i instanceof Al)st.registerEndTiming("render (resize)"),U.debug(i.message);else throw i}));return P(!0)}sendLocationNotification(e,t){let i=_("sendLocationNotification"),n={t:"nav",first:e.isFirstPage,last:e.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[e.spineIndex].title};return this.opf.getEPageFromPosition(this.pagePosition).then(r=>{n.epage=r,n.epageCount=this.opf.epageCount,t&&(n.cfi=t),this.callback(n),i.finish(!0)}),i.result()}getCurrentPageProgression(){return this.opfView?this.opfView.getCurrentPageProgression(this.pagePosition):null}moveTo(e){var t;let i;if(this.readyState!=="complete"&&e.where!=="next"&&this.setReadyState("loading"),typeof e.where=="string"){let r;switch(e.where){case"next":r=this.pref.spreadView?this.opfView.nextSpread:this.opfView.nextPage;break;case"previous":r=this.pref.spreadView?this.opfView.previousSpread:this.opfView.previousPage;break;case"last":r=this.opfView.lastPage;break;case"first":r=this.opfView.firstPage;break;default:return P(!0)}r&&(i=()=>r.call(this.opfView,this.pagePosition,!this.renderAllPages))}else if(typeof e.epage=="number"){let r=e.epage;i=()=>this.opfView.navigateToEPage(r,this.pagePosition,!this.renderAllPages)}else if(typeof e.url=="string"){let r=e.url;i=()=>this.opfView.navigateTo(r,this.pagePosition,!this.renderAllPages)}else if(typeof((t=e.position)==null?void 0:t.spineIndex)=="number"){let r=e.position;i=()=>this.opfView.findPage(r,!this.renderAllPages)}else return P(!0);if(!this.opfView)return P(!0);let n=_("moveTo");return i.call(this.opfView).then(r=>{let o;if(r){this.pagePosition=r.position;let s=_("moveTo.showCurrent");o=s.result(),this.showCurrent(r.page,!this.renderAllPages).then(()=>{this.reportPosition().thenFinish(s)})}else o=P(!0);o.then(s=>{this.readyState==="loading"&&this.setReadyState("interactive"),n.finish(s)})}),n.result()}showTOC(e){let t=!!e.autohide,i=e.v,n=this.opfView.isTOCVisible(),r=t!=this.opfView.tocAutohide&&i!="hide";if(n){if(i=="show"&&!r)return P(!0)}else if(i=="hide")return P(!0);if(n&&i!="show")return this.opfView.hideTOC(),P(!0);{let o=_("showTOC");return this.opfView.showTOC(t).then(s=>{if(s){if(r&&(s.listeners={}),t){let a=()=>{this.opfView.hideTOC()};s.addEventListener("hyperlink",a,!1)}s.addEventListener("hyperlink",this.hyperlinkListener,!1)}o.finish(!0)}),o.result()}}runCommand(e){let t=e.a||"";return $i("runCommand",i=>{let n=this.actions[t];n?n.call(this,e).then(()=>{this.callback({t:"done",a:t}),i.finish(!0)}):(U.error("No such action:",t),i.finish(!0))},(i,n)=>{U.error(n,"Error during action:",t),i.finish(!0)})}initEmbed(e){let t=Rl(e),i=null,n=this;Zp(()=>{let r=_("commandLoop"),o=To().getScheduler();return n.hyperlinkListener=s=>{let a=s,h=a.href.charAt(0)==="#"||n.packageURL.some(l=>a.href.substr(0,l.length)==l);if(h){s.preventDefault();let l={t:"hyperlink",href:a.href,internal:h};o.run(()=>(n.callback(l),P(!0)))}},r.loopWithFrame(s=>{if(n.needResize)n.resize().then(()=>{s.continueLoop()});else if(n.needRefresh)n.currentPage&&n.showCurrent(n.currentPage,!this.renderAllPages).then(()=>{s.continueLoop()});else if(t){let a=t;t=null,n.runCommand(a).then(()=>{s.continueLoop()})}else{let a=_("waitForCommand");i=a.suspend(this),a.result().then(()=>{s.continueLoop()})}}).thenFinish(r),r.result()}),n.kick=()=>{let r=i;r&&(i=null,r.schedule(!0))},n.sendCommand=r=>t?!1:(t=Rl(r),n.kick(),!0),this.window.adapt_command=n.sendCommand}},Dc=(e=>(e.FIT_INSIDE_VIEWPORT="fit inside viewport",e))(Dc||{}),Al=class Vc extends Error{constructor(){super(),u(this,"name","RenderingCanceledError"),u(this,"message","Page rendering has been canceled"),u(this,"stack"),Object.setPrototypeOf(this,Vc.prototype),this.stack=new Error().stack}};function Rl(e){return typeof e=="string"?us(e):e}var Ll=hs;function H0(){return{autoResize:!0,fontSize:16,pageBorderWidth:1,renderAllPages:!0,pageViewMode:"autoSpread",zoom:1,fitToScreen:!1,defaultPaperSize:void 0,allowScripts:!0,pixelRatio:8}}function Ol(e){let t={};return Object.keys(e).forEach(i=>{let n=e[i];switch(i){case"autoResize":t.autoresize=n;break;case"pageBorderWidth":t.pageBorder=n;break;default:t[i]=n}}),t}var Hc=class{constructor(e,t){this.settings=e,u(this,"initialized",!1),u(this,"adaptViewer_"),u(this,"options"),u(this,"eventTarget"),u(this,"readyState"),Ml(e.debug),this.adaptViewer_=new V0(e.window||window,e.viewportElement,"main",this.dispatcher.bind(this)),this.options=H0(),t&&this.setOptions(t),this.eventTarget=new cs,Object.defineProperty(this,"readyState",{get(){return this.adaptViewer_.readyState}})}setOptions(e){let t=Object.assign({a:"configure"},Ol(e));this.adaptViewer_.sendCommand(t),Object.assign(this.options,e)}dispatcher(e){let t={type:e.t},i=e;Object.keys(i).forEach(n=>{n!=="t"&&(t[n]=i[n])}),this.eventTarget.dispatchEvent(t)}addListener(e,t){this.eventTarget.addEventListener(e,t,!1)}removeListener(e,t){this.eventTarget.removeEventListener(e,t,!1)}loadDocument(e,t,i){if(!e||(Array.isArray(e)?!e[0]||typeof e[0]!="string"&&!e[0].url:typeof e!="string"&&!e.url)){this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}});return}this.loadDocumentOrPublication(e,null,t,i)}loadPublication(e,t,i){if(!e){this.eventTarget.dispatchEvent({type:"error",content:{error:new Error("No URL specified")}});return}this.loadDocumentOrPublication(null,e,t,i)}loadDocumentOrPublication(e,t,i,n){let r=i||{};function o(l){if(l)return l.map(c=>({url:c.url||null,text:c.text||null}))}let s=o(r.authorStyleSheet),a=o(r.userStyleSheet);n&&Object.assign(this.options,n);let h=Object.assign({a:e?"loadXML":"loadPublication",userAgentRootURL:this.settings.userAgentRootURL,url:U0(e)||t,document:r.documentObject,fragment:r.fragment,authorStyleSheet:s,userStyleSheet:a},Ol(this.options));this.initialized?this.adaptViewer_.sendCommand(h):(this.initialized=!0,this.adaptViewer_.initEmbed(h))}getCurrentPageProgression(){return this.adaptViewer_.getCurrentPageProgression()}resolveNavigation(e){switch(e){case"left":return this.getCurrentPageProgression()===Ll.LTR?"previous":"next";case"right":return this.getCurrentPageProgression()===Ll.LTR?"next":"previous";default:return e}}navigateToPage(e,t){e==="epage"?this.adaptViewer_.sendCommand({a:"moveTo",epage:t}):this.adaptViewer_.sendCommand({a:"moveTo",where:this.resolveNavigation(e)})}navigateToInternalUrl(e){this.adaptViewer_.sendCommand({a:"moveTo",url:e})}navigateToPosition(e){var t,i;this.adaptViewer_.sendCommand({a:"moveTo",position:{spineIndex:e.spineIndex,pageIndex:(t=e.pageIndex)!=null?t:-1,offsetInItem:(i=e.offsetInItem)!=null?i:-1}})}isTOCVisible(){return this.adaptViewer_.opfView&&this.adaptViewer_.opfView.opf&&this.adaptViewer_.opfView.opf.toc?!!this.adaptViewer_.opfView.isTOCVisible():null}showTOC(e,t){let i=e==null?"toggle":e?"show":"hide";this.adaptViewer_.sendCommand({a:"toc",v:i,autohide:t})}queryZoomFactor(e){return this.adaptViewer_.queryZoomFactor(e)}getPageSizes(){return this.adaptViewer_.pageSizes}getTOC(){var e,t;return(t=(e=this.adaptViewer_.opfView)==null?void 0:e.tocView)==null?void 0:t.getTOC()}getMetadata(){return this.adaptViewer_.opf.getMetadata()}getCover(){return this.adaptViewer_.opf.cover}};function U0(e){function t(n){return typeof n=="number"?n:null}function i(n){return typeof n=="string"?{url:n,startPage:null,skipPagesBefore:null}:{url:n.url,startPage:t(n.startPage),skipPagesBefore:t(n.skipPagesBefore)}}return Array.isArray(e)?e.map(i):e?[i(e)]:null}var Uc=(e=>(e.PREVIOUS="previous",e.NEXT="next",e.LEFT="left",e.RIGHT="right",e.FIRST="first",e.LAST="last",e.EPAGE="epage",e))(Uc||{}),$0=Dc,W0=zc;st.forceRegisterEndTiming("load_vivliostyle");var G0=class{constructor(e,{title:t="",printCallback:i=s=>s.print(),errorCallback:n=null,hideIframe:r=!0,removeIframe:o=!0}){u(this,"htmlDoc"),u(this,"title"),u(this,"printCallback"),u(this,"errorCallback"),u(this,"hideIframe"),u(this,"removeIframe"),u(this,"iframe"),u(this,"iframeWin"),u(this,"window"),this.htmlDoc=e,this.title=t,this.printCallback=i,this.errorCallback=n,this.hideIframe=r,this.removeIframe=o}init(){this.iframe=document.createElement("iframe"),this.hideIframe&&(this.iframe.style.width="0",this.iframe.style.height="0",this.iframe.style.borderWidth="0"),this.window=window,this.window.printInstance=this,this.iframe.srcdoc=`
      <!DOCTYPE html>
      <html data-vivliostyle-paginated="true">
        <head>
          <meta charset='utf-8'/>
          <meta name='viewport' content='width=device-width, initial-scale=1.0'/>
          <title>${this.title}</title>
          <style>
            html[data-vivliostyle-paginated] {
              width: 100%;
              height: 100%;
            }
            html[data-vivliostyle-paginated] body,
            html[data-vivliostyle-paginated] [data-vivliostyle-viewer-viewport] {
              width: 100% !important;
              height: 100% !important;
            }
            html[data-vivliostyle-paginated],
            html[data-vivliostyle-paginated] body {
              margin: 0;
              padding: 0;
            }
          </style>
          <style id='vivliostyle-page-rules'></style>
        </head>
        <body onload='parent.printInstance.runInIframe(window)'>
          <div id="vivliostyle-viewer-viewport"></div>
        </body>
      </html>`,document.body.appendChild(this.iframe)}runInIframe(e){return this.iframeWin=e,this.preparePrint().then(()=>this.browserPrint()).then(()=>this.cleanUp())}preparePrint(){this.iframeWin.document.title=this.title;let e=new Blob([this.htmlDoc],{type:"text/html"}),t=URL.createObjectURL(e),i=new Hc({viewportElement:this.iframeWin.document.body.firstElementChild,window:this.iframeWin,debug:!0});return new Promise(n=>{i.addListener("readystatechange",()=>{i.readyState==="complete"&&n()}),this.errorCallback&&i.addListener("error",r=>{var o,s;let a=(s=(o=r.content.error)==null?void 0:o.toString())!=null?s:r.content.messages.join(`
`);this.errorCallback(a)}),i.loadDocument({url:t})})}browserPrint(){this.printCallback(this.iframeWin)}cleanUp(){delete this.window.printInstance,this.removeIframe&&this.iframe.parentElement.removeChild(this.iframe)}};function j0(e,t){new G0(e,t).init()}});var Ci=(()=>{class e{constructor(i){this.elementRef=i,this.identifierStr="",this.customStyle=""}static{this.\u0275fac=function(n){return new(n||e)(ni(tn))}}static{this.\u0275dir=jn({type:e,selectors:[["","nzxPrintContent",""]],inputs:{identifierStr:"identifierStr",customStyle:"customStyle"}})}}return e})();var ld=["iframeContainer"],hd=[[["","nzxPrintHeader",""]]],ud=["[nzxPrintHeader]"],la=(()=>{class e{constructor(i,n){this.platform=i,this.document=n,this.printTitle="pdf",this.width=814,this.height=1143,this.enablePreview=!0,this.identifierStr="",this.pagedCDN="",this._title=this.document.title,this.afterPrint=()=>{this.iframeEl.contentWindow.parent.document.title=this._title},this.beforePrint=()=>{this.iframeEl.contentWindow.parent.document.title=this.printTitle}}ngOnInit(){if(!this.pagedCDN)throw new Error("pagedCDN is required")}ngAfterViewInit(){this.render()}print(){this.iframeEl.contentWindow&&(this.iframeEl.contentWindow.focus(),this.iframeEl.contentWindow.print())}refresh(){setTimeout(()=>{this.render()},100)}render(){this.iframeEl=this.document.createElement("iframe"),this.iframeEl.height=this.height+"",this.iframeEl.width=this.width+"",this.iframeEl.style.border="1px solid #ccc",this.iframeEl.style.background="#fff",this.enablePreview||(this.iframeEl.style.visibility="hidden",this.platform.FIREFOX?this.iframeEl.setAttribute("style","width: 1px; height: 100px; position: fixed; left: 0; top: 0; opacity: 0; border-width: 0; margin: 0; padding: 0"):this.iframeEl.setAttribute("style","visibility: hidden; height: 0; width: 0; position: absolute; border: 0")),this.containerRef&&(this.containerRef.nativeElement.innerHTML="",this.containerRef.nativeElement.appendChild(this.iframeEl)),this.iframeEl.contentWindow&&(this.iframeEl.contentWindow.document.open(),this.iframeEl.contentWindow.document.write(this.getTemplateStr()),this.iframeEl.contentWindow.document.close(),this.iframeEl.contentWindow.onbeforeprint=this.beforePrint,this.iframeEl.contentWindow.onafterprint=this.afterPrint)}getTemplateStr(){let i=Si("style",this.identifierStr),n=`
        <script src="${this.pagedCDN}"><\/script>
        <script>
          class RepeatingTableHeaders extends Paged.Handler {
            constructor(chunker, polisher, caller) {
              super(chunker, polisher, caller);
            }

            afterPageLayout(pageElement, page, breakToken, chunker) {
              let tables = pageElement.querySelectorAll('table[data-split-from]');
              tables.forEach((table) => {
                let ref = table.dataset.ref;
                let sourceTable = chunker.source.querySelector(
                  "[data-ref='" + ref + "']"
                );
                let header = sourceTable.querySelector('thead');
                if (header) {
                  let clonedHeader = header.cloneNode(true);
                  table.insertBefore(clonedHeader, table.firstChild);
                }
              });
            }
          }
          Paged.registerHandlers(RepeatingTableHeaders);
        <\/script>
      `,r=`
        <!DOCTYPE html>
        <html>
          <head>
          <meta charset="utf-8" />
          <title>${this.printTitle}</title>
          <base href="/" />
          <meta name="viewport" content="width=device-width, initial-scale=1" />
          <link
            rel="preconnect"
            href="https://winkong-frontend.oss-cn-qingdao.aliyuncs.com"
          />
          <style>
              ::-webkit-scrollbar {
                width: 5px;
                height: 5px;
              }
              ::-webkit-scrollbar-thumb {
                background-color: #999;
                -webkit-border-radius: 5px;
                border-radius: 5px;
              }
              ::-webkit-scrollbar-thumb:vertical:hover {
                background-color: #666;
              }
              ::-webkit-scrollbar-thumb:vertical:active {
                background-color: #666;
              }
              ::-webkit-scrollbar-button {
                display: none;
              }
              ::-webkit-scrollbar-track {
                background-color: #f1f1f1;
              }
          </style>

            ${i}
            ${n}
          </head>
          <body>
            ${this._printEl.nativeElement.outerHTML}
          </body>
        </html>
      `;return r=r.replace(/<!---->/g," "),r}static{this.\u0275fac=function(n){return new(n||e)(ni(ea),ni(Js))}}static{this.\u0275cmp=Et({type:e,selectors:[["nzx-print"]],contentQueries:function(n,r,o){if(n&1&&Kn(o,Ci,7,tn),n&2){let s;bi(s=vi())&&(r._printEl=s.first)}},viewQuery:function(n,r){if(n&1&&Zn(ld,7,tn),n&2){let o;bi(o=vi())&&(r.containerRef=o.first)}},inputs:{printTitle:"printTitle",width:"width",height:"height",enablePreview:"enablePreview",identifierStr:"identifierStr",pagedCDN:"pagedCDN"},ngContentSelectors:ud,decls:3,vars:0,consts:[["iframeContainer",""]],template:function(n,r){n&1&&(qn(hd),Yn(0),he(1,"div",null,0))},encapsulation:2})}}return e})();var en=sd(Wc());var q0=["vivView"],Y0=[[["","nzxPrintHeader",""]]],K0=["[nzxPrintHeader]"],Z0=()=>({margin:"10px 0"});function Q0(e,t){if(e&1&&k(0),e&2){let i=t.$implicit;Ut("\u5171 ",i," \u9875")}}var jc=(()=>{class e{constructor(i){this.cd=i,this.printTitle="pdf",this.width=814,this.height=1143,this.enablePreview=!0,this.pixelRatio=8,this.pageRenderComplete=new Ks,this.pageTotal=0,this._title=document.title,this._isRenderComplete=!1,this.handleError=n=>{console.log("error::",n)},this.handleReadyStateChange=n=>{if(this._isRenderComplete=!1,this.pageRenderComplete.emit(!1),this.viewer&&this.viewer.readyState==="complete"){let r=setInterval(()=>{if(this.iframeEl&&this.iframeEl.contentWindow&&this.iframeEl.contentWindow.document){let o=this.iframeEl.contentWindow.document.getElementsByTagName("img"),s=!0;for(let a=0;a<o.length;a++)if(!o[a].complete){s=!1;break}s&&(console.log("All images in iframe loaded successfully"),this.pageRenderComplete.emit(!0),this._isRenderComplete=!0,clearInterval(r))}},1e3)}},this.handleHyperlink=n=>{console.log("handleHyperlink::",n)},this.handleLoaded=n=>{console.log("handleLoaded::",n)},this.handleNavigation=n=>{this.pageTotal=n.epageCount,this.cd.markForCheck()}}ngAfterViewInit(){setTimeout(()=>{this.createIframeWrapper()},1e3)}ngOnDestroy(){this.viewer&&this.clearView()}onPageIndexChange(i){this.viewer&&this.viewer.navigateToPage(en.Navigation.EPAGE,i-1)}print(){this._isRenderComplete?this.iframeEl.contentWindow.print():console.warn("rending...")}refresh(){setTimeout(()=>{this.createIframeWrapper()},100)}createIframeWrapper(){if(this.vivViewRef){this.clearView(),this.iframeEl=document.createElement("iframe"),this.iframeEl.height=this.height+"",this.iframeEl.width=this.width+"",this.iframeEl.style.border="1px solid #ccc",this.iframeEl.style.background="#fff";let i=`
        <!DOCTYPE html>
        <html data-vivliostyle-paginated="true">
          <head>
            <meta charset="utf-8" />
            <meta name="viewport" content="width=device-width, initial-scale=1.0" />
            <base href="/" />
            <title>${this.printTitle}</title>
            <style>
              html[data-vivliostyle-paginated] {
                width: 100%;
                height: 100%;
              }
              html[data-vivliostyle-paginated] body,
              html[data-vivliostyle-paginated] [data-vivliostyle-viewer-viewport] {
                width: 100% !important;
                height: 100% !important;
                background: #fff;
              }
              html[data-vivliostyle-paginated],
              html[data-vivliostyle-paginated] body {
                margin: 0;
                padding: 0;
              }
            </style>
            <style id="vivliostyle-page-rules"></style>
          </head>
          <body>
            <div id="vivliostyle-viewer-viewport"></div>
          </body>
        </html>
      `;this.iframeEl.srcdoc=i,this.vivViewRef.nativeElement.appendChild(this.iframeEl),this.iframeEl.contentWindow.onbeforeprint=()=>{this.iframeEl.contentWindow.parent.document.title=this.printTitle},this.iframeEl.contentWindow.onafterprint=()=>{this.iframeEl.contentWindow.parent.document.title=this._title},this.createVivViewer()}}createVivViewer(){this.iframeEl.onload=()=>{let i=this._printElQueryList.toArray(),n=this.getVivTemplates(i),r=[];n.forEach(o=>{let s=new Blob([o],{type:"text/html"}),a=URL.createObjectURL(s);r.push({url:a})}),this.viewer=new en.CoreViewer({viewportElement:this.iframeEl.contentWindow?.document.body.firstElementChild},{pageViewMode:en.PageViewMode.SINGLE_PAGE,pixelRatio:this.pixelRatio}),this.viewer.loadDocument(r),this.createListener(this.viewer)}}createListener(i){i.addListener("error",this.handleError),i.addListener("readystatechange",this.handleReadyStateChange),i.addListener("loaded",this.handleLoaded),i.addListener("hyperlink",this.handleHyperlink),i.addListener("nav",this.handleNavigation)}removeListeners(i){i.removeListener("error",this.handleError),i.removeListener("readystatechange",this.handleReadyStateChange),i.removeListener("loaded",this.handleLoaded),i.removeListener("hyperlink",this.handleHyperlink),i.removeListener("nav",this.handleNavigation)}getStyles(i){let n=[],r=document.getElementsByTagName("style"),o=r.length,s=[];Array.isArray(i)?s=[...i]:s=[i];for(let a=0;a<o;a++)s.forEach(h=>{if(r[a].outerHTML.includes(h)){let l=r[a].outerHTML.replace(/\/\*[\s\S]*?\*\//g,"");n.push(l)}});return n.join(`\r
`)}getVivTemplates(i){let n=[];return i.forEach(r=>{let o="";(r.identifierStr||r.identifierStr.length>0)&&(o=this.getStyles(r.identifierStr));let s=`
          <!DOCTYPE html>
          <html>
            <head>
            <meta charset="utf-8" />
            <title>${this.printTitle}</title>
            <base href="/" />
            <meta name="viewport" content="width=device-width, initial-scale=1" />
             ${r.customStyle}
             ${o}
            </head>
            <body>
              ${r.elementRef.nativeElement.outerHTML}
            </body>
          </html>
        `;s=s.replace(/<!---->/g," "),n.push(s)}),n}clearView(){this.viewer&&this.removeListeners(this.viewer),this.vivViewRef.nativeElement.innerHTML="",this.viewer=void 0,this._isRenderComplete=!1}static{this.\u0275fac=function(n){return new(n||e)(ni(Qs))}}static{this.\u0275cmp=Et({type:e,selectors:[["nzx-print-v"]],contentQueries:function(n,r,o){if(n&1&&Kn(o,Ci,4),n&2){let s;bi(s=vi())&&(r._printElQueryList=s)}},viewQuery:function(n,r){if(n&1&&Zn(q0,5),n&2){let o;bi(o=vi())&&(r.vivViewRef=o.first)}},inputs:{printTitle:"printTitle",width:"width",height:"height",enablePreview:"enablePreview",pixelRatio:"pixelRatio"},outputs:{pageRenderComplete:"pageRenderComplete"},ngContentSelectors:K0,decls:7,vars:7,consts:[["vivView",""],["totalTemplate",""],[3,"ngStyle"],["nz-row","","nzJustify","end"],["nzShowQuickJumper","",3,"nzPageIndexChange","nzPageIndex","nzTotal","nzPageSize","nzSize","nzShowTotal"]],template:function(n,r){if(n&1){let o=Xn();qn(Y0),Yn(0),he(1,"div",2,0),N(3,"div",3),Vt(4,Q0,1,1,"ng-template",null,1,Zs),N(6,"nz-pagination",4),It("nzPageIndexChange",function(a){return ti(o),ii(r.onPageIndexChange(a))}),F()()}if(n&2){let o=Ht(5);Ae(),qe("ngStyle",ct(6,Z0)),Ae(5),qe("nzPageIndex",1)("nzTotal",r.pageTotal)("nzPageSize",1)("nzSize","small")("nzShowTotal",o)}},dependencies:[yi,Jn,sa],encapsulation:2})}}return e})();var Xc=(()=>{class e{constructor(){this.printTitle="pdf",this.identifierStr=""}ngOnInit(){if(!this.printEl)throw new Error('The "printEl" input is required for the nzxPrint directive.')}ngAfterViewInit(){this.getElement()}print(){let i=window.open("","_blank");if(i){let n=Si("style",this.identifierStr),r=Si("link"),o=Si("base"),a=`
      <!DOCTYPE html>
        <html>
          <head>
            <title>${this.printTitle}</title>
            ${o}
            ${r}
            ${n}
            
      <script>
        window.onload = function () {
          window.print();
        };
        window.onafterprint = function () {
          window.close();
        };
      <\/script>
      
          </head>
          <body>
            ${this._printEl.outerHTML}
          </body>
        </html>
      `;a=a.replace(/<!---->/g," "),i.document.open(),i.document.write(a),i.document.close()}}getElement(){if(typeof this.printEl=="string"){let i=document.querySelector(this.printEl);if(i)this._printEl=i;else throw new Error("printEl is not find")}else if(this.printEl instanceof HTMLElement)this._printEl=this.printEl;else throw new Error("printEl is invalid")}static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275dir=jn({type:e,selectors:[["button","nzxPrint",""]],hostBindings:function(n,r){n&1&&It("click",function(){return r.print()})},inputs:{printEl:"printEl",printTitle:"printTitle",identifierStr:"identifierStr"}})}}return e})();var qc=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=Gn({type:e})}static{this.\u0275inj=Wn({imports:[kt,er,aa]})}}return e})();var Yc=()=>[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Kc=()=>({"text-align":"center"});function tb(e,t){if(e&1&&(N(0,"tr")(1,"td"),k(2),F(),N(3,"td"),k(4,"\u7B26\u5408\u4EBA\u7C7B\u5BA1\u7F8E"),F(),N(5,"td",14),k(6,"\u597D"),F()()),e&2){let i=t.index;Ae(2),Ut("",i+1," \u989C\u8272"),Ae(3),qe("ngStyle",ct(2,Kc))}}function ib(e,t){if(e&1&&(N(0,"tr")(1,"td"),k(2),F(),N(3,"td"),k(4,"\u7B26\u5408\u4EBA\u7C7B\u5BA1\u7F8E"),F(),N(5,"td",14),k(6,"\u597D"),F()()),e&2){let i=t.index;Ae(2),Ut("",i+1," \u989C\u8272"),Ae(3),qe("ngStyle",ct(2,Kc))}}var Zc=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=Et({type:e,selectors:[["nzx-good-evaluate-pdf"]],standalone:!0,features:[xi],decls:166,vars:4,consts:[[1,"mate-pro"],[1,"common-header","mate-pro-header"],["src","https://consumer.huawei.com/content/dam/huawei-cbg-site/cn/mkt/pdp/phones/mate60-pro/img/list-img/green.png"],[1,"common-title"],[1,"common-footer","mate-pro-footer"],[1,"common-description"],[1,"common-evaluation"],[4,"ngFor","ngForOf"],["colSpan","2"],[1,"common-date"],[1,"date"],[1,"mate"],[1,"common-header","mate-header"],[1,"common-footer","mate-footer"],[3,"ngStyle"]],template:function(n,r){n&1&&(N(0,"section",0)(1,"header",1),he(2,"img",2),N(3,"span",3),k(4,"HUAWEI Mate 60 Pro\u8BC4\u4EF7\u8868\uFF08\u7B2C\u4E00\u4EFD\uFF09"),F()(),N(5,"footer",4),k(6," \u9875\u811A mate 60 pro\uFF08\u7B2C\u4E00\u4EFD\uFF09 "),F(),N(7,"table",5)(8,"tbody")(9,"tr")(10,"td"),k(11,"\u5546\u54C1\u540D\u79F0"),F(),N(12,"td"),k(13,"HUAWEI Mate 60 Pro"),F(),N(14,"td"),k(15,"\u5C3A\u5BF8"),F(),N(16,"td"),k(17,"163.65mm x 79mm x 8.1mm"),F()(),N(18,"tr")(19,"td"),k(20,"\u91CD\u91CF"),F(),N(21,"td"),k(22,"\u7EA6 225 g\uFF08\u542B\u7535\u6C60\uFF09"),F(),N(23,"td"),k(24,"\u5C4F\u5E55\u5C3A\u5BF8"),F(),N(25,"td"),k(26,"6.82 \u82F1\u5BF8"),F()(),N(27,"tr")(28,"td"),k(29,"\u8272\u5F69"),F(),N(30,"td"),k(31,"10.7 \u4EBF\u8272\uFF0CP3 \u5E7F\u8272\u57DF"),F(),N(32,"td"),k(33,"\u7C7B\u578B"),F(),N(34,"td"),k(35,"OLED"),F()(),N(36,"tr")(37,"td"),k(38,"\u5206\u8FA8\u7387"),F(),N(39,"td"),k(40,"FHD+ 2720 \xD7 1260 \u50CF\u7D20"),F(),N(41,"td"),k(42,"\u73BB\u7483\u7C7B\u578B"),F(),N(43,"td"),k(44,"\u7B2C\u4E8C\u4EE3\u6606\u4ED1\u73BB\u7483"),F()(),N(45,"tr")(46,"td"),k(47,"\u64CD\u4F5C\u7CFB\u7EDF"),F(),N(48,"td"),k(49,"\u9E3F\u8499\u64CD\u4F5C\u7CFB\u7EDF 4.0"),F(),N(50,"td"),k(51,"\u8FD0\u884C\u5185\u5B58"),F(),N(52,"td"),k(53,"12 GB RAM"),F()()()(),N(54,"table",6)(55,"thead")(56,"tr")(57,"th"),k(58," Investigation Content "),he(59,"br"),k(60," \u8C03\u67E5\u5185\u5BB9 "),F(),N(61,"th"),k(62,"Standard for Evaluation "),he(63,"br"),k(64,"\u8BC4\u4F30\u6807\u51C6"),F(),N(65,"th"),k(66,"Evaluation "),he(67,"br"),k(68,"\u8BC4\u5B9A"),F()()(),N(69,"tbody"),Vt(70,tb,7,3,"tr",7),N(71,"tr")(72,"td"),k(73,"Your valued suggestion "),he(74,"br"),k(75,"\u60A8\u7684\u5EFA\u8BAE"),F(),N(76,"td",8),k(77,"\u5EFA\u8BAE\u8D2D\u4E70"),F()()()(),N(78,"div",9)(79,"span"),k(80," Date "),F(),N(81,"div",10),k(82,"2024-01-01"),F()()(),N(83,"section",11)(84,"header",12),he(85,"img",2),N(86,"span",3),k(87,"HUAWEI Mate 60 \u8BC4\u4EF7\u8868\uFF08\u7B2C\u4E8C\u4EFD\uFF09"),F()(),N(88,"footer",13),k(89,"\u9875\u811A mate 60\uFF08\u7B2C\u4E8C\u4EFD\uFF09"),F(),N(90,"table",5)(91,"tbody")(92,"tr")(93,"td"),k(94,"\u5546\u54C1\u540D\u79F0"),F(),N(95,"td"),k(96,"HUAWEI Mate 60"),F(),N(97,"td"),k(98,"\u5C3A\u5BF8"),F(),N(99,"td"),k(100,"163.65mm x 79mm x 8.1mm"),F()(),N(101,"tr")(102,"td"),k(103,"\u91CD\u91CF"),F(),N(104,"td"),k(105,"\u7EA6 225 g\uFF08\u542B\u7535\u6C60\uFF09"),F(),N(106,"td"),k(107,"\u5C4F\u5E55\u5C3A\u5BF8"),F(),N(108,"td"),k(109,"6.82 \u82F1\u5BF8"),F()(),N(110,"tr")(111,"td"),k(112,"\u8272\u5F69"),F(),N(113,"td"),k(114,"10.7 \u4EBF\u8272\uFF0CP3 \u5E7F\u8272\u57DF"),F(),N(115,"td"),k(116,"\u7C7B\u578B"),F(),N(117,"td"),k(118,"OLED"),F()(),N(119,"tr")(120,"td"),k(121,"\u5206\u8FA8\u7387"),F(),N(122,"td"),k(123,"FHD+ 2720 \xD7 1260 \u50CF\u7D20"),F(),N(124,"td"),k(125,"\u73BB\u7483\u7C7B\u578B"),F(),N(126,"td"),k(127,"\u7B2C\u4E8C\u4EE3\u6606\u4ED1\u73BB\u7483"),F()(),N(128,"tr")(129,"td"),k(130,"\u64CD\u4F5C\u7CFB\u7EDF"),F(),N(131,"td"),k(132,"\u9E3F\u8499\u64CD\u4F5C\u7CFB\u7EDF 4.0"),F(),N(133,"td"),k(134,"\u8FD0\u884C\u5185\u5B58"),F(),N(135,"td"),k(136,"12 GB RAM"),F()()()(),N(137,"table",6)(138,"thead")(139,"tr")(140,"th"),k(141," Investigation Content "),he(142,"br"),k(143," \u8C03\u67E5\u5185\u5BB9 "),F(),N(144,"th"),k(145,"Standard for Evaluation "),he(146,"br"),k(147,"\u8BC4\u4F30\u6807\u51C6"),F(),N(148,"th"),k(149,"Evaluation "),he(150,"br"),k(151,"\u8BC4\u5B9A"),F()()(),N(152,"tbody"),Vt(153,ib,7,3,"tr",7),N(154,"tr")(155,"td"),k(156,"Your valued suggestion "),he(157,"br"),k(158,"\u60A8\u7684\u5EFA\u8BAE"),F(),N(159,"td",8),k(160,"\u5EFA\u8BAE\u8D2D\u4E70"),F()()()(),N(161,"div",9)(162,"span"),k(163," Date "),F(),N(164,"div",10),k(165,"2024-01-01"),F()()()),n&2&&(Ae(70),qe("ngForOf",ct(2,Yc)),Ae(83),qe("ngForOf",ct(3,Yc)))},dependencies:[kt,Qn,yi],styles:['.common-footer[_ngcontent-%COMP%]{text-transform:uppercasse;font-size:12px}.common-guide[_ngcontent-%COMP%]{white-space:pre-wrap;font-size:14px;font-family:Source Han Sans SC,Source Han Sans SC;font-weight:400;color:#333}.common-header[_ngcontent-%COMP%]{height:100px;text-align:start;position:relative}.common-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:110px;height:100px}.common-header[_ngcontent-%COMP%]   .common-title[_ngcontent-%COMP%]{position:absolute;left:295px;top:38px;font-size:16px;font-weight:500;color:#000;line-height:19px}.common-description[_ngcontent-%COMP%]{margin-top:6px;width:100%;border-collapse:collapse}.common-description[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .common-description[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;font-family:Source Han Sans SC,Source Han Sans SC;font-weight:400;color:#000;padding:1em;border:1px solid #dcdcdc}.common-description[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(odd){width:120px;background:#ebedf1}.common-description[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2n){width:249px}.common-evaluation[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.common-evaluation[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .common-evaluation[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;font-family:Source Han Sans SC,Source Han Sans SC;font-weight:400;color:#000;border:1px solid #dcdcdc;padding:1em}.common-evaluation[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#ebedf1}.common-evaluation[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center}.common-evaluation[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(1){width:190px}.common-evaluation[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3){width:131px}.common-date[_ngcontent-%COMP%]{margin-top:50px;display:flex;justify-content:flex-end;font-size:12px;font-family:Source Han Sans SC,Source Han Sans SC;color:#000;line-height:16px}.common-date[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500}.common-date[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{text-align:center;margin-left:8px;height:24px;width:122px;border-bottom:1px solid #000000;font-weight:400}@page{size:A4 portrait;margin:130px 30px 30px}.mate-pro[_ngcontent-%COMP%]{page:mate-pro}.mate-pro-header[_ngcontent-%COMP%]{position:running(mateproHeaderRunning)}.mate-pro-footer[_ngcontent-%COMP%]{position:running(mateproFooterRunning)}@page mate-pro{@top-center{content:element(mateproHeaderRunning)}@bottom-center{content:element(mateproFooterRunning)}@bottom-left{content:"\\7b2c" counter(page) "\\9875\\ff0c\\5171" counter(pages) "\\9875";font-size:12px}}.mate[_ngcontent-%COMP%]{page:mate}.mate-header[_ngcontent-%COMP%]{position:running(mateHeaderRunning)}.mate-footer[_ngcontent-%COMP%]{position:running(mateFooterRunning)}@page mate{@top-center{content:element(mateHeaderRunning)}@bottom-center{content:element(mateFooterRunning)}@bottom-left{content:"\\7b2c" counter(page) "\\9875\\ff0c\\5171" counter(pages) "\\9875";font-size:12px}}']})}}return e})();var Qc=()=>[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],Jc=()=>({"text-align":"center"});function nb(e,t){if(e&1&&(N(0,"tr")(1,"td"),k(2),F(),N(3,"td"),k(4,"\u7B26\u5408\u4EBA\u7C7B\u5BA1\u7F8E"),F(),N(5,"td",14),k(6,"\u597D"),F()()),e&2){let i=t.index;Ae(2),Ut("",i+1," \u989C\u8272"),Ae(3),qe("ngStyle",ct(2,Jc))}}function rb(e,t){if(e&1&&(N(0,"tr")(1,"td"),k(2),F(),N(3,"td"),k(4,"\u7B26\u5408\u4EBA\u7C7B\u5BA1\u7F8E"),F(),N(5,"td",14),k(6,"\u597D"),F()()),e&2){let i=t.index;Ae(2),Ut("",i+1," \u989C\u8272"),Ae(3),qe("ngStyle",ct(2,Jc))}}var ed=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=Et({type:e,selectors:[["nzx-good-evaluate-pdf-v"]],standalone:!0,features:[xi],decls:166,vars:4,consts:[[1,"mate-pro"],[1,"common-header","mate-pro-header"],["src","https://consumer.huawei.com/content/dam/huawei-cbg-site/cn/mkt/pdp/phones/mate60-pro/img/list-img/green.png"],[1,"common-title"],[1,"common-footer","mate-pro-footer"],[1,"common-description"],[1,"common-evaluation"],[4,"ngFor","ngForOf"],["colSpan","2"],[1,"common-date"],[1,"date"],[1,"mate"],[1,"common-header","mate-header"],[1,"common-footer","mate-footer"],[3,"ngStyle"]],template:function(n,r){n&1&&(N(0,"section",0)(1,"header",1),he(2,"img",2),N(3,"span",3),k(4,"HUAWEI Mate 60 Pro\u8BC4\u4EF7\u8868\uFF08\u7B2C\u4E00\u4EFD\uFF09"),F()(),N(5,"footer",4),k(6," \u9875\u811A mate 60 pro\uFF08\u7B2C\u4E00\u4EFD\uFF09 "),F(),N(7,"table",5)(8,"tbody")(9,"tr")(10,"td"),k(11,"\u5546\u54C1\u540D\u79F0"),F(),N(12,"td"),k(13,"HUAWEI Mate 60 Pro"),F(),N(14,"td"),k(15,"\u5C3A\u5BF8"),F(),N(16,"td"),k(17,"163.65mm x 79mm x 8.1mm"),F()(),N(18,"tr")(19,"td"),k(20,"\u91CD\u91CF"),F(),N(21,"td"),k(22,"\u7EA6 225 g\uFF08\u542B\u7535\u6C60\uFF09"),F(),N(23,"td"),k(24,"\u5C4F\u5E55\u5C3A\u5BF8"),F(),N(25,"td"),k(26,"6.82 \u82F1\u5BF8"),F()(),N(27,"tr")(28,"td"),k(29,"\u8272\u5F69"),F(),N(30,"td"),k(31,"10.7 \u4EBF\u8272\uFF0CP3 \u5E7F\u8272\u57DF"),F(),N(32,"td"),k(33,"\u7C7B\u578B"),F(),N(34,"td"),k(35,"OLED"),F()(),N(36,"tr")(37,"td"),k(38,"\u5206\u8FA8\u7387"),F(),N(39,"td"),k(40,"FHD+ 2720 \xD7 1260 \u50CF\u7D20"),F(),N(41,"td"),k(42,"\u73BB\u7483\u7C7B\u578B"),F(),N(43,"td"),k(44,"\u7B2C\u4E8C\u4EE3\u6606\u4ED1\u73BB\u7483"),F()(),N(45,"tr")(46,"td"),k(47,"\u64CD\u4F5C\u7CFB\u7EDF"),F(),N(48,"td"),k(49,"\u9E3F\u8499\u64CD\u4F5C\u7CFB\u7EDF 4.0"),F(),N(50,"td"),k(51,"\u8FD0\u884C\u5185\u5B58"),F(),N(52,"td"),k(53,"12 GB RAM"),F()()()(),N(54,"table",6)(55,"thead")(56,"tr")(57,"th"),k(58," Investigation Content "),he(59,"br"),k(60," \u8C03\u67E5\u5185\u5BB9 "),F(),N(61,"th"),k(62,"Standard for Evaluation "),he(63,"br"),k(64,"\u8BC4\u4F30\u6807\u51C6"),F(),N(65,"th"),k(66,"Evaluation "),he(67,"br"),k(68,"\u8BC4\u5B9A"),F()()(),N(69,"tbody"),Vt(70,nb,7,3,"tr",7),N(71,"tr")(72,"td"),k(73,"Your valued suggestion "),he(74,"br"),k(75,"\u60A8\u7684\u5EFA\u8BAE"),F(),N(76,"td",8),k(77,"\u5EFA\u8BAE\u8D2D\u4E70"),F()()()(),N(78,"div",9)(79,"span"),k(80," Date "),F(),N(81,"div",10),k(82,"2024-01-01"),F()()(),N(83,"section",11)(84,"header",12),he(85,"img",2),N(86,"span",3),k(87,"HUAWEI Mate 60 \u8BC4\u4EF7\u8868\uFF08\u7B2C\u4E8C\u4EFD\uFF09"),F()(),N(88,"footer",13),k(89,"\u9875\u811A mate 60\uFF08\u7B2C\u4E8C\u4EFD\uFF09"),F(),N(90,"table",5)(91,"tbody")(92,"tr")(93,"td"),k(94,"\u5546\u54C1\u540D\u79F0"),F(),N(95,"td"),k(96,"HUAWEI Mate 60"),F(),N(97,"td"),k(98,"\u5C3A\u5BF8"),F(),N(99,"td"),k(100,"163.65mm x 79mm x 8.1mm"),F()(),N(101,"tr")(102,"td"),k(103,"\u91CD\u91CF"),F(),N(104,"td"),k(105,"\u7EA6 225 g\uFF08\u542B\u7535\u6C60\uFF09"),F(),N(106,"td"),k(107,"\u5C4F\u5E55\u5C3A\u5BF8"),F(),N(108,"td"),k(109,"6.82 \u82F1\u5BF8"),F()(),N(110,"tr")(111,"td"),k(112,"\u8272\u5F69"),F(),N(113,"td"),k(114,"10.7 \u4EBF\u8272\uFF0CP3 \u5E7F\u8272\u57DF"),F(),N(115,"td"),k(116,"\u7C7B\u578B"),F(),N(117,"td"),k(118,"OLED"),F()(),N(119,"tr")(120,"td"),k(121,"\u5206\u8FA8\u7387"),F(),N(122,"td"),k(123,"FHD+ 2720 \xD7 1260 \u50CF\u7D20"),F(),N(124,"td"),k(125,"\u73BB\u7483\u7C7B\u578B"),F(),N(126,"td"),k(127,"\u7B2C\u4E8C\u4EE3\u6606\u4ED1\u73BB\u7483"),F()(),N(128,"tr")(129,"td"),k(130,"\u64CD\u4F5C\u7CFB\u7EDF"),F(),N(131,"td"),k(132,"\u9E3F\u8499\u64CD\u4F5C\u7CFB\u7EDF 4.0"),F(),N(133,"td"),k(134,"\u8FD0\u884C\u5185\u5B58"),F(),N(135,"td"),k(136,"12 GB RAM"),F()()()(),N(137,"table",6)(138,"thead")(139,"tr")(140,"th"),k(141," Investigation Content "),he(142,"br"),k(143," \u8C03\u67E5\u5185\u5BB9 "),F(),N(144,"th"),k(145,"Standard for Evaluation "),he(146,"br"),k(147,"\u8BC4\u4F30\u6807\u51C6"),F(),N(148,"th"),k(149,"Evaluation "),he(150,"br"),k(151,"\u8BC4\u5B9A"),F()()(),N(152,"tbody"),Vt(153,rb,7,3,"tr",7),N(154,"tr")(155,"td"),k(156,"Your valued suggestion "),he(157,"br"),k(158,"\u60A8\u7684\u5EFA\u8BAE"),F(),N(159,"td",8),k(160,"\u5EFA\u8BAE\u8D2D\u4E70"),F()()()(),N(161,"div",9)(162,"span"),k(163," Date "),F(),N(164,"div",10),k(165,"2024-01-01"),F()()()),n&2&&(Ae(70),qe("ngForOf",ct(2,Qc)),Ae(83),qe("ngForOf",ct(3,Qc)))},dependencies:[kt,Qn,yi],styles:['.common-footer[_ngcontent-%COMP%]{text-transform:uppercasse;font-size:12px}.common-guide[_ngcontent-%COMP%]{white-space:pre-wrap;font-size:14px;font-family:Source Han Sans SC,Source Han Sans SC;font-weight:400;color:#333}.common-header[_ngcontent-%COMP%]{display:flex;height:100px;align-items:center}.common-header[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:110px;height:100px}.common-header[_ngcontent-%COMP%]   .common-title[_ngcontent-%COMP%]{font-size:16px;font-weight:500;color:#000;line-height:19px}.common-description[_ngcontent-%COMP%]{margin-top:6px;width:100%;border-collapse:collapse}.common-description[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .common-description[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;font-family:Source Han Sans SC,Source Han Sans SC;font-weight:400;color:#000;padding:1em;border:1px solid #dcdcdc}.common-description[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(odd){width:120px;background:#ebedf1}.common-description[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]:nth-child(2n){width:249px}.common-evaluation[_ngcontent-%COMP%]{width:100%;border-collapse:collapse}.common-evaluation[_ngcontent-%COMP%]   th[_ngcontent-%COMP%], .common-evaluation[_ngcontent-%COMP%]   td[_ngcontent-%COMP%]{font-size:12px;font-family:Source Han Sans SC,Source Han Sans SC;font-weight:400;color:#000;border:1px solid #dcdcdc;padding:1em}.common-evaluation[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]{background:#ebedf1}.common-evaluation[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]{text-align:center}.common-evaluation[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(1){width:190px}.common-evaluation[_ngcontent-%COMP%]   thead[_ngcontent-%COMP%]   tr[_ngcontent-%COMP%]   th[_ngcontent-%COMP%]:nth-child(3){width:131px}.common-date[_ngcontent-%COMP%]{margin-top:50px;display:flex;justify-content:flex-end;font-size:12px;font-family:Source Han Sans SC,Source Han Sans SC;color:#000;line-height:16px}.common-date[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font-weight:500}.common-date[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{text-align:center;margin-left:8px;height:24px;width:122px;border-bottom:1px solid #000000;font-weight:400}@page{size:A4 portrait;margin:130px 30px 30px}.mate-pro[_ngcontent-%COMP%]{page:mate-pro}.mate-pro-header[_ngcontent-%COMP%]{position:running(mateproHeaderRunning)}.mate-pro-footer[_ngcontent-%COMP%]{position:running(mateproFooterRunning)}@page mate-pro{@top-center{content:element(mateproHeaderRunning)}@bottom-center{content:element(mateproFooterRunning)}@bottom-left{content:"\\7b2c" counter(page) "\\9875\\ff0c\\5171" counter(pages) "\\9875";font-size:12px}}.mate[_ngcontent-%COMP%]{page:mate}.mate-header[_ngcontent-%COMP%]{position:running(mateHeaderRunning)}.mate-footer[_ngcontent-%COMP%]{position:running(mateFooterRunning)}@page mate{@top-center{content:element(mateHeaderRunning)}@bottom-center{content:element(mateFooterRunning)}@bottom-left{content:"\\7b2c" counter(page) "\\9875\\ff0c\\5171" counter(pages) "\\9875";font-size:12px}}']})}}return e})();var Yr=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275cmp=Et({type:e,selectors:[["nzx-print-example"]],standalone:!0,features:[xi],decls:40,vars:6,consts:[["nzxPrintV",""],["nzxPrint",""],["printRef",""],["nz-row","","nzJustify","space-between","nzAlign","middle"],["nz-col",""],["nz-button","","nzType","primary",3,"click"],["nz-row","","nzJustify","center"],["printTitle","HUAWEI Mate 60 Pro\u8BC4\u4EF7\u8868",3,"enablePreview"],["nzxPrintHeader",""],["nzxPrintContent","",3,"identifierStr"],["printTitle","HUAWEI Mate 60 Pro\u8BC4\u4EF7\u8868",3,"enablePreview","identifierStr","pagedCDN"],["nzxPrintContent",""],["nz-button","","nzType","primary","nzxPrint","","printTitle","\u8BC4\u4EF7\u8868","identifierStr",".mate-pro",3,"printEl"]],template:function(n,r){if(n&1){let o=Xn();N(0,"div",3)(1,"div",4),k(2,"\u57FA\u4E8Evivliostyle\u5B9E\u73B0(\u652F\u6301\u5206\u9875\uFF0C\u9875\u7709\u9875\u811A)"),F(),N(3,"div",4)(4,"button",5),It("click",function(){ti(o);let a=Ht(8);return ii(a.print())}),k(5," \u4E0B\u8F7D\u6253\u5370\u8BC4\u4EF7\u8868 "),F()()(),N(6,"div",6)(7,"nzx-print-v",7,0)(9,"div",8),k(10," \u6211\u662Fheader\u4E0D\u53C2\u4E0E\u6253\u5370 "),N(11,"button",5),It("click",function(){ti(o);let a=Ht(8);return ii(a.refresh())}),k(12," \u5237\u65B0 "),F()(),N(13,"div",9),he(14,"nzx-good-evaluate-pdf-v"),F()()(),N(15,"div",3)(16,"div",4),k(17," \u57FA\u4E8Epaged.js\u5B9E\u73B0(\u76EE\u524Dbug\u6BD4\u8F83\u591A\u63A8\u8350\u4F7F\u7528vivliostyle\uFF0C\u652F\u6301\u5206\u9875\uFF0C\u9875\u7709\u9875\u811A) "),F(),N(18,"div",4)(19,"button",5),It("click",function(){ti(o);let a=Ht(23);return ii(a.print())}),k(20," \u4E0B\u8F7D\u6253\u5370\u8BC4\u4EF7\u8868 "),F()()(),N(21,"div",6)(22,"nzx-print",10,1)(24,"div",8),k(25," \u6211\u662Fheader\u4E0D\u53C2\u4E0E\u6253\u5370 "),N(26,"button",5),It("click",function(){ti(o);let a=Ht(23);return ii(a.refresh())}),k(27," \u5237\u65B0 "),F()(),N(28,"div",11),he(29,"nzx-good-evaluate-pdf"),F()()(),N(30,"div",3)(31,"div",4),k(32,"\u666E\u901A\u6253\u5370"),F(),N(33,"div",4)(34,"button",12),k(35," \u4E0B\u8F7D\u6253\u5370\u8BC4\u4EF7\u8868 "),F()()(),N(36,"div",6)(37,"div",null,2),he(39,"nzx-good-evaluate-pdf"),F()()}if(n&2){let o=Ht(38);Ae(7),qe("enablePreview",!0),Ae(6),qe("identifierStr",".mate-pro-header"),Ae(9),qe("enablePreview",!0)("identifierStr",".mate-pro-header")("pagedCDN","https://unpkg.com/pagedjs/dist/paged.polyfill.js"),Ae(12),qe("printEl",o)}},dependencies:[kt,er,oa,Jn,ra,na,ta,ia,Zc,ed,qc,la,jc,Ci,Xc],encapsulation:2})}}return e})();var td=(()=>{class e{static{this.\u0275fac=function(n){return new(n||e)}}static{this.\u0275mod=Gn({type:e})}static{this.\u0275inj=Wn({imports:[kt,Yr]})}}return e})();var N1={"nzx-print-print-example":Yr},T1=td;export{T1 as EXAMPLES_MODULE,N1 as EXAMPLE_COMPONENTS};
