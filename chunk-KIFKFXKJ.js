import{a as J,b as je,c as Ae}from"./chunk-LUJCEHGC.js";import{c as Ve,d as Me,e as Ge,f as Re,g as $e}from"./chunk-VB2EFXJJ.js";import{a as B,b as L,c as Ee}from"./chunk-DTSBX4ZR.js";import{a as Be,c as Le}from"./chunk-SQSMMIYW.js";import{a as qe}from"./chunk-UEO2LBLP.js";import{c as Je,d as Ue,e as He}from"./chunk-MFMZI4JG.js";import{n as Qe,p as Oe}from"./chunk-752J3DYG.js";import{a as Ie,b as we,c as De}from"./chunk-QXLY7K4I.js";import{a as Pe,b as ke}from"./chunk-ZOSYNVO3.js";import{d as ze,h as b,i as x,n as xe,p as g,s as F,v as ge,x as Ne}from"./chunk-ZVWL25YR.js";import{a as be,b as Fe,d as Te,e as Se}from"./chunk-TU4Q4OVA.js";import{$b as Ce,Ab as me,Ba as W,Bb as pe,Cc as $,Dc as j,Eb as ue,Ec as A,Fb as G,Fc as ye,Gb as w,Hb as D,Jb as S,Ka as i,La as v,Lb as I,Lc as he,Md as _e,Na as ae,Nd as ve,Ra as se,Sb as R,Ta as z,Ub as fe,X as T,Ya as c,ab as r,ba as te,ca as oe,ea as ne,f as q,g as Z,ga as re,gc as de,la as s,ma as ie,na as Q,ob as m,pb as C,qb as d,rb as u,sb as f,ta as le,tb as ce,ua as O,ub as V,va as E,xa as h,xb as M,y as ee,zb as p}from"./chunk-OGFJLPPA.js";import{a as k,b as X}from"./chunk-UKNGC2Y4.js";var Ye=(()=>{class t{constructor(e){this.templateRef=e}static{this.\u0275fac=function(n){return new(n||t)(v(ae))}}static{this.\u0275dir=Q({type:t,selectors:[["","nzxControl",""]],inputs:{nzxControl:"nzxControl"}})}}return t})();var _=(()=>{class t{static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275dir=Q({type:t,inputs:{form:"form",control:"control"}})}}return t})();var nt=()=>({width:"100%"}),Ke=(()=>{class t extends _{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=h(t)))(o||t)}})()}static{this.\u0275cmp=s({type:t,selectors:[["nzx-date-picker-control"]],features:[z],decls:2,vars:5,consts:[[3,"formGroup"],[3,"ngStyle","formControlName","nzPlaceHolder"]],template:function(n,o){n&1&&(u(0,0),d(1,"nz-date-picker",1),f()),n&2&&(r("formGroup",o.form),i(),r("ngStyle",R(4,nt))("formControlName",o.control.controlName)("nzPlaceHolder",o.control.placeholder))},dependencies:[A,b,x,g,F,J],encapsulation:2})}}return t})();var We=(()=>{class t extends _{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=h(t)))(o||t)}})()}static{this.\u0275cmp=s({type:t,selectors:[["nzx-input-control"]],features:[z],decls:2,vars:3,consts:[[3,"formGroup"],["nz-input","","type","text",3,"placeholder","formControlName"]],template:function(n,o){n&1&&(u(0,0),d(1,"input",1),f()),n&2&&(r("formGroup",o.form),i(),r("placeholder",o.control.placeholder)("formControlName",o.control.controlName))},dependencies:[ze,b,x,g,F,Be],encapsulation:2})}}return t})();var rt=()=>({width:"100%"}),Xe=(()=>{class t extends _{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=h(t)))(o||t)}})()}static{this.\u0275cmp=s({type:t,selectors:[["nzx-range-picker-control"]],features:[z],decls:2,vars:4,consts:[[3,"formGroup"],[3,"ngStyle","formControlName"]],template:function(n,o){n&1&&(u(0,0),d(1,"nz-range-picker",1),f()),n&2&&(r("formGroup",o.form),i(),r("ngStyle",R(3,rt))("formControlName",o.control.controlName))},dependencies:[A,b,x,g,F,J,je],encapsulation:2})}}return t})();function it(t,a){if(t&1&&d(0,"nz-option",3),t&2){let e=a.$implicit;r("nzValue",e.value)("nzLabel",e.label)}}var Ze=(()=>{class t extends _{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=h(t)))(o||t)}})()}static{this.\u0275cmp=s({type:t,selectors:[["nzx-select-control"]],features:[z],decls:3,vars:6,consts:[[3,"formGroup"],[3,"formControlName","nzShowSearch","nzAllowClear","nzPlaceHolder"],[3,"nzValue","nzLabel",4,"ngFor","ngForOf"],[3,"nzValue","nzLabel"]],template:function(n,o){if(n&1&&(u(0,0),m(1,"nz-select",1),c(2,it,1,2,"nz-option",2),C(),f()),n&2){let l,y;r("formGroup",o.form),i(),r("formControlName",o.control.controlName)("nzShowSearch",(l=o.control.nzxShowSearch)!==null&&l!==void 0?l:!0)("nzAllowClear",(y=o.control.nzxAllowClear)!==null&&y!==void 0?y:!0)("nzPlaceHolder",o.control.placeholder),i(),r("ngForOf",o.control.menuList)}},dependencies:[$,b,x,g,F,Je,Ue],encapsulation:2})}}return t})();var lt=(t,a)=>({$implicit:t,formGroup:a});function at(t,a){t&1&&ce(0)}var et=(()=>{class t extends _{static{this.\u0275fac=(()=>{let e;return function(o){return(e||(e=h(t)))(o||t)}})()}static{this.\u0275cmp=s({type:t,selectors:[["nzx-template-control"]],features:[z],decls:1,vars:5,consts:[[4,"ngTemplateOutlet","ngTemplateOutletContext"]],template:function(n,o){n&1&&c(0,at,1,0,"ng-container",0),n&2&&r("ngTemplateOutlet",o.control.templateRef)("ngTemplateOutletContext",fe(2,lt,o.form.get(o.control.controlName),o.form))},dependencies:[ye],encapsulation:2})}}return t})();var H=new ne("QUERY_CONFIG"),Y=(()=>{class t{constructor(e){this.controlTypePoll=[{key:"input",component:We},{key:"select",component:Ze},{key:"Template",component:et},{key:"datePicker",component:Ke},{key:"rangePicker",component:Xe}],this.controlTypes$=new Z(this.controlTypePoll),e&&e.controlTypes&&e.controlTypes.length>0&&(e.controlTypes.forEach(n=>{this.addControlType(n)}),this.refreshControlType())}addControlType(e){if(this.controlTypePoll.some(o=>o.key===e.key))throw`ControlType:: ${e.key} already exists !`;this.controlTypePoll.push(e)}removeControlType(e){if(this.controlTypePoll.some(o=>o.key===e))this.controlTypePoll=this.controlTypePoll.filter(o=>o.key!==e);else throw`ControlType:: ${e} not exists !`}refreshControlType(){this.controlTypes$.next(this.controlTypePoll)}static{this.\u0275fac=function(n){return new(n||t)(re(H,8))}}static{this.\u0275prov=te({token:t,factory:t.\u0275fac,providedIn:"root"})}}return t})();var pt=["controlTemp"];function ut(t,a){if(t&1&&(m(0,"nz-form-label",3),S(1),C()),t&2){let e=p();r("nzSpan",e.control.nzxLSpan||6),i(),I(" ",e.control.label," ")}}function ft(t,a){}var tt=(()=>{class t{constructor(e){this.nzxQueryConfigService=e,this.destroy$=new q}ngOnInit(){this.nzxQueryConfigService.controlTypes$.pipe(T(this.destroy$)).subscribe(e=>{this.renderControl(e)})}ngOnDestroy(){this.destroy$&&(this.destroy$.next(),this.destroy$.complete())}renderControl(e){this.controlTemplateView.clear();let n=e.find(o=>o.key===this.control.controlType);if(n){let o=this.controlTemplateView.createComponent(n.component);o.setInput("control",this.control),o.setInput("form",this.form)}else throw`ControlType:: '${this.control.controlType}' is invalidate`}static{this.\u0275fac=function(n){return new(n||t)(v(Y))}}static{this.\u0275cmp=s({type:t,selectors:[["nzx-configurable-query-item"]],viewQuery:function(n,o){if(n&1&&G(pt,7,se),n&2){let l;w(l=D())&&(o.controlTemplateView=l.first)}},inputs:{form:"form",control:"control"},decls:5,vars:4,consts:[["controlTemp",""],[3,"nzSpan",4,"ngIf"],[3,"nzSpan","nzValidateStatus","nzErrorTip"],[3,"nzSpan"]],template:function(n,o){if(n&1&&(m(0,"nz-form-item"),c(1,ut,2,2,"nz-form-label",1),m(2,"nz-form-control",2),c(3,ft,0,0,"ng-template",null,0,Ce),C()()),n&2){let l;i(),r("ngIf",o.control.label),i(),r("nzSpan",o.control.nzxRSpan||18)("nzValidateStatus",(l=o.control==null?null:o.control.controlInstance)!==null&&l!==void 0?l:o.form.get(o.control.controlName))("nzErrorTip",o.control.errorTip)}},dependencies:[j,L,B,Ve,Re,Ge],encapsulation:2})}}return t})();var dt=["queyForm"],yt=["*"];function ht(t,a){if(t&1&&d(0,"nzx-configurable-query-item",13),t&2){let e=p(2).$implicit,n=p();r("form",n.queryForm)("control",e)}}function zt(t,a){if(t&1&&(m(0,"div",11),c(1,ht,1,2,"nzx-configurable-query-item",12),C()),t&2){let e=p(),n=e.$implicit,o=e.index,l=p();r("nzSpan",n.nzxSpan||24/l.lineNumber)("hidden",n.collapse)("nzOrder",o),i(),r("ngIf",n.controlName)}}function xt(t,a){if(t&1&&(u(0),c(1,zt,2,4,"div",10),f()),t&2){let e=a.$implicit;i(),r("ngIf",!e.hidden)}}function gt(t,a){if(t&1){let e=V();m(0,"button",14),M("click",function(){O(e);let o=p();return E(o.search())}),S(1),C()}if(t&2){let e=p();i(),I(" ",e.locale.query," ")}}function Nt(t,a){if(t&1){let e=V();m(0,"button",15),M("click",function(){O(e);let o=p();return E(o.reset())}),S(1),C()}if(t&2){let e=p();i(),I(" ",e.locale.reset," ")}}function _t(t,a){t&1&&(u(0),pe(1),f())}function vt(t,a){if(t&1){let e=V();m(0,"a",17),M("click",function(){O(e);let o=p(2);return E(o.toggleCollapse())}),S(1),d(2,"i",18),C()}if(t&2){let e=p(2);i(),I(" ",e.collapseText," "),i(),r("nzType",e.collapseIcon)}}function bt(t,a){t&1&&(u(0),c(1,vt,3,2,"a",16),f())}var ho=(()=>{class t{get queryParams(){return this._queryParams}set queryParams(e){this._queryParams=e}get nzxCollapse(){return this.controls.some(e=>e.hasOwnProperty("collapse"))}constructor(e,n,o){this.i18n=e,this.fb=n,this.cd=o,this.controls=[],this.nzxJustify="start",this.nzxGutter=8,this.lineNumber=3,this.nzxBtnSpan=null,this.initQuery=!1,this.fixedParams={},this.queryChange=new W,this.resetChange=new W,this.collapseIcon="down",this.collapseText="",this._queryParams={},this.defaultValue={},this.cacheParams={},this.destroy$=new q,this.queryForm=this.fb.group({})}ngOnChanges(e){if(e.controls&&!e.controls.isFirstChange()){let n=e.controls.currentValue;Array.isArray(n)&&this.generateForm(n)}}ngOnInit(){this.i18n.localeChange.pipe(T(this.destroy$)).subscribe(()=>{this.locale=this.i18n.getLocaleData("Query"),this.cd.markForCheck()}),this.queryForm.valueChanges.pipe(T(this.destroy$)).subscribe(e=>{this._queryParams=k(k({},e),this.fixedParams)})}ngAfterViewInit(){this.queyFormEl&&ee(this.queyFormEl.nativeElement,"keydown").pipe(T(this.destroy$)).subscribe(e=>{e.key==="Enter"&&(e.stopPropagation(),e.preventDefault(),this.search()),(e.ctrlKey||e.metaKey)&&e.key==="r"&&(e.preventDefault(),e.stopPropagation(),this.reset())})}ngAfterContentInit(){this.generateForm(this.controls),this.initQuery&&this.search()}setQueryParams(e){this.cacheParams=e,this.queryForm.patchValue(e)}setControl(e,n,o=!1){let l=this.getControl(e);l&&(Object.keys(n).forEach(y=>{l[y]=n[y]}),this.generateControl(l,o),this.cd.markForCheck())}addControl(e,n,o=!1){if(!this.getControl(e.controlName))e&&e.hasOwnProperty("collapse")&&this.controls.some(K=>K.hasOwnProperty("collapse"))&&(e.collapse=this.controls.some(K=>K.collapse===!0)),this.generateControl(e,o),n==null?this.controls.push(e):this.controls.splice(n-1,0,e),this.calculateText();else throw`The control name: '${e.controlName}' already exists!`}removeControl(e){if(this.getControl(e))this.queryForm.removeControl(e),this.controls=this.controls.filter(o=>o.controlName!==e),this.calculateText();else throw`The control name: '${e}' not find!`}getControl(e){return this.controls.find(n=>n.controlName===e)}getFormControl(e){return this.queryForm.get(e)}search(){if(this.queryForm.invalid){qe(this.queryForm);return}this.queryChange.emit(this._queryParams)}reset(){this.queryForm.reset(this.defaultValue),this.resetChange.emit(this._queryParams)}toggleCollapse(){for(let e=0;e<this.controls.length;e++){let n=this.controls[e],o=n.hasOwnProperty("collapse");o&&n.collapse?n.collapse=!1:o&&!n.collapse&&(n.collapse=!0)}this.calculateText()}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}calculateText(){this.controls.some(e=>e.collapse===!0)?(this.collapseIcon="down",this.collapseText=this.locale.expand):(this.collapseIcon="up",this.collapseText=this.locale.collapse),this.cd.markForCheck()}clearFormControl(){Object.keys(this.queryForm.controls).forEach(e=>{this.queryForm.removeControl(e)})}generateForm(e){this.clearFormControl();for(let n of e)this.generateControl(n);this.defaultValue=this.queryForm.getRawValue(),this.cacheParams&&this.queryForm.patchValue(this.cacheParams),this.calculateText()}generateControl(e,n=!1){if(e.controlName){if(!e?.templateRef){let o=this.controlTemplateList.find(l=>l.nzxControl===e.controlName);o&&(e.templateRef=o.templateRef)}if(this.queryForm.setControl(e.controlName,e.controlInstance??this.fb.control(e.default??null)),!n){let o=this.queryForm.get(e.controlName);this.defaultValue=X(k({},this.defaultValue),{[e.controlName]:o.value})}}}static{this.\u0275fac=function(n){return new(n||t)(v(Qe),v(ge),v(de))}}static{this.\u0275cmp=s({type:t,selectors:[["nzx-configurable-query"]],contentQueries:function(n,o,l){if(n&1&&ue(l,Ye,5),n&2){let y;w(y=D())&&(o.controlTemplateList=y)}},viewQuery:function(n,o){if(n&1&&G(dt,5),n&2){let l;w(l=D())&&(o.queyFormEl=l.first)}},inputs:{controls:"controls",nzxJustify:"nzxJustify",nzxGutter:"nzxGutter",lineNumber:"lineNumber",nzxBtnSpan:"nzxBtnSpan",initQuery:"initQuery",fixedParams:"fixedParams"},outputs:{queryChange:"queryChange",resetChange:"resetChange"},exportAs:["NzxConfigurableQuery"],features:[le],ngContentSelectors:yt,decls:12,vars:7,consts:[["queyForm",""],["nz-form","",1,"nzx-query-container",3,"formGroup"],["nz-row","",3,"nzGutter","nzJustify"],[4,"ngFor","ngForOf"],["nz-col","",1,"nzx-query-btn",3,"nzOrder","nzSpan"],["nz-row","","nzJustify","end","nzAlign","middle"],["nz-button","","nzType","primary","type","button","title","Enter",3,"click",4,"nzSpaceItem"],["nz-button","","type","button","title","ctrl+r",3,"click",4,"nzSpaceItem"],[4,"nzSpaceItem"],[4,"ngIf"],["nz-col","",3,"nzSpan","hidden","nzOrder",4,"ngIf"],["nz-col","",3,"nzSpan","hidden","nzOrder"],[3,"form","control",4,"ngIf"],[3,"form","control"],["nz-button","","nzType","primary","type","button","title","Enter",3,"click"],["nz-button","","type","button","title","ctrl+r",3,"click"],["nz-button","","nzType","link",3,"click",4,"nzSpaceItem"],["nz-button","","nzType","link",3,"click"],["nz-icon","",3,"nzType"]],template:function(n,o){n&1&&(me(),m(0,"nz-card")(1,"form",1,0)(3,"div",2),c(4,xt,2,1,"ng-container",3),m(5,"div",4)(6,"div",5)(7,"nz-space"),c(8,gt,2,1,"button",6)(9,Nt,2,1,"button",7)(10,_t,2,0,"ng-container",8)(11,bt,2,0,"ng-container",9),C()()()()()()),n&2&&(i(),r("formGroup",o.queryForm),i(2),r("nzGutter",o.nzxGutter)("nzJustify",o.nzxJustify),i(),r("ngForOf",o.controls),i(),r("nzOrder",o.controls.length)("nzSpan",o.nzxBtnSpan||24/o.lineNumber),i(6),r("ngIf",o.nzxCollapse))},dependencies:[$,j,xe,x,g,L,B,Me,Te,be,Fe,Pe,we,Ie,_e,tt],styles:[".nzx-query-container[_ngcontent-%COMP%]   [nz-form-label][_ngcontent-%COMP%]{overflow:visible}.nzx-query-container[_ngcontent-%COMP%]   .nzx-query-btn[_ngcontent-%COMP%]{flex-grow:2;max-width:none}"],changeDetection:0})}}return t})();var Yo=(()=>{class t{static forRoot(e){return{ngModule:t,providers:[{provide:H,useValue:e}]}}static forChild(e){return{ngModule:t,providers:[{provide:H,useValue:e},Y]}}static{this.\u0275fac=function(n){return new(n||t)}}static{this.\u0275mod=ie({type:t})}static{this.\u0275inj=oe({imports:[he,Ne,Le,$e,Ee,Se,He,Ae,ke,De,ve,Oe]})}}return t})();export{Ye as a,ho as b,Yo as c};
