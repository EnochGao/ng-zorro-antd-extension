import{a as Q,b as Y}from"./chunk-BCFAZKDB.js";import"./chunk-JLUX7UYA.js";import"./chunk-H66T5NKY.js";import"./chunk-KBDRVQ2X.js";import"./chunk-MWDUSRTL.js";import"./chunk-K66H5K2I.js";import{Ba as R,Ec as B,Fb as x,Gb as w,Hb as z,Jb as k,Ka as l,Kb as S,La as N,Lc as v,Md as V,Nd as U,Rb as D,Tb as L,Ub as J,Vb as F,ab as g,ca as y,gc as X,ha as I,la as M,ma as b,ob as a,pb as h,qb as j,ua as p,ub as P,va as f,xb as u}from"./chunk-OGFJLPPA.js";import"./chunk-UKNGC2Y4.js";var H=["canvasCtx"],W=["blockCtx"],K=["sliderContainer"],Z=["slider"],ee=["sliderMask"],te=o=>({width:o}),ne=(o,E,e)=>({display:o,width:E,height:e}),ie=(o,E)=>({width:o,"pointer-events":E}),c=42,d=9,_=Math.PI,C=c+d*2+3,A=(()=>{class o{constructor(e){this.cd=e,this.width=310,this.height=155,this.nzxLoadingText="\u52A0\u8F7D\u4E2D...",this.nzxTipText="\u5411\u53F3\u6ED1\u52A8\u586B\u5145\u62FC\u56FE",this.nzxBgImgUrl="",this.nzxOnRefresh=new R,this.nzxOnSuccess=new R,this.nzxOnFail=new R,this.isLoading=!1,this.x=0,this.y=0,this.originX=0,this.originY=0,this.trail=[],this.isMouseDown=!1}ngAfterViewInit(){this.initImg();let e=t=>{if(!this.isMouseDown)return!1;t.preventDefault();let i=t.clientX||t.touches[0].clientX,r=t.clientY||t.touches[0].clientY,s=i-this.originX,m=r-this.originY;if(s<0||s+38>=this.width)return!1;this.sliderRef.nativeElement.style.left=s+"px";let G=(this.width-40-20)/(this.width-40)*s;return this.blockRef.nativeElement.style.left=G+"px",this.sliderContainerRef.nativeElement.classList.add("nzx-jigsaw-slider-container-active"),this.sliderMaskRef.nativeElement.style.width=s+"px",this.trail.push(m),!1},n=t=>{if(!this.isMouseDown||(this.isMouseDown=!1,(t.clientX||t.changedTouches[0].clientX)===this.originX))return!1;this.sliderContainerRef.nativeElement.classList.remove("nzx-jigsaw-slider-container-active"),this.trail=this.trail;let{spliced:r,verified:s}=this.verify();return r?s?(this.sliderContainerRef.nativeElement.classList.add("nzx-jigsaw-slider-container-success"),this.nzxOnSuccess.emit()):(this.sliderContainerRef.nativeElement.classList.add("nzx-jigsaw-slider-container-fail"),this.nzxTipText="\u8BF7\u518D\u8BD5\u4E00\u6B21",this.reset()):(this.sliderContainerRef.nativeElement.classList.add("nzx-jigsaw-slider-container-fail"),this.nzxOnFail.emit(),setTimeout(()=>this.reset(),1e3)),!1};document.addEventListener("mousemove",e),document.addEventListener("touchmove",e),document.addEventListener("mouseup",n),document.addEventListener("touchend",n)}selectstart(){return!1}refresh(){this.reset(),this.nzxOnRefresh.emit()}handleDragStart(e){this.originX=e.clientX||e.touches[0].clientX,this.originY=e.clientY||e.touches[0].clientY,this.isMouseDown=!0}verify(){let e=this.trail,n=e.reduce((s,m)=>s+m)/e.length,t=e.map(s=>s-n),i=Math.sqrt(t.map(s=>s*s).reduce((s,m)=>s+m)/e.length),r=parseInt(this.blockRef.nativeElement.style.left);return{spliced:Math.abs(r-this.x)<10,verified:i!==0}}reset(){let{width:e,height:n}=this;this.sliderContainerRef.nativeElement.className="nzx-jigsaw-slider-container",this.sliderRef.nativeElement.style.left="0px",this.blockRef.nativeElement.width=e,this.blockRef.nativeElement.style.left="0px",this.sliderMaskRef.nativeElement.style.width="0px",this.canvasRef.nativeElement.getContext("2d").clearRect(0,0,e,n),this.blockRef.nativeElement.getContext("2d").clearRect(0,0,e,n),this.isLoading=!0,this.cd.markForCheck(),this.setImageSrc(this.getRandomImgSrc(),this.img)}initImg(){let e=new Image;e.style.objectFit="cover",e.crossOrigin="Anonymous",e.onload=()=>{this.isLoading=!1,this.draw(e)},e.onerror=()=>{this.setImageSrc(this.getRandomImgSrc(),e)},this.setImageSrc(this.getRandomImgSrc(),e),this.img=e}draw(e){let{width:n,height:t}=this;this.x=this.getRandomNumberByRange(C+10,n-(C+10)),this.y=this.getRandomNumberByRange(10+d*2,t-(C+10)),this.drawPath(this.canvasRef.nativeElement.getContext("2d"),this.x,this.y,"fill"),this.drawPath(this.blockRef.nativeElement.getContext("2d"),this.x,this.y,"clip"),this.canvasRef.nativeElement.getContext("2d").drawImage(e,0,0,n,t),this.blockRef.nativeElement.getContext("2d").drawImage(e,0,0,n,t);let i=this.y-d*2-1,r=this.blockRef.nativeElement.getContext("2d").getImageData(this.x-3,i,C,C);this.blockRef.nativeElement.width=C,this.blockRef.nativeElement.getContext("2d").putImageData(r,0,i),this.cd.markForCheck()}setImageSrc(e,n){if(window.navigator.userAgent.indexOf("Trident")>-1){let i=new XMLHttpRequest;i.onloadend=r=>{let s=new FileReader;s.readAsDataURL(r.target.response),s.onloadend=m=>{n.src=m.target?.result}},i.open("GET",e),i.responseType="blob",i.send()}else n.src=e}getRandomImgSrc(){return this.nzxBgImgUrl&&typeof this.nzxBgImgUrl=="string"?this.nzxBgImgUrl:this.nzxBgImgUrl&&Array.isArray(this.nzxBgImgUrl)&&this.nzxBgImgUrl.length?this.nzxBgImgUrl[this.getRandomNumberByRange(0,this.nzxBgImgUrl.length-1)]:`https://picsum.photos/id/${this.getRandomNumberByRange(0,1084)}/${this.width}/${this.height}`}getRandomNumberByRange(e,n){return Math.round(Math.random()*(n-e)+e)}drawPath(e,n,t,i){e.beginPath(),e.moveTo(n,t),e.arc(n+c/2,t-d+2,d,.72*_,2.26*_),e.lineTo(n+c,t),e.arc(n+c+d-2,t+c/2,d,1.21*_,2.78*_),e.lineTo(n+c,t+c),e.lineTo(n,t+c),e.arc(n+d-2,t+c/2,d+.4,2.76*_,1.24*_,!0),e.lineTo(n,t),e.lineWidth=2,e.fillStyle="rgba(255, 255, 255, 0.7)",e.strokeStyle="rgba(255, 255, 255, 0.7)",e.stroke(),e.globalCompositeOperation="destination-over",i==="fill"?e.fill():e.clip()}static{this.\u0275fac=function(n){return new(n||o)(N(X))}}static{this.\u0275cmp=M({type:o,selectors:[["nzx-jigsaw"]],viewQuery:function(n,t){if(n&1&&(x(H,5),x(W,5),x(K,5),x(Z,5),x(ee,5)),n&2){let i;w(i=z())&&(t.canvasRef=i.first),w(i=z())&&(t.blockRef=i.first),w(i=z())&&(t.sliderContainerRef=i.first),w(i=z())&&(t.sliderRef=i.first),w(i=z())&&(t.sliderMaskRef=i.first)}},inputs:{width:"width",height:"height",nzxLoadingText:"nzxLoadingText",nzxTipText:"nzxTipText",nzxBgImgUrl:"nzxBgImgUrl"},outputs:{nzxOnRefresh:"nzxOnRefresh",nzxOnSuccess:"nzxOnSuccess",nzxOnFail:"nzxOnFail"},decls:19,vars:20,consts:[["canvasCtx",""],["blockCtx",""],["sliderContainer",""],["sliderMask",""],["slider",""],[1,"nzx-jigsaw-container",3,"selectstart","ngStyle"],[1,"nzx-jigsaw-loading-container",3,"ngStyle"],["nz-icon","",1,"nzx-jigsaw-loading-icon",3,"nzType"],[3,"width","height"],["nz-icon","","nzType","redo","nzTheme","outline",1,"nzx-jigsaw-refresh-icon",3,"click","nzRotate"],[1,"nzx-jigsaw-block",3,"touchstart","mousedown","width","height"],[1,"nzx-jigsaw-slider-container",3,"ngStyle"],[1,"nzx-jigsaw-slider-mask"],[1,"nzx-jigsaw-slider",3,"touchstart","mousedown"],["nz-icon","","nzType","arrow-right","nzTheme","outline"],[1,"nzx-jigsaw-slider-text"]],template:function(n,t){if(n&1){let i=P();a(0,"div",5),u("selectstart",function(){return p(i),f(t.selectstart())}),a(1,"div",6),j(2,"span",7),a(3,"span"),k(4),h()(),j(5,"canvas",8,0),a(7,"span",9),u("click",function(){return p(i),f(t.refresh())}),h(),a(8,"canvas",10,1),u("touchstart",function(s){return p(i),f(t.handleDragStart(s))})("mousedown",function(s){return p(i),f(t.handleDragStart(s))}),h(),a(10,"div",11,2)(12,"div",12,3)(14,"div",13,4),u("touchstart",function(s){return p(i),f(t.handleDragStart(s))})("mousedown",function(s){return p(i),f(t.handleDragStart(s))}),j(16,"span",14),h()(),a(17,"span",15),k(18),h()()()}n&2&&(g("ngStyle",L(11,te,t.width+"px")),l(),g("ngStyle",F(13,ne,t.isLoading?"":"none",t.width+"px",t.height+"px")),l(),g("nzType","loading"),l(2),S(t.nzxLoadingText),l(),g("width",t.width)("height",t.height),l(2),g("nzRotate",-80),l(),g("width",t.width)("height",t.height),l(2),g("ngStyle",J(17,ie,t.width+"px",t.isLoading?"none":"")),l(8),S(t.nzxTipText))},dependencies:[B,V],styles:[".nzx-jigsaw-container[_ngcontent-%COMP%]{position:relative}.nzx-jigsaw-block[_ngcontent-%COMP%]{position:absolute;left:0;top:0;cursor:pointer;cursor:grab}.nzx-jigsaw-block[_ngcontent-%COMP%]:active{cursor:grabbing}.nzx-jigsaw-slider-container[_ngcontent-%COMP%]{position:relative;text-align:center;line-height:40px;height:40px;background:#f7f9fa;color:#45494c;border:1px solid #e4e7eb}.nzx-jigsaw-slider-container-active[_ngcontent-%COMP%]   .nzx-jigsaw-slider[_ngcontent-%COMP%]{top:-1px;border:1px solid #1991fa}.nzx-jigsaw-slider-container-active[_ngcontent-%COMP%]   .nzx-jigsaw-slider-mask[_ngcontent-%COMP%]{border-width:1px}.nzx-jigsaw-slider-container-success[_ngcontent-%COMP%]   .nzx-jigsaw-slider[_ngcontent-%COMP%]{top:-1px;border:1px solid #52ccba;background-color:#52ccba!important}.nzx-jigsaw-slider-container-success[_ngcontent-%COMP%]   .nzx-jigsaw-slider-mask[_ngcontent-%COMP%]{border:1px solid #52ccba;background-color:#d2f4ef}.nzx-jigsaw-slider-container-fail[_ngcontent-%COMP%]   .nzx-jigsaw-slider[_ngcontent-%COMP%]{top:-1px;border:1px solid #f57a7a;background-color:#f57a7a!important}.nzx-jigsaw-slider-container-fail[_ngcontent-%COMP%]   .nzx-jigsaw-slider-mask[_ngcontent-%COMP%]{border:1px solid #f57a7a;background-color:#fce1e1}.nzx-jigsaw-slider-container-active[_ngcontent-%COMP%]   .nzx-jigsaw-slider-text[_ngcontent-%COMP%], .nzx-jigsaw-slider-container-success[_ngcontent-%COMP%]   .nzx-jigsaw-slider-text[_ngcontent-%COMP%], .nzx-jigsaw-slider-container-fail[_ngcontent-%COMP%]   .nzx-jigsaw-slider-text[_ngcontent-%COMP%]{display:none}.nzx-jigsaw-slider-mask[_ngcontent-%COMP%]{position:absolute;left:0;top:0;height:40px;border:0 solid #1991fa;background:#d1e9fe}.nzx-jigsaw-slider[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:40px;height:40px;background:#fff;box-shadow:0 0 3px #0000004d;transition:background .2s linear;cursor:pointer;cursor:grab}.nzx-jigsaw-slider[_ngcontent-%COMP%]:active{cursor:grabbing}.nzx-jigsaw-slider[_ngcontent-%COMP%]:hover{background:#1991fa}.nzx-jigsaw-refresh-icon[_ngcontent-%COMP%]{position:absolute;right:5px;top:5px;font-size:24px;cursor:pointer;color:#fff}.nzx-jigsaw-loading-container[_ngcontent-%COMP%]{position:absolute;left:0;top:0;display:flex;flex-direction:column;justify-content:center;align-items:center;font-size:14px;color:#45494c;z-index:2;background:#edf0f2}.nzx-jigsaw-loading-icon[_ngcontent-%COMP%]{font-size:32px;margin-bottom:10px}"],changeDetection:0})}}return o})();var q=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=b({type:o})}static{this.\u0275inj=y({imports:[v,U]})}}return o})();var O=(()=>{class o{constructor(){this.logger=I(Y)}fail(){this.logger.error("\u9A8C\u8BC1\u5931\u8D25")}refresh(){this.logger.warning("\u9A8C\u8BC1\u5237\u65B0")}success(){this.logger.success("\u9A8C\u8BC1\u6210\u529F")}static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275cmp=M({type:o,selectors:[["nzx-jigsaw-example"]],standalone:!0,features:[D],decls:1,vars:0,consts:[[3,"nzxOnFail","nzxOnRefresh","nzxOnSuccess"]],template:function(n,t){n&1&&(a(0,"nzx-jigsaw",0),u("nzxOnFail",function(){return t.fail()})("nzxOnRefresh",function(){return t.refresh()})("nzxOnSuccess",function(){return t.success()}),h())},dependencies:[v,Q,q,A],encapsulation:2})}}return o})();var $=(()=>{class o{static{this.\u0275fac=function(n){return new(n||o)}}static{this.\u0275mod=b({type:o})}static{this.\u0275inj=y({imports:[v,O]})}}return o})();var Ne={"nzx-jigsaw-jigsaw-example":O},Pe=$;export{Pe as EXAMPLES_MODULE,Ne as EXAMPLE_COMPONENTS};
