[{"path":"table-form/table-form.component.html","content":"<div class=\"container\">\n  <form nz-form [formGroup]=\"form\" (ngSubmit)=\"submit()\">\n    <nzx-table-form\n      #table=\"NzxTableForm\"\n      [nzxBordered]=\"true\"\n      nzxSize=\"small\"\n      [tableFormConfig]=\"tableFormConfig\"\n      [enableExpand]=\"true\"\n      [enableNo]=\"true\"\n      [nzxFooter]=\"footer\"\n      [errorTemplate]=\"errorTemp\"\n      [enableLimit]=\"true\"\n      [maxLimit]=\"2\"\n      [tableValidatorFn]=\"customValidate\"\n      (limitMessage)=\"errorMsg($event)\"\n      formControlName=\"students\"\n      [nzxFrontPagination]=\"false\"\n    >\n      <th colspan=\"8\">\n        <h1>学生信息表单(表头)</h1>\n      </th>\n\n      <ng-template\n        nzxTableFormTd\n        controlName=\"stars\"\n        let-formControl=\"formControl\"\n        let-config=\"config\"\n      >\n        <nz-form-item>\n          <nz-form-control [nzErrorTip]=\"config.errorTip\">\n            <nz-rate [formControl]=\"formControl\" nzAllowHalf></nz-rate>\n          </nz-form-control>\n        </nz-form-item>\n      </ng-template>\n\n      <ng-template nzxTableFormTh width=\"140px\" let-form>\n        <button\n          nz-button\n          nzType=\"primary\"\n          nzSize=\"small\"\n          nzShape=\"circle\"\n          type=\"button\"\n          [disabled]=\"form.disabled\"\n          (click)=\"table.addRow()\"\n        >\n          <span nz-icon nzType=\"plus\"></span>\n        </button>\n        /\n        <button\n          nz-button\n          nzSize=\"small\"\n          nzShape=\"circle\"\n          type=\"button\"\n          [disabled]=\"form.disabled\"\n          (click)=\"\n            table.addRow({\n              name: 'enochgao',\n              age: 18,\n              gender: 1,\n              address: '青岛',\n              stars: 1,\n              class: 1,\n              expand: true\n            })\n          \"\n        >\n          <span nz-icon nzType=\"plus\"></span>\n        </button>\n      </ng-template>\n\n      <ng-template nzxTableFormTd let-formGroup let-i=\"index\">\n        <a\n          nz-button\n          nzType=\"link\"\n          [disabled]=\"formGroup.disabled\"\n          (click)=\"table.deleteRow(i)\"\n          >删除</a\n        >\n        <a\n          nz-button\n          nzType=\"link\"\n          (click)=\"formGroup.get('expand').patchValue(!formGroup.value.expand)\"\n          >折叠</a\n        >\n      </ng-template>\n\n      <ng-template nzxTableFormExpand let-formGroup let-i=\"index\">\n        本行值为： {{ formGroup.value | json }}\n      </ng-template>\n    </nzx-table-form>\n  </form>\n\n  <ng-template #footer>\n    <h2>\n      页脚\n      <button\n        nz-button\n        nzType=\"primary\"\n        [disabled]=\"form.invalid || table.invalid\"\n      >\n        提交\n      </button>\n      <button nz-button type=\"button\" (click)=\"table.clearTable()\">\n        清空table\n      </button>\n      <button nz-button type=\"button\" nzType=\"dashed\" (click)=\"form.disable()\">\n        禁用table\n      </button>\n      <button nz-button type=\"button\" nzType=\"dashed\" (click)=\"form.enable()\">\n        启用table\n      </button>\n      <button\n        nz-button\n        type=\"button\"\n        nzType=\"primary\"\n        [nzLoading]=\"loading\"\n        (click)=\"lazyLoad()\"\n      >\n        远程加载下拉地址\n      </button>\n    </h2>\n  </ng-template>\n\n  <ng-template #errorTemp let-control>\n    <div class=\"right\">\n      <span [ngStyle]=\"{ color: 'red' }\">\n        {{ control?.errors?.tableError }}\n      </span>\n    </div>\n  </ng-template>\n\n  <pre>\n    表单值：\n  {{ form.value | json }}\n  </pre>\n\n  渲染只读：\n\n  <nzx-table-form\n    nzxSize=\"small\"\n    [nzxBordered]=\"true\"\n    [tableFormConfig]=\"tableFormConfig2\"\n    [enableExpand]=\"true\"\n    [(ngModel)]=\"students\"\n  >\n    <ng-template\n      nzxTableFormTd\n      controlName=\"stars\"\n      let-formControl=\"formControl\"\n      let-config=\"config\"\n    >\n      <nz-rate [formControl]=\"formControl\" nzAllowHalf nzDisabled></nz-rate>\n    </ng-template>\n\n    <ng-template nzxTableFormTh width=\"80px\">折叠 </ng-template>\n\n    <ng-template nzxTableFormTd let-formGroup let-i=\"index\">\n      <a\n        nz-button\n        nzType=\"link\"\n        (click)=\"formGroup.get('expand').patchValue(!formGroup.value.expand)\"\n        >折叠</a\n      >\n    </ng-template>\n\n    <ng-template nzxTableFormExpand let-formGroup let-i=\"index\">\n      本行值为： {{ formGroup.value | json }}\n    </ng-template>\n  </nzx-table-form>\n</div>\n"},{"path":"table-form/table-form.component.scss","content":"h1,\r\nh2 {\r\n  text-align: center;\r\n}\r\n\r\n.right {\r\n  text-align: right;\r\n}\r\n\r\n.container {\r\n  padding: 12px;\r\n  background-color: #ccc;\r\n}\r\n"},{"path":"table-form/table-form.component.ts","content":"import {\n  ChangeDetectionStrategy,\n  ChangeDetectorRef,\n  Component,\n  OnInit,\n  ViewChild,\n} from '@angular/core';\nimport {\n  AbstractControl,\n  FormBuilder,\n  FormGroup,\n  FormsModule,\n  ReactiveFormsModule,\n  Validators,\n} from '@angular/forms';\nimport { NzMessageModule, NzMessageService } from 'ng-zorro-antd/message';\n\nimport { NzxTableFormComponent } from 'ng-zorro-antd-extension/table-form';\nimport {\n  NzxLimitMessage,\n  NzxTableFormConfig,\n} from 'ng-zorro-antd-extension/table-form/type';\nimport { CommonModule } from '@angular/common';\nimport { NzIconModule } from 'ng-zorro-antd/icon';\nimport { NzFormModule } from 'ng-zorro-antd/form';\nimport { NzButtonModule } from 'ng-zorro-antd/button';\nimport { NzxPipesModule } from 'ng-zorro-antd-extension/pipes';\nimport { NzTableModule } from 'ng-zorro-antd/table';\nimport { NzRateModule } from 'ng-zorro-antd/rate';\nimport { NzxTableFormModule } from 'ng-zorro-antd-extension/table-form';\n\n@Component({\n  selector: 'nzx-table-form-demo',\n  templateUrl: './table-form.component.html',\n  styleUrls: ['./table-form.component.scss'],\n  changeDetection: ChangeDetectionStrategy.OnPush,\n  standalone: true,\n  imports: [\n    CommonModule,\n    FormsModule,\n    ReactiveFormsModule,\n    NzIconModule,\n    NzFormModule,\n    NzButtonModule,\n    NzxPipesModule,\n    NzTableModule,\n    NzRateModule,\n    NzMessageModule,\n    NzxTableFormModule,\n  ],\n})\nexport class NzxTableFormExampleComponent implements OnInit {\n  form: FormGroup;\n  form2: FormGroup;\n\n  tableFormConfig: NzxTableFormConfig[] = [\n    {\n      header: '姓名',\n      controlName: 'name',\n      showRequiredTip: true,\n      placeholder: '请输入姓名不超过10个字',\n      maxLength: 10,\n      type: 'input',\n      validation: [Validators.required],\n      errorTip: '必填,最多不超过10个字',\n    },\n    {\n      header: '年龄',\n      controlName: 'age',\n      defaultValue: 18,\n      type: 'number',\n      validation: [Validators.required],\n      errorTip: '必填',\n    },\n    {\n      header: '性别',\n      controlName: 'gender',\n      type: 'radio',\n      options: [\n        { label: '男', value: 1 },\n        { label: '女', value: 2 },\n      ],\n      defaultValue: 1,\n      validation: [Validators.required],\n      errorTip: '必填',\n    },\n    {\n      header: '地址',\n      controlName: 'address',\n      type: 'select',\n      options: [{ label: '青岛', value: '青岛' }],\n      validation: [Validators.required],\n      errorTip: '必填',\n    },\n    {\n      header: '小星星（自定义控件）',\n      controlName: 'stars',\n      type: 'template',\n      validation: [Validators.required],\n      errorTip: '必填',\n    },\n    {\n      header: '班级（readonly模式）',\n      controlName: 'class',\n      controlMode: 'readonly',\n      defaultValue: 1,\n      format: (value) => `${value}班`,\n    },\n  ];\n  tableFormConfig2: NzxTableFormConfig[] = [\n    {\n      header: '姓名',\n      controlName: 'name',\n      controlMode: 'readonly',\n    },\n\n    {\n      header: '年龄',\n      controlName: 'age',\n      controlMode: 'readonly',\n    },\n    {\n      header: '性别',\n      controlName: 'gender',\n      controlMode: 'readonly',\n      format: (value) => `${value === 1 ? '男' : '女'}`,\n    },\n    {\n      header: '地址',\n      controlName: 'address',\n      controlMode: 'readonly',\n    },\n    {\n      header: '小星星（自定义控件）',\n      controlName: 'stars',\n      controlMode: 'readonly',\n    },\n    {\n      header: '班级',\n      controlName: 'class',\n      controlMode: 'readonly',\n      format: (value) => `${value}班`,\n    },\n    {\n      header: 'id不在列表中展示',\n      controlName: 'id',\n      controlMode: 'readonly',\n      isShow: false,\n    },\n  ];\n\n  students: any[] = [];\n  loading = false;\n\n  @ViewChild('table') private table1!: NzxTableFormComponent;\n\n  constructor(\n    private fb: FormBuilder,\n    private logger: NzMessageService,\n    private cd: ChangeDetectorRef\n  ) {\n    this.form = this.fb.group({\n      students: [[], []],\n    });\n\n    this.form2 = this.fb.group({\n      students: [[], []],\n    });\n  }\n\n  ngOnInit(): void {\n    this.form.valueChanges.subscribe((res) => {\n      // console.log('value::', res);\n    });\n  }\n\n  lazyLoad() {\n    const list = [\n      { label: '青岛', value: '青岛' },\n      { label: '潍坊', value: '潍坊' },\n      { label: '烟台', value: '烟台' },\n    ];\n    this.loading = true;\n\n    setTimeout(() => {\n      this.table1.setConfig('address', { options: list });\n\n      this.loading = false;\n      this.cd.markForCheck();\n    }, 3000);\n  }\n\n  errorMsg(message: NzxLimitMessage) {\n    if (message.type === 'max') {\n      this.logger.warning(message.msg);\n    }\n  }\n\n  submit() {\n    const students = this.form.value.students as any[];\n    this.students = students.map((item: any, index: number) => {\n      return {\n        ...item,\n        id: index + 1,\n      };\n    });\n\n    console.log(this.students);\n  }\n\n  customValidate = (control: AbstractControl) => {\n    const valueList: Array<{ name: string }> = control.value;\n    const index = valueList.length - 1;\n    let lastItem = index > -1 ? valueList[index] : null;\n    const flag = valueList.some((item, i) => {\n      if (i !== index) {\n        return item.name === lastItem?.name;\n      }\n      return false;\n    });\n\n    if (flag) {\n      return { tableError: '姓名不能重复' };\n    }\n    return null;\n  };\n}\n"},{"path":"examples.module.ts","content":"import { NzxTableFormExampleComponent } from './table-form/table-form.component';\nimport { CommonModule } from '@angular/common';\nimport { NgModule } from '@angular/core';\n@NgModule({\n    declarations: [  ],\n    providers: [  ],\n    imports: [ CommonModule, NzxTableFormExampleComponent ],\n    exports: [  ]\n})\nexport class NzxTableFormExamplesModule {}\n"}]